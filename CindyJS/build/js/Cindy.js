/* CindyJS - (C) 2014-2015  The CindyJS Project
 * Mostly licensed under the Apache License 2.0, but subprojects may use different licensing.
 * See https://github.com/CindyJS/CindyJS/tree/$gitid$
 * for corresponding sources and their respective licensing conditions.
 */
'use strict';(function(){function r(b,c,d){f.biginteger_used=1;null!=b&&("number"==typeof b&&"undefined"==typeof c?this.fromInt(b):"number"==typeof b?this.fromNumber(b,c,d):null==c&&"string"!=typeof b?this.fromString(b,256):this.fromString(b,c))}function F(){return new r(null)}function Y(b,c,d,h,f,l){for(;0<=--l;){var x=c*this[b++]+d[h]+f;f=Math.floor(x/67108864);d[h++]=x&67108863}return f}function La(b,c,d,h,f,l){var x=c&32767;for(c>>=15;0<=--l;){var q=this[b]&32767,r=this[b++]>>15,C=c*q+r*x,q=x*
q+((C&32767)<<15)+d[h]+(f&1073741823);f=(q>>>30)+(C>>>15)+c*r+(f>>>30);d[h++]=q&1073741823}return f}function ya(b,c,d,h,f,l){var x=c&16383;for(c>>=14;0<=--l;){var q=this[b]&16383,r=this[b++]>>14,C=c*q+r*x,q=x*q+((C&16383)<<14)+d[h]+f;f=(q>>28)+(C>>14)+c*r;d[h++]=q&268435455}return f}function wa(b,c){var d=Ma[b.charCodeAt(c)];return null==d?-1:d}function ca(b){var c=F();c.fromInt(b);return c}function G(b){var c=1,d;0!=(d=b>>>16)&&(b=d,c+=16);0!=(d=b>>8)&&(b=d,c+=8);0!=(d=b>>4)&&(b=d,c+=4);0!=(d=b>>
2)&&(b=d,c+=2);0!=b>>1&&(c+=1);return c}function P(b){this.m=b}function q(b){this.m=b;this.mp=b.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<b.DB-15)-1;this.mt2=2*b.t}function O(b,c){return b&c}function K(b,c){return b|c}function Rb(b,c){return b^c}function Sb(b,c){return b&~c}function Za(){}function Tb(b){return b}function Da(b){this.r2=F();this.q3=F();r.ONE.dlShiftTo(2*b.t,this.r2);this.mu=this.r2.divide(b);this.m=b}var f={},Ua=!1;"undefined"!==typeof module&&module.exports?
(module.exports=f,Ua=!0):"undefined"!==typeof document?window.ClipperLib=f:self.ClipperLib=f;var V;if(Ua)S="chrome",V="Netscape";else{var S=navigator.userAgent.toString().toLowerCase();V=navigator.appName}var Na,za,Ea,Oa,Fa,Va;Na=-1!=S.indexOf("chrome")&&-1==S.indexOf("chromium")?1:0;Ua=-1!=S.indexOf("chromium")?1:0;za=-1!=S.indexOf("safari")&&-1==S.indexOf("chrome")&&-1==S.indexOf("chromium")?1:0;Ea=-1!=S.indexOf("firefox")?1:0;S.indexOf("firefox/17");S.indexOf("firefox/15");S.indexOf("firefox/3");
Oa=-1!=S.indexOf("opera")?1:0;S.indexOf("msie 10");S.indexOf("msie 9");Fa=-1!=S.indexOf("msie 8")?1:0;Va=-1!=S.indexOf("msie 7")?1:0;S=-1!=S.indexOf("msie ")?1:0;f.biginteger_used=null;"Microsoft Internet Explorer"==V?(r.prototype.am=La,V=30):"Netscape"!=V?(r.prototype.am=Y,V=26):(r.prototype.am=ya,V=28);r.prototype.DB=V;r.prototype.DM=(1<<V)-1;r.prototype.DV=1<<V;r.prototype.FV=Math.pow(2,52);r.prototype.F1=52-V;r.prototype.F2=2*V-52;var Ma=[],T;V=48;for(T=0;9>=T;++T)Ma[V++]=T;V=97;for(T=10;36>T;++T)Ma[V++]=
T;V=65;for(T=10;36>T;++T)Ma[V++]=T;P.prototype.convert=function(b){return 0>b.s||0<=b.compareTo(this.m)?b.mod(this.m):b};P.prototype.revert=function(b){return b};P.prototype.reduce=function(b){b.divRemTo(this.m,null,b)};P.prototype.mulTo=function(b,c,d){b.multiplyTo(c,d);this.reduce(d)};P.prototype.sqrTo=function(b,c){b.squareTo(c);this.reduce(c)};q.prototype.convert=function(b){var c=F();b.abs().dlShiftTo(this.m.t,c);c.divRemTo(this.m,null,c);0>b.s&&0<c.compareTo(r.ZERO)&&this.m.subTo(c,c);return c};
q.prototype.revert=function(b){var c=F();b.copyTo(c);this.reduce(c);return c};q.prototype.reduce=function(b){for(;b.t<=this.mt2;)b[b.t++]=0;for(var c=0;c<this.m.t;++c){var d=b[c]&32767,h=d*this.mpl+((d*this.mph+(b[c]>>15)*this.mpl&this.um)<<15)&b.DM,d=c+this.m.t;for(b[d]+=this.m.am(0,h,b,c,0,this.m.t);b[d]>=b.DV;)b[d]-=b.DV,b[++d]++}b.clamp();b.drShiftTo(this.m.t,b);0<=b.compareTo(this.m)&&b.subTo(this.m,b)};q.prototype.mulTo=function(b,c,d){b.multiplyTo(c,d);this.reduce(d)};q.prototype.sqrTo=function(b,
c){b.squareTo(c);this.reduce(c)};r.prototype.copyTo=function(b){for(var c=this.t-1;0<=c;--c)b[c]=this[c];b.t=this.t;b.s=this.s};r.prototype.fromInt=function(b){this.t=1;this.s=0>b?-1:0;0<b?this[0]=b:-1>b?this[0]=b+this.DV:this.t=0};r.prototype.fromString=function(b,c){var d;if(16==c)d=4;else if(8==c)d=3;else if(256==c)d=8;else if(2==c)d=1;else if(32==c)d=5;else if(4==c)d=2;else{this.fromRadix(b,c);return}this.s=this.t=0;for(var h=b.length,f=!1,l=0;0<=--h;){var x=8==d?b[h]&255:wa(b,h);0>x?"-"==b.charAt(h)&&
(f=!0):(f=!1,0==l?this[this.t++]=x:l+d>this.DB?(this[this.t-1]|=(x&(1<<this.DB-l)-1)<<l,this[this.t++]=x>>this.DB-l):this[this.t-1]|=x<<l,l+=d,l>=this.DB&&(l-=this.DB))}8==d&&0!=(b[0]&128)&&(this.s=-1,0<l&&(this[this.t-1]|=(1<<this.DB-l)-1<<l));this.clamp();f&&r.ZERO.subTo(this,this)};r.prototype.clamp=function(){for(var b=this.s&this.DM;0<this.t&&this[this.t-1]==b;)--this.t};r.prototype.dlShiftTo=function(b,c){var d;for(d=this.t-1;0<=d;--d)c[d+b]=this[d];for(d=b-1;0<=d;--d)c[d]=0;c.t=this.t+b;c.s=
this.s};r.prototype.drShiftTo=function(b,c){for(var d=b;d<this.t;++d)c[d-b]=this[d];c.t=Math.max(this.t-b,0);c.s=this.s};r.prototype.lShiftTo=function(b,c){var d=b%this.DB,h=this.DB-d,f=(1<<h)-1,l=Math.floor(b/this.DB),x=this.s<<d&this.DM,q;for(q=this.t-1;0<=q;--q)c[q+l+1]=this[q]>>h|x,x=(this[q]&f)<<d;for(q=l-1;0<=q;--q)c[q]=0;c[l]=x;c.t=this.t+l+1;c.s=this.s;c.clamp()};r.prototype.rShiftTo=function(b,c){c.s=this.s;var d=Math.floor(b/this.DB);if(d>=this.t)c.t=0;else{var h=b%this.DB,f=this.DB-h,l=
(1<<h)-1;c[0]=this[d]>>h;for(var x=d+1;x<this.t;++x)c[x-d-1]|=(this[x]&l)<<f,c[x-d]=this[x]>>h;0<h&&(c[this.t-d-1]|=(this.s&l)<<f);c.t=this.t-d;c.clamp()}};r.prototype.subTo=function(b,c){for(var d=0,h=0,f=Math.min(b.t,this.t);d<f;)h+=this[d]-b[d],c[d++]=h&this.DM,h>>=this.DB;if(b.t<this.t){for(h-=b.s;d<this.t;)h+=this[d],c[d++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;d<b.t;)h-=b[d],c[d++]=h&this.DM,h>>=this.DB;h-=b.s}c.s=0>h?-1:0;-1>h?c[d++]=this.DV+h:0<h&&(c[d++]=h);c.t=d;c.clamp()};
r.prototype.multiplyTo=function(b,c){var d=this.abs(),h=b.abs(),f=d.t;for(c.t=f+h.t;0<=--f;)c[f]=0;for(f=0;f<h.t;++f)c[f+d.t]=d.am(0,h[f],c,f,0,d.t);c.s=0;c.clamp();this.s!=b.s&&r.ZERO.subTo(c,c)};r.prototype.squareTo=function(b){for(var c=this.abs(),d=b.t=2*c.t;0<=--d;)b[d]=0;for(d=0;d<c.t-1;++d){var h=c.am(d,c[d],b,2*d,0,1);(b[d+c.t]+=c.am(d+1,2*c[d],b,2*d+1,h,c.t-d-1))>=c.DV&&(b[d+c.t]-=c.DV,b[d+c.t+1]=1)}0<b.t&&(b[b.t-1]+=c.am(d,c[d],b,2*d,0,1));b.s=0;b.clamp()};r.prototype.divRemTo=function(b,
c,d){var h=b.abs();if(!(0>=h.t)){var f=this.abs();if(f.t<h.t)null!=c&&c.fromInt(0),null!=d&&this.copyTo(d);else{null==d&&(d=F());var l=F(),x=this.s;b=b.s;var q=this.DB-G(h[h.t-1]);0<q?(h.lShiftTo(q,l),f.lShiftTo(q,d)):(h.copyTo(l),f.copyTo(d));h=l.t;f=l[h-1];if(0!=f){var ha=f*(1<<this.F1)+(1<h?l[h-2]>>this.F2:0),C=this.FV/ha,ha=(1<<this.F1)/ha,L=1<<this.F2,aa=d.t,O=aa-h,P=null==c?F():c;l.dlShiftTo(O,P);0<=d.compareTo(P)&&(d[d.t++]=1,d.subTo(P,d));r.ONE.dlShiftTo(h,P);for(P.subTo(l,l);l.t<h;)l[l.t++]=
0;for(;0<=--O;){var K=d[--aa]==f?this.DM:Math.floor(d[aa]*C+(d[aa-1]+L)*ha);if((d[aa]+=l.am(0,K,d,O,0,h))<K)for(l.dlShiftTo(O,P),d.subTo(P,d);d[aa]<--K;)d.subTo(P,d)}null!=c&&(d.drShiftTo(h,c),x!=b&&r.ZERO.subTo(c,c));d.t=h;d.clamp();0<q&&d.rShiftTo(q,d);0>x&&r.ZERO.subTo(d,d)}}}};r.prototype.invDigit=function(){if(1>this.t)return 0;var b=this[0];if(0==(b&1))return 0;var c=b&3,c=c*(2-(b&15)*c)&15,c=c*(2-(b&255)*c)&255,c=c*(2-((b&65535)*c&65535))&65535,c=c*(2-b*c%this.DV)%this.DV;return 0<c?this.DV-
c:-c};r.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};r.prototype.exp=function(b,c){if(4294967295<b||1>b)return r.ONE;var d=F(),h=F(),f=c.convert(this),l=G(b)-1;for(f.copyTo(d);0<=--l;)if(c.sqrTo(d,h),0<(b&1<<l))c.mulTo(h,f,d);else var x=d,d=h,h=x;return c.revert(d)};r.prototype.toString=function(b){if(0>this.s)return"-"+this.negate().toString(b);if(16==b)b=4;else if(8==b)b=3;else if(2==b)b=1;else if(32==b)b=5;else if(4==b)b=2;else return this.toRadix(b);var c=(1<<b)-1,d,h=!1,
f="",l=this.t,x=this.DB-l*this.DB%b;if(0<l--)for(x<this.DB&&0<(d=this[l]>>x)&&(h=!0,f="0123456789abcdefghijklmnopqrstuvwxyz".charAt(d));0<=l;)x<b?(d=(this[l]&(1<<x)-1)<<b-x,d|=this[--l]>>(x+=this.DB-b)):(d=this[l]>>(x-=b)&c,0>=x&&(x+=this.DB,--l)),0<d&&(h=!0),h&&(f+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(d));return h?f:"0"};r.prototype.negate=function(){var b=F();r.ZERO.subTo(this,b);return b};r.prototype.abs=function(){return 0>this.s?this.negate():this};r.prototype.compareTo=function(b){var c=
this.s-b.s;if(0!=c)return c;var d=this.t,c=d-b.t;if(0!=c)return 0>this.s?-c:c;for(;0<=--d;)if(0!=(c=this[d]-b[d]))return c;return 0};r.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+G(this[this.t-1]^this.s&this.DM)};r.prototype.mod=function(b){var c=F();this.abs().divRemTo(b,null,c);0>this.s&&0<c.compareTo(r.ZERO)&&b.subTo(c,c);return c};r.prototype.modPowInt=function(b,c){var d;d=256>b||c.isEven()?new P(c):new q(c);return this.exp(b,d)};r.ZERO=ca(0);r.ONE=ca(1);Za.prototype.convert=
Tb;Za.prototype.revert=Tb;Za.prototype.mulTo=function(b,c,d){b.multiplyTo(c,d)};Za.prototype.sqrTo=function(b,c){b.squareTo(c)};Da.prototype.convert=function(b){if(0>b.s||b.t>2*this.m.t)return b.mod(this.m);if(0>b.compareTo(this.m))return b;var c=F();b.copyTo(c);this.reduce(c);return c};Da.prototype.revert=function(b){return b};Da.prototype.reduce=function(b){b.drShiftTo(this.m.t-1,this.r2);b.t>this.m.t+1&&(b.t=this.m.t+1,b.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,
this.m.t+1,this.r2);0>b.compareTo(this.r2);)b.dAddOffset(1,this.m.t+1);for(b.subTo(this.r2,b);0<=b.compareTo(this.m);)b.subTo(this.m,b)};Da.prototype.mulTo=function(b,c,d){b.multiplyTo(c,d);this.reduce(d)};Da.prototype.sqrTo=function(b,c){b.squareTo(c);this.reduce(c)};var da=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,
313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Dc=67108864/da[da.length-1];r.prototype.chunkSize=function(b){return Math.floor(Math.LN2*
this.DB/Math.log(b))};r.prototype.toRadix=function(b){null==b&&(b=10);if(0==this.signum()||2>b||36<b)return"0";var c=this.chunkSize(b),c=Math.pow(b,c),d=ca(c),h=F(),f=F(),l="";for(this.divRemTo(d,h,f);0<h.signum();)l=(c+f.intValue()).toString(b).substr(1)+l,h.divRemTo(d,h,f);return f.intValue().toString(b)+l};r.prototype.fromRadix=function(b,c){this.fromInt(0);null==c&&(c=10);for(var d=this.chunkSize(c),h=Math.pow(c,d),f=!1,l=0,x=0,q=0;q<b.length;++q){var ha=wa(b,q);0>ha?"-"==b.charAt(q)&&0==this.signum()&&
(f=!0):(x=c*x+ha,++l>=d&&(this.dMultiply(h),this.dAddOffset(x,0),x=l=0))}0<l&&(this.dMultiply(Math.pow(c,l)),this.dAddOffset(x,0));f&&r.ZERO.subTo(this,this)};r.prototype.fromNumber=function(b,c,d){if("number"==typeof c)if(2>b)this.fromInt(1);else for(this.fromNumber(b,d),this.testBit(b-1)||this.bitwiseTo(r.ONE.shiftLeft(b-1),K,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(r.ONE.shiftLeft(b-1),this);else{d=[];var h=b&7;d.length=
(b>>3)+1;c.nextBytes(d);d[0]=0<h?d[0]&(1<<h)-1:0;this.fromString(d,256)}};r.prototype.bitwiseTo=function(b,c,d){var h,f,l=Math.min(b.t,this.t);for(h=0;h<l;++h)d[h]=c(this[h],b[h]);if(b.t<this.t){f=b.s&this.DM;for(h=l;h<this.t;++h)d[h]=c(this[h],f);d.t=this.t}else{f=this.s&this.DM;for(h=l;h<b.t;++h)d[h]=c(f,b[h]);d.t=b.t}d.s=c(this.s,b.s);d.clamp()};r.prototype.changeBit=function(b,c){var d=r.ONE.shiftLeft(b);this.bitwiseTo(d,c,d);return d};r.prototype.addTo=function(b,c){for(var d=0,h=0,f=Math.min(b.t,
this.t);d<f;)h+=this[d]+b[d],c[d++]=h&this.DM,h>>=this.DB;if(b.t<this.t){for(h+=b.s;d<this.t;)h+=this[d],c[d++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;d<b.t;)h+=b[d],c[d++]=h&this.DM,h>>=this.DB;h+=b.s}c.s=0>h?-1:0;0<h?c[d++]=h:-1>h&&(c[d++]=this.DV+h);c.t=d;c.clamp()};r.prototype.dMultiply=function(b){this[this.t]=this.am(0,b-1,this,0,0,this.t);++this.t;this.clamp()};r.prototype.dAddOffset=function(b,c){if(0!=b){for(;this.t<=c;)this[this.t++]=0;for(this[c]+=b;this[c]>=this.DV;)this[c]-=
this.DV,++c>=this.t&&(this[this.t++]=0),++this[c]}};r.prototype.multiplyLowerTo=function(b,c,d){var h=Math.min(this.t+b.t,c);d.s=0;for(d.t=h;0<h;)d[--h]=0;var f;for(f=d.t-this.t;h<f;++h)d[h+this.t]=this.am(0,b[h],d,h,0,this.t);for(f=Math.min(b.t,c);h<f;++h)this.am(0,b[h],d,h,0,c-h);d.clamp()};r.prototype.multiplyUpperTo=function(b,c,d){--c;var h=d.t=this.t+b.t-c;for(d.s=0;0<=--h;)d[h]=0;for(h=Math.max(c-this.t,0);h<b.t;++h)d[this.t+h-c]=this.am(c-h,b[h],d,0,0,this.t+h-c);d.clamp();d.drShiftTo(1,d)};
r.prototype.modInt=function(b){if(0>=b)return 0;var c=this.DV%b,d=0>this.s?b-1:0;if(0<this.t)if(0==c)d=this[0]%b;else for(var h=this.t-1;0<=h;--h)d=(c*d+this[h])%b;return d};r.prototype.millerRabin=function(b){var c=this.subtract(r.ONE),d=c.getLowestSetBit();if(0>=d)return!1;var h=c.shiftRight(d);b=b+1>>1;b>da.length&&(b=da.length);for(var f=F(),l=0;l<b;++l){f.fromInt(da[Math.floor(Math.random()*da.length)]);var x=f.modPow(h,this);if(0!=x.compareTo(r.ONE)&&0!=x.compareTo(c)){for(var q=1;q++<d&&0!=
x.compareTo(c);)if(x=x.modPowInt(2,this),0==x.compareTo(r.ONE))return!1;if(0!=x.compareTo(c))return!1}}return!0};r.prototype.clone=function(){var b=F();this.copyTo(b);return b};r.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};r.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};r.prototype.shortValue=function(){return 0==
this.t?this.s:this[0]<<16>>16};r.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};r.prototype.toByteArray=function(){var b=this.t,c=[];c[0]=this.s;var d=this.DB-b*this.DB%8,h,f=0;if(0<b--)for(d<this.DB&&(h=this[b]>>d)!=(this.s&this.DM)>>d&&(c[f++]=h|this.s<<this.DB-d);0<=b;)if(8>d?(h=(this[b]&(1<<d)-1)<<8-d,h|=this[--b]>>(d+=this.DB-8)):(h=this[b]>>(d-=8)&255,0>=d&&(d+=this.DB,--b)),0!=(h&128)&&(h|=-256),0==f&&(this.s&128)!=(h&128)&&++f,0<f||h!=this.s)c[f++]=h;
return c};r.prototype.equals=function(b){return 0==this.compareTo(b)};r.prototype.min=function(b){return 0>this.compareTo(b)?this:b};r.prototype.max=function(b){return 0<this.compareTo(b)?this:b};r.prototype.and=function(b){var c=F();this.bitwiseTo(b,O,c);return c};r.prototype.or=function(b){var c=F();this.bitwiseTo(b,K,c);return c};r.prototype.xor=function(b){var c=F();this.bitwiseTo(b,Rb,c);return c};r.prototype.andNot=function(b){var c=F();this.bitwiseTo(b,Sb,c);return c};r.prototype.not=function(){for(var b=
F(),c=0;c<this.t;++c)b[c]=this.DM&~this[c];b.t=this.t;b.s=~this.s;return b};r.prototype.shiftLeft=function(b){var c=F();0>b?this.rShiftTo(-b,c):this.lShiftTo(b,c);return c};r.prototype.shiftRight=function(b){var c=F();0>b?this.lShiftTo(-b,c):this.rShiftTo(b,c);return c};r.prototype.getLowestSetBit=function(){for(var b=0;b<this.t;++b)if(0!=this[b]){var c=b*this.DB,b=this[b];if(0==b)b=-1;else{var d=0;0==(b&65535)&&(b>>=16,d+=16);0==(b&255)&&(b>>=8,d+=8);0==(b&15)&&(b>>=4,d+=4);0==(b&3)&&(b>>=2,d+=2);
0==(b&1)&&++d;b=d}return c+b}return 0>this.s?this.t*this.DB:-1};r.prototype.bitCount=function(){for(var b=0,c=this.s&this.DM,d=0;d<this.t;++d){for(var h=this[d]^c,f=0;0!=h;)h&=h-1,++f;b+=f}return b};r.prototype.testBit=function(b){var c=Math.floor(b/this.DB);return c>=this.t?0!=this.s:0!=(this[c]&1<<b%this.DB)};r.prototype.setBit=function(b){return this.changeBit(b,K)};r.prototype.clearBit=function(b){return this.changeBit(b,Sb)};r.prototype.flipBit=function(b){return this.changeBit(b,Rb)};r.prototype.add=
function(b){var c=F();this.addTo(b,c);return c};r.prototype.subtract=function(b){var c=F();this.subTo(b,c);return c};r.prototype.multiply=function(b){var c=F();this.multiplyTo(b,c);return c};r.prototype.divide=function(b){var c=F();this.divRemTo(b,c,null);return c};r.prototype.remainder=function(b){var c=F();this.divRemTo(b,null,c);return c};r.prototype.divideAndRemainder=function(b){var c=F(),d=F();this.divRemTo(b,c,d);return[c,d]};r.prototype.modPow=function(b,c){var d=b.bitLength(),h,f=ca(1),l;
if(0>=d)return f;h=18>d?1:48>d?3:144>d?4:768>d?5:6;l=8>d?new P(c):c.isEven()?new Da(c):new q(c);var x=[],r=3,ha=h-1,C=(1<<h)-1;x[1]=l.convert(this);if(1<h)for(d=F(),l.sqrTo(x[1],d);r<=C;)x[r]=F(),l.mulTo(d,x[r-2],x[r]),r+=2;for(var L=b.t-1,aa,O=!0,K=F(),d=G(b[L])-1;0<=L;){d>=ha?aa=b[L]>>d-ha&C:(aa=(b[L]&(1<<d+1)-1)<<ha-d,0<L&&(aa|=b[L-1]>>this.DB+d-ha));for(r=h;0==(aa&1);)aa>>=1,--r;0>(d-=r)&&(d+=this.DB,--L);if(O)x[aa].copyTo(f),O=!1;else{for(;1<r;)l.sqrTo(f,K),l.sqrTo(K,f),r-=2;0<r?l.sqrTo(f,K):
(r=f,f=K,K=r);l.mulTo(K,x[aa],f)}for(;0<=L&&0==(b[L]&1<<d);)l.sqrTo(f,K),r=f,f=K,K=r,0>--d&&(d=this.DB-1,--L)}return l.revert(f)};r.prototype.modInverse=function(b){var c=b.isEven();if(this.isEven()&&c||0==b.signum())return r.ZERO;for(var d=b.clone(),h=this.clone(),f=ca(1),l=ca(0),x=ca(0),q=ca(1);0!=d.signum();){for(;d.isEven();)d.rShiftTo(1,d),c?(f.isEven()&&l.isEven()||(f.addTo(this,f),l.subTo(b,l)),f.rShiftTo(1,f)):l.isEven()||l.subTo(b,l),l.rShiftTo(1,l);for(;h.isEven();)h.rShiftTo(1,h),c?(x.isEven()&&
q.isEven()||(x.addTo(this,x),q.subTo(b,q)),x.rShiftTo(1,x)):q.isEven()||q.subTo(b,q),q.rShiftTo(1,q);0<=d.compareTo(h)?(d.subTo(h,d),c&&f.subTo(x,f),l.subTo(q,l)):(h.subTo(d,h),c&&x.subTo(f,x),q.subTo(l,q))}if(0!=h.compareTo(r.ONE))return r.ZERO;if(0<=q.compareTo(b))return q.subtract(b);if(0>q.signum())q.addTo(b,q);else return q;return 0>q.signum()?q.add(b):q};r.prototype.pow=function(b){return this.exp(b,new Za)};r.prototype.gcd=function(b){var c=0>this.s?this.negate():this.clone();b=0>b.s?b.negate():
b.clone();if(0>c.compareTo(b)){var d=c,c=b;b=d}var d=c.getLowestSetBit(),h=b.getLowestSetBit();if(0>h)return c;d<h&&(h=d);for(0<h&&(c.rShiftTo(h,c),b.rShiftTo(h,b));0<c.signum();)0<(d=c.getLowestSetBit())&&c.rShiftTo(d,c),0<(d=b.getLowestSetBit())&&b.rShiftTo(d,b),0<=c.compareTo(b)?(c.subTo(b,c),c.rShiftTo(1,c)):(b.subTo(c,b),b.rShiftTo(1,b));0<h&&b.lShiftTo(h,b);return b};r.prototype.isProbablePrime=function(b){var c,d=this.abs();if(1==d.t&&d[0]<=da[da.length-1]){for(c=0;c<da.length;++c)if(d[0]==
da[c])return!0;return!1}if(d.isEven())return!1;for(c=1;c<da.length;){for(var h=da[c],f=c+1;f<da.length&&h<Dc;)h*=da[f++];for(h=d.modInt(h);c<f;)if(0==h%da[c++])return!1}return d.millerRabin(b)};r.prototype.square=function(){var b=F();this.squareTo(b);return b};r.prototype.IsNegative=function(){return-1==this.compareTo(r.ZERO)?!0:!1};r.op_Equality=function(b,c){return 0==b.compareTo(c)?!0:!1};r.op_Inequality=function(b,c){return 0!=b.compareTo(c)?!0:!1};r.op_GreaterThan=function(b,c){return 0<b.compareTo(c)?
!0:!1};r.op_LessThan=function(b,c){return 0>b.compareTo(c)?!0:!1};r.op_Addition=function(b,c){return(new r(b)).add(new r(c))};r.op_Subtraction=function(b,c){return(new r(b)).subtract(new r(c))};r.Int128Mul=function(b,c){return(new r(b)).multiply(new r(c))};r.op_Division=function(b,c){return b.divide(c)};r.prototype.ToDouble=function(){return parseFloat(this.toString())};if("undefined"==typeof Pa)var Pa=function(b,c){var d;if("undefined"==typeof Object.getOwnPropertyNames)for(d in c.prototype){if("undefined"==
typeof b.prototype[d]||b.prototype[d]==Object.prototype[d])b.prototype[d]=c.prototype[d]}else for(var h=Object.getOwnPropertyNames(c.prototype),f=0;f<h.length;f++)"undefined"==typeof Object.getOwnPropertyDescriptor(b.prototype,h[f])&&Object.defineProperty(b.prototype,h[f],Object.getOwnPropertyDescriptor(c.prototype,h[f]));for(d in c)"undefined"==typeof b[d]&&(b[d]=c[d]);b.$baseCtor=c};f.Path=function(){return[]};f.Paths=function(){return[]};f.DoublePoint=function(){var b=arguments;this.Y=this.X=0;
1==b.length?(this.X=b[0].X,this.Y=b[0].Y):2==b.length&&(this.X=b[0],this.Y=b[1])};f.DoublePoint0=function(){this.Y=this.X=0};f.DoublePoint1=function(b){this.X=b.X;this.Y=b.Y};f.DoublePoint2=function(b,c){this.X=b;this.Y=c};f.PolyNode=function(){this.m_Parent=null;this.m_polygon=new f.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};f.PolyNode.prototype.IsHoleNode=function(){for(var b=!0,c=this.m_Parent;null!==c;)b=!b,c=c.m_Parent;return b};f.PolyNode.prototype.ChildCount=
function(){return this.m_Childs.length};f.PolyNode.prototype.Contour=function(){return this.m_polygon};f.PolyNode.prototype.AddChild=function(b){var c=this.m_Childs.length;this.m_Childs.push(b);b.m_Parent=this;b.m_Index=c};f.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};f.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+
1]};f.PolyNode.prototype.Childs=function(){return this.m_Childs};f.PolyNode.prototype.Parent=function(){return this.m_Parent};f.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};f.PolyTree=function(){this.m_AllPolys=[];f.PolyNode.call(this)};f.PolyTree.prototype.Clear=function(){for(var b=0,c=this.m_AllPolys.length;b<c;b++)this.m_AllPolys[b]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};f.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};
f.PolyTree.prototype.Total=function(){return this.m_AllPolys.length};Pa(f.PolyTree,f.PolyNode);f.Math_Abs_Int64=f.Math_Abs_Int32=f.Math_Abs_Double=function(b){return Math.abs(b)};f.Math_Max_Int32_Int32=function(b,c){return Math.max(b,c)};f.Cast_Int32=S||Oa||za?function(b){return b|0}:function(b){return~~b};f.Cast_Int64=Na?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):~~b}:Ea&&"function"==typeof Number.toInteger?function(b){return Number.toInteger(b)}:Va||Fa?function(b){return parseInt(b,
10)}:S?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):b|0}:function(b){return 0>b?Math.ceil(b):Math.floor(b)};f.Clear=function(b){b.length=0};f.PI=3.141592653589793;f.PI2=6.283185307179586;f.IntPoint=function(){var b;b=arguments;var c=b.length;this.Y=this.X=0;2==c?(this.X=b[0],this.Y=b[1]):1==c?b[0]instanceof f.DoublePoint?(b=b[0],this.X=f.Clipper.Round(b.X),this.Y=f.Clipper.Round(b.Y)):(b=b[0],this.X=b.X,this.Y=b.Y):this.Y=this.X=0};f.IntPoint.op_Equality=function(b,
c){return b.X==c.X&&b.Y==c.Y};f.IntPoint.op_Inequality=function(b,c){return b.X!=c.X||b.Y!=c.Y};f.IntPoint0=function(){this.Y=this.X=0};f.IntPoint1=function(b){this.X=b.X;this.Y=b.Y};f.IntPoint1dp=function(b){this.X=f.Clipper.Round(b.X);this.Y=f.Clipper.Round(b.Y)};f.IntPoint2=function(b,c){this.X=b;this.Y=c};f.IntRect=function(){var b=arguments,c=b.length;4==c?(this.left=b[0],this.top=b[1],this.right=b[2],this.bottom=b[3]):1==c?(this.left=b[0].left,this.top=b[0].top,this.right=b[0].right,this.bottom=
b[0].bottom):this.bottom=this.right=this.top=this.left=0};f.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};f.IntRect1=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};f.IntRect4=function(b,c,d,h){this.left=b;this.top=c;this.right=d;this.bottom=h};f.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};f.PolyType={ptSubject:0,ptClip:1};f.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};f.JoinType={jtSquare:0,jtRound:1,
jtMiter:2};f.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};f.EdgeSide={esLeft:0,esRight:1};f.Direction={dRightToLeft:0,dLeftToRight:1};f.TEdge=function(){this.Bot=new f.IntPoint;this.Curr=new f.IntPoint;this.Top=new f.IntPoint;this.Delta=new f.IntPoint;this.Dx=0;this.PolyTyp=f.PolyType.ptSubject;this.Side=f.EdgeSide.esLeft;this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=
this.Next=null};f.IntersectNode=function(){this.Edge2=this.Edge1=null;this.Pt=new f.IntPoint};f.MyIntersectNodeSort=function(){};f.MyIntersectNodeSort.Compare=function(b,c){return c.Pt.Y-b.Pt.Y};f.LocalMinima=function(){this.Y=0;this.Next=this.RightBound=this.LeftBound=null};f.Scanbeam=function(){this.Y=0;this.Next=null};f.OutRec=function(){this.Idx=0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};f.OutPt=function(){this.Idx=0;this.Pt=new f.IntPoint;this.Prev=
this.Next=null};f.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=new f.IntPoint};f.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};f.ClipperBase.horizontal=-9007199254740992;f.ClipperBase.Skip=-2;f.ClipperBase.Unassigned=-1;f.ClipperBase.tolerance=1E-20;f.ClipperBase.loRange=47453132;f.ClipperBase.hiRange=0xfffffffffffff;
f.ClipperBase.near_zero=function(b){return b>-f.ClipperBase.tolerance&&b<f.ClipperBase.tolerance};f.ClipperBase.IsHorizontal=function(b){return 0===b.Delta.Y};f.ClipperBase.prototype.PointIsVertex=function(b,c){var d=c;do{if(f.IntPoint.op_Equality(d.Pt,b))return!0;d=d.Next}while(d!=c);return!1};f.ClipperBase.prototype.PointOnLineSegment=function(b,c,d,h){return h?b.X==c.X&&b.Y==c.Y||b.X==d.X&&b.Y==d.Y||b.X>c.X==b.X<d.X&&b.Y>c.Y==b.Y<d.Y&&r.op_Equality(r.Int128Mul(b.X-c.X,d.Y-c.Y),r.Int128Mul(d.X-
c.X,b.Y-c.Y)):b.X==c.X&&b.Y==c.Y||b.X==d.X&&b.Y==d.Y||b.X>c.X==b.X<d.X&&b.Y>c.Y==b.Y<d.Y&&(b.X-c.X)*(d.Y-c.Y)==(d.X-c.X)*(b.Y-c.Y)};f.ClipperBase.prototype.PointOnPolygon=function(b,c,d){for(var h=c;;){if(this.PointOnLineSegment(b,h.Pt,h.Next.Pt,d))return!0;h=h.Next;if(h==c)break}return!1};f.ClipperBase.prototype.SlopesEqual=f.ClipperBase.SlopesEqual=function(){var b=arguments,c=b.length,d,h,m;if(3==c)return c=b[0],d=b[1],b[2]?r.op_Equality(r.Int128Mul(c.Delta.Y,d.Delta.X),r.Int128Mul(c.Delta.X,d.Delta.Y)):
f.Cast_Int64(c.Delta.Y*d.Delta.X)==f.Cast_Int64(c.Delta.X*d.Delta.Y);if(4==c)return c=b[0],d=b[1],h=b[2],b[3]?r.op_Equality(r.Int128Mul(c.Y-d.Y,d.X-h.X),r.Int128Mul(c.X-d.X,d.Y-h.Y)):0===f.Cast_Int64((c.Y-d.Y)*(d.X-h.X))-f.Cast_Int64((c.X-d.X)*(d.Y-h.Y));c=b[0];d=b[1];h=b[2];m=b[3];return b[4]?r.op_Equality(r.Int128Mul(c.Y-d.Y,h.X-m.X),r.Int128Mul(c.X-d.X,h.Y-m.Y)):0===f.Cast_Int64((c.Y-d.Y)*(h.X-m.X))-f.Cast_Int64((c.X-d.X)*(h.Y-m.Y))};f.ClipperBase.SlopesEqual3=function(b,c,d){return d?r.op_Equality(r.Int128Mul(b.Delta.Y,
c.Delta.X),r.Int128Mul(b.Delta.X,c.Delta.Y)):f.Cast_Int64(b.Delta.Y*c.Delta.X)==f.Cast_Int64(b.Delta.X*c.Delta.Y)};f.ClipperBase.SlopesEqual4=function(b,c,d,h){return h?r.op_Equality(r.Int128Mul(b.Y-c.Y,c.X-d.X),r.Int128Mul(b.X-c.X,c.Y-d.Y)):0===f.Cast_Int64((b.Y-c.Y)*(c.X-d.X))-f.Cast_Int64((b.X-c.X)*(c.Y-d.Y))};f.ClipperBase.SlopesEqual5=function(b,c,d,h,m){return m?r.op_Equality(r.Int128Mul(b.Y-c.Y,d.X-h.X),r.Int128Mul(b.X-c.X,d.Y-h.Y)):0===f.Cast_Int64((b.Y-c.Y)*(d.X-h.X))-f.Cast_Int64((b.X-c.X)*
(d.Y-h.Y))};f.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var b=0,c=this.m_edges.length;b<c;++b){for(var d=0,h=this.m_edges[b].length;d<h;++d)this.m_edges[b][d]=null;f.Clear(this.m_edges[b])}f.Clear(this.m_edges);this.m_HasOpenPaths=this.m_UseFullRange=!1};f.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var b=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=b}this.m_CurrentLM=null};f.ClipperBase.prototype.RangeTest=
function(b,c){if(c.Value)(b.X>f.ClipperBase.hiRange||b.Y>f.ClipperBase.hiRange||-b.X>f.ClipperBase.hiRange||-b.Y>f.ClipperBase.hiRange)&&f.Error("Coordinate outside allowed range in RangeTest().");else if(b.X>f.ClipperBase.loRange||b.Y>f.ClipperBase.loRange||-b.X>f.ClipperBase.loRange||-b.Y>f.ClipperBase.loRange)c.Value=!0,this.RangeTest(b,c)};f.ClipperBase.prototype.InitEdge=function(b,c,d,h){b.Next=c;b.Prev=d;b.Curr.X=h.X;b.Curr.Y=h.Y;b.OutIdx=-1};f.ClipperBase.prototype.InitEdge2=function(b,c){b.Curr.Y>=
b.Next.Curr.Y?(b.Bot.X=b.Curr.X,b.Bot.Y=b.Curr.Y,b.Top.X=b.Next.Curr.X,b.Top.Y=b.Next.Curr.Y):(b.Top.X=b.Curr.X,b.Top.Y=b.Curr.Y,b.Bot.X=b.Next.Curr.X,b.Bot.Y=b.Next.Curr.Y);this.SetDx(b);b.PolyTyp=c};f.ClipperBase.prototype.FindNextLocMin=function(b){for(var c;;){for(;f.IntPoint.op_Inequality(b.Bot,b.Prev.Bot)||f.IntPoint.op_Equality(b.Curr,b.Top);)b=b.Next;if(b.Dx!=f.ClipperBase.horizontal&&b.Prev.Dx!=f.ClipperBase.horizontal)break;for(;b.Prev.Dx==f.ClipperBase.horizontal;)b=b.Prev;for(c=b;b.Dx==
f.ClipperBase.horizontal;)b=b.Next;if(b.Top.Y!=b.Prev.Bot.Y){c.Prev.Bot.X<b.Bot.X&&(b=c);break}}return b};f.ClipperBase.prototype.ProcessBound=function(b,c){var d=b,h=b,m;b.Dx==f.ClipperBase.horizontal&&(m=c?b.Prev.Bot.X:b.Next.Bot.X,b.Bot.X!=m&&this.ReverseHorizontal(b));if(h.OutIdx!=f.ClipperBase.Skip)if(c){for(;h.Top.Y==h.Next.Bot.Y&&h.Next.OutIdx!=f.ClipperBase.Skip;)h=h.Next;if(h.Dx==f.ClipperBase.horizontal&&h.Next.OutIdx!=f.ClipperBase.Skip){for(m=h;m.Prev.Dx==f.ClipperBase.horizontal;)m=m.Prev;
m.Prev.Top.X==h.Next.Top.X?c||(h=m.Prev):m.Prev.Top.X>h.Next.Top.X&&(h=m.Prev)}for(;b!=h;)b.NextInLML=b.Next,b.Dx==f.ClipperBase.horizontal&&b!=d&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;b.Dx==f.ClipperBase.horizontal&&b!=d&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b);h=h.Next}else{for(;h.Top.Y==h.Prev.Bot.Y&&h.Prev.OutIdx!=f.ClipperBase.Skip;)h=h.Prev;if(h.Dx==f.ClipperBase.horizontal&&h.Prev.OutIdx!=f.ClipperBase.Skip){for(m=h;m.Next.Dx==f.ClipperBase.horizontal;)m=m.Next;
m.Next.Top.X==h.Prev.Top.X?c||(h=m.Next):m.Next.Top.X>h.Prev.Top.X&&(h=m.Next)}for(;b!=h;)b.NextInLML=b.Prev,b.Dx==f.ClipperBase.horizontal&&b!=d&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b),b=b.Prev;b.Dx==f.ClipperBase.horizontal&&b!=d&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b);h=h.Prev}if(h.OutIdx==f.ClipperBase.Skip){b=h;if(c){for(;b.Top.Y==b.Next.Bot.Y;)b=b.Next;for(;b!=h&&b.Dx==f.ClipperBase.horizontal;)b=b.Prev}else{for(;b.Top.Y==b.Prev.Bot.Y;)b=b.Prev;for(;b!=h&&b.Dx==f.ClipperBase.horizontal;)b=
b.Next}b==h?h=c?b.Next:b.Prev:(b=c?h.Next:h.Prev,d=new f.LocalMinima,d.Next=null,d.Y=b.Bot.Y,d.LeftBound=null,d.RightBound=b,d.RightBound.WindDelta=0,h=this.ProcessBound(d.RightBound,c),this.InsertLocalMinima(d))}return h};f.ClipperBase.prototype.AddPath=function(b,c,d){d||c!=f.PolyType.ptClip||f.Error("AddPath: Open paths must be subject.");var h=b.length-1;if(d)for(;0<h&&f.IntPoint.op_Equality(b[h],b[0]);)--h;for(;0<h&&f.IntPoint.op_Equality(b[h],b[h-1]);)--h;if(d&&2>h||!d&&1>h)return!1;for(var m=
[],l=0;l<=h;l++)m.push(new f.TEdge);var x=!0;try{for(m[1].Curr.X=b[1].X,m[1].Curr.Y=b[1].Y,function(){var c={Value:this.m_UseFullRange},d=this.RangeTest(b[0],c);this.m_UseFullRange=c.Value;return d}.call(this),function(){var c={Value:this.m_UseFullRange},d=this.RangeTest(b[h],c);this.m_UseFullRange=c.Value;return d}.call(this),this.InitEdge(m[0],m[1],m[h],b[0]),this.InitEdge(m[h],m[0],m[h-1],b[h]),l=h-1;1<=l;--l)(function(){var c={Value:this.m_UseFullRange},d=this.RangeTest(b[l],c);this.m_UseFullRange=
c.Value;return d}).call(this),this.InitEdge(m[l],m[l+1],m[l-1],b[l])}catch(q){return!1}var r=m[0];d||(r.Prev.OutIdx=f.ClipperBase.Skip);for(var C=r,G=r;;)if(f.IntPoint.op_Equality(C.Curr,C.Next.Curr)){if(C==C.Next)break;C==r&&(r=C.Next);G=C=this.RemoveEdge(C)}else{if(C.Prev==C.Next)break;else if(d&&f.ClipperBase.SlopesEqual(C.Prev.Curr,C.Curr,C.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(C.Prev.Curr,C.Curr,C.Next.Curr))){C==r&&(r=C.Next);C=this.RemoveEdge(C);
G=C=C.Prev;continue}C=C.Next;if(C==G)break}if(!d&&C==C.Next||d&&C.Prev==C.Next)return!1;d||(this.m_HasOpenPaths=!0);C=r;do this.InitEdge2(C,c),C=C.Next,x&&C.Curr.Y!=r.Curr.Y&&(x=!1);while(C!=r);if(x){if(d)return!1;C.Prev.OutIdx=f.ClipperBase.Skip;C.Prev.Bot.X<C.Prev.Top.X&&this.ReverseHorizontal(C.Prev);c=new f.LocalMinima;c.Next=null;c.Y=C.Bot.Y;c.LeftBound=null;c.RightBound=C;c.RightBound.Side=f.EdgeSide.esRight;for(c.RightBound.WindDelta=0;C.Next.OutIdx!=f.ClipperBase.Skip;)C.NextInLML=C.Next,
C.Bot.X!=C.Prev.Top.X&&this.ReverseHorizontal(C),C=C.Next;this.InsertLocalMinima(c);this.m_edges.push(m);return!0}this.m_edges.push(m);for(x=null;;){C=this.FindNextLocMin(C);if(C==x)break;else null==x&&(x=C);c=new f.LocalMinima;c.Next=null;c.Y=C.Bot.Y;C.Dx<C.Prev.Dx?(c.LeftBound=C.Prev,c.RightBound=C,m=!1):(c.LeftBound=C,c.RightBound=C.Prev,m=!0);c.LeftBound.Side=f.EdgeSide.esLeft;c.RightBound.Side=f.EdgeSide.esRight;c.LeftBound.WindDelta=d?c.LeftBound.Next==c.RightBound?-1:1:0;c.RightBound.WindDelta=
-c.LeftBound.WindDelta;C=this.ProcessBound(c.LeftBound,m);r=this.ProcessBound(c.RightBound,!m);c.LeftBound.OutIdx==f.ClipperBase.Skip?c.LeftBound=null:c.RightBound.OutIdx==f.ClipperBase.Skip&&(c.RightBound=null);this.InsertLocalMinima(c);m||(C=r)}return!0};f.ClipperBase.prototype.AddPaths=function(b,c,d){for(var h=!1,f=0,l=b.length;f<l;++f)this.AddPath(b[f],c,d)&&(h=!0);return h};f.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(b,c,d){return f.IntPoint.op_Equality(b,d)||f.IntPoint.op_Equality(b,
c)||f.IntPoint.op_Equality(d,c)?!1:b.X!=d.X?c.X>b.X==c.X<d.X:c.Y>b.Y==c.Y<d.Y};f.ClipperBase.prototype.RemoveEdge=function(b){b.Prev.Next=b.Next;b.Next.Prev=b.Prev;var c=b.Next;b.Prev=null;return c};f.ClipperBase.prototype.SetDx=function(b){b.Delta.X=b.Top.X-b.Bot.X;b.Delta.Y=b.Top.Y-b.Bot.Y;b.Dx=0===b.Delta.Y?f.ClipperBase.horizontal:b.Delta.X/b.Delta.Y};f.ClipperBase.prototype.InsertLocalMinima=function(b){if(null===this.m_MinimaList)this.m_MinimaList=b;else if(b.Y>=this.m_MinimaList.Y)b.Next=this.m_MinimaList,
this.m_MinimaList=b;else{for(var c=this.m_MinimaList;null!==c.Next&&b.Y<c.Next.Y;)c=c.Next;b.Next=c.Next;c.Next=b}};f.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};f.ClipperBase.prototype.ReverseHorizontal=function(b){var c=b.Top.X;b.Top.X=b.Bot.X;b.Bot.X=c};f.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var b=this.m_MinimaList;null!=b;){var c=b.LeftBound;null!=c&&(c.Curr.X=
c.Bot.X,c.Curr.Y=c.Bot.Y,c.Side=f.EdgeSide.esLeft,c.OutIdx=f.ClipperBase.Unassigned);c=b.RightBound;null!=c&&(c.Curr.X=c.Bot.X,c.Curr.Y=c.Bot.Y,c.Side=f.EdgeSide.esRight,c.OutIdx=f.ClipperBase.Unassigned);b=b.Next}};f.Clipper=function(b){"undefined"==typeof b&&(b=0);this.m_PolyOuts=null;this.m_ClipType=f.ClipType.ctIntersection;this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=!1;this.m_SubjFillType=this.m_ClipFillType=
f.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;f.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=f.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&b);this.StrictlySimple=0!==(2&b);this.PreserveCollinear=0!==(4&b)};f.Clipper.ioReverseSolution=
1;f.Clipper.ioStrictlySimple=2;f.Clipper.ioPreserveCollinear=4;f.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),f.ClipperBase.prototype.Clear.call(this))};f.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var b=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=b}};f.Clipper.prototype.Reset=function(){f.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.DisposeAllPolyPts();
for(var b=this.m_MinimaList;null!==b;)this.InsertScanbeam(b.Y),b=b.Next};f.Clipper.prototype.InsertScanbeam=function(b){if(null===this.m_Scanbeam)this.m_Scanbeam=new f.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=b;else if(b>this.m_Scanbeam.Y){var c=new f.Scanbeam;c.Y=b;c.Next=this.m_Scanbeam;this.m_Scanbeam=c}else{for(var d=this.m_Scanbeam;null!==d.Next&&b<=d.Next.Y;)d=d.Next;b!=d.Y&&(c=new f.Scanbeam,c.Y=b,c.Next=d.Next,d.Next=c)}};f.Clipper.prototype.Execute=function(){var b=arguments,
c=b.length,d=b[1]instanceof f.PolyTree;if(4!=c||d){if(4==c&&d){d=b[0];c=b[1];h=b[2];b=b[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=h;this.m_ClipFillType=b;this.m_ClipType=d;this.m_UsingPolyTree=!0;(b=this.ExecuteInternal())&&this.BuildResult2(c);this.m_ExecuteLocked=!1;return b}if(2==c&&!d||2==c&&d)return d=b[0],c=b[1],this.Execute(d,c,f.PolyFillType.pftEvenOdd,f.PolyFillType.pftEvenOdd)}else{var d=b[0],c=b[1],h=b[2],b=b[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&
f.Error("Error: PolyTree struct is need for open path clipping.");this.m_ExecuteLocked=!0;f.Clear(c);this.m_SubjFillType=h;this.m_ClipFillType=b;this.m_ClipType=d;this.m_UsingPolyTree=!1;(b=this.ExecuteInternal())&&this.BuildResult(c);this.m_ExecuteLocked=!1;return b}};f.Clipper.prototype.FixHoleLinkage=function(b){if(null!==b.FirstLeft&&(b.IsHole==b.FirstLeft.IsHole||null===b.FirstLeft.Pts)){for(var c=b.FirstLeft;null!==c&&(c.IsHole==b.IsHole||null===c.Pts);)c=c.FirstLeft;b.FirstLeft=c}};f.Clipper.prototype.ExecuteInternal=
function(){try{this.Reset();if(null===this.m_CurrentLM)return!1;var b=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(b);f.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var c=this.PopScanbeam();if(!this.ProcessIntersections(b,c))return!1;this.ProcessEdgesAtTopOfScanbeam(c);b=c}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var b=0,d=this.m_PolyOuts.length;b<d;b++){var h=this.m_PolyOuts[b];null===h.Pts||h.IsOpen||(h.IsHole^this.ReverseSolution)==
0<this.Area(h)&&this.ReversePolyPtLinks(h.Pts)}this.JoinCommonEdges();b=0;for(d=this.m_PolyOuts.length;b<d;b++)h=this.m_PolyOuts[b],null===h.Pts||h.IsOpen||this.FixupOutPolygon(h);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{f.Clear(this.m_Joins),f.Clear(this.m_GhostJoins)}};f.Clipper.prototype.PopScanbeam=function(){var b=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;return b};f.Clipper.prototype.DisposeAllPolyPts=function(){for(var b=0,c=this.m_PolyOuts.length;b<c;++b)this.DisposeOutRec(b);
f.Clear(this.m_PolyOuts)};f.Clipper.prototype.DisposeOutRec=function(b){var c=this.m_PolyOuts[b];null!==c.Pts&&this.DisposeOutPts(c.Pts);this.m_PolyOuts[b]=null};f.Clipper.prototype.DisposeOutPts=function(b){if(null!==b)for(b.Prev.Next=null;null!==b;)b=b.Next};f.Clipper.prototype.AddJoin=function(b,c,d){var h=new f.Join;h.OutPt1=b;h.OutPt2=c;h.OffPt.X=d.X;h.OffPt.Y=d.Y;this.m_Joins.push(h)};f.Clipper.prototype.AddGhostJoin=function(b,c){var d=new f.Join;d.OutPt1=b;d.OffPt.X=c.X;d.OffPt.Y=c.Y;this.m_GhostJoins.push(d)};
f.Clipper.prototype.InsertLocalMinimaIntoAEL=function(b){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==b;){var c=this.m_CurrentLM.LeftBound,d=this.m_CurrentLM.RightBound;this.PopLocalMinima();var h=null;null===c?(this.InsertEdgeIntoAEL(d,null),this.SetWindingCount(d),this.IsContributing(d)&&(h=this.AddOutPt(d,d.Bot))):(null==d?(this.InsertEdgeIntoAEL(c,null),this.SetWindingCount(c),this.IsContributing(c)&&(h=this.AddOutPt(c,c.Bot))):(this.InsertEdgeIntoAEL(c,null),this.InsertEdgeIntoAEL(d,c),
this.SetWindingCount(c),d.WindCnt=c.WindCnt,d.WindCnt2=c.WindCnt2,this.IsContributing(c)&&(h=this.AddLocalMinPoly(c,d,c.Bot))),this.InsertScanbeam(c.Top.Y));null!=d&&(f.ClipperBase.IsHorizontal(d)?this.AddEdgeToSEL(d):this.InsertScanbeam(d.Top.Y));if(null!=c&&null!=d){if(null!==h&&f.ClipperBase.IsHorizontal(d)&&0<this.m_GhostJoins.length&&0!==d.WindDelta)for(var m=0,l=this.m_GhostJoins.length;m<l;m++){var x=this.m_GhostJoins[m];this.HorzSegmentsOverlap(x.OutPt1.Pt,x.OffPt,d.Bot,d.Top)&&this.AddJoin(x.OutPt1,
h,x.OffPt)}0<=c.OutIdx&&null!==c.PrevInAEL&&c.PrevInAEL.Curr.X==c.Bot.X&&0<=c.PrevInAEL.OutIdx&&f.ClipperBase.SlopesEqual(c.PrevInAEL,c,this.m_UseFullRange)&&0!==c.WindDelta&&0!==c.PrevInAEL.WindDelta&&(m=this.AddOutPt(c.PrevInAEL,c.Bot),this.AddJoin(h,m,c.Top));if(c.NextInAEL!=d&&(0<=d.OutIdx&&0<=d.PrevInAEL.OutIdx&&f.ClipperBase.SlopesEqual(d.PrevInAEL,d,this.m_UseFullRange)&&0!==d.WindDelta&&0!==d.PrevInAEL.WindDelta&&(m=this.AddOutPt(d.PrevInAEL,d.Bot),this.AddJoin(h,m,d.Top)),h=c.NextInAEL,null!==
h))for(;h!=d;)this.IntersectEdges(d,h,c.Curr,!1),h=h.NextInAEL}}};f.Clipper.prototype.InsertEdgeIntoAEL=function(b,c){if(null===this.m_ActiveEdges)b.PrevInAEL=null,b.NextInAEL=null,this.m_ActiveEdges=b;else if(null===c&&this.E2InsertsBeforeE1(this.m_ActiveEdges,b))b.PrevInAEL=null,b.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=b;else{for(null===c&&(c=this.m_ActiveEdges);null!==c.NextInAEL&&!this.E2InsertsBeforeE1(c.NextInAEL,b);)c=c.NextInAEL;b.NextInAEL=c.NextInAEL;
null!==c.NextInAEL&&(c.NextInAEL.PrevInAEL=b);b.PrevInAEL=c;c.NextInAEL=b}};f.Clipper.prototype.E2InsertsBeforeE1=function(b,c){return c.Curr.X==b.Curr.X?c.Top.Y>b.Top.Y?c.Top.X<f.Clipper.TopX(b,c.Top.Y):b.Top.X>f.Clipper.TopX(c,b.Top.Y):c.Curr.X<b.Curr.X};f.Clipper.prototype.IsEvenOddFillType=function(b){return b.PolyTyp==f.PolyType.ptSubject?this.m_SubjFillType==f.PolyFillType.pftEvenOdd:this.m_ClipFillType==f.PolyFillType.pftEvenOdd};f.Clipper.prototype.IsEvenOddAltFillType=function(b){return b.PolyTyp==
f.PolyType.ptSubject?this.m_ClipFillType==f.PolyFillType.pftEvenOdd:this.m_SubjFillType==f.PolyFillType.pftEvenOdd};f.Clipper.prototype.IsContributing=function(b){var c,d;b.PolyTyp==f.PolyType.ptSubject?(c=this.m_SubjFillType,d=this.m_ClipFillType):(c=this.m_ClipFillType,d=this.m_SubjFillType);switch(c){case f.PolyFillType.pftEvenOdd:if(0===b.WindDelta&&1!=b.WindCnt)return!1;break;case f.PolyFillType.pftNonZero:if(1!=Math.abs(b.WindCnt))return!1;break;case f.PolyFillType.pftPositive:if(1!=b.WindCnt)return!1;
break;default:if(-1!=b.WindCnt)return!1}switch(this.m_ClipType){case f.ClipType.ctIntersection:switch(d){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0!==b.WindCnt2;case f.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case f.ClipType.ctUnion:switch(d){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}case f.ClipType.ctDifference:if(b.PolyTyp==
f.PolyType.ptSubject)switch(d){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}else switch(d){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0!==b.WindCnt2;case f.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case f.ClipType.ctXor:if(0===b.WindDelta)switch(d){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;
case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}}return!0};f.Clipper.prototype.SetWindingCount=function(b){for(var c=b.PrevInAEL;null!==c&&(c.PolyTyp!=b.PolyTyp||0===c.WindDelta);)c=c.PrevInAEL;if(null===c)b.WindCnt=0===b.WindDelta?1:b.WindDelta,b.WindCnt2=0,c=this.m_ActiveEdges;else{if(0===b.WindDelta&&this.m_ClipType!=f.ClipType.ctUnion)b.WindCnt=1;else if(this.IsEvenOddFillType(b))if(0===b.WindDelta){for(var d=!0,h=c.PrevInAEL;null!==h;)h.PolyTyp==c.PolyTyp&&0!==
h.WindDelta&&(d=!d),h=h.PrevInAEL;b.WindCnt=d?0:1}else b.WindCnt=b.WindDelta;else 0>c.WindCnt*c.WindDelta?1<Math.abs(c.WindCnt)?b.WindCnt=0>c.WindDelta*b.WindDelta?c.WindCnt:c.WindCnt+b.WindDelta:b.WindCnt=0===b.WindDelta?1:b.WindDelta:b.WindCnt=0===b.WindDelta?0>c.WindCnt?c.WindCnt-1:c.WindCnt+1:0>c.WindDelta*b.WindDelta?c.WindCnt:c.WindCnt+b.WindDelta;b.WindCnt2=c.WindCnt2;c=c.NextInAEL}if(this.IsEvenOddAltFillType(b))for(;c!=b;)0!==c.WindDelta&&(b.WindCnt2=0===b.WindCnt2?1:0),c=c.NextInAEL;else for(;c!=
b;)b.WindCnt2+=c.WindDelta,c=c.NextInAEL};f.Clipper.prototype.AddEdgeToSEL=function(b){null===this.m_SortedEdges?(this.m_SortedEdges=b,b.PrevInSEL=null,b.NextInSEL=null):(b.NextInSEL=this.m_SortedEdges,b.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=b)};f.Clipper.prototype.CopyAELToSEL=function(){var b=this.m_ActiveEdges;for(this.m_SortedEdges=b;null!==b;)b.PrevInSEL=b.PrevInAEL,b=b.NextInSEL=b.NextInAEL};f.Clipper.prototype.SwapPositionsInAEL=function(b,c){if(b.NextInAEL!=b.PrevInAEL&&
c.NextInAEL!=c.PrevInAEL){if(b.NextInAEL==c){var d=c.NextInAEL;null!==d&&(d.PrevInAEL=b);var h=b.PrevInAEL;null!==h&&(h.NextInAEL=c);c.PrevInAEL=h;c.NextInAEL=b;b.PrevInAEL=c;b.NextInAEL=d}else c.NextInAEL==b?(d=b.NextInAEL,null!==d&&(d.PrevInAEL=c),h=c.PrevInAEL,null!==h&&(h.NextInAEL=b),b.PrevInAEL=h,b.NextInAEL=c,c.PrevInAEL=b,c.NextInAEL=d):(d=b.NextInAEL,h=b.PrevInAEL,b.NextInAEL=c.NextInAEL,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=b),b.PrevInAEL=c.PrevInAEL,null!==b.PrevInAEL&&(b.PrevInAEL.NextInAEL=
b),c.NextInAEL=d,null!==c.NextInAEL&&(c.NextInAEL.PrevInAEL=c),c.PrevInAEL=h,null!==c.PrevInAEL&&(c.PrevInAEL.NextInAEL=c));null===b.PrevInAEL?this.m_ActiveEdges=b:null===c.PrevInAEL&&(this.m_ActiveEdges=c)}};f.Clipper.prototype.SwapPositionsInSEL=function(b,c){if(null!==b.NextInSEL||null!==b.PrevInSEL)if(null!==c.NextInSEL||null!==c.PrevInSEL){if(b.NextInSEL==c){var d=c.NextInSEL;null!==d&&(d.PrevInSEL=b);var h=b.PrevInSEL;null!==h&&(h.NextInSEL=c);c.PrevInSEL=h;c.NextInSEL=b;b.PrevInSEL=c;b.NextInSEL=
d}else c.NextInSEL==b?(d=b.NextInSEL,null!==d&&(d.PrevInSEL=c),h=c.PrevInSEL,null!==h&&(h.NextInSEL=b),b.PrevInSEL=h,b.NextInSEL=c,c.PrevInSEL=b,c.NextInSEL=d):(d=b.NextInSEL,h=b.PrevInSEL,b.NextInSEL=c.NextInSEL,null!==b.NextInSEL&&(b.NextInSEL.PrevInSEL=b),b.PrevInSEL=c.PrevInSEL,null!==b.PrevInSEL&&(b.PrevInSEL.NextInSEL=b),c.NextInSEL=d,null!==c.NextInSEL&&(c.NextInSEL.PrevInSEL=c),c.PrevInSEL=h,null!==c.PrevInSEL&&(c.PrevInSEL.NextInSEL=c));null===b.PrevInSEL?this.m_SortedEdges=b:null===c.PrevInSEL&&
(this.m_SortedEdges=c)}};f.Clipper.prototype.AddLocalMaxPoly=function(b,c,d){this.AddOutPt(b,d);0==c.WindDelta&&this.AddOutPt(c,d);b.OutIdx==c.OutIdx?(b.OutIdx=-1,c.OutIdx=-1):b.OutIdx<c.OutIdx?this.AppendPolygon(b,c):this.AppendPolygon(c,b)};f.Clipper.prototype.AddLocalMinPoly=function(b,c,d){var h,m;f.ClipperBase.IsHorizontal(c)||b.Dx>c.Dx?(h=this.AddOutPt(b,d),c.OutIdx=b.OutIdx,b.Side=f.EdgeSide.esLeft,c.Side=f.EdgeSide.esRight,m=b,b=m.PrevInAEL==c?c.PrevInAEL:m.PrevInAEL):(h=this.AddOutPt(c,d),
b.OutIdx=c.OutIdx,b.Side=f.EdgeSide.esRight,c.Side=f.EdgeSide.esLeft,m=c,b=m.PrevInAEL==b?b.PrevInAEL:m.PrevInAEL);null!==b&&0<=b.OutIdx&&f.Clipper.TopX(b,d.Y)==f.Clipper.TopX(m,d.Y)&&f.ClipperBase.SlopesEqual(m,b,this.m_UseFullRange)&&0!==m.WindDelta&&0!==b.WindDelta&&(d=this.AddOutPt(b,d),this.AddJoin(h,d,m.Top));return h};f.Clipper.prototype.CreateOutRec=function(){var b=new f.OutRec;b.Idx=-1;b.IsHole=!1;b.IsOpen=!1;b.FirstLeft=null;b.Pts=null;b.BottomPt=null;b.PolyNode=null;this.m_PolyOuts.push(b);
b.Idx=this.m_PolyOuts.length-1;return b};f.Clipper.prototype.AddOutPt=function(b,c){var d=b.Side==f.EdgeSide.esLeft;if(0>b.OutIdx){var h=this.CreateOutRec();h.IsOpen=0===b.WindDelta;var m=new f.OutPt;h.Pts=m;m.Idx=h.Idx;m.Pt.X=c.X;m.Pt.Y=c.Y;m.Next=m;m.Prev=m;h.IsOpen||this.SetHoleState(b,h);b.OutIdx=h.Idx}else{var h=this.m_PolyOuts[b.OutIdx],l=h.Pts;if(d&&f.IntPoint.op_Equality(c,l.Pt))return l;if(!d&&f.IntPoint.op_Equality(c,l.Prev.Pt))return l.Prev;m=new f.OutPt;m.Idx=h.Idx;m.Pt.X=c.X;m.Pt.Y=c.Y;
m.Next=l;m.Prev=l.Prev;m.Prev.Next=m;l.Prev=m;d&&(h.Pts=m)}return m};f.Clipper.prototype.SwapPoints=function(b,c){var d=new f.IntPoint(b.Value);b.Value.X=c.Value.X;b.Value.Y=c.Value.Y;c.Value.X=d.X;c.Value.Y=d.Y};f.Clipper.prototype.HorzSegmentsOverlap=function(b,c,d,h){return b.X>d.X==b.X<h.X?!0:c.X>d.X==c.X<h.X?!0:d.X>b.X==d.X<c.X?!0:h.X>b.X==h.X<c.X?!0:b.X==d.X&&c.X==h.X?!0:b.X==h.X&&c.X==d.X?!0:!1};f.Clipper.prototype.InsertPolyPtBetween=function(b,c,d){var h=new f.OutPt;h.Pt.X=d.X;h.Pt.Y=d.Y;
c==b.Next?(b.Next=h,c.Prev=h,h.Next=c,h.Prev=b):(c.Next=h,b.Prev=h,h.Next=b,h.Prev=c);return h};f.Clipper.prototype.SetHoleState=function(b,c){for(var d=!1,h=b.PrevInAEL;null!==h;)0<=h.OutIdx&&0!=h.WindDelta&&(d=!d,null===c.FirstLeft&&(c.FirstLeft=this.m_PolyOuts[h.OutIdx])),h=h.PrevInAEL;d&&(c.IsHole=!0)};f.Clipper.prototype.GetDx=function(b,c){return b.Y==c.Y?f.ClipperBase.horizontal:(c.X-b.X)/(c.Y-b.Y)};f.Clipper.prototype.FirstIsBottomPt=function(b,c){for(var d=b.Prev;f.IntPoint.op_Equality(d.Pt,
b.Pt)&&d!=b;)d=d.Prev;for(var h=Math.abs(this.GetDx(b.Pt,d.Pt)),d=b.Next;f.IntPoint.op_Equality(d.Pt,b.Pt)&&d!=b;)d=d.Next;for(var m=Math.abs(this.GetDx(b.Pt,d.Pt)),d=c.Prev;f.IntPoint.op_Equality(d.Pt,c.Pt)&&d!=c;)d=d.Prev;for(var l=Math.abs(this.GetDx(c.Pt,d.Pt)),d=c.Next;f.IntPoint.op_Equality(d.Pt,c.Pt)&&d!=c;)d=d.Next;d=Math.abs(this.GetDx(c.Pt,d.Pt));return h>=l&&h>=d||m>=l&&m>=d};f.Clipper.prototype.GetBottomPt=function(b){for(var c=null,d=b.Next;d!=b;)d.Pt.Y>b.Pt.Y?(b=d,c=null):d.Pt.Y==b.Pt.Y&&
d.Pt.X<=b.Pt.X&&(d.Pt.X<b.Pt.X?(c=null,b=d):d.Next!=b&&d.Prev!=b&&(c=d)),d=d.Next;if(null!==c)for(;c!=d;)for(this.FirstIsBottomPt(d,c)||(b=c),c=c.Next;f.IntPoint.op_Inequality(c.Pt,b.Pt);)c=c.Next;return b};f.Clipper.prototype.GetLowermostRec=function(b,c){null===b.BottomPt&&(b.BottomPt=this.GetBottomPt(b.Pts));null===c.BottomPt&&(c.BottomPt=this.GetBottomPt(c.Pts));var d=b.BottomPt,h=c.BottomPt;return d.Pt.Y>h.Pt.Y?b:d.Pt.Y<h.Pt.Y?c:d.Pt.X<h.Pt.X?b:d.Pt.X>h.Pt.X?c:d.Next==d?c:h.Next==h?b:this.FirstIsBottomPt(d,
h)?b:c};f.Clipper.prototype.Param1RightOfParam2=function(b,c){do if(b=b.FirstLeft,b==c)return!0;while(null!==b);return!1};f.Clipper.prototype.GetOutRec=function(b){for(b=this.m_PolyOuts[b];b!=this.m_PolyOuts[b.Idx];)b=this.m_PolyOuts[b.Idx];return b};f.Clipper.prototype.AppendPolygon=function(b,c){var d=this.m_PolyOuts[b.OutIdx],h=this.m_PolyOuts[c.OutIdx],m;m=this.Param1RightOfParam2(d,h)?h:this.Param1RightOfParam2(h,d)?d:this.GetLowermostRec(d,h);var l=d.Pts,x=l.Prev,q=h.Pts,r=q.Prev;b.Side==f.EdgeSide.esLeft?
(c.Side==f.EdgeSide.esLeft?(this.ReversePolyPtLinks(q),q.Next=l,l.Prev=q,x.Next=r,r.Prev=x,d.Pts=r):(r.Next=l,l.Prev=r,q.Prev=x,x.Next=q,d.Pts=q),l=f.EdgeSide.esLeft):(c.Side==f.EdgeSide.esRight?(this.ReversePolyPtLinks(q),x.Next=r,r.Prev=x,q.Next=l,l.Prev=q):(x.Next=q,q.Prev=x,l.Prev=r,r.Next=l),l=f.EdgeSide.esRight);d.BottomPt=null;m==h&&(h.FirstLeft!=d&&(d.FirstLeft=h.FirstLeft),d.IsHole=h.IsHole);h.Pts=null;h.BottomPt=null;h.FirstLeft=d;m=b.OutIdx;x=c.OutIdx;b.OutIdx=-1;c.OutIdx=-1;for(q=this.m_ActiveEdges;null!==
q;){if(q.OutIdx==x){q.OutIdx=m;q.Side=l;break}q=q.NextInAEL}h.Idx=d.Idx};f.Clipper.prototype.ReversePolyPtLinks=function(b){if(null!==b){var c,d;c=b;do d=c.Next,c.Next=c.Prev,c=c.Prev=d;while(c!=b)}};f.Clipper.SwapSides=function(b,c){var d=b.Side;b.Side=c.Side;c.Side=d};f.Clipper.SwapPolyIndexes=function(b,c){var d=b.OutIdx;b.OutIdx=c.OutIdx;c.OutIdx=d};f.Clipper.prototype.IntersectEdges=function(b,c,d,h){var m=!h&&null===b.NextInLML&&b.Top.X==d.X&&b.Top.Y==d.Y;h=!h&&null===c.NextInLML&&c.Top.X==
d.X&&c.Top.Y==d.Y;var l=0<=b.OutIdx,x=0<=c.OutIdx;if(0===b.WindDelta||0===c.WindDelta)0===b.WindDelta&&0===c.WindDelta?(m||h)&&l&&x&&this.AddLocalMaxPoly(b,c,d):b.PolyTyp==c.PolyTyp&&b.WindDelta!=c.WindDelta&&this.m_ClipType==f.ClipType.ctUnion?0===b.WindDelta?x&&(this.AddOutPt(b,d),l&&(b.OutIdx=-1)):l&&(this.AddOutPt(c,d),x&&(c.OutIdx=-1)):b.PolyTyp!=c.PolyTyp&&(0!==b.WindDelta||1!=Math.abs(c.WindCnt)||this.m_ClipType==f.ClipType.ctUnion&&0!==c.WindCnt2?0!==c.WindDelta||1!=Math.abs(b.WindCnt)||this.m_ClipType==
f.ClipType.ctUnion&&0!==b.WindCnt2||(this.AddOutPt(c,d),x&&(c.OutIdx=-1)):(this.AddOutPt(b,d),l&&(b.OutIdx=-1))),m&&(0>b.OutIdx?this.DeleteFromAEL(b):f.Error("Error intersecting polylines")),h&&(0>c.OutIdx?this.DeleteFromAEL(c):f.Error("Error intersecting polylines"));else{if(b.PolyTyp==c.PolyTyp)if(this.IsEvenOddFillType(b)){var q=b.WindCnt;b.WindCnt=c.WindCnt;c.WindCnt=q}else b.WindCnt=0===b.WindCnt+c.WindDelta?-b.WindCnt:b.WindCnt+c.WindDelta,c.WindCnt=0===c.WindCnt-b.WindDelta?-c.WindCnt:c.WindCnt-
b.WindDelta;else this.IsEvenOddFillType(c)?b.WindCnt2=0===b.WindCnt2?1:0:b.WindCnt2+=c.WindDelta,this.IsEvenOddFillType(b)?c.WindCnt2=0===c.WindCnt2?1:0:c.WindCnt2-=b.WindDelta;var r,C,G;b.PolyTyp==f.PolyType.ptSubject?(r=this.m_SubjFillType,G=this.m_ClipFillType):(r=this.m_ClipFillType,G=this.m_SubjFillType);c.PolyTyp==f.PolyType.ptSubject?(C=this.m_SubjFillType,q=this.m_ClipFillType):(C=this.m_ClipFillType,q=this.m_SubjFillType);switch(r){case f.PolyFillType.pftPositive:r=b.WindCnt;break;case f.PolyFillType.pftNegative:r=
-b.WindCnt;break;default:r=Math.abs(b.WindCnt)}switch(C){case f.PolyFillType.pftPositive:C=c.WindCnt;break;case f.PolyFillType.pftNegative:C=-c.WindCnt;break;default:C=Math.abs(c.WindCnt)}if(l&&x)m||h||0!==r&&1!=r||0!==C&&1!=C||b.PolyTyp!=c.PolyTyp&&this.m_ClipType!=f.ClipType.ctXor?this.AddLocalMaxPoly(b,c,d):(this.AddOutPt(b,d),this.AddOutPt(c,d),f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,c));else if(l){if(0===C||1==C)this.AddOutPt(b,d),f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,
c)}else if(x){if(0===r||1==r)this.AddOutPt(c,d),f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,c)}else if(!(0!==r&&1!=r||0!==C&&1!=C||m||h)){switch(G){case f.PolyFillType.pftPositive:l=b.WindCnt2;break;case f.PolyFillType.pftNegative:l=-b.WindCnt2;break;default:l=Math.abs(b.WindCnt2)}switch(q){case f.PolyFillType.pftPositive:x=c.WindCnt2;break;case f.PolyFillType.pftNegative:x=-c.WindCnt2;break;default:x=Math.abs(c.WindCnt2)}if(b.PolyTyp!=c.PolyTyp)this.AddLocalMinPoly(b,c,d);else if(1==r&&
1==C)switch(this.m_ClipType){case f.ClipType.ctIntersection:0<l&&0<x&&this.AddLocalMinPoly(b,c,d);break;case f.ClipType.ctUnion:0>=l&&0>=x&&this.AddLocalMinPoly(b,c,d);break;case f.ClipType.ctDifference:(b.PolyTyp==f.PolyType.ptClip&&0<l&&0<x||b.PolyTyp==f.PolyType.ptSubject&&0>=l&&0>=x)&&this.AddLocalMinPoly(b,c,d);break;case f.ClipType.ctXor:this.AddLocalMinPoly(b,c,d)}else f.Clipper.SwapSides(b,c)}m!=h&&(m&&0<=b.OutIdx||h&&0<=c.OutIdx)&&(f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,c));
m&&this.DeleteFromAEL(b);h&&this.DeleteFromAEL(c)}};f.Clipper.prototype.DeleteFromAEL=function(b){var c=b.PrevInAEL,d=b.NextInAEL;if(null!==c||null!==d||b==this.m_ActiveEdges)null!==c?c.NextInAEL=d:this.m_ActiveEdges=d,null!==d&&(d.PrevInAEL=c),b.NextInAEL=null,b.PrevInAEL=null};f.Clipper.prototype.DeleteFromSEL=function(b){var c=b.PrevInSEL,d=b.NextInSEL;if(null!==c||null!==d||b==this.m_SortedEdges)null!==c?c.NextInSEL=d:this.m_SortedEdges=d,null!==d&&(d.PrevInSEL=c),b.NextInSEL=null,b.PrevInSEL=
null};f.Clipper.prototype.UpdateEdgeIntoAEL=function(b){null===b.Value.NextInLML&&f.Error("UpdateEdgeIntoAEL: invalid call");var c=b.Value.PrevInAEL,d=b.Value.NextInAEL;b.Value.NextInLML.OutIdx=b.Value.OutIdx;null!==c?c.NextInAEL=b.Value.NextInLML:this.m_ActiveEdges=b.Value.NextInLML;null!==d&&(d.PrevInAEL=b.Value.NextInLML);b.Value.NextInLML.Side=b.Value.Side;b.Value.NextInLML.WindDelta=b.Value.WindDelta;b.Value.NextInLML.WindCnt=b.Value.WindCnt;b.Value.NextInLML.WindCnt2=b.Value.WindCnt2;b.Value=
b.Value.NextInLML;b.Value.Curr.X=b.Value.Bot.X;b.Value.Curr.Y=b.Value.Bot.Y;b.Value.PrevInAEL=c;b.Value.NextInAEL=d;f.ClipperBase.IsHorizontal(b.Value)||this.InsertScanbeam(b.Value.Top.Y)};f.Clipper.prototype.ProcessHorizontals=function(b){for(var c=this.m_SortedEdges;null!==c;)this.DeleteFromSEL(c),this.ProcessHorizontal(c,b),c=this.m_SortedEdges};f.Clipper.prototype.GetHorzDirection=function(b,c,d,h){b.Bot.X<b.Top.X?(d.Value=b.Bot.X,h.Value=b.Top.X,c.Value=f.Direction.dLeftToRight):(d.Value=b.Top.X,
h.Value=b.Bot.X,c.Value=f.Direction.dRightToLeft)};f.Clipper.prototype.PrepareHorzJoins=function(b,c){var d=this.m_PolyOuts[b.OutIdx].Pts;b.Side!=f.EdgeSide.esLeft&&(d=d.Prev);for(var h=0,m=this.m_GhostJoins.length;h<m;++h){var l=this.m_GhostJoins[h];this.HorzSegmentsOverlap(l.OutPt1.Pt,l.OffPt,b.Bot,b.Top)&&this.AddJoin(l.OutPt1,d,l.OffPt)}c&&(f.IntPoint.op_Equality(d.Pt,b.Top)?this.AddGhostJoin(d,b.Bot):this.AddGhostJoin(d,b.Top))};f.Clipper.prototype.ProcessHorizontal=function(b,c){var d,h,m;(function(){d=
{Value:d};h={Value:h};m={Value:m};var c=this.GetHorzDirection(b,d,h,m);d=d.Value;h=h.Value;m=m.Value;return c}).call(this);for(var l=b,x=null;null!==l.NextInLML&&f.ClipperBase.IsHorizontal(l.NextInLML);)l=l.NextInLML;for(null===l.NextInLML&&(x=this.GetMaximaPair(l));;){for(var q=b==l,r=this.GetNextInAEL(b,d);null!==r&&!(r.Curr.X==b.Top.X&&null!==b.NextInLML&&r.Dx<b.NextInLML.Dx);){var C=this.GetNextInAEL(r,d);if(d==f.Direction.dLeftToRight&&r.Curr.X<=m||d==f.Direction.dRightToLeft&&r.Curr.X>=h){0<=
b.OutIdx&&0!=b.WindDelta&&this.PrepareHorzJoins(b,c);if(r==x&&q){d==f.Direction.dLeftToRight?this.IntersectEdges(b,r,r.Top,!1):this.IntersectEdges(r,b,r.Top,!1);0<=x.OutIdx&&f.Error("ProcessHorizontal error");return}if(d==f.Direction.dLeftToRight){var G=new f.IntPoint(r.Curr.X,b.Curr.Y);this.IntersectEdges(b,r,G,!0)}else G=new f.IntPoint(r.Curr.X,b.Curr.Y),this.IntersectEdges(r,b,G,!0);this.SwapPositionsInAEL(b,r)}else if(d==f.Direction.dLeftToRight&&r.Curr.X>=m||d==f.Direction.dRightToLeft&&r.Curr.X<=
h)break;r=C}0<=b.OutIdx&&0!==b.WindDelta&&this.PrepareHorzJoins(b,c);if(null!==b.NextInLML&&f.ClipperBase.IsHorizontal(b.NextInLML))(function(){b={Value:b};var c=this.UpdateEdgeIntoAEL(b);b=b.Value;return c}).call(this),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),function(){d={Value:d};h={Value:h};m={Value:m};var c=this.GetHorzDirection(b,d,h,m);d=d.Value;h=h.Value;m=m.Value;return c}.call(this);else break}null!==b.NextInLML?0<=b.OutIdx?(l=this.AddOutPt(b,b.Top),function(){b={Value:b};var c=this.UpdateEdgeIntoAEL(b);
b=b.Value;return c}.call(this),0!==b.WindDelta&&(x=b.PrevInAEL,C=b.NextInAEL,null!==x&&x.Curr.X==b.Bot.X&&x.Curr.Y==b.Bot.Y&&0!==x.WindDelta&&0<=x.OutIdx&&x.Curr.Y>x.Top.Y&&f.ClipperBase.SlopesEqual(b,x,this.m_UseFullRange)?(C=this.AddOutPt(x,b.Bot),this.AddJoin(l,C,b.Top)):null!==C&&C.Curr.X==b.Bot.X&&C.Curr.Y==b.Bot.Y&&0!==C.WindDelta&&0<=C.OutIdx&&C.Curr.Y>C.Top.Y&&f.ClipperBase.SlopesEqual(b,C,this.m_UseFullRange)&&(C=this.AddOutPt(C,b.Bot),this.AddJoin(l,C,b.Top)))):function(){b={Value:b};var c=
this.UpdateEdgeIntoAEL(b);b=b.Value;return c}.call(this):null!==x?0<=x.OutIdx?(d==f.Direction.dLeftToRight?this.IntersectEdges(b,x,b.Top,!1):this.IntersectEdges(x,b,b.Top,!1),0<=x.OutIdx&&f.Error("ProcessHorizontal error")):(this.DeleteFromAEL(b),this.DeleteFromAEL(x)):(0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b))};f.Clipper.prototype.GetNextInAEL=function(b,c){return c==f.Direction.dLeftToRight?b.NextInAEL:b.PrevInAEL};f.Clipper.prototype.IsMinima=function(b){return null!==b&&b.Prev.NextInLML!=
b&&b.Next.NextInLML!=b};f.Clipper.prototype.IsMaxima=function(b,c){return null!==b&&b.Top.Y==c&&null===b.NextInLML};f.Clipper.prototype.IsIntermediate=function(b,c){return b.Top.Y==c&&null!==b.NextInLML};f.Clipper.prototype.GetMaximaPair=function(b){var c=null;f.IntPoint.op_Equality(b.Next.Top,b.Top)&&null===b.Next.NextInLML?c=b.Next:f.IntPoint.op_Equality(b.Prev.Top,b.Top)&&null===b.Prev.NextInLML&&(c=b.Prev);return null===c||-2!=c.OutIdx&&(c.NextInAEL!=c.PrevInAEL||f.ClipperBase.IsHorizontal(c))?
c:null};f.Clipper.prototype.ProcessIntersections=function(b,c){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(b,c);if(0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch(d){this.m_SortedEdges=null,this.m_IntersectList.length=0,f.Error("ProcessIntersections error")}this.m_SortedEdges=null;return!0};f.Clipper.prototype.BuildIntersectList=function(b,c){if(null!==this.m_ActiveEdges){var d=
this.m_ActiveEdges;for(this.m_SortedEdges=d;null!==d;)d.PrevInSEL=d.PrevInAEL,d.NextInSEL=d.NextInAEL,d.Curr.X=f.Clipper.TopX(d,c),d=d.NextInAEL;for(var h=!0;h&&null!==this.m_SortedEdges;){h=!1;for(d=this.m_SortedEdges;null!==d.NextInSEL;){var m=d.NextInSEL,l=new f.IntPoint;d.Curr.X>m.Curr.X?(l={Value:l},h=this.IntersectPoint(d,m,l),l=l.Value,!h&&d.Curr.X>m.Curr.X+1&&f.Error("Intersection error"),l.Y>b&&(l.Y=b,Math.abs(d.Dx)>Math.abs(m.Dx)?l.X=f.Clipper.TopX(m,b):l.X=f.Clipper.TopX(d,b)),h=new f.IntersectNode,
h.Edge1=d,h.Edge2=m,h.Pt.X=l.X,h.Pt.Y=l.Y,this.m_IntersectList.push(h),this.SwapPositionsInSEL(d,m),h=!0):d=m}if(null!==d.PrevInSEL)d.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}};f.Clipper.prototype.EdgesAdjacent=function(b){return b.Edge1.NextInSEL==b.Edge2||b.Edge1.PrevInSEL==b.Edge2};f.Clipper.IntersectNodeSort=function(b,c){return c.Pt.Y-b.Pt.Y};f.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var b=
this.m_IntersectList.length,c=0;c<b;c++){if(!this.EdgesAdjacent(this.m_IntersectList[c])){for(var d=c+1;d<b&&!this.EdgesAdjacent(this.m_IntersectList[d]);)d++;if(d==b)return!1;var h=this.m_IntersectList[c];this.m_IntersectList[c]=this.m_IntersectList[d];this.m_IntersectList[d]=h}this.SwapPositionsInSEL(this.m_IntersectList[c].Edge1,this.m_IntersectList[c].Edge2)}return!0};f.Clipper.prototype.ProcessIntersectList=function(){for(var b=0,c=this.m_IntersectList.length;b<c;b++){var d=this.m_IntersectList[b];
this.IntersectEdges(d.Edge1,d.Edge2,d.Pt,!0);this.SwapPositionsInAEL(d.Edge1,d.Edge2)}this.m_IntersectList.length=0};Na=function(b){return 0>b?Math.ceil(b-.5):Math.round(b)};Ea=function(b){return 0>b?Math.ceil(b-.5):Math.floor(b+.5)};Oa=function(b){return 0>b?-Math.round(Math.abs(b)):Math.round(b)};Fa=function(b){if(0>b)return b-=.5,-2147483648>b?Math.ceil(b):b|0;b+=.5;return 2147483647<b?Math.floor(b):b|0};f.Clipper.Round=S?Na:Ua?Oa:za?Fa:Ea;f.Clipper.TopX=function(b,c){return c==b.Top.Y?b.Top.X:
b.Bot.X+f.Clipper.Round(b.Dx*(c-b.Bot.Y))};f.Clipper.prototype.IntersectPoint=function(b,c,d){d.Value=new f.IntPoint;var h,m;if(f.ClipperBase.SlopesEqual(b,c,this.m_UseFullRange)||b.Dx==c.Dx)return c.Bot.Y>b.Bot.Y?(d.Value.X=c.Bot.X,d.Value.Y=c.Bot.Y):(d.Value.X=b.Bot.X,d.Value.Y=b.Bot.Y),!1;if(0===b.Delta.X)d.Value.X=b.Bot.X,f.ClipperBase.IsHorizontal(c)?d.Value.Y=c.Bot.Y:(m=c.Bot.Y-c.Bot.X/c.Dx,d.Value.Y=f.Clipper.Round(d.Value.X/c.Dx+m));else if(0===c.Delta.X)d.Value.X=c.Bot.X,f.ClipperBase.IsHorizontal(b)?
d.Value.Y=b.Bot.Y:(h=b.Bot.Y-b.Bot.X/b.Dx,d.Value.Y=f.Clipper.Round(d.Value.X/b.Dx+h));else{h=b.Bot.X-b.Bot.Y*b.Dx;m=c.Bot.X-c.Bot.Y*c.Dx;var l=(m-h)/(b.Dx-c.Dx);d.Value.Y=f.Clipper.Round(l);Math.abs(b.Dx)<Math.abs(c.Dx)?d.Value.X=f.Clipper.Round(b.Dx*l+h):d.Value.X=f.Clipper.Round(c.Dx*l+m)}if(d.Value.Y<b.Top.Y||d.Value.Y<c.Top.Y){if(b.Top.Y>c.Top.Y)return d.Value.Y=b.Top.Y,d.Value.X=f.Clipper.TopX(c,b.Top.Y),d.Value.X<b.Top.X;d.Value.Y=c.Top.Y;Math.abs(b.Dx)<Math.abs(c.Dx)?d.Value.X=f.Clipper.TopX(b,
d.Value.Y):d.Value.X=f.Clipper.TopX(c,d.Value.Y)}return!0};f.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(b){for(var c=this.m_ActiveEdges;null!==c;){var d=this.IsMaxima(c,b);d&&(d=this.GetMaximaPair(c),d=null===d||!f.ClipperBase.IsHorizontal(d));if(d){var h=c.PrevInAEL;this.DoMaxima(c);c=null===h?this.m_ActiveEdges:h.NextInAEL}else this.IsIntermediate(c,b)&&f.ClipperBase.IsHorizontal(c.NextInLML)?(function(){c={Value:c};var b=this.UpdateEdgeIntoAEL(c);c=c.Value;return b}.call(this),0<=c.OutIdx&&
this.AddOutPt(c,c.Bot),this.AddEdgeToSEL(c)):(c.Curr.X=f.Clipper.TopX(c,b),c.Curr.Y=b),this.StrictlySimple&&(h=c.PrevInAEL,0<=c.OutIdx&&0!==c.WindDelta&&null!==h&&0<=h.OutIdx&&h.Curr.X==c.Curr.X&&0!==h.WindDelta&&(d=this.AddOutPt(h,c.Curr),h=this.AddOutPt(c,c.Curr),this.AddJoin(d,h,c.Curr))),c=c.NextInAEL}this.ProcessHorizontals(!0);for(c=this.m_ActiveEdges;null!==c;){if(this.IsIntermediate(c,b)){d=null;0<=c.OutIdx&&(d=this.AddOutPt(c,c.Top));(function(){c={Value:c};var b=this.UpdateEdgeIntoAEL(c);
c=c.Value;return b}).call(this);var h=c.PrevInAEL,m=c.NextInAEL;null!==h&&h.Curr.X==c.Bot.X&&h.Curr.Y==c.Bot.Y&&null!==d&&0<=h.OutIdx&&h.Curr.Y>h.Top.Y&&f.ClipperBase.SlopesEqual(c,h,this.m_UseFullRange)&&0!==c.WindDelta&&0!==h.WindDelta?(h=this.AddOutPt(h,c.Bot),this.AddJoin(d,h,c.Top)):null!==m&&m.Curr.X==c.Bot.X&&m.Curr.Y==c.Bot.Y&&null!==d&&0<=m.OutIdx&&m.Curr.Y>m.Top.Y&&f.ClipperBase.SlopesEqual(c,m,this.m_UseFullRange)&&0!==c.WindDelta&&0!==m.WindDelta&&(h=this.AddOutPt(m,c.Bot),this.AddJoin(d,
h,c.Top))}c=c.NextInAEL}};f.Clipper.prototype.DoMaxima=function(b){var c=this.GetMaximaPair(b);if(null===c)0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b);else{for(var d=b.NextInAEL;null!==d&&d!=c;)this.IntersectEdges(b,d,b.Top,!0),this.SwapPositionsInAEL(b,d),d=b.NextInAEL;-1==b.OutIdx&&-1==c.OutIdx?(this.DeleteFromAEL(b),this.DeleteFromAEL(c)):0<=b.OutIdx&&0<=c.OutIdx?this.IntersectEdges(b,c,b.Top,!1):0===b.WindDelta?(0<=b.OutIdx&&(this.AddOutPt(b,b.Top),b.OutIdx=-1),this.DeleteFromAEL(b),
0<=c.OutIdx&&(this.AddOutPt(c,b.Top),c.OutIdx=-1),this.DeleteFromAEL(c)):f.Error("DoMaxima error")}};f.Clipper.ReversePaths=function(b){for(var c=0,d=b.length;c<d;c++)b[c].reverse()};f.Clipper.Orientation=function(b){return 0<=f.Clipper.Area(b)};f.Clipper.prototype.PointCount=function(b){if(null===b)return 0;var c=0,d=b;do c++,d=d.Next;while(d!=b);return c};f.Clipper.prototype.BuildResult=function(b){f.Clear(b);for(var c=0,d=this.m_PolyOuts.length;c<d;c++){var h=this.m_PolyOuts[c];if(null!==h.Pts){var h=
h.Pts.Prev,m=this.PointCount(h);if(!(2>m)){for(var l=Array(m),x=0;x<m;x++)l[x]=h.Pt,h=h.Prev;b.push(l)}}}};f.Clipper.prototype.BuildResult2=function(b){b.Clear();for(var c=0,d=this.m_PolyOuts.length;c<d;c++){var h=this.m_PolyOuts[c],m=this.PointCount(h.Pts);if(!(h.IsOpen&&2>m||!h.IsOpen&&3>m)){this.FixHoleLinkage(h);var l=new f.PolyNode;b.m_AllPolys.push(l);h.PolyNode=l;l.m_polygon.length=m;for(var h=h.Pts.Prev,x=0;x<m;x++)l.m_polygon[x]=h.Pt,h=h.Prev}}c=0;for(d=this.m_PolyOuts.length;c<d;c++)h=this.m_PolyOuts[c],
null!==h.PolyNode&&(h.IsOpen?(h.PolyNode.IsOpen=!0,b.AddChild(h.PolyNode)):null!==h.FirstLeft&&null!=h.FirstLeft.PolyNode?h.FirstLeft.PolyNode.AddChild(h.PolyNode):b.AddChild(h.PolyNode))};f.Clipper.prototype.FixupOutPolygon=function(b){var c=null;b.BottomPt=null;for(var d=b.Pts;;){if(d.Prev==d||d.Prev==d.Next){this.DisposeOutPts(d);b.Pts=null;return}if(f.IntPoint.op_Equality(d.Pt,d.Next.Pt)||f.IntPoint.op_Equality(d.Pt,d.Prev.Pt)||f.ClipperBase.SlopesEqual(d.Prev.Pt,d.Pt,d.Next.Pt,this.m_UseFullRange)&&
(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(d.Prev.Pt,d.Pt,d.Next.Pt)))c=null,d.Prev.Next=d.Next,d=d.Next.Prev=d.Prev;else if(d==c)break;else null===c&&(c=d),d=d.Next}b.Pts=d};f.Clipper.prototype.DupOutPt=function(b,c){var d=new f.OutPt;d.Pt.X=b.Pt.X;d.Pt.Y=b.Pt.Y;d.Idx=b.Idx;c?(d.Next=b.Next,d.Prev=b,b.Next.Prev=d,b.Next=d):(d.Prev=b.Prev,d.Next=b,b.Prev.Next=d,b.Prev=d);return d};f.Clipper.prototype.GetOverlap=function(b,c,d,h,f,l){b<c?d<h?(f.Value=Math.max(b,d),l.Value=Math.min(c,h)):
(f.Value=Math.max(b,h),l.Value=Math.min(c,d)):d<h?(f.Value=Math.max(c,d),l.Value=Math.min(b,h)):(f.Value=Math.max(c,h),l.Value=Math.min(b,d));return f.Value<l.Value};f.Clipper.prototype.JoinHorz=function(b,c,d,h,m,l){var x=b.Pt.X>c.Pt.X?f.Direction.dRightToLeft:f.Direction.dLeftToRight;h=d.Pt.X>h.Pt.X?f.Direction.dRightToLeft:f.Direction.dLeftToRight;if(x==h)return!1;if(x==f.Direction.dLeftToRight){for(;b.Next.Pt.X<=m.X&&b.Next.Pt.X>=b.Pt.X&&b.Next.Pt.Y==m.Y;)b=b.Next;l&&b.Pt.X!=m.X&&(b=b.Next);c=
this.DupOutPt(b,!l);f.IntPoint.op_Inequality(c.Pt,m)&&(b=c,b.Pt.X=m.X,b.Pt.Y=m.Y,c=this.DupOutPt(b,!l))}else{for(;b.Next.Pt.X>=m.X&&b.Next.Pt.X<=b.Pt.X&&b.Next.Pt.Y==m.Y;)b=b.Next;l||b.Pt.X==m.X||(b=b.Next);c=this.DupOutPt(b,l);f.IntPoint.op_Inequality(c.Pt,m)&&(b=c,b.Pt.X=m.X,b.Pt.Y=m.Y,c=this.DupOutPt(b,l))}if(h==f.Direction.dLeftToRight){for(;d.Next.Pt.X<=m.X&&d.Next.Pt.X>=d.Pt.X&&d.Next.Pt.Y==m.Y;)d=d.Next;l&&d.Pt.X!=m.X&&(d=d.Next);h=this.DupOutPt(d,!l);f.IntPoint.op_Inequality(h.Pt,m)&&(d=h,
d.Pt.X=m.X,d.Pt.Y=m.Y,h=this.DupOutPt(d,!l))}else{for(;d.Next.Pt.X>=m.X&&d.Next.Pt.X<=d.Pt.X&&d.Next.Pt.Y==m.Y;)d=d.Next;l||d.Pt.X==m.X||(d=d.Next);h=this.DupOutPt(d,l);f.IntPoint.op_Inequality(h.Pt,m)&&(d=h,d.Pt.X=m.X,d.Pt.Y=m.Y,h=this.DupOutPt(d,l))}x==f.Direction.dLeftToRight==l?(b.Prev=d,d.Next=b,c.Next=h,h.Prev=c):(b.Next=d,d.Prev=b,c.Prev=h,h.Next=c);return!0};f.Clipper.prototype.JoinPoints=function(b,c,d){var h=b.OutPt1,m=new f.OutPt,l=b.OutPt2,x=new f.OutPt;if((x=b.OutPt1.Pt.Y==b.OffPt.Y)&&
f.IntPoint.op_Equality(b.OffPt,b.OutPt1.Pt)&&f.IntPoint.op_Equality(b.OffPt,b.OutPt2.Pt)){for(m=b.OutPt1.Next;m!=h&&f.IntPoint.op_Equality(m.Pt,b.OffPt);)m=m.Next;m=m.Pt.Y>b.OffPt.Y;for(x=b.OutPt2.Next;x!=l&&f.IntPoint.op_Equality(x.Pt,b.OffPt);)x=x.Next;if(m==x.Pt.Y>b.OffPt.Y)return!1;m?(m=this.DupOutPt(h,!1),x=this.DupOutPt(l,!0),h.Prev=l,l.Next=h,m.Next=x,x.Prev=m):(m=this.DupOutPt(h,!0),x=this.DupOutPt(l,!1),h.Next=l,l.Prev=h,m.Prev=x,x.Next=m);b.OutPt1=h;b.OutPt2=m;return!0}if(x){for(m=h;h.Prev.Pt.Y==
h.Pt.Y&&h.Prev!=m&&h.Prev!=l;)h=h.Prev;for(;m.Next.Pt.Y==m.Pt.Y&&m.Next!=h&&m.Next!=l;)m=m.Next;if(m.Next==h||m.Next==l)return!1;for(x=l;l.Prev.Pt.Y==l.Pt.Y&&l.Prev!=x&&l.Prev!=m;)l=l.Prev;for(;x.Next.Pt.Y==x.Pt.Y&&x.Next!=l&&x.Next!=h;)x=x.Next;if(x.Next==l||x.Next==h)return!1;var q,r;q={Value:q};r={Value:r};c=this.GetOverlap(h.Pt.X,m.Pt.X,l.Pt.X,x.Pt.X,q,r);q=q.Value;r=r.Value;if(!c)return!1;c=new f.IntPoint;h.Pt.X>=q&&h.Pt.X<=r?(c.X=h.Pt.X,c.Y=h.Pt.Y,d=h.Pt.X>m.Pt.X):l.Pt.X>=q&&l.Pt.X<=r?(c.X=
l.Pt.X,c.Y=l.Pt.Y,d=l.Pt.X>x.Pt.X):m.Pt.X>=q&&m.Pt.X<=r?(c.X=m.Pt.X,c.Y=m.Pt.Y,d=m.Pt.X>h.Pt.X):(c.X=x.Pt.X,c.Y=x.Pt.Y,d=x.Pt.X>l.Pt.X);b.OutPt1=h;b.OutPt2=l;return this.JoinHorz(h,m,l,x,c,d)}for(m=h.Next;f.IntPoint.op_Equality(m.Pt,h.Pt)&&m!=h;)m=m.Next;if(q=m.Pt.Y>h.Pt.Y||!f.ClipperBase.SlopesEqual(h.Pt,m.Pt,b.OffPt,this.m_UseFullRange)){for(m=h.Prev;f.IntPoint.op_Equality(m.Pt,h.Pt)&&m!=h;)m=m.Prev;if(m.Pt.Y>h.Pt.Y||!f.ClipperBase.SlopesEqual(h.Pt,m.Pt,b.OffPt,this.m_UseFullRange))return!1}for(x=
l.Next;f.IntPoint.op_Equality(x.Pt,l.Pt)&&x!=l;)x=x.Next;if(r=x.Pt.Y>l.Pt.Y||!f.ClipperBase.SlopesEqual(l.Pt,x.Pt,b.OffPt,this.m_UseFullRange)){for(x=l.Prev;f.IntPoint.op_Equality(x.Pt,l.Pt)&&x!=l;)x=x.Prev;if(x.Pt.Y>l.Pt.Y||!f.ClipperBase.SlopesEqual(l.Pt,x.Pt,b.OffPt,this.m_UseFullRange))return!1}if(m==h||x==l||m==x||c==d&&q==r)return!1;q?(m=this.DupOutPt(h,!1),x=this.DupOutPt(l,!0),h.Prev=l,l.Next=h,m.Next=x,x.Prev=m):(m=this.DupOutPt(h,!0),x=this.DupOutPt(l,!1),h.Next=l,l.Prev=h,m.Prev=x,x.Next=
m);b.OutPt1=h;b.OutPt2=m;return!0};f.Clipper.GetBounds=function(b){for(var c=0,d=b.length;c<d&&0==b[c].length;)c++;if(c==d)return new f.IntRect(0,0,0,0);var h=new f.IntRect;h.left=b[c][0].X;h.right=h.left;h.top=b[c][0].Y;for(h.bottom=h.top;c<d;c++)for(var m=0,l=b[c].length;m<l;m++)b[c][m].X<h.left?h.left=b[c][m].X:b[c][m].X>h.right&&(h.right=b[c][m].X),b[c][m].Y<h.top?h.top=b[c][m].Y:b[c][m].Y>h.bottom&&(h.bottom=b[c][m].Y);return h};f.Clipper.prototype.GetBounds2=function(b){var c=b,d=new f.IntRect;
d.left=b.Pt.X;d.right=b.Pt.X;d.top=b.Pt.Y;d.bottom=b.Pt.Y;for(b=b.Next;b!=c;)b.Pt.X<d.left&&(d.left=b.Pt.X),b.Pt.X>d.right&&(d.right=b.Pt.X),b.Pt.Y<d.top&&(d.top=b.Pt.Y),b.Pt.Y>d.bottom&&(d.bottom=b.Pt.Y),b=b.Next;return d};f.ClipperBase.prototype.PointInPolygon=f.Clipper.prototype.PointInPolygon=function(){var b=arguments,c=b.length;if(2==c){for(var c=b[0],d=b[1],b=0,h=d;;){var f=d.Pt.X,l=d.Pt.Y,q=d.Next.Pt.X,G=d.Next.Pt.Y;if(G==c.Y&&(q==c.X||l==c.Y&&q>c.X==f<c.X))return-1;if(l<c.Y!=G<c.Y)if(f>=
c.X)if(q>c.X)b=1-b;else{f=(f-c.X)*(G-c.Y)-(q-c.X)*(l-c.Y);if(0==f)return-1;0<f==G>l&&(b=1-b)}else if(q>c.X){f=(f-c.X)*(G-c.Y)-(q-c.X)*(l-c.Y);if(0==f)return-1;0<f==G>l&&(b=1-b)}d=d.Next;if(h==d)break}return b}if(3==c){c=b[0];d=b[1];h=b[2];l=d;b=!1;if(h){do l.Pt.Y>c.Y!=l.Prev.Pt.Y>c.Y&&r.op_LessThan(new r(c.X-l.Pt.X),r.op_Division(r.Int128Mul(l.Prev.Pt.X-l.Pt.X,c.Y-l.Pt.Y),new r(l.Prev.Pt.Y-l.Pt.Y)))&&(b=!b),l=l.Next;while(l!=d)}else{do l.Pt.Y>c.Y!=l.Prev.Pt.Y>c.Y&&c.X-l.Pt.X<(l.Prev.Pt.X-l.Pt.X)*
(c.Y-l.Pt.Y)/(l.Prev.Pt.Y-l.Pt.Y)&&(b=!b),l=l.Next;while(l!=d)}return b}};f.Clipper.prototype.Poly2ContainsPoly1=function(b,c){var d=b;do{var h=this.PointInPolygon(d.Pt,c);if(0<=h)return 0!=h;d=d.Next}while(d!=b);return!0};f.Clipper.prototype.FixupFirstLefts1=function(b,c){for(var d=0,h=this.m_PolyOuts.length;d<h;d++){var f=this.m_PolyOuts[d];null!==f.Pts&&f.FirstLeft==b&&this.Poly2ContainsPoly1(f.Pts,c.Pts)&&(f.FirstLeft=c)}};f.Clipper.prototype.FixupFirstLefts2=function(b,c){for(var d=0,h=this.m_PolyOuts,
f=h.length,l=h[d];d<f;d++,l=h[d])l.FirstLeft==b&&(l.FirstLeft=c)};f.Clipper.ParseFirstLeft=function(b){for(;null!=b&&null==b.Pts;)b=b.FirstLeft;return b};f.Clipper.prototype.JoinCommonEdges=function(){for(var b=0,c=this.m_Joins.length;b<c;b++){var d=this.m_Joins[b],h=this.GetOutRec(d.OutPt1.Idx),m=this.GetOutRec(d.OutPt2.Idx);if(null!=h.Pts&&null!=m.Pts){var l;l=h==m?h:this.Param1RightOfParam2(h,m)?m:this.Param1RightOfParam2(m,h)?h:this.GetLowermostRec(h,m);if(this.JoinPoints(d,h,m))if(h==m){h.Pts=
d.OutPt1;h.BottomPt=null;m=this.CreateOutRec();m.Pts=d.OutPt2;this.UpdateOutPtIdxs(m);if(this.m_UsingPolyTree){l=0;for(var q=this.m_PolyOuts.length;l<q-1;l++){var r=this.m_PolyOuts[l];null!=r.Pts&&f.Clipper.ParseFirstLeft(r.FirstLeft)==h&&r.IsHole!=h.IsHole&&this.Poly2ContainsPoly1(r.Pts,d.OutPt2)&&(r.FirstLeft=m)}}this.Poly2ContainsPoly1(m.Pts,h.Pts)?(m.IsHole=!h.IsHole,m.FirstLeft=h,this.m_UsingPolyTree&&this.FixupFirstLefts2(m,h),(m.IsHole^this.ReverseSolution)==0<this.Area(m)&&this.ReversePolyPtLinks(m.Pts)):
this.Poly2ContainsPoly1(h.Pts,m.Pts)?(m.IsHole=h.IsHole,h.IsHole=!m.IsHole,m.FirstLeft=h.FirstLeft,h.FirstLeft=m,this.m_UsingPolyTree&&this.FixupFirstLefts2(h,m),(h.IsHole^this.ReverseSolution)==0<this.Area(h)&&this.ReversePolyPtLinks(h.Pts)):(m.IsHole=h.IsHole,m.FirstLeft=h.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(h,m))}else m.Pts=null,m.BottomPt=null,m.Idx=h.Idx,h.IsHole=l.IsHole,l==m&&(h.FirstLeft=m.FirstLeft),m.FirstLeft=h,this.m_UsingPolyTree&&this.FixupFirstLefts2(m,h)}}};f.Clipper.prototype.UpdateOutPtIdxs=
function(b){var c=b.Pts;do c.Idx=b.Idx,c=c.Prev;while(c!=b.Pts)};f.Clipper.prototype.DoSimplePolygons=function(){for(var b=0;b<this.m_PolyOuts.length;){var c=this.m_PolyOuts[b++],d=c.Pts;if(null!==d){do{for(var h=d.Next;h!=c.Pts;){if(f.IntPoint.op_Equality(d.Pt,h.Pt)&&h.Next!=d&&h.Prev!=d){var m=d.Prev,l=h.Prev;d.Prev=l;l.Next=d;h.Prev=m;m.Next=h;c.Pts=d;m=this.CreateOutRec();m.Pts=h;this.UpdateOutPtIdxs(m);this.Poly2ContainsPoly1(m.Pts,c.Pts)?(m.IsHole=!c.IsHole,m.FirstLeft=c):this.Poly2ContainsPoly1(c.Pts,
m.Pts)?(m.IsHole=c.IsHole,c.IsHole=!m.IsHole,m.FirstLeft=c.FirstLeft,c.FirstLeft=m):(m.IsHole=c.IsHole,m.FirstLeft=c.FirstLeft);h=d}h=h.Next}d=d.Next}while(d!=c.Pts)}}};f.Clipper.Area=function(b){var c=b.length;if(3>c)return 0;for(var d=0,h=0,f=c-1;h<c;++h)d+=(b[f].X+b[h].X)*(b[f].Y-b[h].Y),f=h;return.5*-d};f.Clipper.prototype.Area=function(b){var c=b.Pts;if(null==c)return 0;var d=0;do d+=(c.Prev.Pt.X+c.Pt.X)*(c.Prev.Pt.Y-c.Pt.Y),c=c.Next;while(c!=b.Pts);return.5*d};f.Clipper.SimplifyPolygon=function(b,
c){var d=[],h=new f.Clipper(0);h.StrictlySimple=!0;h.AddPath(b,f.PolyType.ptSubject,!0);h.Execute(f.ClipType.ctUnion,d,c,c);return d};f.Clipper.SimplifyPolygons=function(b,c){"undefined"==typeof c&&(c=f.PolyFillType.pftEvenOdd);var d=[],h=new f.Clipper(0);h.StrictlySimple=!0;h.AddPaths(b,f.PolyType.ptSubject,!0);h.Execute(f.ClipType.ctUnion,d,c,c);return d};f.Clipper.DistanceSqrd=function(b,c){var d=b.X-c.X,h=b.Y-c.Y;return d*d+h*h};f.Clipper.DistanceFromLineSqrd=function(b,c,d){var h=c.Y-d.Y;d=d.X-
c.X;c=h*c.X+d*c.Y;c=h*b.X+d*b.Y-c;return c*c/(h*h+d*d)};f.Clipper.SlopesNearCollinear=function(b,c,d,h){return f.Clipper.DistanceFromLineSqrd(c,b,d)<h};f.Clipper.PointsAreClose=function(b,c,d){var h=b.X-c.X;b=b.Y-c.Y;return h*h+b*b<=d};f.Clipper.ExcludeOp=function(b){var c=b.Prev;c.Next=b.Next;b.Next.Prev=c;c.Idx=0;return c};f.Clipper.CleanPolygon=function(b,c){"undefined"==typeof c&&(c=1.415);var d=b.length;if(0==d)return[];for(var h=Array(d),m=0;m<d;++m)h[m]=new f.OutPt;for(m=0;m<d;++m)h[m].Pt=
b[m],h[m].Next=h[(m+1)%d],h[m].Next.Prev=h[m],h[m].Idx=0;m=c*c;for(h=h[0];0==h.Idx&&h.Next!=h.Prev;)f.Clipper.PointsAreClose(h.Pt,h.Prev.Pt,m)?(h=f.Clipper.ExcludeOp(h),d--):f.Clipper.PointsAreClose(h.Prev.Pt,h.Next.Pt,m)?(f.Clipper.ExcludeOp(h.Next),h=f.Clipper.ExcludeOp(h),d-=2):f.Clipper.SlopesNearCollinear(h.Prev.Pt,h.Pt,h.Next.Pt,m)?(h=f.Clipper.ExcludeOp(h),d--):(h.Idx=1,h=h.Next);3>d&&(d=0);for(var l=Array(d),m=0;m<d;++m)l[m]=new f.IntPoint(h.Pt),h=h.Next;return l};f.Clipper.CleanPolygons=
function(b,c){for(var d=Array(b.length),h=0,m=b.length;h<m;h++)d[h]=f.Clipper.CleanPolygon(b[h],c);return d};f.Clipper.Minkowski=function(b,c,d,h){var m=h?1:0,l=b.length,q=c.length;h=[];if(d)for(d=0;d<q;d++){for(var r=Array(l),G=0,C=b.length,L=b[G];G<C;G++,L=b[G])r[G]=new f.IntPoint(c[d].X+L.X,c[d].Y+L.Y);h.push(r)}else for(d=0;d<q;d++){r=Array(l);G=0;C=b.length;for(L=b[G];G<C;G++,L=b[G])r[G]=new f.IntPoint(c[d].X-L.X,c[d].Y-L.Y);h.push(r)}b=[];for(d=0;d<=q-2+m;d++)for(G=0;G<=l-1;G++)c=[],c.push(h[d%
q][G%l]),c.push(h[(d+1)%q][G%l]),c.push(h[(d+1)%q][(G+1)%l]),c.push(h[d%q][(G+1)%l]),f.Clipper.Orientation(c)||c.reverse(),b.push(c);m=new f.Clipper(0);m.AddPaths(b,f.PolyType.ptSubject,!0);m.Execute(f.ClipType.ctUnion,h,f.PolyFillType.pftNonZero,f.PolyFillType.pftNonZero);return h};f.Clipper.MinkowskiSum=function(b,c,d){return f.Clipper.Minkowski(b,c,!0,d)};f.Clipper.MinkowskiDiff=function(b,c,d){return f.Clipper.Minkowski(b,c,!1,d)};f.Clipper.PolyTreeToPaths=function(b){var c=[];f.Clipper.AddPolyNodeToPaths(b,
f.Clipper.NodeType.ntAny,c);return c};f.Clipper.AddPolyNodeToPaths=function(b,c,d){var h=!0;switch(c){case f.Clipper.NodeType.ntOpen:return;case f.Clipper.NodeType.ntClosed:h=!b.IsOpen}0<b.m_polygon.length&&h&&d.push(b.m_polygon);h=0;b=b.Childs();for(var m=b.length,l=b[h];h<m;h++,l=b[h])f.Clipper.AddPolyNodeToPaths(l,c,d)};f.Clipper.OpenPathsFromPolyTree=function(b){for(var c=new f.Paths,d=0,h=b.ChildCount();d<h;d++)b.Childs()[d].IsOpen&&c.push(b.Childs()[d].m_polygon);return c};f.Clipper.ClosedPathsFromPolyTree=
function(b){var c=new f.Paths;f.Clipper.AddPolyNodeToPaths(b,f.Clipper.NodeType.ntClosed,c);return c};Pa(f.Clipper,f.ClipperBase);f.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};f.ClipperOffset=function(b,c){"undefined"==typeof b&&(b=2);"undefined"==typeof c&&(c=f.ClipperOffset.def_arc_tolerance);this.m_destPolys=new f.Paths;this.m_srcPoly=new f.Path;this.m_destPoly=new f.Path;this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new f.IntPoint;
this.m_polyNodes=new f.PolyNode;this.MiterLimit=b;this.ArcTolerance=c;this.m_lowest.X=-1};f.ClipperOffset.two_pi=6.28318530717959;f.ClipperOffset.def_arc_tolerance=.25;f.ClipperOffset.prototype.Clear=function(){f.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};f.ClipperOffset.Round=f.Clipper.Round;f.ClipperOffset.prototype.AddPath=function(b,c,d){var h=b.length-1;if(!(0>h)){var m=new f.PolyNode;m.m_jointype=c;m.m_endtype=d;if(d==f.EndType.etClosedLine||d==f.EndType.etClosedPolygon)for(;0<h&&
f.IntPoint.op_Equality(b[0],b[h]);)h--;m.m_polygon.push(b[0]);var l=0;c=0;for(var q=1;q<=h;q++)f.IntPoint.op_Inequality(m.m_polygon[l],b[q])&&(l++,m.m_polygon.push(b[q]),b[q].Y>m.m_polygon[c].Y||b[q].Y==m.m_polygon[c].Y&&b[q].X<m.m_polygon[c].X)&&(c=l);if(!(d==f.EndType.etClosedPolygon&&2>l||d!=f.EndType.etClosedPolygon&&0>l)&&(this.m_polyNodes.AddChild(m),d==f.EndType.etClosedPolygon))if(0>this.m_lowest.X)this.m_lowest=new f.IntPoint(0,c);else if(b=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],
m.m_polygon[c].Y>b.Y||m.m_polygon[c].Y==b.Y&&m.m_polygon[c].X<b.X)this.m_lowest=new f.IntPoint(this.m_polyNodes.ChildCount()-1,c)}};f.ClipperOffset.prototype.AddPaths=function(b,c,d){for(var h=0,f=b.length;h<f;h++)this.AddPath(b[h],c,d)};f.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!f.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var b=0;b<this.m_polyNodes.ChildCount();b++){var c=this.m_polyNodes.Childs()[b];(c.m_endtype==f.EndType.etClosedPolygon||
c.m_endtype==f.EndType.etClosedLine&&f.Clipper.Orientation(c.m_polygon))&&c.m_polygon.reverse()}else for(b=0;b<this.m_polyNodes.ChildCount();b++)c=this.m_polyNodes.Childs()[b],c.m_endtype!=f.EndType.etClosedLine||f.Clipper.Orientation(c.m_polygon)||c.m_polygon.reverse()};f.ClipperOffset.GetUnitNormal=function(b,c){var d=c.X-b.X,h=c.Y-b.Y;if(0==d&&0==h)return new f.DoublePoint(0,0);var m=1/Math.sqrt(d*d+h*h);return new f.DoublePoint(h*m,-(d*m))};f.ClipperOffset.prototype.DoOffset=function(b){this.m_destPolys=
[];this.m_delta=b;if(f.ClipperBase.near_zero(b))for(var c=0;c<this.m_polyNodes.ChildCount();c++){var d=this.m_polyNodes.Childs()[c];d.m_endtype==f.EndType.etClosedPolygon&&this.m_destPolys.push(d.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var c=0>=this.ArcTolerance?f.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(b)*f.ClipperOffset.def_arc_tolerance?Math.abs(b)*f.ClipperOffset.def_arc_tolerance:this.ArcTolerance,h=3.14159265358979/Math.acos(1-
c/Math.abs(b));this.m_sin=Math.sin(f.ClipperOffset.two_pi/h);this.m_cos=Math.cos(f.ClipperOffset.two_pi/h);this.m_StepsPerRad=h/f.ClipperOffset.two_pi;0>b&&(this.m_sin=-this.m_sin);for(c=0;c<this.m_polyNodes.ChildCount();c++){d=this.m_polyNodes.Childs()[c];this.m_srcPoly=d.m_polygon;var m=this.m_srcPoly.length;if(!(0==m||0>=b&&(3>m||d.m_endtype!=f.EndType.etClosedPolygon))){this.m_destPoly=[];if(1==m)if(d.m_jointype==f.JoinType.jtRound)for(var d=1,m=0,l=1;l<=h;l++){this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+
d*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+m*b)));var q=d,d=d*this.m_cos-this.m_sin*m,m=q*this.m_sin+m*this.m_cos}else for(m=d=-1,l=0;4>l;++l)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+d*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+m*b))),0>d?d=1:0>m?m=1:d=-1;else{for(l=this.m_normals.length=0;l<m-1;l++)this.m_normals.push(f.ClipperOffset.GetUnitNormal(this.m_srcPoly[l],this.m_srcPoly[l+1]));d.m_endtype==f.EndType.etClosedLine||d.m_endtype==f.EndType.etClosedPolygon?
this.m_normals.push(f.ClipperOffset.GetUnitNormal(this.m_srcPoly[m-1],this.m_srcPoly[0])):this.m_normals.push(new f.DoublePoint(this.m_normals[m-2]));if(d.m_endtype==f.EndType.etClosedPolygon)for(q=m-1,l=0;l<m;l++)q=this.OffsetPoint(l,q,d.m_jointype);else if(d.m_endtype==f.EndType.etClosedLine){q=m-1;for(l=0;l<m;l++)q=this.OffsetPoint(l,q,d.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=[];q=this.m_normals[m-1];for(l=m-1;0<l;l--)this.m_normals[l]=new f.DoublePoint(-this.m_normals[l-
1].X,-this.m_normals[l-1].Y);this.m_normals[0]=new f.DoublePoint(-q.X,-q.Y);q=0;for(l=m-1;0<=l;l--)q=this.OffsetPoint(l,q,d.m_jointype)}else{q=0;for(l=1;l<m-1;++l)q=this.OffsetPoint(l,q,d.m_jointype);d.m_endtype==f.EndType.etOpenButt?(l=m-1,q=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[l].X+this.m_normals[l].X*b),f.ClipperOffset.Round(this.m_srcPoly[l].Y+this.m_normals[l].Y*b)),this.m_destPoly.push(q),q=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[l].X-this.m_normals[l].X*b),f.ClipperOffset.Round(this.m_srcPoly[l].Y-
this.m_normals[l].Y*b)),this.m_destPoly.push(q)):(l=m-1,q=m-2,this.m_sinA=0,this.m_normals[l]=new f.DoublePoint(-this.m_normals[l].X,-this.m_normals[l].Y),d.m_endtype==f.EndType.etOpenSquare?this.DoSquare(l,q):this.DoRound(l,q));for(l=m-1;0<l;l--)this.m_normals[l]=new f.DoublePoint(-this.m_normals[l-1].X,-this.m_normals[l-1].Y);this.m_normals[0]=new f.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y);q=m-1;for(l=q-1;0<l;--l)q=this.OffsetPoint(l,q,d.m_jointype);d.m_endtype==f.EndType.etOpenButt?
(q=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*b)),this.m_destPoly.push(q),q=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*b)),this.m_destPoly.push(q)):(this.m_sinA=0,d.m_endtype==f.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};f.ClipperOffset.prototype.Execute=
function(){var b=arguments;if(b[0]instanceof f.PolyTree)if(c=b[0],d=b[1],c.Clear(),this.FixOrientations(),this.DoOffset(d),b=new f.Clipper(0),b.AddPaths(this.m_destPolys,f.PolyType.ptSubject,!0),0<d)b.Execute(f.ClipType.ctUnion,c,f.PolyFillType.pftPositive,f.PolyFillType.pftPositive);else if(d=f.Clipper.GetBounds(this.m_destPolys),h=new f.Path,h.push(new f.IntPoint(d.left-10,d.bottom+10)),h.push(new f.IntPoint(d.right+10,d.bottom+10)),h.push(new f.IntPoint(d.right+10,d.top-10)),h.push(new f.IntPoint(d.left-
10,d.top-10)),b.AddPath(h,f.PolyType.ptSubject,!0),b.ReverseSolution=!0,b.Execute(f.ClipType.ctUnion,c,f.PolyFillType.pftNegative,f.PolyFillType.pftNegative),1==c.ChildCount()&&0<c.Childs()[0].ChildCount())for(b=c.Childs()[0],c.Childs()[0]=b.Childs()[0],d=1;d<b.ChildCount();d++)c.AddChild(b.Childs()[d]);else c.Clear();else{var c=b[0],d=b[1];f.Clear(c);this.FixOrientations();this.DoOffset(d);b=new f.Clipper(0);b.AddPaths(this.m_destPolys,f.PolyType.ptSubject,!0);if(0<d)b.Execute(f.ClipType.ctUnion,
c,f.PolyFillType.pftPositive,f.PolyFillType.pftPositive);else{var d=f.Clipper.GetBounds(this.m_destPolys),h=new f.Path;h.push(new f.IntPoint(d.left-10,d.bottom+10));h.push(new f.IntPoint(d.right+10,d.bottom+10));h.push(new f.IntPoint(d.right+10,d.top-10));h.push(new f.IntPoint(d.left-10,d.top-10));b.AddPath(h,f.PolyType.ptSubject,!0);b.ReverseSolution=!0;b.Execute(f.ClipType.ctUnion,c,f.PolyFillType.pftNegative,f.PolyFillType.pftNegative);0<c.length&&c.splice(0,1)}}};f.ClipperOffset.prototype.OffsetPoint=
function(b,c,d){this.m_sinA=this.m_normals[c].X*this.m_normals[b].Y-this.m_normals[b].X*this.m_normals[c].Y;if(5E-5>this.m_sinA&&-5E-5<this.m_sinA)return c;1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[c].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[c].Y*this.m_delta))),this.m_destPoly.push(new f.IntPoint(this.m_srcPoly[b])),this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+
this.m_normals[b].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)));else switch(d){case f.JoinType.jtMiter:d=1+(this.m_normals[b].X*this.m_normals[c].X+this.m_normals[b].Y*this.m_normals[c].Y);d>=this.m_miterLim?this.DoMiter(b,c,d):this.DoSquare(b,c);break;case f.JoinType.jtSquare:this.DoSquare(b,c);break;case f.JoinType.jtRound:this.DoRound(b,c)}return b};f.ClipperOffset.prototype.DoSquare=function(b,c){var d=Math.tan(Math.atan2(this.m_sinA,this.m_normals[c].X*
this.m_normals[b].X+this.m_normals[c].Y*this.m_normals[b].Y)/4);this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[c].X-this.m_normals[c].Y*d)),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[c].Y+this.m_normals[c].X*d))));this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[b].X+this.m_normals[b].Y*d)),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[b].Y-
this.m_normals[b].X*d))))};f.ClipperOffset.prototype.DoMiter=function(b,c,d){d=this.m_delta/d;this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+(this.m_normals[c].X+this.m_normals[b].X)*d),f.ClipperOffset.Round(this.m_srcPoly[b].Y+(this.m_normals[c].Y+this.m_normals[b].Y)*d)))};f.ClipperOffset.prototype.DoRound=function(b,c){for(var d=Math.atan2(this.m_sinA,this.m_normals[c].X*this.m_normals[b].X+this.m_normals[c].Y*this.m_normals[b].Y),d=f.Cast_Int32(f.ClipperOffset.Round(this.m_StepsPerRad*
Math.abs(d))),h=this.m_normals[c].X,m=this.m_normals[c].Y,l,q=0;q<d;++q)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+h*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+m*this.m_delta))),l=h,h=h*this.m_cos-this.m_sin*m,m=l*this.m_sin+m*this.m_cos;this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)))};f.Error=function(b){try{throw Error(b);
}catch(c){alert(c.message)}};f.JS={};f.JS.AreaOfPolygon=function(b,c){c||(c=1);return f.Clipper.Area(b)/(c*c)};f.JS.AreaOfPolygons=function(b,c){c||(c=1);for(var d=0,h=0;h<b.length;h++)d+=f.Clipper.Area(b[h]);return d/(c*c)};f.JS.BoundsOfPath=function(b,c){return f.JS.BoundsOfPaths([b],c)};f.JS.BoundsOfPaths=function(b,c){c||(c=1);var d=f.Clipper.GetBounds(b);d.left/=c;d.bottom/=c;d.right/=c;d.top/=c;return d};f.JS.Clean=function(b,c){if(!(b instanceof Array))return[];var d=b[0]instanceof Array;b=
f.JS.Clone(b);if("number"!=typeof c||null===c)return f.Error("Delta is not a number in Clean()."),b;if(0===b.length||1==b.length&&0===b[0].length||0>c)return b;d||(b=[b]);for(var h=b.length,m,l,q,r,G,C,L,F=[],P=0;P<h;P++)if(l=b[P],m=l.length,0!==m)if(3>m)q=l,F.push(q);else{q=l;r=c*c;G=l[0];for(L=C=1;L<m;L++)(l[L].X-G.X)*(l[L].X-G.X)+(l[L].Y-G.Y)*(l[L].Y-G.Y)<=r||(q[C]=l[L],G=l[L],C++);G=l[C-1];(l[0].X-G.X)*(l[0].X-G.X)+(l[0].Y-G.Y)*(l[0].Y-G.Y)<=r&&C--;C<m&&q.splice(C,m-C);q.length&&F.push(q)}!d&&
F.length?F=F[0]:d||0!==F.length?d&&0===F.length&&(F=[[]]):F=[];return F};f.JS.Clone=function(b){if(!(b instanceof Array)||0===b.length)return[];if(1==b.length&&0===b[0].length)return[[]];var c=b[0]instanceof Array;c||(b=[b]);var d=b.length,h,f,l,q,r=Array(d);for(f=0;f<d;f++){h=b[f].length;q=Array(h);for(l=0;l<h;l++)q[l]={X:b[f][l].X,Y:b[f][l].Y};r[f]=q}c||(r=r[0]);return r};f.JS.Lighten=function(b,c){if(!(b instanceof Array))return[];if("number"!=typeof c||null===c)return f.Error("Tolerance is not a number in Lighten()."),
f.JS.Clone(b);if(0===b.length||1==b.length&&0===b[0].length||0>c)return f.JS.Clone(b);b[0]instanceof Array||(b=[b]);var d,h,m,l,q,r,G,C,F,P,O,K,T,S,V,da=b.length,ca=c*c,Y=[];for(d=0;d<da;d++)if(m=b[d],r=m.length,0!=r){for(l=0;1E6>l;l++){q=[];r=m.length;m[r-1].X!=m[0].X||m[r-1].Y!=m[0].Y?(O=1,m.push({X:m[0].X,Y:m[0].Y}),r=m.length):O=0;P=[];for(h=0;h<r-2;h++){G=m[h];F=m[h+1];C=m[h+2];S=G.X;V=G.Y;G=C.X-S;K=C.Y-V;if(0!==G||0!==K)T=((F.X-S)*G+(F.Y-V)*K)/(G*G+K*K),1<T?(S=C.X,V=C.Y):0<T&&(S+=G*T,V+=K*T);
G=F.X-S;K=F.Y-V;C=G*G+K*K;C<=ca&&(P[h+1]=1,h++)}q.push({X:m[0].X,Y:m[0].Y});for(h=1;h<r-1;h++)P[h]||q.push({X:m[h].X,Y:m[h].Y});q.push({X:m[r-1].X,Y:m[r-1].Y});O&&m.pop();if(P.length)m=q;else break}r=q.length;q[r-1].X==q[0].X&&q[r-1].Y==q[0].Y&&q.pop();2<q.length&&Y.push(q)}b[0]instanceof Array||(Y=Y[0]);"undefined"==typeof Y&&(Y=[[]]);return Y};f.JS.PerimeterOfPath=function(b,c,d){if("undefined"==typeof b)return 0;var h=Math.sqrt,f=0,l,q,r=0,G=0,C=b.length;if(2>C)return 0;for(c&&(b[C]=b[0],C++);--C;)l=
b[C],r=l.X,l=l.Y,q=b[C-1],G=q.X,q=q.Y,f+=h((r-G)*(r-G)+(l-q)*(l-q));c&&b.pop();return f/d};f.JS.PerimeterOfPaths=function(b,c,d){d||(d=1);for(var h=0,m=0;m<b.length;m++)h+=f.JS.PerimeterOfPath(b[m],c,d);return h};f.JS.ScaleDownPath=function(b,c){var d,h;c||(c=1);for(d=b.length;d--;)h=b[d],h.X/=c,h.Y/=c};f.JS.ScaleDownPaths=function(b,c){var d,h,f;c||(c=1);for(d=b.length;d--;)for(h=b[d].length;h--;)f=b[d][h],f.X/=c,f.Y/=c};f.JS.ScaleUpPath=function(b,c){var d,f,m=Math.round;c||(c=1);for(d=b.length;d--;)f=
b[d],f.X=m(f.X*c),f.Y=m(f.Y*c)};f.JS.ScaleUpPaths=function(b,c){var d,f,m,l=Math.round;c||(c=1);for(d=b.length;d--;)for(f=b[d].length;f--;)m=b[d][f],m.X=l(m.X*c),m.Y=l(m.Y*c)};f.ExPolygons=function(){return[]};f.ExPolygon=function(){this.holes=this.outer=null};f.JS.AddOuterPolyNodeToExPolygons=function(b,c){var d=new f.ExPolygon;d.outer=b.Contour();var h=b.Childs(),m=h.length;d.holes=Array(m);var l,q,r,G,C;for(q=0;q<m;q++)for(l=h[q],d.holes[q]=l.Contour(),r=0,G=l.Childs(),C=G.length;r<C;r++)l=G[r],
f.JS.AddOuterPolyNodeToExPolygons(l,c);c.push(d)};f.JS.ExPolygonsToPaths=function(b){var c,d,h,m,l=new f.Paths;c=0;for(h=b.length;c<h;c++)for(l.push(b[c].outer),d=0,m=b[c].holes.length;d<m;d++)l.push(b[c].holes[d]);return l};f.JS.PolyTreeToExPolygons=function(b){var c=new f.ExPolygons,d,h,m;d=0;h=b.Childs();for(m=h.length;d<m;d++)b=h[d],f.JS.AddOuterPolyNodeToExPolygons(b,c);return c}})();
var createCindy=function(){function r(r){if(0===Y)return console.error("Waiting for "+r+" after we finished waiting."),function(){};0>Y&&(Y=0);++Y;return function(){--Y;0>Y&&console.error("Wait count mismatch: "+r);if(0===Y)for(var F=0,q=La.length;F<q;)La[F++].startup()}}function F(r){var P=F.newInstance(r);0>=Y?P.startup():!1!==r.autostart&&La.push(P);return P}var Y=-1,La=[];"undefined"===typeof document||"undefined"===typeof window||"undefined"===typeof document.addEventListener||"undefined"!==
typeof window.cindyDontWait&&!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",r("DOMContentLoaded"));var ya=null,wa=null,ca={};F.getBaseDir=function(){if(null!==ya)return ya;for(var r=document.getElementsByTagName("script"),F=0;F<r.length;++F){var q=r[F],O=q.src;if(O){var K=/Cindy\.js$/.exec(O);if(K)return ya=O.substr(0,K.index),console.log("Will load extensions from "+ya),wa=q,ya}}console.error("Could not find <script> tag for Cindy.js");return ya=wa=!1};F.addNewScript=function(r,
P){P||console.error.bind(console);var q=F.getBaseDir();if(!1===q)return!1;var O=document.createElement("script");O.src=q+r;var q=wa.nextSibling,K=wa.parentElement;q?K.insertBefore(O,q):K.appendChild(O);return O};F.loadScript=function(r,P,q,O){if(window[r])return q(),!0;O||(O=console.error.bind(console));var K=ca[r];if(!K){K=F.addNewScript(P,O);if(!1===K)return O("Can't load additional components."),!1;ca[r]=K}K.addEventListener("load",q);K.addEventListener("error",O);return null};F._autoLoadingPlugin=
{};F.autoLoadPlugin=function(r,P,q){if(F._pluginRegistry[r])return q(),!0;var O=F._autoLoadingPlugin[r];if(!O){P||(P=r+"-plugin.js");O=F._autoLoadingPlugin[r]=[];r=F.addNewScript(P);if(!1===r)return!1;r.addEventListener("error",console.error.bind(console))}O.push(q);return null};F.waitFor=r;F._pluginRegistry={};F.instances=[];F.registerPlugin=function(r,P,q){if(1!==r)return console.error("Plugin API version "+r+" not supported"),!1;F._pluginRegistry[P]=q;(F._autoLoadingPlugin[P]||[]).forEach(function(q){q()})};
F.newInstance=function(r){var F,q,O,K,Y,ca;function ya(a){if(a){for(var n=0;n<a.length;n++){var e=a[n],D=Object.keys(e)[0];"scale"===D&&(fb=e.scale,v[D](e.scale));if("translate"===D)v[D](e.translate[0],e.translate[1]);"scaleAndOrigin"===D&&(fb=e[D][0]/25,v[D].apply(null,e[D]));"visibleRect"===D&&(v[D].apply(null,e[D]),fb=v.drawingstate.initialmatrix.a/25)}v.createnewbackup()}}function wa(){ub=!0;if(0===gb){void 0!==r.csconsole&&(ma=r.csconsole);ma=null===ma?new Va:!0===ma?new Oa:"string"===typeof ma?
new Fa(ma):"object"===typeof ma&&"function"===typeof ma.appendChild?new Fa(ma):new Va;$a=[100,100];var a,n=null,e=r.transform;r.ports&&0<r.ports.length&&(a=r.ports[0],(n=a.element)||(n=document.getElementById(a.id)),"window"===a.fill?(n.setAttribute("width",window.innerWidth),n.setAttribute("height",window.innerHeight)):a.width&&a.height&&(n.setAttribute("width",a.width),n.setAttribute("height",a.height)),a.background&&(n.style.backgroundColor=a.background),void 0!==a.transform&&(e=a.transform));
n||(n=r.canvas)||"undefined"===typeof document||(n=document.getElementById(r.canvasname));n&&(B=n.getContext("2d"),B.setLineDash||(B.setLineDash=function(){}));a=ab(Ec);a=na(a,!1);y(a);var D=r.scripts,c=null;"string"===typeof D&&D.search(/\*/)&&(c=D);"object"!==typeof D&&(D=null);"move keydown mousedown mouseup mousedrag init tick draw simulationstep cssimulationstart cssimulationstop".split(" ").forEach(function(a){var e;if(null!==D&&D[a])e=D[a];else{e=a+"script";if(r[e])e=document.getElementById(r[e]);
else if(c){if(e=document.getElementById(c.replace(/\*/,a)),!e)return}else return;e=e.text}e=ab(e);e=na(e,!1);"error"===e.ctype?console.error("Error compiling "+a+" script: "+e.message):ka[a]=e});r.grid&&0!==r.grid&&(Ga=r.grid,Yb=na("#drawgrid("+Ga+")",!1));r.snap&&(Zb=r.snap);n&&(ia=n.width,ba=n.height,ya(e),v.drawingstate.matrix.ty-=ba,v.drawingstate.initialmatrix.ty-=ba,e=1,"undefined"!==typeof window&&window.devicePixelRatio&&(e=window.devicePixelRatio),a=B.webkitBackingStorePixelRatio||B.mozBackingStorePixelRatio||
B.msBackingStorePixelRatio||B.oBackingStorePixelRatio||B.backingStorePixelRatio||1,e!==a&&(e/=a,n.width=ia*e,n.height=ba*e,n.style.width||(n.style.width=ia+"px"),n.style.height||(n.style.height=ba+"px"),B.scale(e,e)));ca=Y=K=O=q=F=void 0;e=0;ga={};r.geometry||(r.geometry=[]);Fc(r.geometry);r.behavior||(r.behavior=[]);"function"===typeof wb&&wb(r.behavior);for(var d in r.images)e=r.images[d],ga[d]=new Image,ga[d].ready=!1,ga[d].onload=function(){ga[d].ready=!0;b()},ga[d].src=e;sa.canvas=n;if(r.oninit)r.oninit(sa);
if(r.exclusive)for(e=xa.instances.length;0<e;)xa.instances[--e].shutdown();xa.instances.push(sa);r.use&&r.use.forEach(function(a){t.use$1([w.wrap(a)],{})});$b.convexhull3d$1&&Da("quickhull3d","quickhull3d/quickhull3d.nocache.js");f()}}function Da(a,n){var e=null;r.plugins&&(e=r.plugins[a]);e||(e=xa._pluginRegistry[a]);e?t.use$1([w.wrap(a)],{}):(++ac,xa.autoLoadPlugin(a,n,function(){t.use$1([w.wrap(a)],{});f()}))}function f(){0===--ac&&(y(ka.init),r.autoplay&&V(),sa.canvas&&da(sa.canvas,r))}function Ua(){null!==
bb&&(ea.set(bb.state),Object.keys(bb.speeds).forEach(function(a){var n=q[a];"undefined"!==typeof n.behavior&&(a=bb.speeds[a],n.behavior.vx=a[0],n.behavior.vy=a[1],n.behavior.vz=a[2],n.behavior.fx=0,n.behavior.fy=0,n.behavior.fz=0)}),Gc())}function V(){if(!Aa){if(ib){var a=Ha.backup;a.set(ea);for(var n={},e=0;e<O.length;e++){var D=O[e];"undefined"!==typeof D.behavior&&(n[D.name]=[D.behavior.vx,D.behavior.vy,D.behavior.vz])}bb={state:a,speeds:n};ib=!1}"function"===typeof wb&&xb&&Hc(oa);Aa=!0;Pa()}}
function S(){Aa&&(Aa=!1)}function Na(){ib||(Aa=!1,ib=!0,Ua())}function za(){if(!yb){yb=!0;for(var a=xa.instances.length;0<a;)if(xa.instances[--a]===sa){xa.instances.splice(a,1);break}for(a=Wa.length;0<a;)try{Wa[--a]()}catch(n){console.error(n)}}}function Ea(a){this.in=function(a,e){console.log(a);e?this.append(this.createTextNode("span","blue",a)):this.append(this.createTextNode("p","blue",a))};this.out=function(a,e){console.log(a);e?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p",
"red",a))};this.err=function(a,e){console.log(a);e?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p","red",a))};this.createTextNode=function(a,e,D){return"undefined"!==typeof document?(a=document.createElement(a),a.appendChild(document.createTextNode(D)),a.style.color=e,a):D+"\n"}}function Oa(){var a=this,n,e=document.createElement("div"),D;e.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>';
document.body.appendChild(e);n=document.getElementById("cmd");D=document.getElementById("log");n.onkeydown=function(e){13===e.keyCode&&""!==n.value&&(a.in(n.value),e=t.parse$1([w.wrap(n.value)],[]),e=y(e),console.log(L(e)),"undefined"!==e.ctype&&ma.out(L(e)),n.value="",D.scrollTop=D.scrollHeight)};this.append=function(a){D.appendChild(a)};this.clear=function(){D.innerHTML=""}}function Fa(a){var n=a;"string"===typeof a&&(n=document.getElementById(a));this.append=function(a){n.appendChild(a)};this.clear=
function(){n.innerHTML=""}}function Va(){this.append=function(a){};this.clear=function(){}}function Ma(a){for(var n=null,e=1E6,D,b=0;b<ca.length;b++){var c=ca[b];if(!c.pinned&&!1!==c.visible){var d,f,h,m=v.drawingstate.matrix.sdet;if("P"===c.kind){var l=g.normalizeZ(c.homog);if(!g._helper.isAlmostReal(l))continue;d=l.value[0].value.real-a.x;f=l.value[1].value.real-a.y;h=Math.sqrt(d*d+f*f);c.narrow&h>20/m&&(h=1E4)}else"C"===c.kind?(f=q[c.args[0]],h=c.radius,d=k.div(f.homog.value[0],f.homog.value[2]).value.real,
f=k.div(f.homog.value[1],f.homog.value[2]).value.real,d-=a.x,f-=a.y,h=Math.sqrt(d*d+f*f)-h.value.real,f=d=0,0>h&&(h=-h),h+=30/m):"L"===c.kind&&(d=c.homog,h=k,f=h.add(h.mult(d.value[0],h.conjugate(d.value[0])),h.mult(d.value[1],h.conjugate(d.value[1]))),f=g.scaldiv(h.sqrt(f),d),h=f.value[0].value.real*a.x+f.value[1].value.real*a.y+f.value[2].value.real,d=-f.value[0].value.real*h,f=-f.value[1].value.real*h,0>h&&(h=-h),h+=1);h<e+.2/m&&(e=h,n=c,D={x:d,y:f})}}console.log("Moving "+(n?n.name:"nothing"));
return null===n?null:{mover:n,offset:D,prev:{x:a.x,y:a.y}}}function T(a,n,e,D){void 0===D&&(D=!1);Wa.push(function(){a.removeEventListener(n,e,D)});a.addEventListener(n,e,D)}function da(a,n){function e(e){var n=a.getBoundingClientRect();e=v.to(e.clientX-n.left-a.clientLeft+.5,e.clientY-n.top-a.clientTop+.5);W.prevx=W.x;W.prevy=W.y;W.x=e[0];W.y=e[1];$a[0]=W.x;$a[1]=W.y;W.moved=!0}function D(a){W.down=!1;fa=void 0;Qa();b();y(ka.mouseup);a.preventDefault()}var Q=null;"undefined"!==typeof MutationObserver&&
(Q=MutationObserver);Q||"undefined"===typeof WebKitMutationObserver||(Q=WebKitMutationObserver);Q?(Q=new Q(function(e){document.body.contains(a)||za()}),Q.observe(document.documentElement,{childList:!0,subtree:!0}),Wa.push(function(){Q.disconnect()})):(T(a,"DOMNodeRemovedFromDocument",za),T(a,"DOMNodeRemoved",za));!0===n.keylistener?T(document,"keydown",function(a){c(a);return!1}):ka.keydown&&(a.setAttribute("tabindex","0"),T(a,"mousedown",function(){a.focus()}),T(a,"keydown",function(a){9!==a.keyCode&&
(c(a),a.preventDefault())}));T(a,"mousedown",function(a){W.button=a.which;e(a);y(ka.mousedown);fa=Ma(W);Pa();W.down=!0;a.preventDefault()});T(a,"mouseup",function(a){W.down=!1;fa=void 0;Qa();y(ka.mouseup);b();a.preventDefault()});T(a,"mousemove",function(a){e(a);W.down?y(ka.mousedrag):y(ka.mousemove);a.preventDefault()});T(a,"touchstart",function(a){e(a.targetTouches[0]);y(ka.mousedown);W.down=!0;fa=Ma(W);Pa();a.preventDefault()},!1);T(a,"touchmove",function(a){e(a.targetTouches[0]);W.down?y(ka.mousedrag):
y(ka.mousemove);a.preventDefault()},!0);T(a,"touchend",D,!1);"undefined"!==typeof document&&document.body&&T(document.body,"touchcancel",D,!1);b()}function La(){if(yb)return!0;Aa&&(xb&&"undefined"!==typeof la&&la.tick(),Aa&&y(ka.tick));if(Aa||W.moved)W.moved=!1,b();jb=Aa||W.down;return!jb}function Pa(){jb||(jb=!0,zb.timer(La))}function b(){v.reset();B.save();B.clearRect(0,0,ia,ba);0!==Ga&&y(Yb);Ic();v.greset();Jc();Kc();B.restore()}function c(a){a=window.event?event:a;a=a.charCode?a.charCode:a.keyCode;
bc=String.fromCharCode(a);cc=a;y(ka.keydown);b()}function d(a,n){if(n in a)return n;n=n.charAt(0).toUpperCase()+n.substring(1);for(var e=0,D=dc.length;e<D;++e){var b=dc[e]+n;if(b in a)return b}}function h(){var a=m(),a=l()-a;24<a?(isFinite(a)&&(clearTimeout(kb),kb=setTimeout(h,a)),lb=0):(lb=1,ec(h))}function m(){var a=Date.now();for(Ia=mb;Ia;)a>=Ia.t&&(Ia.f=Ia.c(a-Ia.t)),Ia=Ia.n;return a}function l(){for(var a,n=mb,e=Infinity;n;)n.f?n=a?a.n=n.n:mb=n.n:(n.t<e&&(e=n.t),n=(a=n).n);nb=a;return e}function x(){this.ctype=
"undefined"}function Cc(){this.ctype="void"}function ha(a){this.ctype="error";this.message=a}function C(a){var n=a.value;a=n[0].value;var e=n[1].value,n=n[2].value;return g.turnIntoCSList([a[0],k.add(a[1],e[0]),k.add(a[2],n[0]),e[1],k.add(e[2],n[1]),n[2]])}function L(a){if("undefined"===typeof a)return"_??_";if("undefined"===a.ctype)return"_?_";if("number"===a.ctype)return k.niceprint(a);if("string"===a.ctype||"boolean"===a.ctype)return a.value;if("list"===a.ctype){for(var n="[",e=0;e<a.value.length;e++)n+=
L(y(a.value[e])),e!==a.value.length-1&&(n+=", ");return n+"]"}return"function"===a.ctype?"FUNCTION":"infix"===a.ctype?"INFIX":"modifier"===a.ctype?a.key+"->"+L(a.value):"shape"===a.ctype?a.type:"error"===a.ctype?"Error: "+a.message:"variable"===a.ctype?(console.log("HALLO"),L(a.stack[length.stack])):"geo"===a.ctype?a.value.name:"__"}function aa(a,n,e){a=aa[a];if(void 0===a)return u;var D=[];for(e=0;e<a.arglist.length;e++)D[e]=y(n[e]);for(e=0;e<a.arglist.length;e++)J.newvar(a.arglist[e].name),J.setvar(a.arglist[e].name,
D[e]);J.pushVstack("*");n=y(a.body);J.cleanVstack();for(e=0;e<a.arglist.length;e++)J.removevar(a.arglist[e].name);return n}function rb(a,n){var e="undefined"===a[0].ctype,D="undefined"===a[1].ctype,b=y(a[1]);if(e||D)return u;"variable"===a[0].ctype?J.setvar(a[0].name,b):"infix"===a[0].ctype?"_"===a[0].oper?E.assigntake(a[0],b):console.error("Can't use infix expression as lvalue"):"field"===a[0].ctype?E.assigndot(a[0],b):"function"===a[0].ctype&&"genList"===a[0].oper?"list"===b.ctype?E.assignlist(a[0].args,
b.value):console.error("Expected list in rhs of assignment"):console.error("Left hand side of assignment is not a recognized lvalue");return b}function eb(a,n){var e=z(a[0]),D=z(a[1]);return"number"===e.ctype&&"number"===D.ctype?{ctype:"boolean",value:e.value.real===D.value.real&&e.value.imag===D.value.imag}:"string"===e.ctype&&"string"===D.ctype||"boolean"===e.ctype&&"boolean"===D.ctype?{ctype:"boolean",value:e.value===D.value}:"list"===e.ctype&&"list"===D.ctype?g.equals(e,D):{ctype:"boolean",value:!1}}
function sb(a,n){var e=z(a[0]),D=z(a[1]);return"number"===e.ctype&&"number"===D.ctype?{ctype:"boolean",value:k._helper.isAlmostEqual(e,D)}:"string"===e.ctype&&"string"===D.ctype||"boolean"===e.ctype&&"boolean"===D.ctype?{ctype:"boolean",value:e.value===D.value}:"list"===e.ctype&&"list"===D.ctype?g.almostequals(e,D):{ctype:"boolean",value:!1}}function Ub(a,n){var e=z(a[0]),D=z(a[1]);return"boolean"===e.ctype&&"boolean"===D.ctype?{ctype:"boolean",value:e.value&&D.value}:u}function Vb(a,n){var e=z(a[0]),
D=z(a[1]);return"boolean"===e.ctype&&"boolean"===D.ctype?{ctype:"boolean",value:e.value||D.value}:u}function Wb(a,n){var e=z(a[0]),D=z(a[1]),b=w.add(e,D);"Angle"===e.usage&&"Angle"===D.usage&&(b=w.withUsage(b,"Angle"));return b}function tb(a,n){var e=z(a[0]),D=z(a[1]),b=w.sub(e,D);"Angle"===e.usage&&"Angle"===D.usage&&(b=w.withUsage(b,"Angle"));return b}function Xb(a,n){var e=z(a[0]),D=z(a[1]),b=w.mult(e,D);"Angle"!==e.usage||D.usage?"Angle"!==D.usage||e.usage||(b=w.withUsage(b,"Angle")):b=w.withUsage(b,
"Angle");return b}function fc(a,n){var e=z(a[0]),D=z(a[1]),b=w.div(e,D);"Angle"!==e.usage||D.usage?"Angle"!==D.usage||e.usage||(b=w.withUsage(b,"Angle")):b=w.withUsage(b,"Angle");return b}function gc(a,n){var e=z(a[0]),D=z(a[1]);return"number"===e.ctype&&"number"===D.ctype?k.pow(e,D):u}function Ab(a){var n=a.length;if(0===n)return[];if(1===n)return[0];if(2===n)return a[0][0]+a[1][1]<=a[0][1]+a[1][0]?[0,1]:[1,0];if(4<n)return Lc(a);for(var e=Mc[n],D=Number.POSITIVE_INFINITY,b=e[0],c=0;c<e.length;++c){for(var d=
e[c],g=0,f=0;f<n;++f)g+=a[f][d[f]];g<D&&(D=g,b=d)}return b}function Lc(a){function n(){return{matched:-1,prev:-1,start:-1,cost:0,used:!1,leaf:!1}}function e(a){for(var n=0;n<c;++n)0<k[a][n]||h[n].used||(h[n].used=!0,e(h[n].matched))}function D(a){for(var e=0;e<c;++e)0<k[e][a]||f[e].used||(f[e].used=!0,D(f[e].matched))}var b=Math.abs,c=a.length,d,g,f=Array(c),h=Array(c),k=Array(c);for(d=0;d<c;++d)k[d]=Array(c);for(d=0;d<c;++d)for(f[d]=n(),h[d]=n(),f[d].cost=a[d][0],g=1;g<c;++g)f[d].cost>a[d][g]&&(f[d].cost=
a[d][g]);for(;;){for(d=0;d<c;++d)for(g=0;g<c;++g)k[d][g]=a[d][g]-f[d].cost-h[g].cost,k[d][g]<1E-14*(b(a[d][g])+b(f[d].cost)+b(h[g].cost))&&(k[d][g]=0);for(d=0;d<c;++d)f[d].matched=h[d].matched=-1;for(var m=0;;){for(d=0;d<c;++d)f[d].used=f[d].leaf=h[d].used=h[d].leaf=!1,-1===f[d].matched&&(f[d].start=d,f[d].used=f[d].leaf=!0,f[d].prev=-1);for(var l=!1,p=!1;!p;){for(d=0;d<c;++d)if(f[d].leaf)for(f[d].leaf=!1,g=0;g<c;++g)if(!(h[g].used||0<k[d][g])&&f[d].matched!==g&&(h[g].prev=d,h[g].start=f[d].start,
h[g].used=h[g].leaf=!0,-1===h[g].matched)){f[h[g].start].prev=g;l=!0;break}if(l)break;p=!0;for(g=0;g<c;++g)h[g].leaf&&(h[g].leaf=!1,d=h[g].matched,f[d].used||(f[d].prev=g,f[d].start=h[g].start,f[d].used=f[d].leaf=!0,p=!1))}if(!l)break;for(l=0;l<c;++l)if(-1===f[l].matched&&-1!==f[l].prev){g=f[l].prev;do d=h[g].prev,h[g].matched=d,f[d].matched=g,g=f[d].prev;while(d!==l);++m}}if(m===c)break;for(d=0;d<c;++d)f[d].used=f[d].leaf=h[d].used=h[d].leaf=!1;for(d=0;d<c;++d)-1===f[d].matched&&e(d);for(g=0;g<c;++g)-1===
h[g].matched&&D(g);for(d=0;d<c;++d)-1===f[d].matched||f[d].used||h[f[d].matched].used||(f[d].used=!0);m=Number.POSITIVE_INFINITY;for(d=0;d<c;++d)if(!f[d].used)for(g=0;g<c;++g)h[g].used||m>k[d][g]&&(m=k[d][g]);for(d=0;d<c;++d)f[d].used||(f[d].cost+=m),h[d].used&&(h[d].cost-=m)}a=Array(c);for(d=0;d<c;++d)g=f[d].matched,a[d]=g;return a}function hc(a,n){var e=y(a[0]),D=z(a[1]);if("number"===D.ctype){var b=Math.floor(D.value.real);if("list"===e.ctype||"string"===e.ctype)return 0>b&&(b=e.value.length+b+
1),0<b&&b<e.value.length+1?"list"===e.ctype?e.value[b-1]:{ctype:"string",value:e.value.charAt(b-1)}:u}if("list"===D.ctype){for(var b=[],c=0;c<D.value.length;c++){var d=z(D.value[c]);b[c]=hc([e,d],[])}return g.turnIntoCSList(b)}return u}function ic(a,n){var e=y(a[0]),b=y(a[1]);return"list"===e.ctype&&"list"===b.ctype?g.concat(e,b):"shape"===e.ctype&&"shape"===b.ctype?E.shapeconcat(e,b):u}function jc(a,n){var e=y(a[0]),b=y(a[1]);return"list"===e.ctype&&"list"===b.ctype?g.set(g.common(e,b)):"shape"===
e.ctype&&"shape"===b.ctype?E.shapecommon(e,b):u}function kc(a,n){var e=y(a[0]),b=y(a[1]);return"list"===e.ctype&&"list"===b.ctype?g.remove(e,b):"shape"===e.ctype&&"shape"===b.ctype?E.shaperemove(e,b):u}function lc(a,n){var e=y(a[0]),b=y(a[1]);return"list"===e.ctype?g.append(e,b):u}function mc(a,n){var e=y(a[0]),b=y(a[1]);return"list"===b.ctype?g.prepend(e,b):u}function Bb(a,n){a|=0;n|=0;if(0===a&&0===n)return 0;for(;0!==n;){var e=a;a=n;n=e%n|0}return a}function Nc(a){return 1===a?0:1}function y(a){if("undefined"===
typeof a)return u;if("infix"===a.ctype)return a.impl(a.args,{});if("variable"===a.ctype)return J.getvar(a.name);if("void"===a.ctype||"geo"===a.ctype||"number"===a.ctype||"boolean"===a.ctype||"string"===a.ctype||"list"===a.ctype||"undefined"===a.ctype||"shape"===a.ctype)return a;if("field"===a.ctype){var n=y(a.obj);return"geo"===n.ctype?ta.getField(n.value,a.key):"list"===n.ctype?g.getField(n,a.key):u}return"function"===a.ctype?E.evaluate(a.oper,a.args,a.modifs):u}function z(a){a=y(a);if("geo"===a.ctype){var n=
a.value;if("P"===n.kind)return ta.getField(n,"xy")}return a}function M(a){a=y(a);if("geo"===a.ctype){var n=a.value;if("P"===n.kind||"L"===n.kind)return ta.getField(n,"homog")}return g._helper.isNumberVecN(a,3)?a:g._helper.isNumberVecN(a,2)?(n=g.turnIntoCSList([a.value[0],a.value[1],k.real(1)]),a.usage&&(n=w.withUsage(n,a.usage)),n):u}function ab(a){for(var n=!1,e=!1,b="",c=0;c<a.length;c++){var d=a[c];'"'!==d||e||(n=!n);"/"===d&&c!==a.length-1&&"/"===a[c+1]&&(e=!0);"\n"===d&&(e=!1);if(" "!==d&&"\t"!==
d&&"\n"!==d&&"\f"!==d&&"\r"!==d&&!e||n)b+=d}return b}function nc(a,n,e){var b={ctype:"infix"};b.oper=a;b.impl=U[a];b.args=[n,e];return b}function Oc(a){var n,e;if("function"!==a.ctype)return console.log("Invalid function name."),!1;for(n=0;n<a.args.length;n++)if("variable"!==a.args[n].ctype)return console.log("Argument is not a variable."),!1;for(n=0;n<a.args.length-1;n++)for(e=n+1;e<a.args.length;e++)if(a.args[n].name===a.args[e].name)return console.log("Variable name used twice."),!1;return!0}function ob(a){return""!==
a&&!isNaN(a)}function Cb(a){return"["===a||"("===a||"{"===a||"|"===a}function Db(a){return"]"===a||")"===a||"}"===a||"|"===a}function Eb(a){var n,e=[],b=[],c=[];n=a+",";var d=n.length,g=0,f=0,h=!1,k=!1;for(a=f;a<d;a++){var m;m=n[a];'"'===m&&(k=!k);!k&&(!Cb(m)||"|"===m&&h?Db(m)&&("|"!==m||h)&&(g--,"|"===m&&(h=!1)):(g++,"|"===m&&(h=!0)),","===m&&0===g||-1===g)&&(m=n.substring(f,a),e.push(m),b.push(f),f=a+1)}for(a=0;a<e.length;a++)if(b=e[a],""===b)c.push("nil");else{b=na(b,!1);if("error"===b.ctype)return b;
c.push(b)}e={ctype:"function",oper:"genList"};e.args=c;e.modifs={};return e}function Pc(a){var n;return"|"===a[0]?(a=Eb(a.substring(1,a.length-1)),n=a.args.length,1===n?(a.oper="abs_infix",a):2===n?(a.oper="dist_infix",a):u):"()"===a||"[]"===a?n={ctype:"list",value:[]}:"["===a[0]?Eb(a.substring(1,a.length-1)):"("===a[0]&&(n=Eb(a.substring(1,a.length-1)),1<n.args.length)?n:n=na(a.substring(1,a.length-1),!1)}function na(a,n){for(var e=!1,b="",c=-1,d=-1,g="",f=0,h=0,k=" ",m=" ",l=0,p=!1,q=a.length,r=
0;r<q;r++){var t,w=" ",v=" ";0<l&&l--;t=a[r];r+1<q&&(w=a[r+1]);r+2<q&&(v=a[r+2]);'"'===t&&(e=!e);if(!e){if(Cb(t)&&("|"!==t||!p))"|"===t&&(p=!0),b+=t,f++,1===f&&h++," "===k&&(k=t);else if(Db(t)&&("|"!==t||p)){"|"===t&&(p=!1);if(0===f)return new ha("close without open");m=b[b.length-1]+t;if("[]"===m||"()"===m||"{}"===m||"||"===m)f--,b=b.substring(0,b.length-1),m=t;else return new ha("unmatched brackets")}if(0===b.length){var x=-1,y="";"undefined"!==typeof pb[t+w+v]&&0===l?(y=t+w+v,l=3):"undefined"!==
typeof pb[t+w]&&0===l?(y=""+t+w,l=2):"undefined"!==typeof pb[t]&&0===l&&(y=""+t,l=1);""!==y&&(x=pb[y]);x>=d&&(d=x,c=r,g=y,0<=x&&(r+=y.length-1))}}}if(0!==f)return new ha("open without close");e=a.indexOf(k);b=a.lastIndexOf(m);if(0===f&&-1<d){if("->"===g)return d=g,g=a.substring(0,c),c=na(a.substring(c+d.length),!1),g="error"===c.ctype?c:{ctype:"modifier",key:g,value:c},g;if("."===g)return d=a.indexOf("."),f=a.lastIndexOf("."),(d!==f?0:-1===d?ob(a):ob(a.substring(0,d))||ob(a.substring(d+1)))?(g={},
g.value={real:parseFloat(a),imag:0},g.ctype="number"):(d=na(a.substring(0,c),!1),g=a.substring(c+g.length),g={ctype:"field",obj:d,key:g}),g;if(":="===g)return d=a.substring(0,c),d=na(d,!0),"error"===d.ctype?g=d:"variable"===d.cstring||Oc(d)?(c=a.substring(c+g.length),c=na(c,!1),g="error"===c.ctype?c:nc(g,d,c)):(console.log(["Function not definable",d]),g=new ha("Function not definable")),g;d=na(a.substring(0,c),!1);c=na(a.substring(c+g.length),!1);g="error"===d.ctype?d:"error"===c.ctype?c:nc(g,d,
c);return g}if(0===f&&1===h&&b===a.length-1){if(0===e)return Pc(a);a:{f=[];h=[];g=[];c={};d=a.substring(0,e);b=a.length;k=0;m=e+1;p=l=!1;for(e=m;e<b;e++)if(q=a[e],'"'===q&&(l=!l),!l)if(!Cb(q)||"|"===q&&p?Db(q)&&("|"!==q||p)&&(k--,"|"===q&&(p=!1)):(k++,"|"===q&&(p=!0)),","===q&&0===k||-1===k)q=a.substring(m,e),f.push(q),h.push(m),1!==f.length||-1!==k||f[0].length||(f=[],h=[]),m=e+1;for(e=0;e<f.length;e++){h=na(f[e],!1);if("error"===h.ctype){g=h;break a}"modifier"===h.ctype?c[h.key]=h.value:g.push(h)}f=
{ctype:"function"};f.oper=d+"$"+g.length;$b[f.oper]=!0;f.args=g;f.modifs=c;g=f}return g}return""===a?new Cc:'"'===a.charAt(0)&&'"'===a.charAt(a.length-1)?{ctype:"string",value:a.substring(1,a.length-1)}:ob(a)?{ctype:"number",value:{real:parseInt(a),imag:0}}:J.isVariable(a)?J.vars[a]:J.isVariableName(a)?J.create(a):u}function Qc(a){for(var n in a)null!==a[n]&&(ra[n]=a[n])}function Fc(a){Object.keys(p).forEach(function(a){var e=p[a];Ja(e.signature||"_helper"===a,a+" has no signature");void 0!==e.updatePosition&&
void 0===e.stateSize&&(e.stateSize=0)});F=[];q={};O=[];K=[];Y=[];ca=[];a.forEach(qb);Rc()}function Fb(a){void 0===a.size&&(a.size=ra.lineSize);a.size=k.real(a.size);a.color=g.realVector(a.color||ra.lineColor);void 0===a.alpha&&(a.alpha=ra.alpha);a.alpha=k.real(a.alpha);a.clip=w.string(a.clip||ra.clip);void 0===a.overhang&&(a.overhang=ra.overhangLine);a.overhang=k.real(a.overhang);a.dashtype&&(a.dashtype=w.wrap(a.dashtype))}function qb(a){var n;if(void 0!==q[a.name]){console.log("Element name '"+a.name+
"' already exists");var e=q[a.name];p[e.type].isMovable&&Ra(e,a.pos,"homog");return{ctype:"geo",value:e}}if(e=Sc[a.type]){a=e(a);e=null;for(n=0;n<a.length;++n)e=qb(a[n]);return e}e=p[a.type];if(!e)return console.error(a),console.error("Operation "+a.type+" not implemented yet"),null;if(e.signature.length!==(a.args?a.args.length:0))return window.alert("Wrong number of arguments for "+a.name),null;if(a.args)for(n=0;n<a.args.length;++n){if(!q.hasOwnProperty(a.args[n]))return console.log("Dropping "+
a.name+" due to missing argument "+a.args[n]),null;var b=q[a.args[n]].kind;if(e.signature[n]!==b&&("S"!==b||"L"!==e.signature[n]))return window.alert("Wrong argument kind "+b+" as argument "+n+" to element "+a.name+" of type "+a.type),null}e.signatureConstraints&&!e.signatureConstraints(a)&&window.alert("signature constraints violated for element "+a.name);F.push(a);q[a.name]=a;n=qa.length;a.kind=e.kind;a.stateIdx=n;n+=e.stateSize;a.incidences=[];a.isshowing=!0;a.movable=!1;e.isMovable&&(a.movable=
!0,ca.push(a));"P"===a.kind&&(O.push(a),void 0===a.size&&(a.size=ra.pointSize),a.size=k.real(a.size),"Free"!==a.type?(a.color=g.realVector(a.color||ra.pointColor),a.color=g.scalmult(k.real(ra.dimDependent),a.color)):a.color=g.realVector(a.color||ra.pointColor),void 0===a.alpha&&(a.alpha=ra.alpha),a.alpha=k.real(a.alpha),a.drawtrace&&("undefined"===typeof a.tracedim&&(a.tracedim=1),"undefined"===typeof a.tracelength&&(a.tracelength=100),"undefined"===typeof a.traceskip&&(a.traceskip=1),a._traces=Array(a.tracelength),
a._traces_index=0,a._traces_tick=0));"L"===a.kind&&(K.push(a),Fb(a));"C"===a.kind&&(Y.push(a),Fb(a));"S"===a.kind&&(K.push(a),void 0===a.overhang&&(a.overhang=ra.overhangSeg),a.arrow&&(a.arrow=w.bool(a.arrow)),a.arrowsize&&(a.arrowsize=k.real(a.arrowsize)),a.arrowposition&&(a.arrowposition=k.real(a.arrowposition)),a.arrowshape&&(a.arrowshape=w.string(a.arrowshape)),a.arrowsides&&(a.arrowsides=w.string(a.arrowsides)),Fb(a),a.clip=w.string("end"));if(n!==qa.length){var c,d=Gb.length;Ka.length<n*d?(b=
2*n,Ka=new Float64Array(d*b)):b=Ka.length/d|0;for(c=0;c<d;++c)Ha[Gb[c]]=Ka.subarray(c*b,c*b+n);n=qa;ea=Ha.in;ua=Ha.out;qa=Ha.good;qa.set(n)}ea=ua=qa;Sa=!0;e.initialize&&(ja=pa=a.stateIdx,a.param=e.initialize(a),Ja(pa===a.stateIdx+e.stateSize,"State fully initialized"));ja=pa=a.stateIdx;e.updatePosition(a,!1);Ja(ja===a.stateIdx+e.stateSize,"State fully consumed");Ja(pa===a.stateIdx+e.stateSize,"State fully updated");Sa=!1;ea=Ha.in;ea.set(qa);ua=Ha.out;Hb(a,e);Ib={}}function oc(a,n){var e=q[n.args[0]].homog,
b=q[n.args[1]].homog,c=a.homog,d=k.div(e.value[0],e.value[2]),g=k.div(e.value[1],e.value[2]),e=k.div(b.value[0],b.value[2]),b=k.div(b.value[1],b.value[2]),f=k.div(c.value[0],c.value[2]),h=k.div(c.value[1],c.value[2]);return k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(g)&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(b)&&k._helper.isAlmostReal(f)&&k._helper.isAlmostReal(h)?(d=d.value.real,g=g.value.real,e=e.value.real,b=b.value.real,f=f.value.real,h=h.value.real,c=Math.sqrt((d-e)*(d-e)+(g-
b)*(g-b)),d=Math.sqrt((d-f)*(d-f)+(g-h)*(g-h)),e=Math.sqrt((e-f)*(e-f)+(b-h)*(b-h)),d=c-d-e,1E-15>d*d):!1}function Hb(a,n){a.isshowing=!0;if(a.args)for(var e=0;e<a.args.length;e++)if(!q[a.args[e]].isshowing){a.isshowing=!1;return}n.visiblecheck&&n.visiblecheck(a)}function Rc(){for(var a=0;a<K.length;a++)for(var n=K[a],e=0;e<O.length;e++){var b=O[e],c=g.scaldiv(g.abs(b.homog),b.homog),d=g.scaldiv(g.abs(n.homog),n.homog);1E-13>k.abs(g.scalproduct(c,d)).value.real&&(b.incidences.push(n.name),n.incidences.push(b.name))}}
function Kc(){function a(a){if(a.isshowing&&!1!==a.visible&&g._helper.isAlmostReal(a.homog)){var e=a.color;a.behavior&&(e=a.color);t.draw$1([a.homog],{size:a.size,color:e,alpha:a.alpha});if(a.labeled){var e=a.printname||a.name||"P",n=a.labelpos||{x:3,y:3},b=a.textsize||12,D=!0===a.textbold,c=!0===a.textitalics,d=a.text_fontfamily||ra.fontFamily,Q=n.x*n.x+n.y*n.y,f=1;0<Q&&(f=1+a.size.value.real/Math.sqrt(Q));t.drawtext$2([a.homog,w.wrap(e)],{x_offset:w.wrap(f*n.x),y_offset:w.wrap(f*n.y),size:w.wrap(b),
bold:w.wrap(D),italics:w.wrap(c),family:w.wrap(d)})}}}function n(a){if(a.isshowing&&!1!==a.visible){var e={};e.color=a.color;e.alpha=a.alpha;e.size=a.size;E.drawarc(a,e,a.filled?"F":"D")}}function e(a){if(a.isshowing&&!1!==a.visible){var e={};e.color=a.color;e.alpha=a.alpha;e.size=a.size;E.drawconic(a.matrix,e)}}function b(a){var e,n;if(a.isshowing&&!1!==a.visible&&g._helper.isAlmostReal(a.homog))if("S"===a.kind)t.draw$2([a.startpos,a.endpos],{overhang:a.overhang,dashtype:a.dashtype,size:a.size,color:a.color,
alpha:a.alpha,arrow:a.arrow,arrowsize:a.arrowsize,arrowposition:a.arrowposition,arrowshape:a.arrowshape,arrowsides:a.arrowsides});else if("end"===a.clip.value&&"Join"===a.type)e=q[a.args[0]],n=q[a.args[1]],t.draw$2([e.homog,n.homog],{overhang:a.overhang,dashtype:a.dashtype,size:a.size,color:a.color,alpha:a.alpha});else{if("inci"===a.clip.value){e=[1E6,0];n=[-1E6,0];for(var D=[1E6,0],c=[-1E6,0],d=0;d<a.incidences.length;d++){var Q=q[a.incidences[d]].homog,f=Q.value[0],h=Q.value[1],m=Q.value[2];k._helper.isAlmostZero(m)||
(f=k.div(f,m),h=k.div(h,m),k._helper.isAlmostReal(f)&&k._helper.isAlmostReal(h)&&(f.value.real<e[0]&&(e=[f.value.real,Q]),f.value.real>n[0]&&(n=[f.value.real,Q]),h.value.real<D[0]&&(D=[h.value.real,Q]),h.value.real>c[0]&&(c=[h.value.real,Q])))}n[0]-e[0]>c[0]-D[0]?(e=e[1],n=n[1]):(e=D[1],n=c[1]);if(e!==n){t.draw$2([e,n],{dashtype:a.dashtype,size:a.size,color:a.color,alpha:a.alpha,overhang:a.overhang});return}}t.draw$1([a.homog],{dashtype:a.dashtype,size:a.size,color:a.color,alpha:a.alpha})}}var c;
for(c=0;c<Y.length;c++)Y[c].isArc?n(Y[c]):e(Y[c]);for(c=0;c<K.length;c++)b(K[c]);for(c=0;c<O.length;c++)a(O[c])}function Jc(){function a(){var a=f++/e._traces.length,n=e._traces[g];n&&(a*=b*a*a,t.draw$1([n],{size:k.real(c),color:e.color,alpha:k.real(a)}));c*=d}for(var n=0;n<O.length;n++){var e=O[n];if(e.drawtrace){e._traces_tick===e.traceskip?(e._traces[e._traces_index]=e.homog,e._traces_index=(e._traces_index+1)%e._traces.length,e._traces_tick=0):e._traces_tick++;var b=e.alpha.value.real,c=e.size.value.real,
d=1;1!==e.tracedim&&(c*=e.tracedim,d=Math.pow(e.tracedim,-1/e._traces.length));var g,f=0;for(g=e._traces_index;g<e._traces.length;++g)a();for(g=0;g<e._traces_index;++g)a()}}}function Ja(a,n){var e="Assertion failed: "+n;if(!a)throw console.log(e),za(),"undefined"!==typeof alert&&alert(e),Error(e);}function Qa(){qa.set(ea);pc(!1);for(var a=qa.length,n=Math.abs,e=0;e<a;e+=2)n(qa[e])>1E12*n(qa[e+1])&&(qa[e+1]=0)}function Jb(){if(Ya)va=!0;else throw qc;}function rc(a,n,e,b,c){return w.add(b,w.mult(e,
w.sub(c,b)))}function Ic(){H&&(H.currentMouseAndScripts=[]);Kb=!0;va=!1;ea.set(qa);if(fa){var a=fa.mover,n=g.realVector([W.x+fa.offset.x,W.y+fa.offset.y,1]);Lb(a,n,"mouse");fa.prev.x=W.x;fa.prev.y=W.y}y(ka.move);y(ka.draw);va||Qa();Kb=!1;H&&(H.fullLog.push(g.turnIntoCSList([g.turnIntoCSList(H.currentMouseAndScripts)])),H.length>H.logLength&&H.splice(0,H.length-H.logLength),H.currentMouseAndScripts=null,H.postMouseHooks.forEach(function(a){a()}))}function Ra(a,n,e){Kb?Lb(a,n,e):(Qa(),va=!1,Lb(a,n,
e),Qa())}function Lb(a,n,e){H&&H.currentMouseAndScripts&&(H.currentMover=[]);ua.set(ea);var b=1E4,c;c=Ib[a.name];if(!c){var d={},f=0;c=[];d[a.name]=a;for(var h=F,m=0;m<h.length;++m){var l=h[m],q=l.args;if(q)for(var r=0;r<q.length;++r)d.hasOwnProperty(q[r])&&(d[l.name]=l,c[f++]=l)}Ib[a.name]=c}var d=-1,f=.9,u,t,v,h=p[a.type],m=h.parameterPath||rc;ja=a.stateIdx;l=h.getParamFromState(a);ja=pa=a.stateIdx;q=h.getParamForInput(a,n,e);for(r=d+f;d!==r;){var x=r*r,y=.5/(1+x),y=k.complex(2*r*y+.5,(1-x)*y);
Ya=d+.5*f<=d||0===b;0===b&&console.log("tracing limit Reached");x=!1;H&&H.currentMouseAndScripts&&(H.currentStep=[]);try{ja=pa=a.stateIdx;var A=m(a,r,y,l,q);H&&(H.currentParam=A);y=ua;ua=ea;h.putParamToState(t,A);ua=y;pa=a.stateIdx;H&&(H.currentElement=a);h.updatePosition(a,!0);Ja(ja===a.stateIdx+h.stateSize,"State fully consumed");Ja(pa===a.stateIdx+h.stateSize,"State fully updated");for(u=0;u<c.length;++u)t=c[u],v=p[t.type],ja=pa=t.stateIdx,H&&(H.currentElement=t),v.updatePosition(t,!1),Ja(ja===
t.stateIdx+v.stateSize,"State fully consumed"),Ja(pa===t.stateIdx+v.stateSize,"State fully updated");H&&(H.currentElement=null);d=r;f*=1.25;r+=f;1<=r&&(r=1);ua=ea;ea=y}catch(B){if(B!==qc)throw B;f*=.5;r=d+f;--b;x=!0}H&&H.currentMouseAndScripts&&(H.currentMover.push(g.turnIntoCSList([g.turnIntoCSList(H.currentStep),w.wrap(x),w.wrap(d),w.wrap(r),w.wrap(H.currentParam)])),H.currentStep=null,H.currentParam=null)}pc(va);for(u=0;u<c.length;++u)t=c[u],v=p[t.type],Hb(t,v);H&&H.currentMouseAndScripts&&(H.currentMouseAndScripts.push(g.turnIntoCSList([g.turnIntoCSList(H.currentMover),
w.wrap(va),w.wrap(a.name),n,w.wrap(e),l,q])),H.currentMover=null)}function Gc(){Qa();Ya=!0;for(var a=F,n=0;n<a.length;n++){var e=a[n],b=p[e.type];ja=pa=e.stateIdx;b.updatePosition(e,!1);Hb(e,b)}a=ua;ua=ea;ea=a;Qa()}function pc(a){var n=r.tracingStateReport;"string"===typeof n&&(document.getElementById(n).textContent=a?"BAD":"GOOD")}function Tc(){return g.turnIntoCSList(H.fullLog.slice())}function Uc(a){var n=JSON.stringify(H.fullLog);a=new Blob([n],{type:a?"application/octet-stream":"application/json"});
return window.URL.createObjectURL(a)}function cb(){var a=ja;ja+=2;return k.complex(ea[a],ea[a+1])}function X(a){for(var n=Array(a),e=0;e<a;++e)n[e]=cb();return g.turnIntoCSList(n)}function Ta(a){ua[pa]=a.value.real;ua[pa+1]=a.value.imag;pa+=2}function R(a){for(var n=0,e=a.value.length;n<e;++n)Ta(a.value[n])}function Ba(a,n){var e=X(3),b=X(3),e=sc(a,n,e,b);R(e[0]);R(e[1]);return g.turnIntoCSList(e)}function sc(a,n,e,b){if(Sa)return[a,n];var c=g.projectiveDistMinScal(e,a),d=g.projectiveDistMinScal(e,
n),f=g.projectiveDistMinScal(b,a),h=g.projectiveDistMinScal(b,n),k=g.projectiveDistMinScal(e,b),m=g.projectiveDistMinScal(a,n),l=c+h,q=d+f,p;l>q?(p=[n,a],l=q):p=[a,n];q=function(){};if(H&&H.currentStep){var r=[H.labelTracing2,w.wrap(H.currentElement.name),g.turnIntoCSList(p),g.turnIntoCSList([e,b]),g.realMatrix([[c,d],[f,h]]),w.wrap(l),w.wrap(k),w.wrap(m),u];H.currentStep.push(g.turnIntoCSList(r));q=function(a){H.hasOwnProperty(a)||(H[a]=w.wrap(a));r[r.length-1]=H[a]}}g._helper.isNaN(a)||g._helper.isNaN(n)?
(q("Tracing failed due to NaNs."),va=!0):k>3*l&&m>3*l?q("Normal case, everything all right."):1E-5>m?1E-5>k?q("Staying inside singularity."):(q("Moved into singularity."),va=!0):1E-5>k?q("Moved out of singularity."):(Ya?q("Reached refinement limit, giving up."):q("Need to refine."),Jb());return p}function Mb(a,n,e,b){var c=X(3),d=X(3),f=X(3),h=X(3);a=Vc(a,n,e,b,c,d,f,h);R(a[0]);R(a[1]);R(a[2]);R(a[3]);return g.turnIntoCSList(a)}function Vc(a,n,e,b,c,d,f,h){var k=function(){};c=[c,d,f,h];a=[a,n,e,
b];if(Sa)return a;d=0;b=Array(4);for(e=0;4>e;e++)for(b[e]=Array(4),h=0;4>h;h++)f=g.projectiveDistMinScal(c[e],a[h]),b[e][h]=f;f=Ab(b);n=Array(4);for(e=0;4>e;++e)n[e]=a[f[e]],d+=b[e][f[e]];var m=1*d,l=Infinity,q=Infinity;for(e=0;4>e;e++){if(g._helper.isNaN(a[e]))return k("Tracing failed due to NaNs."),va=!0,n;for(h=e+1;4>h;h++)f=g.projectiveDistMinScal(c[e],c[h]),l>f&&(l=f),f=g.projectiveDistMinScal(n[e],n[h]),q>f&&(q=f)}if(H&&H.currentStep){var p=[H.labelTracing4,w.wrap(H.currentElement.name),g.turnIntoCSList(n),
g.turnIntoCSList(c),g.realMatrix(b),w.wrap(d),w.wrap(l),w.wrap(q),u];H.currentStep.push(g.turnIntoCSList(p));k=function(a){H.hasOwnProperty(a)||(H[a]=w.wrap(a));p[p.length-1]=H[a]}}l>m&&q>m||(1E-5>q?1E-5>l?k("Staying inside singularity."):(k("Moved into singularity."),va=!0):1E-5>l?k("Moved out of singularity."):(Ya?k("Reached refinement limit, giving up."):k("Need to refine."),Jb()));return n}function tc(a){var n=a.length,e,b;if(Sa){for(e=0;e<n;++e)ja+=2*a[e].value.length,R(a[e]);return a}var c=
Array(n),d=Array(n),f=Array(n),h=99,k=99,m=Array(n);for(e=0;e<n;++e)c[e]=X(a[e].value.length),d[e]=g.normSquared(c[e]).value.real,f[e]=g.normSquared(a[e]).value.real,m[e]=Array(n);var l;for(e=0;e<n;++e){for(b=0;b<n;++b)l=g.sesquilinearproduct(c[e],a[b]).value,l=(l.real*l.real+l.imag*l.imag)/(d[e]*f[b]),m[e][b]=1-l;for(b=e+1;b<n;++b)l=g.sesquilinearproduct(c[e],c[b]).value,l=(l.real*l.real+l.imag*l.imag)/(d[e]*d[b]),h>1-l&&(h=1-l),l=g.sesquilinearproduct(a[e],a[b]).value,l=(l.real*l.real+l.imag*l.imag)/
(f[e]*f[b]),k>1-l&&(k=1-l)}l=Ab(m);b=Array(n);d=0;f=!1;for(e=0;e<n;++e){var d=d+m[e][l[e]],q=b[e]=a[l[e]];R(q);f|=g._helper.isNaN(q)}f|=isNaN(d);a=function(){};if(H&&H.currentStep){var p=[H.labelTracingSesq,w.wrap(H.currentElement.name),g.turnIntoCSList(b),g.turnIntoCSList(c),g.realMatrix(m),w.wrap(d),w.wrap(h),w.wrap(k),u];H.currentStep.push(g.turnIntoCSList(p));a=function(a){H.hasOwnProperty(a)||(H[a]=w.wrap(a));p[p.length-1]=H[a]}}f?(a("Tracing failed due to NaNs."),va=!0):h>3*d&&k>3*d?a("Normal case, everything all right."):
1E-5>k?1E-5>h?a("Staying inside singularity."):(a("Moved into singularity."),va=!0):1E-5>h?a("Moved out of singularity."):(Ya?a("Reached refinement limit, giving up."):a("Need to refine."),Jb());return b}function Hc(a){oa.forEach(function(a){I[a.behavior.type].init(a.behavior,q[a.name])})}function wb(a){xb=0!==a.length;oa=a;Z=[];oa.forEach(function(a){if(a.name){var e=a.name;q[e]&&(q[e].behavior=a.behavior,I[a.behavior.type].init(a.behavior,q[e]),"Mass"===a.behavior.type&&Z.push(q[e]))}else I[a.behavior.type].init(a.behavior)})}
var xa=this,ma,ka={},Aa=!1,ib=!0,jb=!1,fb=1,Ga=0,Yb,Zb=!1,$a,B,ia,ba,ga,ac=1,bb=null,Ec="           #drawgrid(s):=(              regional(b,xmin,xmax,ymin,ymax,nx,ny);              b=screenbounds();              xmin=b_4_1-s;              xmax=b_2_1+s;              ymin=b_4_2-s;              ymax=b_2_2+s;              nx=round((xmax-xmin)/s);              ny=round((ymax-ymin)/s);              xmin=floor(xmin/s)*s;              ymin=floor(ymin/s)*s;              repeat(nx,x,                 draw((xmin+x*s,ymin),(xmin+x*s,ymax),color->(1,1,1)*.9,size->1);              );              repeat(ny,y,                 draw((xmin,ymin+y*s),(xmax,ymin+y*s),color->(1,1,1)*.9,size->1);              )            );",
Wa=[],yb=!1,sa={config:r,startup:wa,shutdown:za,evokeCS:function(a){a=ab(a);a=na(a,!1);console.log(a);y(a);b()},play:V,pause:S,stop:Na,evalcs:function(a){return y(na(ab(a),!1))},niceprint:L,canvas:null},ub=!1,gb=0;r.use&&r.use.forEach(function(a){var n=null;r.plugins&&(n=r.plugins[a]);n||(n=xa._pluginRegistry[a]);n||(++gb,console.log("Loading script for plugin "+a),xa.loadScript(a+"-plugin",a+"-plugin.js",function(){console.log("Successfully loaded plugin "+a);0===--gb&&ub&&wa()},function(){console.error("Failed to auto-load plugin "+
a);0===--gb&&ub&&wa()}))});Oa.prototype=new Ea;Fa.prototype=new Ea;Va.prototype=new Ea;var W={},fa,bc="",cc=0,Wc=[].slice,Nb,uc=function(a){return Wc.call(a)};if(!r.isNode){var Xc=document.documentElement;Nb=window;try{uc(Xc.childNodes)[0].nodeType}catch(ad){uc=function(a){for(var n=a.length,e=Array(n);n--;)e[n]=a[n];return e}}}var dc="webkit ms moz Moz o O".split(" "),zb={},mb,nb,lb,kb,Ia,ec=!r.isNode&&Nb[d(Nb,"requestAnimationFrame")]||function(a){setTimeout(a,17)};zb.timer=function(a,n,e){var b=
arguments.length;2>b&&(n=0);3>b&&(e=Date.now());b={c:a,t:e+n,f:!1,n:null};nb?nb.n=b:mb=b;nb=b;lb||(kb=clearTimeout(kb),lb=1,ec(h))};zb.timer.flush=function(){m();l()};var u=new x,Ob=new x,J=new function(){this.vars={pi:{ctype:"variable",stack:[{ctype:"number",value:{real:Math.PI,imag:0}}],name:"pi"},i:{ctype:"variable",stack:[{ctype:"number",value:{real:0,imag:1}}],name:"i"},"true":{ctype:"variable",stack:[{ctype:"boolean",value:!0}],name:"true"},"false":{ctype:"variable",stack:[{ctype:"boolean",
value:!1}],name:"false"},"#":{ctype:"variable",stack:[u],name:"#"}};this.isVariable=function(a){return void 0!==this.vars[a]};this.isVariableName=function(a){if("#"===a||"#1"===a||"#2"===a)return!0;var n=/^[a-z,A-Z]+$/.test(a[0]);a=/^[0-9,a-z,A-Z]+$/.test(a);return n&&a};this.create=function(a){var n={ctype:"variable",stack:[Ob],name:a};return this.vars[a]=n};this.newvar=function(a){a=this.vars[a];a.stack.push(u);return a};this.removevar=function(a){var n=this.vars[a].stack;0===n.length&&console.error("Removing non-existing "+
a);n.pop();0===n.length&&console.warn("Removing last "+a)};this.setvar=function(a,n){var e=this.vars[a].stack;0===e.length&&console.error("Setting non-existing variable "+a);void 0===n&&(console.error("Setting variable "+a+" to undefined value"),n=u);if("undefined"===n.ctype)e[e.length-1]=n;else{var b=n;b===Ob&&(b=u);e[e.length-1]=b}};this.undefinedWarning={};this.getvar=function(a){var n=this.vars[a].stack;0===n.length&&console.error("Getting non-existing variable "+a);n=n[n.length-1];if(n===Ob){if(void 0!==
q[a])return{ctype:"geo",value:q[a]};console&&console.log&&void 0===this.undefinedWarning[a]&&(this.undefinedWarning[a]=!0,console.log("Warning: Accessing undefined variable: "+a));return u}return n};this.dump=function(a){var n=this.vars[a].stack;console.log("*** Dump "+a);for(a=0;a<n.length;a++)console.log(a+":> "+L(n[a]))};this.vstack=[];this.pushVstack=function(a){this.vstack.push(a)};this.popVstack=function(){this.vstack.pop()};this.cleanVstack=function(){for(var a=this.vstack;0<a.length&&"*"!==
a[a.length-1];)this.removevar(a[a.length-1]),a.pop();0<a.length&&a.pop()}},ta={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",trace:"trace",tracelength:"",selected:""},getGeoField:function(a,n){return"undefined"!==typeof q[a]?ta.getField(q[a],n):u},setGeoField:function(a,n,e){return"undefined"!==typeof q[a]?ta.setField(q[a],n,e):u},getField:function(a,n){var e;if("P"===a.kind){if("xy"===n){e=k.div(a.homog.value[0],
a.homog.value[2]);var b=k.div(a.homog.value[1],a.homog.value[2]);e=g.turnIntoCSList([e,b]);return w.withUsage(e,"Point")}if("homog"===n)return w.withUsage(a.homog,"Point");if("x"===n)return k.div(a.homog.value[0],a.homog.value[2]);if("y"===n)return k.div(a.homog.value[1],a.homog.value[2])}if("L"===a.kind){if("homog"===n)return w.withUsage(a.homog,"Line");if("angle"===n)return e=g.eucangle(g.ey,a.homog),w.withUsage(e,"Angle")}if("Tr"===a.kind&&"matrix"===n)return a.matrix;if("C"===a.kind&&"radius"===
n){var c=a.matrix;e=c.value[0].value[0];var d=c.value[0].value[2],b=c.value[1].value[2],c=c.value[2].value[2];k.mult(e,e);d=k.div(d,e);b=k.div(b,e);e=k.div(c,e);return e=k.sqrt(k.sub(k.add(k.mult(d,d),k.mult(b,b)),e))}if(ta.generalFields[n])return(e=a[ta.generalFields[n]])?e:u;if(a.behavior){if("mass"===n&&"Mass"===a.behavior.type)return k.real(a.behavior.mass);if("radius"===n&&"Mass"===a.behavior.type)return k.real(a.behavior.radius);if("charge"===n&&"Mass"===a.behavior.type)return k.real(a.behavior.charge);
if("friction"===n&&"Mass"===a.behavior.type)return k.real(a.behavior.friction);if("vx"===n&&"Mass"===a.behavior.type)return k.real(a.behavior.vx);if("vy"===n&&"Mass"===a.behavior.type)return k.real(a.behavior.vy);if("v"===n&&"Mass"===a.behavior.type)return g.realVector([a.behavior.vx,a.behavior.vy]);if("fx"===n&&"Mass"===a.behavior.type)return k.real(a.behavior.fx);if("fy"===n&&"Mass"===a.behavior.type)return k.real(a.behavior.fy);if("f"===n&&"Mass"===a.behavior.type)return g.realVector([a.behavior.fx,
a.behavior.fy])}return u},setField:function(a,n,e){"color"===n&&(a.color=e);"size"===n&&(a.size=e);"alpha"===n&&(a.alpha=e);"visible"===n&&"boolean"===e.ctype&&(a.visible=e.value);"pinned"===n&&"boolean"===e.ctype&&(a.pinned=e.value);"printlabel"===n&&(a.printname=L(e));"xy"===n&&"P"===a.kind&&a.movable&&g._helper.isNumberVecN(e,2)&&Ra(a,g.turnIntoCSList([e.value[0],e.value[1],k.real(1)]),"homog");"x"===n&&"P"===a.kind&&a.movable&&"number"===e.ctype&&Ra(a,g.turnIntoCSList([k.mult(e,a.homog.value[2]),
a.homog.value[1],a.homog.value[2]]),"homog");"y"===n&&"P"===a.kind&&a.movable&&"number"===e.ctype&&Ra(a,g.turnIntoCSList([a.homog.value[0],k.mult(e,a.homog.value[2]),a.homog.value[2]]),"homog");"homog"===n&&"P"===a.kind&&a.movable&&g._helper.isNumberVecN(e,3)&&Ra(a,e,"homog");if("angle"===n&&"Through"===a.type){var b=k.cos(e),c=k.sin(e),b=g.turnIntoCSList([b,c,k.real(0)]);Ra(a,b,"dir")}a.behavior&&("mass"===n&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.mass=e.value.real),"mass"===n&&
"Sun"===a.behavior.type&&"number"===e.ctype&&(a.behavior.mass=e.value.real),"friction"===n&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.friction=e.value.real),"charge"===n&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.charge=e.value.real),"radius"===n&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.radius=e.value.real),"vx"===n&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.vx=e.value.real),"vy"===n&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.vy=
e.value.real),"v"===n&&"Mass"===a.behavior.type&&g._helper.isNumberVecN(e,2)&&(a.behavior.vx=e.value[0].value.real,a.behavior.vy=e.value[1].value.real))}},k={_helper:{}};k._helper.roundingfactor=1E4;k._helper.niceround=function(a){return Math.round(a*k._helper.roundingfactor)/k._helper.roundingfactor};k.niceprint=function(a){if("Angle"===a.usage)return k._helper.niceangle(a);var n=k._helper.niceround(a.value.real);a=k._helper.niceround(a.value.imag);return 0===a?""+n:0<a?""+n+" + i*"+a:""+n+" - i*"+
-a};var Pb=r.angleUnit||"\u00b0",Yc=Pb.replace(/\s+/g,""),vc=2*Math.PI,Zc=1/vc,$c={rad:vc,"\u00b0":360,deg:360,degree:360,gra:400,grad:400,turn:1,cyc:1,rev:1,rot:1,"\u03c0":2,pi:2,quad:4};k._helper.niceangle=function(a){var n=$c[Yc];if(!n)return k.niceprint(w.withUsage(a,null));if("function"===typeof n)return n(a);a=k.niceprint(k.realmult(n*Zc,a));return-1===a.indexOf("i*")?a+Pb:"("+a+")"+Pb};k.complex=function(a,n){return{ctype:"number",value:{real:a,imag:n}}};k.real=function(a){return{ctype:"number",
value:{real:a,imag:0}}};k.zero=k.real(0);k.one=k.real(1);k._helper.input=function(a){return"object"===typeof a?k.complex(+a.r,+a.i):k.real(+a)};k.argmax=function(a,n){return a.value.real*a.value.real+a.value.imag*a.value.imag<n.value.real*n.value.real+n.value.imag*n.value.imag?n:a};k.max=function(a,n){return{ctype:"number",value:{real:Math.max(a.value.real,n.value.real),imag:Math.max(a.value.imag,n.value.imag)}}};k.min=function(a,n){return{ctype:"number",value:{real:Math.min(a.value.real,n.value.real),
imag:Math.min(a.value.imag,n.value.imag)}}};k.add=function(a,n){return{ctype:"number",value:{real:a.value.real+n.value.real,imag:a.value.imag+n.value.imag}}};k.sub=function(a,n){return{ctype:"number",value:{real:a.value.real-n.value.real,imag:a.value.imag-n.value.imag}}};k.neg=function(a){return{ctype:"number",value:{real:-a.value.real,imag:-a.value.imag}}};k.re=function(a){return{ctype:"number",value:{real:a.value.real,imag:0}}};k.im=function(a){return{ctype:"number",value:{real:a.value.imag,imag:0}}};
k.conjugate=function(a){return{ctype:"number",value:{real:a.value.real,imag:-a.value.imag}}};k.round=function(a){return{ctype:"number",value:{real:Math.round(a.value.real),imag:Math.round(a.value.imag)}}};k.ceil=function(a){return{ctype:"number",value:{real:Math.ceil(a.value.real),imag:Math.ceil(a.value.imag)}}};k.floor=function(a){return{ctype:"number",value:{real:Math.floor(a.value.real),imag:Math.floor(a.value.imag)}}};k.mult=function(a,n){return{ctype:"number",value:{real:a.value.real*n.value.real-
a.value.imag*n.value.imag,imag:a.value.real*n.value.imag+a.value.imag*n.value.real}}};k.realmult=function(a,n){return{ctype:"number",value:{real:a*n.value.real,imag:a*n.value.imag}}};k.multiMult=function(a){var n=a[0];if("number"!==n.ctype)return u;for(var e=1;e<a.length;e++){if("number"!==a[e].ctype)return u;n=k.mult(n,a[e])}return n};k.abs2=function(a,n){return{ctype:"number",value:{real:a.value.real*a.value.real+a.value.imag*a.value.imag,imag:0}}};k.abs=function(a){return k.sqrt(k.abs2(a))};k.inv=
function(a){var n=a.value.real*a.value.real+a.value.imag*a.value.imag;0===n&&console.error("DIVISION BY ZERO");return{ctype:"number",value:{real:a.value.real/n,imag:-a.value.imag/n}}};k.div=function(a,n){return k.mult(a,k.inv(n))};k.eps=1E-7;k.snap=function(a){var n=a.value.real;a=a.value.imag;Math.floor(n+k.eps)!==Math.floor(n-k.eps)&&(n=Math.round(n));Math.floor(a+k.eps)!==Math.floor(a-k.eps)&&(a=Math.round(a));return{ctype:"number",value:{real:n,imag:a}}};k.exp=function(a){var n=Math.exp(a.value.real),
e=n*Math.cos(a.value.imag);a=n*Math.sin(a.value.imag);return{ctype:"number",value:{real:e,imag:a}}};k.cos=function(a){var n=a.value.real,e=a.value.imag,b=Math.exp(e);a=b*Math.sin(-n);var c=b*Math.cos(-n),b=Math.exp(-e),e=b*Math.sin(n),n=b*Math.cos(n);return{ctype:"number",value:{real:(c+n)/2,imag:(a+e)/2}}};k.sin=function(a){var n=a.value.real,e=a.value.imag,b=Math.exp(e);a=b*Math.sin(-n);var c=b*Math.cos(-n),b=Math.exp(-e),e=b*Math.sin(n),n=b*Math.cos(n);return{ctype:"number",value:{real:-(a-e)/
2,imag:(c-n)/2}}};k.tan=function(a){var n=k.sin(a);a=k.cos(a);return k.div(n,a)};k.arccos=function(a){var n=k.mult(a,k.neg(a)),n=k.sqrt(k.add(k.real(1),n));a=k.add(k.mult(a,k.complex(0,1)),n);a=k.add(k.mult(k.log(a),k.complex(0,1)),k.real(.5*Math.PI));return w.withUsage(a,"Angle")};k.arcsin=function(a){var n=k.mult(a,k.neg(a)),n=k.sqrt(k.add(k.real(1),n));a=k.add(k.mult(a,k.complex(0,1)),n);a=k.mult(k.log(a),k.complex(0,-1));return w.withUsage(a,"Angle")};k.arctan=function(a){var n=k.log(k.add(k.mult(a,
k.complex(0,-1)),k.real(1)));a=k.log(k.add(k.mult(a,k.complex(0,1)),k.real(1)));n=k.mult(k.sub(n,a),k.complex(0,.5));return w.withUsage(n,"Angle")};k.arctan2=function(a,n){var e=k.real(Math.atan2(n.value.real,a.value.real));return w.withUsage(e,"Angle")};k.sqrt=function(a){var n=a.value.real,e=a.value.imag;a=Math.sqrt(Math.sqrt(n*n+e*e));n=Math.atan2(e,n);e=a*Math.sin(n/2);return{ctype:"number",value:{real:a*Math.cos(n/2),imag:e}}};k.pow2=function(a,n){var e=a.value.real,b=a.value.imag,c=Math.pow(Math.sqrt(e*
e+b*b),n),e=Math.atan2(b,e),b=c*Math.sin(e*n);return{ctype:"number",value:{real:c*Math.cos(e*n),imag:b}}};k.log=function(a){var n=a.value.real,e=a.value.imag,b=Math.sqrt(n*n+e*e);a=Math.atan2(e,n);0>e&&(a+=2*Math.PI);0===e&&0>n&&(a=Math.PI);a>Math.PI&&(a-=2*Math.PI);n=Math.log(b);return k.snap({ctype:"number",value:{real:n,imag:a}})};k.pow=function(a,n){if(n.value.real===Math.round(n.value.real)&&0===n.value.imag){for(var e={ctype:"number",value:{real:1,imag:0}},b=0;b<Math.abs(n.value.real);b++)e=
k.mult(e,a);return 0>n.value.real?k.inv(e):e}return k.exp(k.mult(k.log(a),n))};k.mod=function(a,n){var e=a.value.real,b=n.value.real,c=a.value.imag,d=n.value.imag,e=e-Math.floor(e/b)*b,c=c-Math.floor(c/d)*d;0===b&&(e=0);0===d&&(c=0);return k.snap({ctype:"number",value:{real:e,imag:c}})};k._helper.seed="NO";k.eps=1E-10;k.epsbig=1E-6;k._helper.seedrandom=function(a){a-=Math.floor(a);k._helper.seed=.8*a+.1};k._helper.rand=function(){if("NO"===k._helper.seed)return Math.random();var a=k._helper.seed,
a=1E3*Math.sin(1E3*a),a=a-Math.floor(a);return k._helper.seed=a};k._helper.randnormal=function(){var a=k._helper.rand(),n=k._helper.rand();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*n)};k._helper.isEqual=function(a,n){return a.value.real===n.value.real&&a.value.imag===n.value.imag};k._helper.isLessThan=function(a,n){return a.value.real<n.value.real||a.value.real===n.value.real&&a.value.imag<n.value.imag};k._helper.compare=function(a,n){return k._helper.isLessThan(a,n)?-1:k._helper.isEqual(a,
n)?0:1};k._helper.isAlmostEqual=function(a,n,e){var b=k.eps;"undefined"!==typeof e&&(b=e);e=a.value.real-n.value.real;a=a.value.imag-n.value.imag;return e<b&&e>-b&&a<b&&a>-b};k._helper.isZero=function(a){return 0===a.value.real&&0===a.value.imag};k._helper.isAlmostZero=function(a){var n=a.value.real;a=a.value.imag;return n<k.eps&&n>-k.eps&&a<k.eps&&a>-k.eps};k._helper.isReal=function(a){return 0===a.value.imag};k._helper.isAlmostReal=function(a){a=a.value.imag;return a<k.epsbig&&a>-k.epsbig};k._helper.isNaN=
function(a){return isNaN(a.value.real)||isNaN(a.value.imag)};k._helper.isFinite=function(a){return isFinite(a.value.real)&&isFinite(a.value.imag)};k._helper.isAlmostImag=function(a){a=a.value.real;return a<k.epsbig&&a>-k.epsbig};k._helper.z3a=k.complex(-.5,.5*Math.sqrt(3));k._helper.z3b=k.complex(-.5,-.5*Math.sqrt(3));k._helper.cub1={ctype:"list",value:[k.one,k.one,k.one]};k._helper.cub2={ctype:"list",value:[k._helper.z3a,k.one,k._helper.z3b]};k._helper.cub3={ctype:"list",value:[k._helper.z3b,k.one,
k._helper.z3a]};k.solveCubic=function(a,n,e,b){a=k._helper.solveCubicHelper(a,n,e,b);return[g.scalproduct(k._helper.cub1,a),g.scalproduct(k._helper.cub2,a),g.scalproduct(k._helper.cub3,a)]};k._helper.solveCubicHelper=function(a,n,e,b){var c=a.value.real;a=a.value.imag;var d=n.value.real;n=n.value.imag;var f=e.value.real,h=e.value.imag,l=b.value.real,m=b.value.imag;e=c*f-a*h;b=c*h+a*f;var q=4*e-(d*d-n*n),p=4*b-2*d*n,r=c*d-a*n,u=c*n+a*d,t=q*f-p*h-18*(r*l-u*m),p=q*h+p*f-18*(r*m+u*l),v=27*(c*c-a*a),w=
54*a*c,q=v*l-w*m,x=v*m+w*l,y=d*d-n*n,v=2*d*n,A=y*d-v*n,B=y*n+v*d,w=q+4*A,z=x+4*B,A=-2*A+9*(r*f-u*h),B=-2*B+9*(r*h+u*f),A=A-q,B=B-x,q=27*(t*f-p*h+w*l-z*m),p=27*(t*h+p*f+w*m+z*l),w=Math.sqrt(Math.sqrt(q*q+p*p)),z=Math.atan2(p,q),p=w*Math.sin(z/2),q=w*Math.cos(z/2),A=A+(q*c-p*a),B=B+(q*a+p*c),f=Math.exp(Math.log(Math.sqrt(A*A+B*B))/3),p=Math.atan2(B,A),w=f*Math.sin(p/3),z=f*Math.cos(p/3),f=f*f,p=2*p,q=f*Math.sin(p/3),f=f*Math.cos(p/3);e=2*y-6*e;b=2*v-6*b;v=-1.5874010519681996*(d*z-n*w);d=-1.5874010519681996*
(d*w+n*z);n=1.2599210498948732*f;y=1.2599210498948732*q;q=4.762203155904599*(z*c-w*a);p=4.762203155904599*(z*a+w*c);c=q*q+p*p;w=(e*q+b*p)/c;z=(-e*p+b*q)/c;e=w;b=z;w=(v*q+d*p)/c;z=(-v*p+d*q)/c;v=w;d=z;w=(n*q+y*p)/c;z=(-n*p+y*q)/c;n=w;y=z;return g.turnIntoCSList([k.complex(e,b),k.complex(v,d),k.complex(n,y)])};var g={_helper:{},turnIntoCSList:function(a){return{ctype:"list",value:a}},realVector:function(a){for(var n=[],e=0;e<a.length;e++)n[e]={ctype:"number",value:{real:a[e],imag:0}};return{ctype:"list",
value:n}}};g._helper.unitvector=function(a,n){var e=g.zerovector(a);e.value[Math.floor(n.value.real-1)]=k.real(1);return e};g.idMatrix=function(a){for(var n=g.zeromatrix(a,a),e=k.real(1),b=0;b<a.value.real;b++)n.value[b].value[b]=e;return n};g._helper.flippedidMatrix=function(a){for(var n=g.zeromatrix(a,a),e=k.real(1),b=0;b<a.value.real;b++)n.value[b].value[a.value.real-b-1]=e;return n};g.println=function(a){for(var n=[],e=0;e<a.value.length;e++)if("number"===a.value[e].ctype)n[e]=k.niceprint(a.value[e]);
else if("list"===a.value[e].ctype)g.println(a.value[e]);else return u;"number"===a.value[0].ctype&&console.log(n)};g.matrix=function(a){return g.turnIntoCSList(a.map(g.turnIntoCSList))};g.realMatrix=function(a){for(var n=a.length,e=Array(n),b=0;b<n;b++)e[b]=g.realVector(a[b]);return g.turnIntoCSList(e)};g.ex=g.realVector([1,0,0]);g.ey=g.realVector([0,1,0]);g.ez=g.realVector([0,0,1]);g.linfty=g.realVector([0,0,1]);g.ii=g.turnIntoCSList([k.complex(1,0),k.complex(0,1),k.complex(0,0)]);g.jj=g.turnIntoCSList([k.complex(1,
0),k.complex(0,-1),k.complex(0,0)]);g.fundDual=g.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);g.fund=g.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);g.sequence=function(a,n){for(var e=[],b=0,c=Math.round(a.value.real);c<Math.round(n.value.real)+1;c++)e[b]={ctype:"number",value:{real:c,imag:0}},b++;return{ctype:"list",value:e}};g.pairs=function(a){for(var n=[],e=0;e<a.value.length-1;e++)for(var b=e+1;b<a.value.length;b++)n.push({ctype:"list",value:[a.value[e],a.value[b]]});return{ctype:"list",value:n}};g.triples=
function(a){for(var n=[],e=0;e<a.value.length-2;e++)for(var b=e+1;b<a.value.length-1;b++)for(var c=b+1;c<a.value.length;c++)n.push({ctype:"list",value:[a.value[e],a.value[b],a.value[c]]});return{ctype:"list",value:n}};g.cycle=function(a){for(var n=[],e=0;e<a.value.length-1;e++)n[e]={ctype:"list",value:[a.value[e],a.value[e+1]]};n.push({ctype:"list",value:[a.value[a.value.length-1],a.value[0]]});return{ctype:"list",value:n}};g.consecutive=function(a){for(var n=[],e=0;e<a.value.length-1;e++)n[e]={ctype:"list",
value:[a.value[e],a.value[e+1]]};return{ctype:"list",value:n}};g.reverse=function(a){for(var n=[],e=a.value.length-1;0<=e;e--)n.push(a.value[e]);return{ctype:"list",value:n}};g.directproduct=function(a,n){for(var e=[],b=0;b<a.value.length;b++)for(var c=0;c<n.value.length;c++)e.push({ctype:"list",value:[a.value[b],n.value[c]]});return{ctype:"list",value:e}};g.concat=function(a,n){for(var e=[],b=0;b<a.value.length;b++)e.push(a.value[b]);for(b=0;b<n.value.length;b++)e.push(n.value[b]);return{ctype:"list",
value:e}};g.prepend=function(a,n){var e=[];e[0]=a;for(var b=0;b<n.value.length;b++)e[b+1]=n.value[b];return{ctype:"list",value:e}};g.append=function(a,n){for(var e=[],b=0;b<a.value.length;b++)e[b]=a.value[b];e.push(n);return{ctype:"list",value:e}};g.contains=function(a,n){for(var e=0;e<a.value.length;e++)if(E.equals(a.value[e],n).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};g.common=function(a,n){for(var e=[],b=0,c=0;c<a.value.length;c++){for(var d=!1,g=a.value[c],f=0;f<
n.value.length;f++)d=d||E.equals(g,n.value[f]).value;d&&(e[b]=a.value[c],b++)}return{ctype:"list",value:e}};g.remove=function(a,n){for(var e=[],b=0,c=0;c<a.value.length;c++){for(var d=!1,g=a.value[c],f=0;f<n.value.length;f++)d=d||E.equals(g,n.value[f]).value;d||(e[b]=a.value[c],b++)}return{ctype:"list",value:e}};g.sort1=function(a){a=a.value.slice();a.sort(w.compare);return g.turnIntoCSList(a)};g._helper.isEqual=function(a,n){return g.equals(a,n).value};g._helper.isLessThan=function(a,n){for(var e=
a.value.length,b=n.value.length,c=0;!(c>=e||c>=b)&&w.isEqual(a.value[c],n.value[c]);)c++;return c===e&&c<b?!0:c===b&&c<e||c===e&&c===b?!1:w.isLessThan(a.value[c],n.value[c])};g._helper.compare=function(a,n){return g._helper.isLessThan(a,n)?-1:g._helper.isEqual(a,n)?0:1};g.equals=function(a,n){if(a.value.length!==n.value.length)return{ctype:"boolean",value:!1};for(var e=!0,b=0;b<a.value.length;b++)var c=a.value[b],d=n.value[b],e="list"===c.ctype&&"list"===d.ctype?e&&g.equals(c,d).value:e&&eb([c,d],
[]).value;return{ctype:"boolean",value:e}};g.almostequals=function(a,n){if(a.value.length!==n.value.length)return{ctype:"boolean",value:!1};for(var e=!0,b=0;b<a.value.length;b++)var c=a.value[b],d=n.value[b],e="list"===c.ctype&&"list"===d.ctype?e&&g.comp_almostequals(c,d).value:e&&sb([c,d],[]).value;return{ctype:"boolean",value:e}};g._helper.isAlmostReal=function(a){for(var n=!0,e=0;e<a.value.length;e++)var b=a.value[e],n="list"===b.ctype?n&&g._helper.isAlmostReal(b):n&&k._helper.isAlmostReal(b);
return n};g._helper.isAlmostZero=function(a){for(var n=0;n<a.value.length;n++){var e=a.value[n];if("list"===e.ctype){if(!g._helper.isAlmostZero(e))return!1}else if(!k._helper.isAlmostZero(e))return!1}return!0};g._helper.isNaN=function(a){for(var n=!1,e=0;e<a.value.length;e++)var b=a.value[e],n="list"===b.ctype?n||g._helper.isNaN(b):n||k._helper.isNaN(b);return n};g.set=function(a){var n=[],e=0;a=a.value.slice();a.sort(w.compare);for(var b=0;b<a.length;b++)0!==b&&eb([n[n.length-1],a[b]],[]).value||
(n[e]=a[b],e++);return{ctype:"list",value:n}};g.maxval=function(a){for(var n=k.zero,e=0;e<a.value.length;e++){var b=a.value[e];"number"===b.ctype&&(n=k.argmax(n,b));"list"===b.ctype&&(n=k.argmax(n,g.maxval(b)))}return n};g.maxIndex=function(a,n,e){var b=0;void 0!==e&&(b=e);e=b;for(var c=n(a.value[b]).value.real;b<a.value.length;++b){var d=n(a.value[b]).value.real;d>c&&(e=b,c=d)}return e};g.normalizeMax=function(a){var n=k.inv(g.maxval(a));return k._helper.isFinite(n)?g.scalmult(n,a):a};g.normalizeZ=
function(a){var n=k.inv(a.value[2]);return g.scalmult(n,a)};g.normalizeAbs=function(a){var n=k.inv(g.abs(a));return g.scalmult(n,a)};g.max=function(a,n){if(a.value.length!==n.value.length)return u;for(var e=[],b=0;b<a.value.length;b++)e[b]=w.max(a.value[b],n.value[b]);return{ctype:"list",value:e}};g.min=function(a,n){if(a.value.length!==n.value.length)return u;for(var e=[],b=0;b<a.value.length;b++)e[b]=w.min(a.value[b],n.value[b]);return{ctype:"list",value:e}};g.scaldiv=function(a,n){if("number"!==
a.ctype)return u;for(var e=[],b=0;b<n.value.length;b++){var c=n.value[b];e[b]="number"===c.ctype?w.div(c,a):"list"===c.ctype?g.scaldiv(a,c):u}return{ctype:"list",value:e}};g.scalmult=function(a,n){if("number"!==a.ctype)return u;for(var e=[],b=0;b<n.value.length;b++){var c=n.value[b];e[b]="number"===c.ctype?w.mult(c,a):"list"===c.ctype?g.scalmult(a,c):u}return{ctype:"list",value:e}};g.add=function(a,n){if(a.value.length!==n.value.length)return u;for(var e=[],b=0;b<a.value.length;b++){var c=a.value[b],
d=n.value[b];e[b]="number"===c.ctype&&"number"===d.ctype?w.add(c,d):"list"===c.ctype&&"list"===d.ctype?g.add(c,d):u}return{ctype:"list",value:e}};g.sub=function(a,n){if(a.value.length!==n.value.length)return u;for(var e=[],b=0;b<a.value.length;b++){var c=a.value[b],d=n.value[b];e[b]="number"===c.ctype&&"number"===d.ctype?k.sub(c,d):"list"===c.ctype&&"list"===d.ctype?g.sub(c,d):u}return{ctype:"list",value:e}};g.abs2=function(a){for(var n=0,e=0;e<a.value.length;e++){var b=a.value[e];if("number"===b.ctype)n+=
k.abs2(b).value.real;else if("list"===b.ctype)n+=g.abs2(b).value.real;else return u}return{ctype:"number",value:{real:n,imag:0}}};g.abs=function(a){return k.sqrt(g.abs2(a))};g.normalizeMaxXX=function(a){for(var n=-1E4,e=k.real(1),b=0;b<a.value.length;b++){var c=k.abs(a.value[b]);c.value.real>n&&(e=a.value[b],n=c.value.real)}return g.scaldiv(e,a)};g.recursive=function(a,n){for(var e=[],b=0;b<a.value.length;b++){var c=z(a.value[b]);e[b]="number"===c.ctype?k[n](c):"list"===c.ctype?g[n](c):u}return{ctype:"list",
value:e}};g.re=function(a){return g.recursive(a,"re")};g.neg=function(a){return g.recursive(a,"neg")};g.im=function(a){return g.recursive(a,"im")};g.conjugate=function(a){return g.recursive(a,"conjugate")};g.transjugate=function(a){return g.transpose(g.conjugate(a))};g.round=function(a){return g.recursive(a,"round")};g.ceil=function(a){return g.recursive(a,"ceil")};g.floor=function(a){return g.recursive(a,"floor")};g._helper.colNumb=function(a){if("list"!==a.ctype)return-1;for(var n=-1,e=0;e<a.value.length;e++){if("list"!==
a.value[e].ctype)return-1;if(0===e)n=a.value[e].value.length;else if(n!==a.value[e].value.length)return-1}return n};g._helper.isNumberVecN=function(a,n){if("list"!==a.ctype||a.value.length!==n)return!1;for(var e=0;e<a.value.length;e++)if("number"!==a.value[e].ctype)return!1;return!0};g.isNumberVector=function(a){if("list"!==a.ctype)return{ctype:"boolean",value:!1};for(var n=0;n<a.value.length;n++)if("number"!==a.value[n].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};g.isNumberVectorN=
function(a,n){if("list"!==a.ctype)return{ctype:"boolean",value:!1};if(a.value)for(var e=0;e<a.value.length;e++)if("number"!==a.value[e].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};g.isNumberMatrix=function(a){if(-1===g._helper.colNumb(a))return{ctype:"boolean",value:!1};for(var n=0;n<a.value.length;n++)if(!g.isNumberVector(a.value[n]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};g.scalproduct=function(a,n){if(a.value.length!==n.value.length)return u;
for(var e={ctype:"number",value:{real:0,imag:0}},b=0;b<n.value.length;b++){var c=a.value[b],d=n.value[b];if("number"===c.ctype&&"number"===d.ctype)e=k.add(k.mult(c,d),e);else return u}return e};g.sesquilinearproduct=function(a,n){if(a.value.length!==n.value.length)return u;for(var e=0,b=0,c=0;c<n.value.length;c++)var d=a.value[c].value,g=n.value[c].value,e=e+(d.real*g.real+d.imag*g.imag),b=b+(d.real*g.imag-d.imag*g.real);return k.complex(e,b)};g.normSquared=function(a){for(var n=0,e=0;e<a.value.length;e++)var b=
a.value[e].value,n=n+(b.real*b.real+b.imag*b.imag);return k.real(n)};g.productMV=function(a,n){if(a.value[0].value.length!==n.value.length)return u;for(var e=[],b=0;b<a.value.length;b++){for(var c={ctype:"number",value:{real:0,imag:0}},d=a.value[b],f=0;f<n.value.length;f++){var h=d.value[f],l=n.value[f];if("number"===h.ctype&&"number"===l.ctype)c=k.add(k.mult(h,l),c);else return u}e[b]=c}return g.turnIntoCSList(e)};g.productVM=function(a,n){if(a.value.length!==n.value.length)return u;for(var e=[],
b=0;b<n.value[0].value.length;b++){for(var c={ctype:"number",value:{real:0,imag:0}},d=0;d<a.value.length;d++){var f=a.value[d],h=n.value[d].value[b];if("number"===f.ctype&&"number"===h.ctype)c=k.add(k.mult(f,h),c);else return u}e[b]=c}return g.turnIntoCSList(e)};g.productMM=function(a,n){if(a.value[0].value.length!==n.value.length)return u;for(var e=[],b=0;b<a.value.length;b++){var c=g.productVM(a.value[b],n);e[b]=c}return g.turnIntoCSList(e)};g.mult=function(a,n){return a.value.length===n.value.length&&
g.isNumberVector(a).value&&g.isNumberVector(n).value?g.scalproduct(a,n):g.isNumberMatrix(a).value&&n.value.length===a.value[0].value.length&&g.isNumberVector(n).value?g.productMV(a,n):g.isNumberMatrix(n).value&&a.value.length===n.value.length&&g.isNumberVector(a).value?g.productVM(a,n):g.isNumberMatrix(a).value&&g.isNumberMatrix(n)&&n.value.length===a.value[0].value.length?g.productMM(a,n):u};g.projectiveDistMinScal=function(a,n){var e=g.abs(a),b=g.abs(n);if(0===e.value.real||0===b.value.real)return 0;
var c=g.conjugate(n),c=g.scalproduct(a,c),c=k._helper.isAlmostZero(c)?k.real(1):k.div(c,k.abs(c)),e=g.scaldiv(e,a),b=g.scaldiv(b,n),b=g.scalmult(c,b),c=g.abs(g.add(e,b)),b=g.abs(g.sub(e,b));return Math.min(c.value.real,b.value.real)};g.conicDist=function(a,b){var e=C(a),c=C(b);console.log(L(e),L(c));return g.projectiveDistMinScal(e,c)};g.crossOperator=function(a){var b=a.value[0],e=a.value[1];a=a.value[2];return g.turnIntoCSList([g.turnIntoCSList([k.zero,k.neg(a),e]),g.turnIntoCSList([a,k.zero,k.neg(b)]),
g.turnIntoCSList([k.neg(e),b,k.zero])])};g.cross=function(a,b){var e=k.sub(k.mult(a.value[1],b.value[2]),k.mult(a.value[2],b.value[1])),c=k.sub(k.mult(a.value[2],b.value[0]),k.mult(a.value[0],b.value[2])),d=k.sub(k.mult(a.value[0],b.value[1]),k.mult(a.value[1],b.value[0]));return g.turnIntoCSList([e,c,d])};g.crossratio3harm=function(a,b,e,c,d){var f=g.det3(a,e,d),h=g.det3(b,c,d);a=g.det3(a,c,d);b=g.det3(b,e,d);f=k.mult(f,h);h=k.mult(a,b);return g.turnIntoCSList([f,h])};g.crossratio3=function(a,b,
e,c,d){a=g.crossratio3harm(a,b,e,c,d);return k.div(a.value[0],a.value[1])};g.veronese=function(a){var b=k.mult(a.value[0],a.value[0]),e=k.mult(a.value[1],a.value[1]),c=k.mult(a.value[2],a.value[2]),d=k.mult(a.value[0],a.value[1]),f=k.mult(a.value[0],a.value[2]);a=k.mult(a.value[1],a.value[2]);return g.turnIntoSCList([b,e,c,d,f,a])};g.matrixFromVeronese=function(a){var b=a.value[0],e=a.value[1],c=a.value[2],d=k.realmult(.5,a.value[3]),f=k.realmult(.5,a.value[4]);a=k.realmult(.5,a.value[5]);return g.turnIntoCSList([g.turnIntoCSList([b,
d,f]),g.turnIntoCSList([d,e,a]),g.turnIntoCSList([f,a,c])])};g.det2=function(a,b){var e=k.mult(a.value[0],b.value[1]);return e=k.sub(e,k.mult(a.value[1],b.value[0]))};g.det3=function(a,b,e){return k.complex(a.value[0].value.real*b.value[1].value.real*e.value[2].value.real-a.value[0].value.imag*b.value[1].value.imag*e.value[2].value.real-a.value[0].value.imag*b.value[1].value.real*e.value[2].value.imag-a.value[0].value.real*b.value[1].value.imag*e.value[2].value.imag+a.value[2].value.real*b.value[0].value.real*
e.value[1].value.real-a.value[2].value.imag*b.value[0].value.imag*e.value[1].value.real-a.value[2].value.imag*b.value[0].value.real*e.value[1].value.imag-a.value[2].value.real*b.value[0].value.imag*e.value[1].value.imag+a.value[1].value.real*b.value[2].value.real*e.value[0].value.real-a.value[1].value.imag*b.value[2].value.imag*e.value[0].value.real-a.value[1].value.imag*b.value[2].value.real*e.value[0].value.imag-a.value[1].value.real*b.value[2].value.imag*e.value[0].value.imag-a.value[0].value.real*
b.value[2].value.real*e.value[1].value.real+a.value[0].value.imag*b.value[2].value.imag*e.value[1].value.real+a.value[0].value.imag*b.value[2].value.real*e.value[1].value.imag+a.value[0].value.real*b.value[2].value.imag*e.value[1].value.imag-a.value[2].value.real*b.value[1].value.real*e.value[0].value.real+a.value[2].value.imag*b.value[1].value.imag*e.value[0].value.real+a.value[2].value.imag*b.value[1].value.real*e.value[0].value.imag+a.value[2].value.real*b.value[1].value.imag*e.value[0].value.imag-
a.value[1].value.real*b.value[0].value.real*e.value[2].value.real+a.value[1].value.imag*b.value[0].value.imag*e.value[2].value.real+a.value[1].value.imag*b.value[0].value.real*e.value[2].value.imag+a.value[1].value.real*b.value[0].value.imag*e.value[2].value.imag,-a.value[0].value.imag*b.value[1].value.imag*e.value[2].value.imag+a.value[0].value.imag*b.value[1].value.real*e.value[2].value.real+a.value[0].value.real*b.value[1].value.real*e.value[2].value.imag+a.value[0].value.real*b.value[1].value.imag*
e.value[2].value.real-a.value[2].value.imag*b.value[0].value.imag*e.value[1].value.imag+a.value[2].value.imag*b.value[0].value.real*e.value[1].value.real+a.value[2].value.real*b.value[0].value.real*e.value[1].value.imag+a.value[2].value.real*b.value[0].value.imag*e.value[1].value.real-a.value[1].value.imag*b.value[2].value.imag*e.value[0].value.imag+a.value[1].value.imag*b.value[2].value.real*e.value[0].value.real+a.value[1].value.real*b.value[2].value.real*e.value[0].value.imag+a.value[1].value.real*
b.value[2].value.imag*e.value[0].value.real+a.value[0].value.imag*b.value[2].value.imag*e.value[1].value.imag-a.value[0].value.imag*b.value[2].value.real*e.value[1].value.real-a.value[0].value.real*b.value[2].value.real*e.value[1].value.imag-a.value[0].value.real*b.value[2].value.imag*e.value[1].value.real+a.value[2].value.imag*b.value[1].value.imag*e.value[0].value.imag-a.value[2].value.imag*b.value[1].value.real*e.value[0].value.real-a.value[2].value.real*b.value[1].value.real*e.value[0].value.imag-
a.value[2].value.real*b.value[1].value.imag*e.value[0].value.real+a.value[1].value.imag*b.value[0].value.imag*e.value[2].value.imag-a.value[1].value.imag*b.value[0].value.real*e.value[2].value.real-a.value[1].value.real*b.value[0].value.real*e.value[2].value.imag-a.value[1].value.real*b.value[0].value.imag*e.value[2].value.real)};g.det4m=function(a){var b=a.value,e=b[0].value,c=e[0].value,d=+c.real,g=+c.imag,c=e[1].value,f=+c.real,h=+c.imag,c=e[2].value,l=+c.real,m=+c.imag,c=e[3].value,q=+c.real,
p=+c.imag,e=b[1].value,c=e[0].value,r=+c.real,u=+c.imag,c=e[1].value,t=+c.real,w=+c.imag,c=e[2].value,v=+c.real,x=+c.imag,c=e[3].value,e=+c.real,c=+c.imag;a=d*t-g*w-f*r+h*u;var y=d*w+g*t-f*u-h*r,A=d*v-g*x-l*r+m*u,B=d*x+g*v-l*u-m*r,z=d*e-g*c-q*r+p*u,C=d*c+g*e-q*u-p*r,E=f*v-h*x-l*t+m*w,F=f*x+h*v-l*w-m*t,G=f*e-h*c-q*t+p*w,H=f*c+h*e-q*w-p*t,I=l*e-m*c-q*v+p*x,J=l*c+m*e-q*x-p*v,e=b[2].value,c=e[0].value,d=+c.real,g=+c.imag,c=e[1].value,f=+c.real,h=+c.imag,c=e[2].value,l=+c.real,m=+c.imag,c=e[3].value,q=
+c.real,p=+c.imag,e=b[3].value,c=e[0].value,r=+c.real,u=+c.imag,c=e[1].value,t=+c.real,w=+c.imag,c=e[2].value,v=+c.real,x=+c.imag,c=e[3].value,e=+c.real,c=+c.imag,b=d*t-g*w-f*r+h*u,wc=d*w+g*t-f*u-h*r,K=d*v-g*x-l*r+m*u,L=d*x+g*v-l*u-m*r,M=d*e-g*c-q*r+p*u,d=d*c+g*e-q*u-p*r,g=f*v-h*x-l*t+m*w,r=f*x+h*v-l*w-m*t,u=f*e-h*c-q*t+p*w,f=f*c+h*e-q*w-p*t,h=l*e-m*c-q*v+p*x,l=l*c+m*e-q*x-p*v;return k.complex(a*h-y*l-A*u+B*f+z*g-C*r+E*M-F*d-G*K+H*L+I*b-J*wc,a*l+y*h-A*f-B*u+z*r+C*g+E*d+F*M-G*L-H*K+I*wc+J*b)};g.eucangle=
function(a,b){var e=g.cross(a,g.linfty),c=g.cross(b,g.linfty),d=g.det3(g.ez,e,g.ii),e=g.det3(g.ez,e,g.jj),f=g.det3(g.ez,c,g.ii),c=g.det3(g.ez,c,g.jj),d=k.div(k.mult(d,c),k.mult(f,e)),d=k.log(d);return d=k.mult(d,k.complex(0,.5))};g.zerovector=function(a){a=Math.floor(a.value.real);for(var b=Array(a),e=0;e<a;e++)b[e]=0;return g.realVector(b)};g.zeromatrix=function(a,b){for(var e=Math.floor(a.value.real),c=Array(e),d=0;d<e;d++)c[d]=g.zerovector(b);return g.turnIntoCSList(c)};g.vandermonde=function(a){for(var b=
a.value.length,e=g.zeromatrix(b,b),c=0;c<b;c++)for(var d=0;d<b;d++)e.value[c].value[d]=k.pow(a.value[c],k.real(d-1));return e};g.transpose=function(a){for(var b=[],e=a.value[0].value.length,c=a.value.length,d=0;d<e;d++){for(var f=[],h=0;h<c;h++)f[h]=a.value[h].value[d];b[d]=g.turnIntoCSList(f)}return g.turnIntoCSList(b)};g.column=function(a,b){for(var e=[],c=a.value.length,d=Math.floor(b.value.real-1),f=0;f<c;f++)e[f]=a.value[f].value[d];return g.turnIntoCSList(e)};g.row=function(a,b){for(var e=[],
c=a.value[0].value.length,d=Math.floor(b.value.real-1),f=0;f<c;f++)e[f]=a.value[d].value[f];return g.turnIntoCSList(e)};g.adjoint2=function(a){var b=a.value[0].value[0],e=a.value[1].value[0],c=Array(2);c[0]=g.turnIntoCSList([a.value[1].value[1],k.neg(a.value[0].value[1])]);c[1]=g.turnIntoCSList([k.neg(e),b]);return c=g.turnIntoCSList(c)};g.adjoint3=function(a){var b,e,c,d,g,f,h,k,l,m,q,p,r,u,t,w,v;b=a.value[0].value;e=b[0].value;c=e.real;d=e.imag;e=b[1].value;g=e.real;f=e.imag;e=b[2].value;h=e.real;
k=e.imag;b=a.value[1].value;e=b[0].value;l=e.real;m=e.imag;e=b[1].value;q=e.real;p=e.imag;e=b[2].value;r=e.real;u=e.imag;b=a.value[2].value;e=b[0].value;a=e.real;t=e.imag;e=b[1].value;w=e.real;v=e.imag;e=b[2].value;b=e.real;e=e.imag;return{ctype:"list",value:[{ctype:"list",value:[{ctype:"number",value:{real:q*b-r*w-p*e+u*v,imag:q*e-r*v-w*u+b*p}},{ctype:"number",value:{real:-g*b+h*w+f*e-k*v,imag:-g*e+h*v+w*k-b*f}},{ctype:"number",value:{real:g*r-h*q-f*u+k*p,imag:g*u-h*p-q*k+r*f}}]},{ctype:"list",value:[{ctype:"number",
value:{real:-l*b+r*a+m*e-u*t,imag:-l*e+r*t+a*u-b*m}},{ctype:"number",value:{real:c*b-h*a-d*e+k*t,imag:c*e-h*t-a*k+b*d}},{ctype:"number",value:{real:-c*r+h*l+d*u-k*m,imag:-c*u+h*m+l*k-r*d}}]},{ctype:"list",value:[{ctype:"number",value:{real:l*w-q*a-m*v+p*t,imag:l*v-q*t-a*p+w*m}},{ctype:"number",value:{real:-c*w+g*a+d*v-f*t,imag:-c*v+g*t+a*f-w*d}},{ctype:"number",value:{real:c*q-g*l-d*p+f*m,imag:c*p-g*m-l*f+q*d}}]}]}};g.inverse=function(a){var b=a.value.length;if(b!==a.value[0].value.length)return console.log("Inverse works only for square matrices"),
u;if(2===b)return g.scaldiv(g.det(a),g.adjoint2(a));if(3===b)return g.scaldiv(g.det(a),g.adjoint3(a));b=g.LUdecomp(a);a=a.value.length;var e=k.real(0),c=k.real(1),d=g.zerovector(k.real(a));d.value[0]=c;for(var f=Array(a),h=0;h<a;h++)f[h]=g._helper.LUsolve(b,d),d.value[h]=e,d.value[h+1]=c;f=g.turnIntoCSList(f);return f=g.transpose(f)};g.linearsolve=function(a,b){return 2===a.value.length?g.linearsolveCramer2(a,b):3===a.value.length?g.linearsolveCramer3(a,b):g.LUsolve(a,b)};g.getDiag=function(a){if(a.value.length!==
a.value[0].value.length)return u;for(var b=Array(a.value.length),e=0;e<a.value.length;e++)b[e]=a.value[e].value[e];return g.turnIntoCSList(b)};g.getSubDiag=function(a){if(a.value.length!==a.value[0].value.length)return u;for(var b=Array(a.value.length-1),e=0;e<a.value.length-1;e++)b[e]=a.value[e+1].value[e];return g.turnIntoCSList(b)};g.eig2=function(a){var b=k.add(a.value[0].value[0],a.value[1].value[1]);a=g.det2(a.value[0],a.value[1]);var e=k.mult(b,b),c=b=k.mult(b,k.real(.5));a=k.sqrt(k.sub(k.div(e,
k.real(4)),a));b=k.add(b,a);c=k.sub(c,a);return g.turnIntoCSList([b,c])};g.eig=function(a,b){var e=b||!0,c=a,d=k.real(c.value.length),f=d.value.real;k.real(0);var c=g._helper.QRIteration(c)[0],c=g.getDiag(c),c=g.sort1(c),d=g.idMatrix(d,d),h=Array(f),h=g.turnIntoCSList(h);if(e){for(var l,m,q,p=0,r=!1,e=0;e<f;e++)r?m=l.value[p]:(l=c.value[e],l=g.sub(a,g.scalmult(l,d)),l=g.nullSpace(l),m=l.value[0],void 0!==m&&(q=m)),void 0===m&&(m=q),1E-8>g.abs(m).value.real&&0===p&&(m=g._helper.inverseIteration(a,
c.value[e])),h.value[e]=g._helper.isAlmostZeroVec(m)?m:g.scaldiv(g.abs(m),m),e<f-1&&((r=1E-6>k.abs(k.sub(c.value[e],c.value[e+1])).value.real)?p++:p=0);h=g.transpose(h)}return g.turnIntoCSList([c,h])};g._helper.isNormalMatrix=function(a){return 1E-10>g.abs(g.sub(a,g.transjugate(a))).value.real};g._helper.QRIteration=function(a,b){var e,c=a;e=k.real(c.value.length);var d=e.value.real,f=e.value.real;k.real(0);var h=g.idMatrix(e,e),l=g.zeromatrix(e,e),m=g.idMatrix(e,e),q=b?b:2500,p,r,u,t=0,v=Array(f);
for(e=0;e<q;e++){h=g._helper.getBlock(c,[f-2,f-1],[f-2,f-1]);p=g.eig2(h);h=p.value[0];p=p.value[1];g.abs(h);g.abs(p);r=c.value[f-1].value[f-1];u=k.abs(k.sub(r,h)).value.real;r=k.abs(k.sub(r,p)).value.real;p=u<r?h:p;h=g.idMatrix(k.real(f),k.real(f));p=g.scalmult(p,h);h=g.QRdecomp(g.sub(c,p));c=w.mult(h.R,h.Q);c=g.add(c,p);h.Q=g._helper.buildBlockMatrix(h.Q,g.idMatrix(k.real(t),k.real(t)));m=w.mult(m,h.Q);if(1E-48>k.abs2(c.value[c.value.length-1].value[c.value[0].value.length-2]).value.real&&1<f){v[d-
t-1]=c.value[f-1].value[f-1];for(e=0;e<f;e++)l.value[f-1].value[e]=c.value[f-1].value[e],l.value[e].value[f-1]=c.value[e].value[f-1];c=g._helper.getBlock(c,[0,f-2],[0,f-2]);t++;f--}if(1===f){l.value[0].value[0]=c.value[0].value[0];break}if(g._helper.isUpperTriangular(c)){for(e=0;e<f;e++)l.value[e].value[e]=c.value[e].value[e];break}}return[l,m]};g.rank=function(a,b){return g.RRQRdecomp(a,b).rank};g._helper.isAlmostZeroVec=function(a){for(var b=a.value.length,e=0;e<b;e++)if(!k._helper.isAlmostZero(a.value[e]))return!1;
return!0};g._helper.isLowerTriangular=function(a){for(var b=a.value.length,e=a.value[0].value.length,c=0;c<b;c++)for(var d=c+1;d<e;d++)if(!k._helper.isAlmostZero(a.value[c].value[d]))return!1;return!0};g._helper.isUpperTriangular=function(a){return g._helper.isLowerTriangular(g.transpose(a))};g._helper.isAlmostId=function(a){var b=a.value.length,e=k.real(b);if(b!==a.value[0].value.length)return!1;a=g.sub(a,g.idMatrix(e),e);for(e=0;e<b;e++)for(var c=0;c<b;c++)if(1E-16<k.abs(a.value[e].value[c]).value.real)return!1;
return!0};g.nullSpace=function(a,b){var e=a.value.length,c=g.RRQRdecomp(g.transjugate(a),b),d=g.transpose(c.Q),c=e-c.rank.value.real,f=Array(c);d.value.reverse();for(var h,l=0;l<c;l++)h=d.value[l],f[l]=g.scaldiv(g.abs(h),h);f=g.turnIntoCSList(f);return 0<f.value.length?f:g.turnIntoCSList([g.zerovector(k.real(e))])};g._helper.isAlmostDiagonal=function(a){var b=a.value.length;k.real(b);k.real(0);if(b!==a.value[0].value.length)return!1;for(var e=0;e<b;e++)for(var c=0;c<b;c++)if(e!==c&&1E-16<k.abs(a.value[e].value[c]).value.real)return!1;
return!0};g._helper.inverseIteration=function(a,b){console.log("warning: code untested");for(var e=a.value.length,c=Array(e),d=0;d<e;d++)c[d]=2*Math.random()-.5;var d=c=g.realVector(c),e=g.idMatrix(k.real(e),k.real(e)),f;f=k.add(b,k.real(.1*Math.random()-.5));for(var h=0;100>h;h++)d=g.scaldiv(g.abs(c),c),c=g.LUsolve(g.sub(a,g.scalmult(f,e)),JSON.parse(JSON.stringify(d)));return g.scaldiv(g.abs(c),c)};g._helper.toHessenberg=function(a){var b=JSON.parse(JSON.stringify(a)),e=b.value.length,c=k.real(e-
1),d=k.real(e);k.real(1);if(g._helper.isUpperTriangular(b))return[g.idMatrix(c,c),a];var f;a=g.idMatrix(d,d);for(var h,d=1;d<e-1;d++)f=g.column(b,k.real(d)),f.value=f.value.splice(d),h=g.abs2(f).value.real,1E-16<h&&(f=g._helper.getHouseHolder(f),a=w.mult(a,f),b=w.mult(w.mult(f,b),f)),c.value.real--;return[a,b]};g._helper.swapEl=function(a,b,e){var c;"[object Array]"===Object.prototype.toString.call(a)?(c=a[b],a[b]=a[e],a[e]=c):"list"===a.ctype&&(c=a.value[b],a.value[b]=a.value[e],a.value[e]=c)};g.RRQRdecomp=
function(a,b){var e=Math.sqrt(k.eps);void 0!==b&&(e=.1*b.value.real);var e=e*e,c,d=a.value.length,f=k.real(d),h=k.real(1),l=g._helper.unitvector(k.real(a.value.length),h),m=g.idMatrix(f,f),p=JSON.parse(JSON.stringify(a)),q=g.transpose(a),r=Array(d);for(c=0;c<d;c++)r[c]=g.abs2(q.value[c]);r=g.turnIntoCSList(r);q=Array(d);for(c=0;c<d;c++)q[c]=c;c=g.maxIndex(r,k.abs);for(var u=r.value[c],t=0,v=0;1E-16<k.abs2(u).value.real;v++){t++;g._helper.swapColumn(p,v,c);g._helper.swapEl(r,v,c);g._helper.swapEl(q,
v,c);c=g._helper.getBlock(p,[v],[v]);c=g.column(c,h);u=g.abs2(c).value.real;1E-8<u&&(c=g._helper.getHouseHolder(c),c=g._helper.buildBlockMatrix(g.idMatrix(k.real(v),k.real(v)),c),m=w.mult(m,g.transjugate(c)),p=w.mult(c,p));for(c=v+1;c<d;c++)r.value[c]=k.sub(r.value[c],k.mult(p.value[v].value[c],k.conjugate(p.value[v].value[c])));c=g.maxIndex(r,k.abs2,v+1);u=r.value[c];if(v+2===d){k.abs(u).value.real>e&&t++;break}f=k.sub(f,h);l.value=l.value.splice(0,l.value.length-1)}return{Q:m,R:p,P:g.turnIntoCSList(q),
rank:k.real(t)}};g._helper.getHouseHolder=function(a){var b=k.real(a.value.length);if(1E-16>g.abs2(a))return g.idMatrix(b,b);var e,c=k.real(1),d=g._helper.unitvector(k.real(a.value.length),c);e=g._helper.QRgetAlpha(a,0);e=g.sub(a,g.scalmult(e,d));e=g.scaldiv(g.abs(e),e);a=k.div(g.sesquilinearproduct(a,e),g.sesquilinearproduct(e,a));b=g.idMatrix(b,b);return b=g.sub(b,g.scalmult(k.add(c,a),g._helper.transposeMult(e,g.conjugate(e))))};g._helper.reOrderbyPivots=function(a,b){for(var e=a.value.length.length,
c=g.transpose(a),e=Array(e),d=0;d<b.length;d++)e[b[d]]=c.value[d];e=g.turnIntoCSList(e);return g.transpose(e)};g.QRdecomp=function(a){var b,e=a.value.length,c=k.real(e);if(g._helper.isUpperTriangular(a))return{Q:g.idMatrix(c,c),R:a};var d=k.real(1),f=g._helper.unitvector(k.real(a.value.length),d),h,l=g.idMatrix(c,c);a=JSON.parse(JSON.stringify(a));for(var m=0;;m++){b=g._helper.getBlock(a,[m],[m]);b=g.column(b,d);h=g.abs2(b).value.real;1E-8<h&&(b=g._helper.getHouseHolder(b),b=g._helper.buildBlockMatrix(g.idMatrix(k.real(m),
k.real(m)),b),l=w.mult(l,g.transjugate(b)),a=w.mult(b,a));if(m+2===e)break;c=k.sub(c,d);f.value=f.value.splice(0,f.value.length-1)}return{Q:l,R:a}};g._helper.swapColumn=function(a,b,e){for(var c,d=0;d<a.value.length;d++)c=a.value[d].value[b],a.value[d].value[b]=a.value[d].value[e],a.value[d].value[e]=c};g._helper.buildBlockMatrix=function(a,b){if(0===a.value.length)return b;if(0===b.value.length)return a;for(var e=a.value.length,c=a.value[0].value.length,d=c+b.value[0].value.length,d=g.zeromatrix(k.real(e+
b.value.length),k.real(d)),f=0;f<a.value.length;f++)for(var h=0;h<a.value[0].value.length;h++)d.value[f].value[h]=a.value[f].value[h];for(f=0;f<b.value.length;f++)for(h=0;h<b.value[0].value.length;h++)d.value[e+f].value[c+h]=b.value[f].value[h];return d};g._helper.getBlock=function(a,b,e){a=JSON.parse(JSON.stringify(a));var c=b[0],d=e[0];b=void 0===b[1]?a.value.length:b[1];e=void 0===e[1]?a.value[0].value.length:e[1];b++;e++;a.value=a.value.slice(c,b);for(c=0;c<a.value.length;c++)a.value[c].value=
a.value[c].value.slice(d,e);return a};g._helper.setBlock=function(a,b,e){a=JSON.parse(JSON.stringify(a));var c=e[0];e=e[1];for(var d=b.value.length,g=b.value[0].value.length,f=0;f<d;f++)for(var h=0;h<g;h++)a.value[c+f].value[e+h]=b.value[f].value[h];return a};g._helper.transposeMult=function(a,b){if(a.value.length!==b.value.length)return u;for(var e=a.value.length,c=Array(e),d=0;d<e;d++)c[d]=g.scalmult(a.value[d],b);return g.turnIntoCSList(c)};g._helper.QRgetAlpha=function(a,b){return 0>a.value[b].value.real?
g.abs(a):k.neg(g.abs(a))};g.LUdecomp=function(a){a=JSON.parse(JSON.stringify(a));var b,e,c,d,g,f=0,h,l=a.value.length,m=l-1,p=Array(l);for(c=0;c<l;++c){g=c;d=a.value[c];h=k.abs(d.value[c]).value.real;for(e=c+1;e<l;++e)b=k.abs(a.value[e].value[c]),h<b.value.real&&(h=b.value.real,g=e);h<k.eps&&console.log("Warning: singular matrix!");p[c]=g;g!==c&&(a.value[c]=a.value[g],a.value[g]=d,d=a.value[c],f++);e=d.value[c];for(b=c+1;b<l;++b)a.value[b].value[c]=k.div(a.value[b].value[c],e);for(b=c+1;b<l;++b){g=
a.value[b];for(e=c+1;e<m;++e)g.value[e]=k.sub(g.value[e],k.mult(g.value[c],d.value[e])),++e,g.value[e]=k.sub(g.value[e],k.mult(g.value[c],d.value[e]));e===m&&(g.value[e]=k.sub(g.value[e],k.mult(g.value[c],d.value[e])))}}return{LU:a,P:p,TransPos:f}};g.LUsolve=function(a,b){var e=g.LUdecomp(a);return g._helper.LUsolve(e,b)};g._helper.LUsolve=function(a,b){var e=JSON.parse(JSON.stringify(b)),c,d=a.LU,g=d.value.length,f=JSON.parse(JSON.stringify(e)),h=a.P,l;for(c=g-1;-1!==c;--c)f.value[c]=e.value[c];
for(c=0;c<g;++c)for(e=h[c],h[c]!==c&&(l=f.value[c],f.value[c]=f.value[e],f.value[e]=l),l=d.value[c],e=0;e<c;++e)f.value[c]=k.sub(f.value[c],k.mult(f.value[e],l.value[e]));for(c=g-1;0<=c;--c){l=d.value[c];for(e=c+1;e<g;++e)f.value[c]=k.sub(f.value[c],k.mult(f.value[e],l.value[e]));f.value[c]=k.div(f.value[c],l.value[c])}return f};g.linearsolveCramer2=function(a,b){var e=g.column(a,k.real(1)),c=g.column(a,k.real(2)),d=g.det2(e,c);k._helper.isZero(d)&&console.log("A is not regular!");c=g.det2(b,c);c=
k.div(c,d);e=g.det2(e,b);e=k.div(e,d);return g.turnIntoCSList([c,e])};g.linearsolveCramer3=function(a,b){var e=g.column(a,k.real(1)),c=g.column(a,k.real(2)),d=g.column(a,k.real(3)),f=g.det3(e,c,d);k._helper.isZero(f)&&console.log("A is not regular!");var h=g.det3(b,c,d),d=g.det3(e,b,d),e=g.det3(e,c,b),h=g.turnIntoCSList([h,d,e]);return h=g.scaldiv(f,h)};g.linearsolveCGNR=function(a,b){var e=g.transpose(a),c=w.mult(e,a),e=w.mult(e,b);return g.linearsolveCG(c,e)};g.linearsolveCG=function(a,b){var e,
c,d,f,h,l;f=b;c=e=g.sub(b,w.mult(a,b));for(var m=Math.ceil(1.2*a.value.length),p=0;p<m;){p++;h=w.mult(a,c);l=d=g.scalproduct(e,e);d=k.div(d,g.scalproduct(c,h));f=g.add(f,w.mult(d,c));e=g.sub(e,w.mult(d,h));if(g.abs(e).value.real<k.eps)break;d=g.scalproduct(e,e);d=k.div(d,l);c=g.add(e,w.mult(d,c))}p>=m&&console.log("CG did not converge");return f};g.det=function(a){if(1===a.value.length)return a.value[0].value[0];if(2===a.value.length)return g.det2(a.value[0],a.value[1]);if(3===a.value.length)return g.det3(a.value[0],
a.value[1],a.value[2]);if(4===a.value.length)return g.det4m(a);var b=a.value.length,e=k.real(1),c,d,f=JSON.parse(JSON.stringify(a)),h,l,m,p;for(a=0;a<b-1;a++){d=a;for(c=a+1;c<b;c++)k.abs(f.value[c].value[a]).value.real>k.abs(f.value[d].value[a]).value.real&&(d=c);d!==a&&(c=f.value[d],f.value[d]=f.value[a],f.value[a]=c,e=k.neg(e));h=f.value[a];for(c=a+1;c<b;c++){l=f.value[c];m=k.div(l.value[a],h.value[a]);for(d=a+1;d<b-1;d+=2)p=d+1,l.value[d]=k.sub(l.value[d],k.mult(h.value[d],m)),l.value[p]=k.sub(l.value[p],
k.mult(h.value[p],m));d!==b&&(l.value[d]=k.sub(l.value[d],k.mult(h.value[d],m)))}if(k._helper.isZero(h.value[a]))return k.real(0);e=k.mult(e,h.value[a])}return k.mult(e,f.value[a].value[a])};g.LUdet=function(a){a=g.LUdecomp(a);for(var b=a.LU,e=b.value.length,c=b.value[0].value[0],d=1;d<e;d++)c=k.mult(c,b.value[d].value[d]);1===a.TransPos%2&&(c=k.neg(c));return c};g.getField=function(a,b){var e;if("homog"===b){if(g._helper.isNumberVecN(a,3))return a;if(g._helper.isNumberVecN(a,2))return g.turnIntoCSList([a.value[0],
a.value[1],k.real(1)])}if("xy"===b){if(g._helper.isNumberVecN(a,2))return a;if(g._helper.isNumberVecN(a,3))return g.turnIntoCSList([k.div(a.value[0],a.value[2]),k.div(a.value[1],a.value[2])])}if("x"===b&&g.isNumberVector(a)){e=a.value.length;if(0<e&&3!==e)return a.value[0];if(3===e)return"Point"===a.usage?k.div(a.value[0],a.value[2]):a.value[0]}if("y"===b&&g.isNumberVector(a)){e=a.value.length;if(1<e&&3!==e)return a.value[1];if(3===e)return"Point"===a.usage?k.div(a.value[1],a.value[2]):a.value[1]}return"z"===
b&&g.isNumberVector(a)&&(e=a.value.length,2<e)?a.value[2]:u};var pb={":":20,".":25,"\u00b0":25,_:50,"^":50,"*":100,"/":100,"+":200,"-":200,"!":200,"==":300,"~=":300,"~<":300,"~>":300,"=:=":300,">=":300,"<=":300,"~>=":300,"~<=":300,">":300,"<":300,"<>":300,"&":350,"%":350,"!=":350,"~!=":350,"..":350,"++":370,"--":370,"~~":370,":>":370,"<:":370,"=":400,":=":400,":=_":400,"::=":400,"->":400,",":500,";":500},U={};U["+"]=Wb;U["-"]=tb;U["*"]=Xb;U["/"]=fc;U["^"]=gc;U["\u00b0"]=function(a,b){var e=z(a[0]),
c=z(a[1]);return"number"===e.ctype&&"void"===c.ctype?w.withUsage(k.realmult(Math.PI/180,e),"Angle"):u};U[";"]=function(a,b){var e="void"===a[0].ctype,c="void"===a[1].ctype;if(e&&c)return u;if(!e&&c)return y(a[0]);e||c||y(a[0]);return c?u:y(a[1])};U["="]=rb;U[".."]=function(a,b){var e=y(a[0]),c=y(a[1]);return"number"===e.ctype&&"number"===c.ctype?g.sequence(e,c):u};U[":="]=function(a,b){var e="undefined"===a[1].ctype;if("undefined"===a[0].ctype||e)return u;"function"===a[0].ctype&&(e=a[0].oper,aa[e]=
{oper:e,body:a[1],arglist:a[0].args});return u};U["=="]=eb;U["!="]=function(a,b){return w.not(eb(a,b))};U["~="]=sb;U["~!="]=function(a,b){return w.not(sb(a,b))};U[">"]=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real>c.value.real}:"string"===e.ctype&&"string"===c.ctype?{ctype:"boolean",value:e.value>c.value}:u};U["<"]=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===e.ctype&&
"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real<c.value.real}:"string"===e.ctype&&"string"===c.ctype?{ctype:"boolean",value:e.value<c.value}:u};U[">="]=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real>=c.value.real}:"string"===e.ctype&&"string"===c.ctype?{ctype:"boolean",value:e.value>=c.value}:u};U["<="]=function(a,
b){var e=z(a[0]),c=z(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real<=c.value.real}:"string"===e.ctype&&"string"===c.ctype?{ctype:"boolean",value:e.value<=c.value}:u};U["~>"]=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real>c.value.real+k.eps}:u};U["~<"]=function(a,b){var e=z(a[0]),c=
z(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real<c.value.real-k.eps}:u};U["~>="]=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real>c.value.real-k.eps}:u};U["~<="]=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?
{ctype:"boolean",value:e.value.real<c.value.real+k.eps}:u};U["&"]=Ub;U["%"]=Vb;U["!"]=function(a,b){var e=z(a[0]),c=z(a[1]);return"void"===e.ctype&&"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:u};U._=hc;U["++"]=ic;U["~~"]=jc;U["--"]=kc;U[":>"]=lc;U["<:"]=mc;var t={},E={evaluate:function(a,b,e){if(aa.hasOwnProperty(a))return aa(a,b,e);var c=t[a];if(c)return c(b,e);var d=a.lastIndexOf("$");if(-1!==d&&(d=a.substr(0,d),c=t[d]))return c(b,e);ma.err("Called undefined function "+d+" (as "+a+")");
return u},equals:function(a,b){return"number"===a.ctype&&"number"===b.ctype?{ctype:"boolean",value:a.value.real===b.value.real&&a.value.imag===b.value.imag}:"string"===a.ctype&&"string"===b.ctype||"boolean"===a.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:a.value===b.value}:"list"===a.ctype&&"list"===b.ctype?g.equals(a,b):{ctype:"boolean",value:!1}}},w={_helper:{},order:{undefined:0,boolean:1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(a){return{ctype:"string",
value:a}},bool:function(a){return{ctype:"boolean",value:a}},not:function(a){return w.bool(!a.value)},isLessThan:function(a,b){return-1===w.compare(a,b)},isEqual:function(a,b){return 0===w.compare(a,b)},compareResults:function(a,b){return w.compare(a.result,b.result)},compare:function(a,b){if(a.ctype!==b.ctype)return w.order[a.ctype]-w.order[b.ctype];if("number"===a.ctype)return k._helper.compare(a,b);if("list"===a.ctype)return g._helper.compare(a,b);if("string"===a.ctype)return a.value===b.value?
0:a.value<b.value?-1:1;if("boolean"===a.ctype)return a.value===b.value?0:!1===a.value?-1:1},add:function(a,b){return"void"===a.ctype&&"number"===b.ctype?b:"number"===a.ctype&&"number"===b.ctype?k.add(a,b):"string"===a.ctype||"string"===b.ctype?{ctype:"string",value:L(a)+L(b)}:"list"===a.ctype&&"list"===b.ctype?g.add(a,b):u},sub:function(a,b){return"void"===a.ctype&&"number"===b.ctype?k.neg(b):"void"===a.ctype&&"list"===b.ctype?g.neg(b):"number"===a.ctype&&"number"===b.ctype?k.sub(a,b):"list"===a.ctype&&
"list"===b.ctype?g.sub(a,b):u},mult:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.mult(a,b):"number"===a.ctype&&"list"===b.ctype?g.scalmult(a,b):"list"===a.ctype&&"number"===b.ctype?g.scalmult(b,a):"list"===a.ctype&&"list"===b.ctype?g.mult(a,b):u},div:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.div(a,b):"list"===a.ctype&&"number"===b.ctype?g.scaldiv(b,a):u},max:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.max(a,b):"list"===a.ctype&&"list"===b.ctype?
g.max(a,b):u},min:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.min(a,b):"list"===a.ctype&&"list"===b.ctype?g.min(a,b):u},wrap:function(a){if("number"===typeof a)return k.real(a);if("object"===typeof a&&void 0!==a.length){for(var b=[],e=0;e<a.length;e++)b[e]=w.wrap(a[e]);return g.turnIntoCSList(b)}return"string"===typeof a?{ctype:"string",value:a}:"boolean"===typeof a?{ctype:"boolean",value:a}:u},withUsage:function(a,b){return{ctype:a.ctype,value:a.value,usage:b}}};t.timestamp$0=function(a,
b){return{ctype:"number",value:{real:(new Date).getTime(),imag:0}}};t.seconds$0=function(a,b){return{ctype:"number",value:{real:(new Date).getTime()/1E3,imag:0}}};t.clearconsole$0=function(a,b){ma.clear()};t.err$1=function(a,b){var e="",c;"variable"===a[0].ctype?(e=a[0].name,c=J.getvar(a[0].name)):c=a[0];c=e+" ===> "+L(y(c));ma.err(c);return u};t.errc$1=function(a,b){var e;"variable"===a[0].ctype?(e=y(J.getvar(a[0].name)),console.log(a[0].name+" ===> "+L(e))):(e=y(a[0]),console.log(" ===> "+L(e)));
return u};t.print$1=function(a,b){ma.out(L(y(a[0])),!0)};t.println$1=function(a,b){ma.out(L(y(a[0])))};t.dump$1=function(a,b){console.log(JSON.stringify(a[0]));return u};t.repeat$2=function(a,b){return t.repeat$3([a[0],null,a[1]],b)};t.repeat$3=function(a,b){var e=z(a[0]),c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);if("number"!==e.ctype)return u;var e=Math.round(e.value.real),d=1,g=1,f=e+1,h=!1,k=!1,l=!1,m;void 0!==b.start&&(m=y(b.start),"number"===m.ctype&&(h=!0,g=m.value.real));void 0!==
b.step&&(m=y(b.step),"number"===m.ctype&&(l=!0,d=m.value.real));void 0!==b.stop&&(m=y(b.stop),"number"===m.ctype&&(k=!0,f=m.value.real));!h||k||l||(f=d*e+g);h||!k||l||(g=-d*(e-1)+f,f+=d);h||k||!l||(f=d*e+g);h&&k&&!l&&(d=(f-g)/(e-1),f+=d);h&&!k&&l&&(f=d*e+g);!h&&k&&l&&(g=-d*(e-1)+f,f+=d);h&&k&&l&&(f+=d);(g<=f&&0<d||g>=f&&0>d)&&h&&k&&l&&(e=Math.floor((f-g)/d));J.newvar(c);f=u;for(h=0;h<e;h++)J.setvar(c,{ctype:"number",value:{real:h*d+g,imag:0}}),f=y(a[2]);J.removevar(c);return f};t.while$2=function(a,
b){for(var e=a[1],c=a[0],d=y(c),g=u;"list"!==d.ctype&&d.value;)g=y(e),d=y(c);return g};t.apply$2=function(a,b){return t.apply$3([a[0],null,a[1]],b)};t.apply$3=function(a,b){var e=z(a[0]);if("list"!==e.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);var e=e.value,d=[];J.newvar(c);for(var g=0;g<e.length;g++)J.setvar(c,e[g]),d[g]=y(a[2]);J.removevar(c);return{ctype:"list",value:d}};t.forall$2=function(a,b){return t.forall$3([a[0],null,a[1]],b)};t.forall$3=function(a,b){var e=
z(a[0]);if("list"!==e.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);e=e.value;J.newvar(c);for(var d,g=0;g<e.length;g++)J.setvar(c,e[g]),d=y(a[2]);J.removevar(c);return d};t.select$2=function(a,b){return t.select$3([a[0],null,a[1]],b)};t.select$3=function(a,b){var e=z(a[0]);if("list"!==e.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);var e=e.value,d=[];J.newvar(c);for(var g=0,f=0;f<e.length;f++){J.setvar(c,e[f]);var h=y(a[2]);"boolean"===
h.ctype&&!0===h.value&&(d[g]=e[f],g++)}J.removevar(c);return{ctype:"list",value:d}};t.flatten$1=function(a,b){function e(a,b){return-1===b||"list"!==a.ctype?a:[].concat.apply([],a.value.map(function(a){return e(a,b-1)}))}var c=z(a[0]);if("list"!==c.ctype)return c;var d=b.levels;void 0===d?d=1:(d=y(d),d="number"===d.ctype?d.value.real:"string"===d.ctype&&"all"===d.value?-2:1);return{ctype:"list",value:e(c,d)}};t.createvar$1=function(a,b){"variable"===a[0].ctype&&J.newvar(a[0].name);return u};t.local=
function(a,b){for(var e=0;e<a.length;e++)"variable"===a[e].ctype&&J.newvar(a[e].name);return u};t.removevar$1=function(a,b){var e=y(a[0]);"variable"===a[0].ctype&&J.removevar(a[0].name);return e};t.release=function(a,b){if(0===a.length)return u;for(var e=y(a[a.length-1]),c=0;c<a.length;c++)"variable"===a[c].ctype&&J.removevar(a[c].name);return e};t.regional=function(a,b){for(var e=0;e<a.length;e++)if("variable"===a[e].ctype){var c=a[e].name;J.newvar(c);J.pushVstack(c)}return u};t.genList=function(a,
b){for(var e=[],c=0;c<a.length;c++)e[c]=y(a[c]);return{ctype:"list",value:e}};E.assigntake=function(a,b){var e=a.args[0],c=y(e),d=z(a.args[1]),f=u;if("list"===c.ctype||"string"===c.ctype)d=Math.floor(d.value.real),0>d&&(d=c.value.length+d+1),0<d&&d<=c.value.length&&("list"===c.ctype?(c=c.value.slice(),c[d-1]=y(b),f=g.turnIntoCSList(c)):(c=c.value,c=c.substring(0,d-1)+L(y(b))+c.substring(d,c.length),f=w.string(c)));rb([e,f])};E.assigndot=function(a,b){var e=y(a.obj),c=a.key;"geo"===e.ctype&&c&&ta.setField(e.value,
c,b);return u};E.assignlist=function(a,b){var e=a.length,c=b.length;c<e&&(e=c);for(c=0;c<e;c++)rb([a[c],b[c]],[])};t.if$2=function(a,b){return t.if$3(a,b)};t.if$3=function(a,b){var e=z(a[0]);if("boolean"===e.ctype){if(!0===e.value)return y(a[1]);if(3===a.length)return y(a[2])}return u};t.and$2=Ub;t.or$2=Vb;t.xor$2=function(a,b){var e=z(a[0]),c=z(a[1]);return"boolean"===e.ctype&&"boolean"===c.ctype?{ctype:"boolean",value:e.value!==c.value}:u};t.not$1=function(a,b){var e=z(a[0]);return"boolean"===e.ctype?
{ctype:"boolean",value:!e.value}:u};E.genericListMathGen=function(a,b,e){t[a+"$1"]=function(a,c){var d=y(a[0]);if("list"!==d.ctype)return u;d=d.value;if(0===d.length)return e;for(var g=d[0],f=1;f<d.length;f++)g=b(g,d[f]);return g};var c=a+"$3";t[a+"$2"]=function(a,e){return t[c]([a[0],null,a[1]])};t[c]=function(a,c){var d=z(a[0]);if("list"!==d.ctype)return u;d=d.value;if(0===d.length)return e;var g="#";null!==a[1]&&"variable"===a[1].ctype&&(g=a[1].name);J.newvar(g);J.setvar(g,d[0]);for(var f=y(a[2]),
D=1;D<d.length;D++){J.setvar(g,d[D]);var h=y(a[2]),f=b(f,h)}J.removevar(g);return f}};E.genericListMathGen("product",w.mult,k.real(1));E.genericListMathGen("sum",w.add,k.real(0));E.genericListMathGen("max",w.max,u);E.genericListMathGen("min",w.min,u);t.max$2=function(a,b){var e=z(a[0]);if("list"===e.ctype)return t.max$3([e,null,a[1]]);var c=z(a[1]);return t.max$1([g.turnIntoCSList([e,c])])};t.min$2=function(a,b){var e=z(a[0]);if("list"===e.ctype)return t.min$3([e,null,a[1]]);var c=z(a[1]);return t.min$1([g.turnIntoCSList([e,
c])])};t.add$2=Wb;t.sub$2=tb;t.mult$2=Xb;t.div$2=fc;t.mod$2=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===e.ctype&&"number"===c.ctype?k.mod(e,c):u};t.pow$2=gc;t.exp$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?k.exp(e):u};t.sin$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?k.sin(e):u};t.sqrt$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?k.sqrt(e):u};E.laguerre=function(a,b,e){if("list"!==a.ctype)return u;var c=a.value.length-1,d;for(d=0;d<=c;d++)if("number"!==
a.value[d].ctype)return u;if("number"!==b.ctype)return u;for(var g=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],f,h,l,m=1;m<=e;m++){l=k.real(0);h=k.real(0);f=a.value[c];for(d=c-1;0<=d;d--)l=k.add(h,k.mult(l,b)),h=k.add(f,k.mult(h,b)),f=k.add(a.value[d],k.mult(f,b));if(k._helper.isLessThan(k.abs(f),k.real(1E-14)))break;d=k.div(h,f);h=k.mult(d,d);f=k.sub(h,k.div(k.mult(k.real(2),l),f));l=k.sqrt(k.mult(k.real(c-1),k.sub(k.mult(k.real(c),f),h)));f=k.add(d,l);d=k.sub(d,l);k._helper.isLessThan(k.abs(f),
k.abs(d))&&(f=d);d=k._helper.isLessThan(k.real(1E-14),k.abs(f))?k.div(k.real(c),f):k.mult(k.add(k.abs(b),k.real(1)),k.complex(Math.cos(m),Math.sin(m)));if(k._helper.isLessThan(k.abs(d),k.real(1E-14)))break;0===m%20&&(d=k.mult(d,k.real(g[m/20])));b=k.sub(b,d)}return b};t.roots$1=function(a,b){var e=z(a[0]);if("list"===e.ctype){var c;for(c=0;c<e.value.length;c++)if("number"!==e.value[c].ctype)return u;var d=[],f=e,h=e.value.length-1;for(c=0;c<h;c++){d[c]=E.laguerre(e,k.zero,200);d[c]=E.laguerre(f,d[c],
1);var l=[];l[h-c]=e.value[h-c];for(var m=h-c;0<m;m--)l[m-1]=k.add(e.value[m-1],k.mult(l[m],d[c]));l.shift();e=g.turnIntoCSList(l)}return g.sort1(g.turnIntoCSList(d))}return u};t.autodiff$3=function(a,b){var e="x",c;if("function"===a[0].ctype)c=aa[a[0].oper].body,e=a[0].args[0].name;else if("function"===typeof a[0].impl)c=a[0];else return console.log("could not parse function"),u;var d=z(a[1]),g=z(a[2]);if(1>g.value.real)return console.log("grade cant be < 1"),u;g=k.add(g,k.real(1));return N.autodiff(c,
e,d,g)};t.cos$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?k.cos(e):u};t.tan$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?k.tan(e):u};t.arccos$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?k.arccos(e):u};t.arcsin$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?k.arcsin(e):u};t.arctan$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?k.arctan(e):u};t.arctan2$2=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===e.ctype&&"number"===c.ctype?k.arctan2(e,c):
u};t.arctan2$1=function(a,b){var e=z(a[0]);return"list"===e.ctype&&2===e.value.length&&(e=e.value,"number"===e[0].ctype&&"number"===e[1].ctype)?t.arctan2$2(e,b):u};t.log$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?k.log(e):u};E.recursiveGen=function(a){var b=k[a],e=g[a];t[a+"$1"]=function(a,c){var d=z(a[0]);return"number"===d.ctype?b(d):"list"===d.ctype?e(d):u}};E.recursiveGen("im");E.recursiveGen("re");E.recursiveGen("conjugate");E.recursiveGen("round");E.recursiveGen("ceil");E.recursiveGen("floor");
E.recursiveGen("abs");t.abs_infix=t.abs$1;t.random$0=function(a,b){return k.real(k._helper.rand())};t.random$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?k.complex(e.value.real*k._helper.rand(),e.value.imag*k._helper.rand()):u};t.seedrandom$1=function(a,b){var e=z(a[0]);"number"===e.ctype&&k._helper.seedrandom(e.value.real);return u};t.randomnormal$0=function(a,b){return k.real(k._helper.randnormal())};t.randominteger$1=function(a,b){var e=z(a[0]);if("number"===e.ctype){var c=e.value.real|
0,e=e.value.imag|0,c=c*k._helper.rand()|0,e=e*k._helper.rand()|0;return k.complex(c,e)}return u};t.randomint$1=t.randominteger$1;t.randombool$0=function(a,b){return.5<k._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isreal$1=function(a,b){var e=y(a[0]);return"number"===e.ctype&&k._helper.isAlmostReal(e)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isinteger$1=function(a,b){var e=y(a[0]);return"number"===e.ctype&&k._helper.isAlmostReal(e)&&e.value.real===Math.floor(e.value.real)?
{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.iseven$1=function(a,b){var e=y(a[0]);return"number"===e.ctype&&k._helper.isAlmostReal(e)&&e.value.real/2===Math.floor(e.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isodd$1=function(a,b){var e=y(a[0]);return"number"===e.ctype&&k._helper.isAlmostReal(e)&&(e.value.real-1)/2===Math.floor((e.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.iscomplex$1=function(a,b){return"number"===y(a[0]).ctype?
{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isstring$1=function(a,b){return"string"===y(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.islist$1=function(a,b){return"list"===y(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.ismatrix$1=function(a,b){var e=y(a[0]);return-1!==g._helper.colNumb(e)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.iscircle$1=function(a,b){var e=y(a[0]);return"geo"===e.ctype&&"C"===e.value.kind&&"Circle"===e.value.matrix.usage?
{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isconic$1=function(a,b){var e=y(a[0]);return"geo"===e.ctype&&"C"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isline$1=function(a,b){var e=y(a[0]);return"geo"===e.ctype&&"L"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.ispoint$1=function(a,b){var e=y(a[0]);return"geo"===e.ctype&&"P"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isgeometric$1=function(a,b){return"geo"===
y(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isnumbermatrix$1=function(a,b){var e=y(a[0]);return g.isNumberMatrix(e).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isnumbervector$1=function(a,b){var e=y(a[0]);return g.isNumberVector(e).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.issun$1=function(a,b){var e=y(a[0]);return"geo"===e.ctype&&void 0!==e.value.behavior&&"Sun"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",
value:!1}};t.ismass$1=function(a,b){var e=y(a[0]);return"geo"===e.ctype&&void 0!==e.value.behavior&&"Mass"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isspring$1=function(a,b){var e=y(a[0]);return"geo"===e.ctype&&void 0!==e.value.behavior&&"Spring"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isbouncer$1=function(a,b){var e=y(a[0]);return"geo"===e.ctype&&void 0!==e.value.behavior&&"Bouncer"===e.value.behavior.type?{ctype:"boolean",
value:!0}:{ctype:"boolean",value:!1}};t.isundefined$1=function(a,b){return"undefined"===y(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.matrixrowcolumn$1=function(a,b){var e=y(a[0]);return-1!==g._helper.colNumb(e)?g.realVector([e.value.length,e.value[0].value.length]):u};t.rowmatrix$1=function(a,b){var e=y(a[0]);return"list"===e.ctype?g.turnIntoCSList([e]):u};t.columnmatrix$1=function(a,b){var e=y(a[0]);return"list"===e.ctype?g.turnIntoCSList(e.value.map(function(a){return g.turnIntoCSList([a])})):
u};t.submatrix$3=function(a,b){var e=y(a[0]),c=y(a[1]),d=y(a[2]);if("list"===e.ctype&&"number"===c.ctype&&"number"===d.ctype){var f=Math.round(c.value.real),c=Math.round(d.value.real),e=e.value.slice();0<c&&c<=e.length&&e.splice(c-1,1);var h=!0,e=e.map(function(a){if("list"!==a.ctype)h=!1;else return a=a.value.slice(),0<f&&f<=a.length&&a.splice(f-1,1),g.turnIntoCSList(a)});return h?g.turnIntoCSList(e):u}return u};t.complex$1=function(a,b){var e,c,d;d=z(a[0]);if("list"===d.ctype&&g.isNumberVector(d)){if(2===
d.value.length)return e=d.value[0],c=d.value[1],k.complex(e.value.real-c.value.imag,c.value.real+e.value.imag);if(3===d.value.length)return e=d.value[0],c=d.value[1],d=d.value[2],e=k.div(e,d),c=k.div(c,d),k.complex(e.value.real-c.value.imag,c.value.real+e.value.imag)}return u};t.gauss$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?g.realVector([e.value.real,e.value.imag]):u};t.cross$2=function(a,b){var e=M(a[0]),c=M(a[1]);if(e!==u&&c!==u){var d=g.cross(e,c);"Point"===e.usage&&"Point"===c.usage&&
(d=w.withUsage(d,"Line"));"Line"===e.usage&&"Line"===c.usage&&(d=w.withUsage(d,"Point"));return d}return u};t.crossratio$4=function(a,b){var e=y(a[0]),c=y(a[1]),d=y(a[2]),f=y(a[3]),h=M(e),l=M(c),m=M(d),p=M(f);return h!==u&&l!==u&&m!==u&&p!==u?g.crossratio3(h,l,m,p,g.ii):"number"===e.ctype&&"number"===c.ctype&&"number"===d.ctype&&"number"===f.ctype?k.div(k.mult(k.sub(e,d),k.sub(c,f)),k.mult(k.sub(e,f),k.sub(c,d))):u};t.para$2=function(a,b){var e=z(a[0]),c=z(a[1]),d=M(e),f=M(c);if(e!==u&&c!==u){var c=
c.usage,h=d,k=f;if("Line"===e.usage||"Point"===c)h=f,k=d;e=g.cross(g.cross(g.linfty,k),h);return w.withUsage(e,"Line")}return u};t.perp$2=function(a,b){var e=z(a[0]),c=z(a[1]),d=M(e),f=M(c);if(e!==u&&c!==u){var h=c.usage||f.usage,c=d,l=f;if("Line"===(e.usage||d.usage)||"Point"===h)c=f,l=d;e=g.turnIntoCSList([l.value[0],l.value[1],k.zero]);e=g.cross(e,c);return w.withUsage(e,"Line")}return u};t.perp$1=function(a,b){var e=z(a[0]);return g._helper.isNumberVecN(e,2)?g.turnIntoCSList([k.neg(e.value[1]),
e.value[0]]):u};t.parallel$2=t.para$2;t.perpendicular$2=t.perp$2;t.perpendicular$1=t.perp$1;t.meet$2=function(a,b){var e=M(a[0]),c=M(a[1]);return e!==u&&c!==u?(e=g.cross(e,c),w.withUsage(e,"Point")):u};t.join$2=function(a,b){var e=M(a[0]),c=M(a[1]);return e!==u&&c!==u?(e=g.cross(e,c),w.withUsage(e,"Line")):u};t.dist$2=function(a,b){var e=z(a[0]),c=z(a[1]),e=tb([e,c],[]);return t.abs$1([e],[])};t.dist_infix=t.dist$2;t.point$1=function(a,b){var e=y(a[0]);return g._helper.isNumberVecN(e,3)||g._helper.isNumberVecN(e,
2)?w.withUsage(e,"Point"):e};t.line$1=function(a,b){var e=y(a[0]);return g._helper.isNumberVecN(e,3)?w.withUsage(e,"Line"):e};t.det$3=function(a,b){var e=M(a[0]),c=M(a[1]),d=M(a[2]);if(e!==u&&c!==u&&d!==u)return g.det3(e,c,d)};t.det$1=function(a,b){var e=z(a[0]);if("list"===e.ctype){var c=g._helper.colNumb(e);if(-1!==c&&c===e.value.length)return g.det(e)}return u};t.eig$1=function(a,b){var e=z(a[0]);if("list"===e.ctype){var c=g._helper.colNumb(e);if(-1!==c&&c===e.value.length)return g.eig(e)}return u};
t.eigenvalues$1=function(a,b){var e=z(a[0]);if("list"===e.ctype){var c=g._helper.colNumb(e);if(-1!==c&&c===e.value.length)return g.eig(e,!1).value[0]}return u};t.rank$1=function(a,b){var e=z(a[0]);if("list"===e.ctype){var c=g._helper.colNumb(e);if(-1!==c&&c===e.value.length)return g.rank(e,b.precision)}return u};t.kernel$1=function(a,b){var e=z(a[0]);if("list"===e.ctype){var c=g._helper.colNumb(e);if(-1!==c&&c===e.value.length)return e=g.nullSpace(e,b.precision),g.transpose(e)}return u};t.eigenvectors$1=
function(a,b){var e=z(a[0]);if("list"===e.ctype){var c=g._helper.colNumb(e);if(-1!==c&&c===e.value.length)return g.eig(e).value[1]}return u};t.area$3=function(a,b){var e=M(a[0]),c=M(a[1]),d=M(a[2]);if(e!==u&&c!==u&&d!==u){var f=e.value[2],h=c.value[2],l=d.value[2];if(!k._helper.isAlmostZero(f)&&!k._helper.isAlmostZero(h)&&!k._helper.isAlmostZero(l))return e=g.scaldiv(f,e),c=g.scaldiv(h,c),d=g.scaldiv(l,d),e=g.det3(e,c,d),k.realmult(.5,e)}return u};t.inverse$1=function(a,b){var e=z(a[0]);if("list"===
e.ctype){var c=g._helper.colNumb(e);if(-1!==c&&c===e.value.length)return g.inverse(e)}return u};t.linearsolve$2=function(a,b){var e=z(a[0]),c=z(a[1]);if("list"===e.ctype){var d=g._helper.colNumb(e);if(-1!==d&&d===e.value.length&&g._helper.isNumberVecN(c,d))return g.linearsolve(e,c)}return u};var Mc=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,
1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];t.mincostmatching$1=function(a,b){var e=y(a[0]);if(g.isNumberMatrix(e)){var c=e.value.length,d=g._helper.colNumb(e),f=c<d?d:c,h,l,m=Array(f);for(h=0;h<f;++h)for(m[h]=Array(f),l=0;l<f;++l)m[h][l]=h<c&&l<d?e.value[h].value[l].value.real:0;e=Ab(m);f=Array(c);for(h=0;h<c;++h)l=e[h],f[h]=l<d?k.real(l+1):k.real(0);return g.turnIntoCSList(f)}return u};t.length$1=function(a,b){var e=y(a[0]);
return"list"===e.ctype||"string"===e.ctype?k.real(e.value.length):u};t.pairs$1=function(a,b){var e=y(a[0]);return"list"===e.ctype?g.pairs(e):u};t.triples$1=function(a,b){var e=y(a[0]);return"list"===e.ctype?g.triples(e):u};t.cycle$1=function(a,b){var e=y(a[0]);return"list"===e.ctype?g.cycle(e):u};t.consecutive$1=function(a,b){var e=y(a[0]);return"list"===e.ctype?g.consecutive(e):u};t.reverse$1=function(a,b){var e=y(a[0]);return"list"===e.ctype?g.reverse(e):u};t.directproduct$2=function(a,b){var e=
y(a[0]),c=y(a[1]);return"list"===e.ctype&&"list"===c.ctype?g.directproduct(e,c):u};t.concat$2=ic;t.common$2=jc;t.remove$2=kc;t.append$2=lc;t.prepend$2=mc;t.contains$2=function(a,b){var e=y(a[0]),c=y(a[1]);return"list"===e.ctype?g.contains(e,c):u};t.sort$2=function(a,b){return t.sort$3([a[0],null,a[1]],b)};t.sort$3=function(a,b){var e=z(a[0]);if("list"!==e.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);var e=e.value,d=[];J.newvar(c);var g;for(g=0;g<e.length;g++)J.setvar(c,
e[g]),d[g]={val:e[g],result:y(a[2])};J.removevar(c);d.sort(w.compareResults);c=[];for(g=0;g<e.length;g++)c[g]=d[g].val;return{ctype:"list",value:c}};t.sort$1=function(a,b){var e=y(a[0]);return"list"===e.ctype?g.sort1(e):u};t.set$1=function(a,b){var e=y(a[0]);return"list"===e.ctype?g.set(e):u};t.combinations$2=function(a,b){function e(a,b){a===h?m.push(g.turnIntoCSList(l.slice())):b<f&&(l[a]=c.value[b],e(a+1,b+1),e(a,b+1))}var c=y(a[0]),d=y(a[1]),f,h,l,m;if("number"===d.ctype){h=d.value.real|0;if("number"===
c.ctype){f=c.value.real|0;f-h<h&&(h=f-h);if(0>h)return k.real(0);if(0===h)return k.real(1);if(1===h)return c;for(var p=d=1,q=1;q<=h;++q)var r=f-h+q|0,t=q|0,v=Bb(r,t)|0,r=r/v|0,t=t/v|0,v=Bb(d,t)|0,d=d/v|0,t=t/v|0,v=Bb(r,p)|0,r=r/v|0,p=p/v|0,d=d*r|0,p=p*t|0;return k.real(d/p)}if("list"===c.ctype){f=c.value.length;if(0>h||h>f)return g.turnIntoCSList([]);if(0===h)return g.turnIntoCSList([g.turnIntoCSList([])]);if(h===f)return g.turnIntoCSList([c]);m=[];l=Array(h);e(0,0);return g.turnIntoCSList(m)}}return u};
t.zeromatrix$2=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===e.ctype&&"number"===c.ctype?g.zeromatrix(e,c):u};t.zerovector$1=function(a,b){var e=z(a[0]);return"number"===e.ctype?g.zerovector(e):u};t.transpose$1=function(a,b){var e=z(a[0]);return"list"===e.ctype&&-1!==g._helper.colNumb(e)?g.transpose(e):u};t.row$2=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===c.ctype&&"list"===e.ctype&&-1!==g._helper.colNumb(e)?g.row(e,c):u};t.column$2=function(a,b){var e=z(a[0]),c=z(a[1]);return"number"===
c.ctype&&"list"===e.ctype&&-1!==g._helper.colNumb(e)?g.column(e,c):u};t.red$1=function(a,b){var e=y(a[0]);return"number"===e.ctype?(e=Math.min(1,Math.max(0,e.value.real)),g.realVector([e,0,0])):u};t.green$1=function(a,b){var e=y(a[0]);return"number"===e.ctype?(e=Math.min(1,Math.max(0,e.value.real)),g.realVector([0,e,0])):u};t.blue$1=function(a,b){var e=y(a[0]);return"number"===e.ctype?(e=Math.min(1,Math.max(0,e.value.real)),g.realVector([0,0,e])):u};t.gray$1=function(a,b){var e=y(a[0]);return"number"===
e.ctype?(e=Math.min(1,Math.max(0,e.value.real)),g.realVector([e,e,e])):u};t.grey$1=t.gray$1;E.HSVtoRGB=function(a,b,e){var c,d,f,h,k,l;a&&void 0===b&&void 0===e&&(b=a.s,e=a.v,a=a.h);h=Math.floor(6*a);k=6*a-h;a=e*(1-b);l=e*(1-k*b);b=e*(1-(1-k)*b);switch(h%6){case 0:c=e;d=b;f=a;break;case 1:c=l;d=e;f=a;break;case 2:c=a;d=e;f=b;break;case 3:c=a;d=l;f=e;break;case 4:c=b;d=a;f=e;break;case 5:c=e,d=a,f=l}return g.realVector([c,d,f])};t.hue$1=function(a,b){var e=y(a[0]);return"number"===e.ctype?(e=e.value.real,
e-=Math.floor(e),E.HSVtoRGB(e,1,1)):u};E.shapeconvert=function(a){var b,e;if("circle"===a.type){b=a.value.value[0];b=w.div(b,b.value[2]);var c=b.value[0].value.real,d=b.value[1].value.real;a=a.value.value[1].value.real;e=[];var g=2*Math.PI/36;for(b=0;36>b;b++)e[b]={X:c+Math.cos(b*g)*a,Y:d+Math.sin(b*g)*a};return[e]}if("polygon"===a.type){c=[];for(b=0;b<a.value.length;b++){d=a.value[b];e=[];for(g=0;g<d.length;g++)e[g]={X:d[g].X,Y:d[g].Y};c[b]=e}return c}};E.shapeop=function(a,b,e){a=E.shapeconvert(a);
var c=E.shapeconvert(b);ClipperLib.JS.ScaleUpPaths(a,1E3);ClipperLib.JS.ScaleUpPaths(c,1E3);b=new ClipperLib.Clipper;b.AddPaths(a,ClipperLib.PolyType.ptSubject,!0);b.AddPaths(c,ClipperLib.PolyType.ptClip,!0);var c=a=ClipperLib.PolyFillType.pftNonZero,d=new ClipperLib.Paths;b.Execute(e,d,a,c);ClipperLib.JS.ScaleDownPaths(d,1E3);return{ctype:"shape",type:"polygon",value:d}};E.shapecommon=function(a,b){return E.shapeop(a,b,ClipperLib.ClipType.ctIntersection)};E.shaperemove=function(a,b){return E.shapeop(a,
b,ClipperLib.ClipType.ctDifference)};E.shapeconcat=function(a,b){return E.shapeop(a,b,ClipperLib.ClipType.ctUnion)};t.key$0=function(a,b){return{ctype:"string",value:bc}};t.keycode$0=function(a,b){return k.real(cc)};t.mouse$0=function(a,b){return g.realVector([$a[0],$a[1]])};t.mover$0=function(a,b){if(fa&&fa.mover)return{ctype:"geo",value:fa.mover,type:"P"};console.log("Not moving anything at the moment");return u};t.translate$1=function(a,b){var e=z(a[0]);"list"===e.ctype&&g.isNumberVector(e)&&2===
e.value.length&&v.translate(e.value[0].value.real,e.value[1].value.real);return u};t.rotate$1=function(a,b){var e=z(a[0]);"number"===e.ctype&&v.rotate(e.value.real);return u};t.scale$1=function(a,b){var e=z(a[0]);"number"===e.ctype&&v.scale(e.value.real);return u};t.greset$0=function(a,b){var e=Ca.stack.length;v.greset();for(var c=0;c<e;c++)B.restore();return u};t.gsave$0=function(a,b){v.gsave();B.save();return u};t.grestore$0=function(a,b){v.grestore();B.restore();return u};t.color$1=function(a,
b){var e=z(a[0]);"list"===e.ctype&&g.isNumberVector(e).value&&v.setcolor(e);return u};t.linecolor$1=function(a,b){var e=z(a[0]);"list"===e.ctype&&g.isNumberVector(e).value&&v.setlinecolor(e);return u};t.pointcolor$1=function(a,b){var e=z(a[0]);"list"===e.ctype&&g.isNumberVector(e).value&&v.setpointcolor(e);return u};t.alpha$1=function(a,b){var e=z(a[0]);"number"===e.ctype&&v.setalpha(e);return u};t.pointsize$1=function(a,b){var e=z(a[0]);"number"===e.ctype&&v.setpointsize(e);return u};t.linesize$1=
function(a,b){var e=z(a[0]);"number"===e.ctype&&v.setlinesize(e);return u};t.textsize$1=function(a,b){var e=z(a[0]);"number"===e.ctype&&v.settextsize(e);return u};t.playanimation$0=function(a,b){V();return u};t.pauseanimation$0=function(a,b){S();return u};t.stopanimation$0=function(a,b){Na();return u};t.replace$3=function(a,b){var e=y(a[0]),c=y(a[1]),d=y(a[2]);if("string"===e.ctype&&"string"===c.ctype&&"string"===d.ctype)return e=e.value,c=c.value.replace(/[^A-Za-z0-9]/g,"\\$&"),d=d.value.replace(/\$/g,
"$$$$"),e=e.replace(new RegExp(c,"g"),d),{ctype:"string",value:e}};t.replace$2=function(a,b){function e(a,b,e){var n="";d=c=-1;for(var g=0;g<b.length;g++){var f=b[g][0],h=a.indexOf(f,e);-1!==h&&(-1===c?(n=f,c=h,d=g):h<c&&(n=f,c=h,d=g))}return n}var c,d,g,f=y(a[0]);g=y(a[1]);if("string"===f.ctype&&"list"===g.ctype){for(var f=f.value,h=[],k=0;k<g.value.length;k++){var l=g.value[k];"list"===l.ctype&&2===l.value.length&&"string"===l.value[0].ctype&&"string"===l.value[1].ctype&&(h[h.length]=[l.value[0].value,
l.value[1].value])}c=-1;for(g=e(f,h,0);-1!==c;)f=f.substring(0,c)+h[d][1]+f.substring(c+g.length,f.length),g=c+h[d][1].length,g=e(f,h,g);return{ctype:"string",value:f}}return u};t.substring$3=function(a,b){var e=y(a[0]),c=z(a[1]),d=z(a[2]);return"string"===e.ctype&&"number"===c.ctype&&"number"===d.ctype?{ctype:"string",value:e.value.substring(Math.floor(c.value.real),Math.floor(d.value.real))}:u};t.tokenize$2=function(a,b){var e,c;e=y(a[0]);var d=y(a[1]);if("string"===e.ctype&&"string"===d.ctype){var f=
!0;void 0!==b.autoconvert&&(c=y(b.autoconvert),"boolean"===c.ctype&&(f=c.value));d=e.value.split(d.value);e=[];for(c=0;c<d.length;c++){var h=d[c];if(f){var k=parseFloat(h);isNaN(k)||(h=k)}e[c]={ctype:"string",value:h}}return g.turnIntoCSList(e)}if("string"===e.ctype&&"list"===d.ctype){if(0===d.value.length)return e;e=d.value[0];f=g.turnIntoCSList(f);h=t.tokenize$2([a[0],e],b).value;e=[];for(c=0;c<h.length;c++){f=[];for(k=1;k<d.value.length;k++)f[k-1]=d.value[k];f=g.turnIntoCSList(f);e[c]=t.tokenize$2([h[c],
f],b)}return g.turnIntoCSList(e)}return u};t.indexof$2=function(a,b){var e=y(a[0]),c=y(a[1]);return"string"===e.ctype&&"string"===c.ctype?(e=e.value.indexOf(c.value),k.real(e+1)):u};t.indexof$3=function(a,b){var e=y(a[0]),c=y(a[1]),d=y(a[2]);return"string"===e.ctype&&"string"===c.ctype&&"number"===d.ctype?(e=e.value,c=c.value,d=Math.round(d.value.real),d=e.indexOf(c,d-1),k.real(d+1)):u};t.parse$1=function(a,b){var e=y(a[0]);return"string"===e.ctype?(e=ab(e.value),e=na(e),y(e)):u};t.unicode$1=function(a,
b){var e;e=y(a[0]);var c=16;if(b.base){var d=y(b.base);"number"===d.ctype&&(c=d.value.real)}if("string"===e.ctype)e=parseInt(e.value,c);else if("number"===e.ctype)e=e.value.real;else return u;"undefined"!==typeof String.fromCodePoint?e=String.fromCodePoint(e):65535>=e?e=String.fromCharCode(e):(e-=65536,e=String.fromCharCode((e>>10)+55296,(e&1023)+56320));return w.string(e)};t.international$1=function(a,b){return t.international$2([a[0],null],b)};t.international$2=function(a,b){var e=y(a[0]);if("string"!==
e.ctype)return u;var c=(r.translations||{})[r.language||"en"]||{};if(!c.hasOwnProperty(e.value))return e;var d=c[e.value];if("string"===typeof d)return w.string(d);if(null===a[1])return e;var g=y(a[1]),g="number"===g.ctype?g.value.real:0,c=(c._pluralFormFunction||Nc)(g);return c<d.length?w.string(d[c]):e};t.currentlanguage$0=function(a,b){return w.string(r.language||"en")};E.basismap=function(a,b,e,c){var d=g.turnIntoCSList([a,b,e]),d=g.adjoint3(g.transpose(d));c=w.mult(d,c);d=g.turnIntoCSList([w.mult(c.value[0],
a),w.mult(c.value[1],b),w.mult(c.value[2],e)]);return g.transpose(d)};t.map$8=function(a,b){var e=M(a[0]),c=M(a[1]),d=M(a[2]),f=M(a[3]),h=M(a[4]),k=M(a[5]),l=M(a[6]),m=M(a[7]);return h!==u&&k!==u&&l!==u&&m!==u&&e!==u&&c!==u&&d!==u&&f!==u?(h=E.basismap(h,k,l,m),e=E.basismap(e,c,d,f),e=w.mult(h,g.adjoint3(e)),g.normalizeMax(e)):u};t.map$6=function(a,b){var e=M(a[0]),c=M(a[1]),d=M(a[2]),f=g.realVector([0,0,1]),h=g.cross,k=h(h(d,h(f,h(e,c))),h(c,h(f,h(e,d)))),l=M(a[3]),m=M(a[4]),p=M(a[5]),f=h(h(p,h(f,
h(l,m))),h(m,h(f,h(l,p))));return l!==u&&m!==u&&p!==u&&f!==u&&e!==u&&c!==u&&d!==u&&k!==u?(l=E.basismap(l,m,p,f),e=E.basismap(e,c,d,k),e=w.mult(l,g.adjoint3(e)),g.normalizeMax(e)):u};t.map$4=function(a,b){var e=g.ii,c=g.jj,d=M(a[0]),f=M(a[1]),h=M(a[2]),k=M(a[3]);return h!==u&&k!==u&&d!==u&&f!==u?(h=E.basismap(h,k,e,c),e=E.basismap(d,f,e,c),e=w.mult(h,g.adjoint3(e)),g.normalizeMax(e)):u};t.map$2=function(a,b){var e=g.ii,c=g.jj,d=M(a[0]),f=w.add(g.realVector([1,0,0]),d),h=M(a[1]),k=w.add(g.realVector([1,
0,0]),h);return h!==u&&k!==u&&d!==u&&f!==u?(h=E.basismap(h,k,e,c),e=E.basismap(d,f,e,c),e=w.mult(h,g.adjoint3(e)),g.normalizeMax(e)):u};t.pointreflect$1=function(a,b){var e=g.ii,c=g.jj,d=M(a[0]),f=w.add(g.realVector([1,0,0]),d),h=w.add(g.realVector([-1,0,0]),d);return h!==u&&d!==u&&f!==u?(h=E.basismap(d,h,e,c),e=E.basismap(d,f,e,c),e=w.mult(h,g.adjoint3(e)),g.normalizeMax(e)):u};t.linereflect$1=function(a,b){var e=g.ii,c=g.jj,d=M(a[0]),f=g.realVector([Math.random(),Math.random(),Math.random()]),h=
g.realVector([Math.random(),Math.random(),Math.random()]),f=g.cross(f,d),h=g.cross(h,d);return d!==u&&f!==u?(d=E.basismap(f,h,e,c),e=E.basismap(f,h,c,e),e=w.mult(d,g.adjoint3(e)),g.normalizeMax(e)):u};E.extractPointVec=function(a){var b={ok:!1};if("geo"===a.ctype){var e=a.value;if("P"===e.kind)return b.x=ta.getField(e,"x"),b.y=ta.getField(e,"y"),b.z=k.real(1),b.ok=!0,b}if("list"!==a.ctype)return b;var c=a.value;if(2===c.length&&(a=c[0],e=c[1],"number"===a.ctype&&"number"===e.ctype))return b.x=a,b.y=
e,b.z=k.real(1),b.ok=!0,b;3===c.length&&(a=c[0],e=c[1],c=c[2],"number"===a.ctype&&"number"===e.ctype&&"number"===c.ctype&&(b.x=k.div(a,c),b.y=k.div(e,c),b.z=k.real(1),b.ok=!0));return b};t.polygon$1=function(a,b){var e=y(a[0]);if("list"===e.ctype){for(var c=[],d=0;d<e.value.length;d++){var g=E.extractPoint(e.value[d]);if(!g.ok)return u;c[d]={X:g.x,Y:g.y}}return{ctype:"shape",type:"polygon",value:[c]}}return u};t.circle$2=function(a,b){var e=z(a[0]),c=z(a[1]),e=E.extractPointVec(e);if(!e.ok||"number"!==
c.ctype)return u;e=g.turnIntoCSList([e.x,e.y,e.z]);return{ctype:"shape",type:"circle",value:g.turnIntoCSList([e,c])}};t.screen$0=function(a,b){var e=v.drawingstate.initialmatrix,c=function(a,b){var c=a-e.tx,d=b+e.ty;return{X:(c*e.d-d*e.b)/e.det,Y:-(-c*e.c+d*e.a)/e.det}};return{ctype:"shape",type:"polygon",value:[[c(0,0),c(ia,0),c(ia,ba),c(0,ba)]]}};t.halfplane$2=function(a,b){var e=z(a[0]),c=z(a[1]),d=M(e),f=M(c);if(e!==u&&c!==u){var h=c.usage,c=f;if("Line"===e.usage||"Point"===h)d=f,c=e;e=g.turnIntoCSList([c.value[0],
c.value[1],k.zero]);e=g.cross(e,d);f=g.cross(c,e);f=w.div(f,f.value[2]);d=w.div(d,d.value[2]);d=g.sub(d,f);e=g.abs(d);d=w.div(d,e);e=f.value[0].value.real;f=f.value[1].value.real;c=1E3*d.value[0].value.real;d=1E3*d.value[1].value.real;return{ctype:"shape",type:"polygon",value:[[{X:e+d/2,Y:f-c/2},{X:e+d/2+c,Y:f-c/2+d},{X:e-d/2+c,Y:f+c/2+d},{X:e-d/2,Y:f+c/2}]]}}return u};t.allpoints$0=function(a,b){for(var e=[],c=0;c<O.length;c++)e[c]={ctype:"geo",value:O[c],type:"P"};return{ctype:"list",value:e}};
t.allmasses$0=function(a,b){for(var e=[],c=0;c<Z.length;c++)e[c]={ctype:"geo",value:Z[c],type:"P"};return{ctype:"list",value:e}};t.alllines$0=function(a,b){for(var e=[],c=0;c<K.length;c++)e[c]={ctype:"geo",value:K[c],type:"L"};return{ctype:"list",value:e}};t.createpoint$2=function(a,b){var e=y(a[0]),c=M(a[1]);return"string"!==e.ctype?(console.log("Name must be a string"),u):"list"!==c.ctype&&g.isNumberVector(c)?(console.log("Position must be a number vector"),u):qb({name:e.value,type:"Free",labeled:!0,
pos:c})};t.create$3=function(a,b){var e=y(a[0]),c=y(a[1]),d=y(a[2]),g;if("string"===e.ctype)g=e.value;else{if("list"!==e.ctype)return console.log("Names must be a string or a list of strings"),u;if(1!==e.value.length)return console.log("multi-result compatibility operations not supported yet"),u;if("string"!==e.value[0].ctype)return console.log("Element of names list must be a string"),u;g=e.value[0].value}if("string"!==c.ctype)return console.log("Type must be a string"),u;if("list"!==d.ctype)return console.log("Arguments must be a list"),
u;if(void 0===p[c.value])return console.log("Invalid geometric operation: '"+c.value+"'"),u;for(var e=[],f=null,h=0;h<d.value.length;h++){var k=d.value[h];if("string"===k.ctype)e.push(k.value);else if(f=M(k),f===u)return console.log("Unknown argument type"),u}c={name:g,type:c.value,labeled:!0};f&&(c.pos=f);0<e.length&&(c.args=e);return qb(c)};t.javascript$1=function(a,b){var e=y(a[0]);"string"===e.ctype&&(new Function(e.value)).call(sa);return u};t.use$1=function(a,b){function e(a,b,e){t[a+"$"+b]=
e}var c=y(a[0]);if("string"===c.ctype){var c=c.value,d;r.plugins&&(d=r.plugins[c]);d||(d=xa._pluginRegistry[c]);if(d)return d({instance:sa,config:r,nada:u,evaluate:y,evaluateAndVal:z,defineFunction:e,addShutdownHook:Wa.push.bind(Wa),addAutoCleaningEventListener:T,getVariable:J.getvar.bind(J),getInitialMatrix:function(){return v.drawingstate.initialmatrix},setTextRenderer:function(a){xc=a}}),{ctype:"boolean",value:!0};console.log("Plugin "+c+" not found");return{ctype:"boolean",value:!1}}return u};
t.format$2=function(a,b){function e(a){a=a.toFixed(f);var b;do b=a,a=a.substring(0,a.length-1);while(""!==a&&"-"!==a&&+a===+b);return""+b}function c(a){var b;return"number"===a.ctype?(b=e(a.value.real),a=e(a.value.imag),b="0"===a?b:"-"===a.substring(0,1)?b+" - i*"+a.substring(1):b+" + i*"+a,{ctype:"string",value:b}):"list"===a.ctype?{ctype:"list",value:a.value.map(c)}:{ctype:"string",value:L(a).toString()}}var d=z(a[0]),g=z(a[1]),f;return"number"!==d.ctype&&"list"!==d.ctype||"number"!==g.ctype?u:
(f=Math.round(g.value.real),c(d))};Date.now||(Date.now=function(){return(new Date).getTime()});var yc=0;t.seconds$0=function(a,b){return{ctype:"number",value:{real:(Date.now()-yc)/1E3,imag:0}}};t.resetclock$0=function(a,b){yc=Date.now();return u};t.time$0=function(a,b){var e=new Date;return g.realVector([e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()])};t.date$0=function(a,b){var e=new Date;return g.realVector([e.getFullYear(),e.getMonth(),e.getDay()])};t.setTimeout$2=function(a,c){function e(){y(g);
b()}var d=y(a[0]),g=a[1];"number"===d.ctype&&"undefined"!==typeof window&&window.setTimeout(e,1E3*d.value.real);return u};E.formatForWebGL=function(a){return a.toFixed(10)};t.generateWebGL$2=function(a,b){var e=E.formatForWebGL,c=a[0],d=y(a[1]);console.log(d);if("list"!==d.ctype)return u;for(var g=[],f=0;f<d.value.length;f++)"string"===d.value[f].ctype&&g.push(d.value[f].value);console.log("***********");console.log(g);d=E.plotvars(c);console.log(d);-1===d.indexOf("a")&&-1===d.indexOf("b")&&-1===
d.indexOf("c")&&-1===d.indexOf("d")&&-1===d.indexOf("e")&&-1===d.indexOf("f")&&(c=z(c));if("number"===c.ctype)return{ctype:"string",value:"vec2("+e(c.value.real)+","+e(c.value.imag)+")"};if("variable"===c.ctype)return{ctype:"string",value:c.name};if("string"===c.ctype||"void"===c.ctype)return c;if(2===c.args.length&&("infix"===c.ctype||"function"===c.ctype)){e=t.compileToWebGL$1([c.args[0]],{});d=t.compileToWebGL$1([c.args[1]],{});if("+"===c.oper||"add"===c.oper)return void 0===e.value||"void"===
e.ctype?{ctype:"string",value:d.value}:{ctype:"string",value:"addc("+e.value+","+d.value+")"};if("*"===c.oper||"mult"===c.oper)return{ctype:"string",value:"multc("+e.value+","+d.value+")"};if("/"===c.oper||"div"===c.oper)return{ctype:"string",value:"divc("+e.value+","+d.value+")"};if("-"===c.oper||"sub"===c.oper)return void 0===e.value||"void"===e.ctype?{ctype:"string",value:"negc("+d.value+")"}:{ctype:"string",value:"subc("+e.value+","+d.value+")"};if("^"===c.oper||"pow"===c.oper)return{ctype:"string",
value:"powc("+e.value+","+d.value+")"}}if("function"===c.ctype&&1===c.args.length){e=t.compileToWebGL$1([c.args[0]],{});if("sin$1"===c.oper)return{ctype:"string",value:"sinc("+e.value+")"};if("cos$1"===c.oper)return{ctype:"string",value:"cosc("+e.value+")"};if("tan$1"===c.oper)return{ctype:"string",value:"tanc("+e.value+")"};if("exp$1"===c.oper)return{ctype:"string",value:"expc("+e.value+")"};if("log$1"===c.oper)return{ctype:"string",value:"logc("+e.value+")"};if("arctan$1"===c.oper)return{ctype:"string",
value:"arctanc("+e.value+")"};if("arcsin$1"===c.oper)return{ctype:"string",value:"arcsinc("+e.value+")"};if("arccos$1"===c.oper)return{ctype:"string",value:"arccosc("+e.value+")"};if("sqrt$1"===c.oper)return{ctype:"string",value:"sqrtc("+e.value+")"}}return u};t.compileToWebGL$1=function(a,b){var e,c;e=E.formatForWebGL;var d=a[0];c=E.plotvars(d);-1===c.indexOf("a")&&-1===c.indexOf("b")&&-1===c.indexOf("c")&&-1===c.indexOf("d")&&-1===c.indexOf("e")&&-1===c.indexOf("f")&&(d=z(d));if("number"===d.ctype)return{ctype:"string",
value:"vec2("+e(d.value.real)+","+e(d.value.imag)+")"};if("variable"===d.ctype)return{ctype:"string",value:d.name};if("string"===d.ctype||"void"===d.ctype)return d;if(2===d.args.length&&("infix"===d.ctype||"function"===d.ctype)){e=t.compileToWebGL$1([d.args[0]],{});c=t.compileToWebGL$1([d.args[1]],{});if("+"===d.oper||"add"===d.oper)return void 0===e.value||"void"===e.ctype?{ctype:"string",value:c.value}:{ctype:"string",value:"addc("+e.value+","+c.value+")"};if("*"===d.oper||"mult"===d.oper)return{ctype:"string",
value:"multc("+e.value+","+c.value+")"};if("/"===d.oper||"div"===d.oper)return{ctype:"string",value:"divc("+e.value+","+c.value+")"};if("-"===d.oper||"sub"===d.oper)return void 0===e.value||"void"===e.ctype?{ctype:"string",value:"negc("+c.value+")"}:{ctype:"string",value:"subc("+e.value+","+c.value+")"};if("^"===d.oper||"pow"===d.oper)return{ctype:"string",value:"powc("+e.value+","+c.value+")"}}if("function"===d.ctype&&1===d.args.length){e=t.compileToWebGL$1([d.args[0]],{});if("sin$1"===d.oper)return{ctype:"string",
value:"sinc("+e.value+")"};if("cos$1"===d.oper)return{ctype:"string",value:"cosc("+e.value+")"};if("tan$1"===d.oper)return{ctype:"string",value:"tanc("+e.value+")"};if("exp$1"===d.oper)return{ctype:"string",value:"expc("+e.value+")"};if("log$1"===d.oper)return{ctype:"string",value:"logc("+e.value+")"};if("arctan$1"===d.oper)return{ctype:"string",value:"arctanc("+e.value+")"};if("arcsin$1"===d.oper)return{ctype:"string",value:"arcsinc("+e.value+")"};if("arccos$1"===d.oper)return{ctype:"string$1",value:"arccosc("+
e.value+")"};if("sqrt$1"===d.oper)return{ctype:"string",value:"sqrtc("+e.value+")"}}return u};t.setsimulationspeed$1=function(a,b){var e=z(a[0]);"number"===e.ctype&&"undefined"!==typeof I&&"undefined"!==typeof I.env&&(I.env.deltat=e.value.real);return u};t.setsimulationaccuracy$1=function(a,b){var e=z(a[0]);"number"===e.ctype&&"undefined"!==typeof I&&"undefined"!==typeof I.env&&(I.env.accuracy=e.value.real);return u};t.setsimulationquality$1=function(a,b){var e=z(a[0]);"number"===e.ctype&&"undefined"!==
typeof I&&"undefined"!==typeof I.env&&(e=e.value.real,0===e&&(I.env.errorbound=.01,I.env.lowestdeltat=1E-5,I.env.slowdownfactor=2),1===e&&(I.env.errorbound=.001,I.env.lowestdeltat=1E-7,I.env.slowdownfactor=2),2===e&&(I.env.errorbound=1E-5,I.env.lowestdeltat=1E-10,I.env.slowdownfactor=4),3===e&&(I.env.errorbound=1E-6,I.env.lowestdeltat=1E-12,I.env.slowdownfactor=4));return u};E.extractPoint=function(a){var b={ok:!1};if("geo"===a.ctype){var e=a.value;if("P"===e.kind)return b.x=ta.getField(e,"x").value.real,
b.y=ta.getField(e,"y").value.real,b.ok=!0,b}if("list"!==a.ctype)return b;var c=a.value;if(2===c.length&&(a=c[0],e=c[1],"number"===a.ctype&&"number"===e.ctype))return b.x=a.value.real,b.y=e.value.real,b.ok=!0,b;3===c.length&&(a=c[0],e=c[1],c=c[2],"number"===a.ctype&&"number"===e.ctype&&"number"===c.ctype&&(a=k.div(a,c),e=k.div(e,c),b.x=a.value.real,b.y=e.value.real,b.ok=!0));return b};t.draw$1=function(a,b){var e=z(a[0]);if("shape"===e.ctype)E.drawshape(e,b);else if("Line"===e.usage)A.handleModifs(b,
A.lineModifs),A.drawline(e);else{var c=E.extractPoint(e);if(!c.ok){if("undefined"!==typeof e.value&&2===e.value.length)return t.draw$2(e.value,b);return}null!==b&&A.handleModifs(b,A.pointModifs);A.drawpoint(c)}return u};t.draw$2=function(a,b){var e=z(a[0]),c=z(a[1]),e=E.extractPoint(e),c=E.extractPoint(c);if(!e.ok||!c.ok)return u;null!==b&&A.handleModifs(b,A.lineModifs);A.drawsegcore(e,c);return u};t.drawcircle$2=function(a,b){return E.drawcircle(a,b,"D")};E.arcHelper=function(a){var b={};b.startPoint=
M(a[0]);b.viaPoint=M(a[1]);b.endPoint=M(a[2]);return b};t.fillcircle$2=function(a,b){return E.drawcircle(a,b,"F")};t.drawarc$3=function(a,b){var e=E.arcHelper(a);return E.drawarc(e,b,"D")};t.fillarc$3=function(a,b){var e=E.arcHelper(a);return E.drawarc(e,b,"F")};E.drawarc=function(a,b,e){var c=a.startPoint,d=a.viaPoint;a=a.endPoint;if(!g._helper.isAlmostReal(g.turnIntoCSList([c,d,a])))return u;A.handleModifs(b,A.conicModifs);A.preDrawCurve();b=g.det3(c,d,a);if(1E-12<Math.abs(b.value.real)){b=p._helper.ConicBy5(null,
c,d,a,g.ii,g.jj);var f=p._helper.CenterOfConic(b),f=g.normalizeMax(f);b=k.real(0);var h=g.turnIntoCSList([g.turnIntoCSList([f.value[2],b,k.neg(f.value[0])]),g.turnIntoCSList([b,f.value[2],k.neg(f.value[1])]),g.turnIntoCSList([b,b,f.value[2]])]);b=g.normalizeZ(w.mult(h,c));g.normalizeZ(w.mult(h,d));h=g.normalizeZ(w.mult(h,a));b=-Math.atan2(b.value[1].value.real,b.value[0].value.real);h=-Math.atan2(h.value[1].value.real,h.value[0].value.real);f=g.normalizeZ(f);c=g.normalizeZ(c);d=g.normalizeZ(d);a=
g.normalizeZ(a);var l=g.abs(g.sub(c,f)),m=[f.value[0].value.real,f.value[1].value.real],q=v.drawingstate.matrix,f=m[0]*q.a-m[1]*q.b+q.tx,m=m[0]*q.c-m[1]*q.d-q.ty,d=0<g.det3(c,d,a).value.real;B.save();c=l.value.real*q.sdet;B.beginPath();B.translate(f,m);b>h&&(h+=2*Math.PI);d=d?-(2*Math.PI-h+b)/500:(h-b)/500;B.moveTo(c*Math.cos(b),c*Math.sin(b));for(h=0;500>=h;h++)a=b+h*d,B.lineTo(c*Math.cos(a),c*Math.sin(a));"F"===e&&(B.fillStyle=A.lineColor,B.closePath(),B.fill());"D"===e&&B.stroke();B.restore()}else{if("D"!==
e)return u;e=E.extractPoint(c);h=E.extractPoint(d);b=E.extractPoint(a);if(!e.ok||!h.ok||!b.ok)return u;l=(e.x-h.x)*(e.x-h.x)+(e.y-h.y)*(e.y-h.y);f=(e.x-b.x)*(e.x-b.x)+(e.y-b.y)*(e.y-b.y);q=(b.x-h.x)*(b.x-h.x)+(b.y-h.y)*(b.y-h.y);if(1E-12>l||1E-12>f||1E-12>q)return u;0>g.crossratio3(c,a,d,g.cross(g.cross(c,d),g.linfty),g.ii).value.real?A.drawsegcore(e,b):(d=l>q?1:-1,c=d*(e.x-h.x),d*=e.y-h.y,a=Math.sqrt(c*c+d*d),a=25E3/v.drawingstate.matrix.sdet/a,c*=a,d*=a,A.drawsegcore(e,{x:e.x+c,y:e.y+d}),A.drawsegcore(b,
{x:b.x-c,y:b.y-d}))}return u};E.drawcircle=function(a,b,e){var c=z(a[0]);a=z(a[1]);var d=E.extractPoint(c);if(!d.ok||"number"!==a.ctype)return u;var c=v.drawingstate.matrix,g=d.x*c.a-d.y*c.b+c.tx,d=d.x*c.c-d.y*c.d-c.ty;A.handleModifs(b,A.conicModifs);A.preDrawCurve();B.beginPath();B.arc(g,d,a.value.real*c.sdet,0,2*Math.PI);"D"===e&&B.stroke();"F"===e&&(B.fillStyle=A.lineColor,B.fill());"C"===e&&B.clip();return u};t.drawconic$1=function(a,b){var e;e=z(a[0]);if("list"!==e.ctype||3!==e.value.length&&
6!==e.value.length)return console.error("could not parse conic"),u;if(6===e.value.length){for(var c=0;6>c;c++)if("number"!==e.value[c].ctype)return console.error("could not parse conic"),u;var d=k.real(.5),c=e.value[0],f=e.value[2],f=k.mult(f,d),h=e.value[1],l=e.value[3],l=k.mult(l,d),m=e.value[4],m=k.mult(m,d);e=e.value[5];e=g.turnIntoCSList([g.turnIntoCSList([c,f,l]),g.turnIntoCSList([f,h,m]),g.turnIntoCSList([l,m,e])])}else{for(c=0;3>c;c++)for(f=0;3>f;f++)if("number"!==e.value[c].value[f].ctype)return console.error("could not parse conic"),
u;g.equals(e,g.transpose(e)).value||(c=w.mult(e,k.real(.5)),e=w.mult(g.transpose(e),k.real(.5)),e=g.add(c,e))}e=g.normalizeMax(e);return E.drawconic(e,b)};E.drawconic=function(a,b){A.handleModifs(b,A.conicModifs);if(0!==A.lsize){A.preDrawCurve();for(var e=g.normalizeMax(a),c=e,d=0;2>d;d++)for(var f=0;2>f;f++)if(1E-14<Math.abs(e.value[d].value[f].value.imag))return;d=g.turnIntoCSList([g.realVector([-1,-1,1]),g.realVector([1,0,0]),g.realVector([0,1,0])]);f=v.from(0,0,1);f[2]=1;var h=v.from(1,0,1);h[2]=
1;var k=v.from(0,1,1);k[2]=1;var f=g.turnIntoCSList([g.realVector(f),g.realVector(h),g.realVector(k)]),f=g.transpose(f),d=w.mult(f,d),d=g.inverse(d),e=w.mult(g.transpose(d),e),e=w.mult(e,d),d=e.value[0].value[0].value.real,f=e.value[1].value[0].value.real,h=e.value[1].value[1].value.real,k=e.value[2].value[0].value.real,l=e.value[2].value[1].value.real,m=e.value[2].value[2].value.real,e=[[d,f,k],[f,h,l],[k,l,m]],q=1E-14>Math.abs(d*h*m-d*l*l-f*f*m+2*f*k*l-h*k*k),r=ia>ba?ia:ba,x=-1.5*r,y=1.5*r,z=-1.5*
r,C=1.5*r,E=1;q&&(E=0);if(E)var k=0,k=1E-14<Math.abs(d-f)?Math.atan(f/d-h)/2:Math.PI/4,Xa=function(a){var b=Math.cos(a);a=Math.sin(a);return[[b,-a,0],[a,b,0],[0,0,1]]}(k),Xa=g.realMatrix(Xa),d=g.transpose(Xa),e=w.mult(g.realMatrix(e),Xa),e=w.mult(d,e),d=e.value[0].value[0].value.real,f=e.value[1].value[0].value.real,h=e.value[1].value[1].value.real,k=e.value[2].value[0].value.real,l=e.value[2].value[1].value.real,m=e.value[2].value[2].value.real;var e=[d,f,h,k,l,m],d=function(){var a=p._helper.splitDegenConic(c);
if(a!==u){var e=a[1],a=[a[0]];t.draw$1(a,b);a[0]=e;t.draw$1(a,b)}},F=function(a){"undefined"!==a&&6===a.length||console.error("this does not define a Conic");if(q)return"degenerate";a=a[0]*a[2]-a[1]*a[1];return 1E-14>Math.abs(a)?"parabola":1E-14<a?"ellipsoid":"hyperbola"};F(e);var G=function(a,b){return 0<a&&a<ia&&0<b&&b<ba},H=[],I=[],J=[],K=[],L=[],M=[],O=function(){H=[];I=[];J=[];K=[];L=[];M=[]},N=function(a,b){B.beginPath();B.moveTo(a[0],b[0]);for(var e=1;e<a.length;e++)B.lineTo(a[e],b[e]);B.stroke()},
P=function(a,b,e){var c,d,n=F(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{var f=a[0],h=a[1],k=a[2],D=a[3],l=a[4];a=a[5];var m;c=e-b;for(var p=.1*c+b,q=e-.1*c,Q=b;Q<=e;Q+=m){m=Q<p||Q>q||100>Math.abs(e-b)?.5:0>Q||Q>ba?10:3;d=-f*k*Q*Q-2*f*l*Q-f*a+h*h*Q*Q+2*h*D*Q+D*D;d=Math.sqrt(d);c=1/f*(-h*Q-D+d);d=-1/f*(h*Q+D+d);var r,u;E?(r=[c,Q,1],u=[d,Q,1],r=w.mult(Xa,g.realVector(r)),u=w.mult(Xa,g.realVector(u)),c=r.value[0].value.real,d=u.value[0].value.real,r=r.value[1].value.real,u=u.value[1].value.real):
u=r=Q;isNaN(c)||"ellipsoid"!==n?!isNaN(c)&&c>=x&&c<=y&&(H.push(c),J.push(r)):(H.push(c),J.push(r));isNaN(d)||"ellipsoid"!==n?!isNaN(d)&&d>=x&&d<=y&&(I.push(d),K.push(u)):(I.push(d),K.push(u))}}},f=function(a){var b,e,c;F(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{c=a[0];var d=a[1],n=a[2],f=a[3],g=a[4],h=a[5];b=-c*g+d*f;e=Math.sqrt(c*(-c*n*h+c*Math.pow(g,2)+Math.pow(d,2)*h-2*d*f*g+n*Math.pow(f,2)));n=c*n-Math.pow(d,2);1E-14<Math.abs(n)?(c=(b-e)/n,e=(b+e)/n):e=c=(-c*h+f*f)/(2*
c*g-2*d*f);!isNaN(c)&&c>z&&c<C||(c=z);!isNaN(e)&&e>z&&e<C||(e=z);b=c<e?c:e;e=c>e?c:e;P(a,z,b);L=H.concat(I.reverse());M=J.concat(K.reverse());N(L,M);O();P(a,e,C);N(H,J);if(G(H[0],J[1])||G(I[0],K[0]))B.beginPath(),B.moveTo(H[0],J[0]),B.lineTo(I[0],K[0]),B.stroke();N(I,K);O();P(a,b,e);N(H,J);B.beginPath();B.moveTo(H[0],J[0]);B.lineTo(I[0],K[0]);B.stroke();B.beginPath();B.moveTo(H[H.length-1],J[J.length-1]);B.lineTo(I[I.length-1],K[K.length-1]);B.stroke();N(I,K);O()}};q?d():f(e)}};t.drawall$1=function(a,
b){var e=y(a[0]);if("list"===e.ctype){A.handleModifs(b,A.pointAndLineModifs);for(var c=0;c<e.value.length;c++)t.draw$1([e.value[c]],null)}return u};t.connect$1=function(a,b){return E.drawpolygon(a,b,"D",!1)};t.drawpoly$1=function(a,b){return E.drawpolygon(a,b,"D",!0)};t.fillpoly$1=function(a,b){return E.drawpolygon(a,b,"F",!0)};t.drawpolygon$1=function(a,b){return E.drawpolygon(a,b,"D",!0)};t.fillpolygon$1=function(a,b){return E.drawpolygon(a,b,"F",!0)};E.drawpolygon=function(a,b,e,c){function d(){for(var a=
h.value,b=0;b<a.length;b++){var e=a[b],c;for(c=0;c<e.length;c++){var n=e[c],f=n.X*g.a-n.Y*g.b+g.tx,n=n.X*g.c-n.Y*g.d-g.ty;0===c?B.moveTo(f,n):B.lineTo(f,n)}B.closePath()}}function f(){var a;for(a=0;a<h.value.length;a++){var b=E.extractPoint(h.value[a]);if(!b.ok)return;var e=b.x*g.a-b.y*g.b+g.tx,b=b.x*g.c-b.y*g.d-g.ty;0===a?B.moveTo(e,b):B.lineTo(e,b)}c&&B.closePath()}A.handleModifs(b,A.conicModifs);A.preDrawCurve();B.mozFillRule="evenodd";var g=v.drawingstate.matrix,h=y(a[0]);B.beginPath();"list"===
h.ctype&&f();"shape"===h.ctype&&d();"D"===e&&B.stroke();"F"===e&&(B.fillStyle=A.lineColor,B.fill());"C"===e&&B.clip();return u};var xc=function(a,b,e,c,d){var f=a.measureText(b).width;a.fillText(b,e-f*d,c)};t.drawtext$2=function(a,b){var e=z(a[0]),c=y(a[1]),d=E.extractPoint(e);if(!d.ok)return u;var f=v.drawingstate.matrix,e=d.x*f.a-d.y*f.b+f.tx,d=d.x*f.c-d.y*f.d-f.ty;A.handleModifs(b,A.textModifs);f=v.drawingstate.textsize;null!==A.size&&(f=A.size);B.fillStyle=A.textColor;B.font=A.bold+A.italics+
Math.round(10*f)/10+"px "+A.family;c=L(c);xc(B,c,e+A.xOffset,d-A.yOffset,A.align);return u};E.drawshape=function(a,b){return"polygon"===a.type?E.drawpolygon([a],b,"D",1):"circle"===a.type?E.drawcircle([a.value.value[0],a.value.value[1]],b,"D"):u};E.fillshape=function(a,b){return"polygon"===a.type?E.drawpolygon([a],b,"F",1):"circle"===a.type?E.drawcircle([a.value.value[0],a.value.value[1]],b,"F"):u};E.clipshape=function(a,b){return"polygon"===a.type?E.drawpolygon([a],b,"C",1):"circle"===a.type?E.drawcircle([a.value.value[0],
a.value.value[1]],b,"C"):u};t.fill$1=function(a,b){var e=y(a[0]);return"shape"===e.ctype?E.fillshape(e,b):u};t.clip$1=function(a,b){var e=y(a[0]);return"shape"===e.ctype?E.clipshape(e,b):"list"===e.ctype?(e=t.polygon$1(a,[]),t.clip$1([e],[])):u};t.plot$1=function(a,b){return t.plot$2([a[0],null],b)};t.plot$2=function(a,b){function e(a){return"number"===a.ctype&&k._helper.isAlmostReal(a)}function c(a,b,e,d,n){l++;b=+b.value.real;n=+d.value.real;d=b*C.a-n*C.b+C.tx;b=b*C.c-n*C.d-C.ty;a=+a.value.real;
n=+e.value.real;e=a*C.a-n*C.b+C.tx;a=a*C.c-n*C.d-C.ty;m?(B.lineTo(e,a),B.lineTo(d,b)):(B.beginPath(),B.moveTo(e,a),B.lineTo(d,b),m=!0)}function d(a,b,n,g,l){var p=e(n),q=e(g);if(.001>l)!f&&m&&(B.stroke(),m=!1);else if(p||q){var r=k.real((a.value.real+b.value.real)/2);J.setvar(x,r);var u=y(w),t=e(u);if(p&&q&&t){var v=n.value.real,q=u.value.real,t=g.value.real;if(p=1>Math.abs(v+t-2*q)/h){var vb=k.real((a.value.real+r.value.real)/2);J.setvar(x,vb);var vb=y(w),z=k.real((r.value.real+b.value.real)/2);
J.setvar(x,z);z=y(w).value.real;v=Math.abs(v+q-2*vb.value.real)/h;q=Math.abs(q+t-2*z)/h;p=p&&1>v&&1>q}p?(c(a,r,n,u,l/2),c(r,b,u,g,l/2)):(d(a,r,n,u,l/2),d(r,b,u,g,l/2))}else d(a,r,n,u,l/2),d(r,b,u,g,l/2)}}var f=!1,h=.2/fb,l=0,m=!1,p=-10,q=10,r=1,t=1E3,w=a[0],x;if(null!==a[1]&&"variable"===a[1].ctype)x=a[1].name;else{var z=E.plotvars(w);x="#";-1!==z.indexOf("t")&&(x="t");-1!==z.indexOf("z")&&(x="z");-1!==z.indexOf("y")&&(x="y");-1!==z.indexOf("x")&&(x="x")}J.newvar(x);var C=v.drawingstate.matrix;A.handleModifs(b,
{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,connect:function(a){"boolean"===a.ctype&&(f=a.value)},start:function(a){"number"===a.ctype&&(p=a.value.real)},stop:function(a){"number"===a.ctype&&(q=a.value.real)},steps:function(a){"number"===a.ctype&&(t=a.value.real)}});B.strokeStyle=A.lineColor;B.lineWidth=A.lsize;B.lineCap="round";B.lineJoin="round";var F,H,G,I,m=!1,z=k.real(14.32);J.setvar(x,z);G=y(w);if("number"!==G.ctype){if(g.isNumberVector(G).value&&2===G.value.length){m=!1;
r=(q-p)/t;for(z=p;z<q;z+=r)J.setvar(x,k.real(z)),I=y(w),g.isNumberVector(I).value&&2===I.value.length&&(F=+I.value[0].value.real,H=+I.value[1].value.real,I=F*C.a-H*C.b+C.tx,F=F*C.c-H*C.d-C.ty,m?B.lineTo(I,F):(B.beginPath(),B.moveTo(I,F),m=!0));B.stroke();J.removevar(x)}return u}for(I=p;I<q+r;I+=r)z=k.real(I),J.setvar(x,z),G=y(w),z.value.real>p&&d(F,z,H,G,r),F=z,H=G;J.removevar(x);m&&B.stroke();return u};t.plotX$1=function(a,b){var e=a[0],c=E.plotvars(e),d="#";-1!==c.indexOf("t")&&(d="t");-1!==c.indexOf("z")&&
(d="z");-1!==c.indexOf("y")&&(d="y");-1!==c.indexOf("x")&&(d="x");J.newvar(d);c=v.drawingstate.matrix;B.fillStyle=v.drawingstate.linecolor;B.lineWidth=1;B.lineCap="round";for(var f=!1,g=-10;10>g;g+=.01){J.setvar(d,k.real(g));var h=y(e);if("number"===h.ctype){var l=+h.value.real,h=g*c.a-l*c.b+c.tx,l=g*c.c-l*c.d-c.ty;f?B.lineTo(h,l):(B.beginPath(),B.moveTo(h,l),f=!0)}}B.stroke();J.removevar(d);return u};E.plotvars=function(a){function b(a,e){var c={},d;for(d=a.length-1;0<=d;--d)c[a[d]]=a[d];for(d=e.length-
1;0<=d;--d)c[e[d]]=e[d];d=[];for(var n in c)c.hasOwnProperty(n)&&d.push(c[n]);return d}function e(a,b){for(var e=0;e<a.length;e++)a[e]===b&&(a.splice(e,1),e--);return a}var c,d,f,g;if("variable"===a.ctype)return[a.name];if("infix"===a.ctype)return c=E.plotvars(a.args[0]),a=E.plotvars(a.args[1]),b(c,a);if("list"===a.ctype){f=a.value;d=[];for(g=0;g<f.length;g++)c=E.plotvars(f[g]),d=b(d,c);return d}if("function"===a.ctype){f=a.args;d=[];for(g=0;g<f.length;g++)c=E.plotvars(f[g]),d=b(d,c);"apply"!==a.oper&&
"select"!==a.oper&&"forall"!==a.oper&&"sum"!==a.oper&&"product"!==a.oper&&"repeat"!==a.oper&&"min"!==a.oper&&"max"!==a.oper&&"sort"!==a.oper||"variable"!==a.args[1].ctype||(d=e(d,a.args[1].name));return d}return[]};t.clrscr$0=function(a,b){"undefined"!==typeof ia&&"undefined"!==typeof ba&&B.clearRect(0,0,ia,ba);return u};t.repaint$0=function(a,c){b();return u};t.screenbounds$0=function(a,b){var e=w.withUsage(g.realVector(v.to(0,0)),"Point"),c=w.withUsage(g.realVector(v.to(ia,0)),"Point"),d=w.withUsage(g.realVector(v.to(ia,
ba)),"Point"),f=w.withUsage(g.realVector(v.to(0,ba)),"Point");return g.turnIntoCSList([e,c,d,f])};t.createimage$3=function(a,b){var e=y(a[0]),c=z(a[1]),d=z(a[2]);if("number"!==c.ctype||"number"!==d.ctype||"string"!==e.ctype)return u;var f=document.createElement("canvas");f.id=e.value;f.width=c.value.real;f.height=d.value.real;f.style.display="none";document.body.appendChild(f);ga[e.value]=f;return u};t.clearimage$1=function(a,b){var e=y(a[0]);if("string"!==e.ctype)return u;e=document.getElementById(e.value);
if("undefined"===typeof e||null===e)return u;var c=e.width,d=e.height;e.getContext("2d").clearRect(0,0,c,d);return u};t.canvas$4=function(a,b){var e=z(a[0]),c=z(a[1]),d=y(a[2]),f=a[3],g=E.extractPoint(e),h=E.extractPoint(c);if(!g.ok||!h.ok||"string"!==d.ctype)return u;d=document.getElementById(d.value);if("undefined"===typeof d||null===d)return u;var e=d.width,c=d.height,k=h.x-g.x,l=h.y-g.y,m=g.x-l*c/e,p=g.y+k*c/e,l=h.x-l*c/e,k=h.y+k*c/e,h=v.from(g.x,g.y,1),m=v.from(m,p,1),l=v.from(l,k,1),g=h[0],
p=h[1],k=m[0],q=m[1],r=l[0],t=l[1],m=e*(p-q)/((g-k)*(p-t)-(g-r)*(p-q)),e=e*(g-k)/((p-q)*(g-r)-(p-t)*(g-k)),l=-m*g-e*p,h=(c*(p-t)-c*(p-q))/((g-k)*(p-t)-(g-r)*(p-q)),k=(c*(g-r)-c*(g-k))/((p-q)*(g-r)-(p-t)*(g-k)),c=c-h*g-k*p,d=d.getContext("2d"),g=B;B=d;B.save();B.transform(m,h,e,k,l,c);y(f);B.restore();B=g};t.canvas$5=function(a,b){var e=z(a[0]),c=z(a[1]),d=z(a[2]),f=y(a[3]),g=a[4],e=E.extractPoint(e),c=E.extractPoint(c),h=E.extractPoint(d);if(!e.ok||!c.ok||!h.ok||"string"!==f.ctype)return u;f=document.getElementById(f.value);
if("undefined"===typeof f||null===f)return u;var k=f.width,d=f.height,l=v.from(e.x,e.y,1),m=v.from(c.x,c.y,1),c=v.from(h.x,h.y,1),e=l[0],h=l[1],p=m[0],q=m[1],r=c[0],t=c[1],c=((0-k)*(h-t)-0*(h-q))/((e-p)*(h-t)-(e-r)*(h-q)),k=((0-k)*(e-r)-0*(e-p))/((h-q)*(e-r)-(h-t)*(e-p)),m=0-c*e-k*h,l=((d-d)*(h-t)-(d-0)*(h-q))/((e-p)*(h-t)-(e-r)*(h-q)),p=((d-d)*(e-r)-(d-0)*(e-p))/((h-q)*(e-r)-(h-t)*(e-p)),d=d-l*e-p*h,f=f.getContext("2d"),e=B;B=f;B.save();B.transform(c,l,k,p,m,d);y(g);B.restore();B=e};t.screenresolution$0=
function(a,b){return k.real(v.drawingstate.matrix.a)};t.layer$1=function(a,b){};E.extractReferenceX=function(a,b){};t.imagesize$1=function(a,b){var e=z(a[0]);return"string"===e.ctype&&ga[e.value]?g.realVector([ga[e.value].width,ga[e.value].height]):u};t.drawimage$2=function(a,b){function e(){var a=1,e=1,c=1,f=1,h=0,l=1,m=E.extractPoint(d);if(!m.ok||"string"!==k.ctype)return u;B.save();var D;void 0!==b.angle&&(D=y(b.angle),"number"===D.ctype&&(h=D.value.real));void 0!==b.rotation&&(D=y(b.rotation),
"number"===D.ctype&&(h=D.value.real));void 0!==b.scale&&(D=z(b.scale),"number"===D.ctype&&(e=a=D.value.real),g.isNumberVector(D).value&&2===D.value.length&&(a=D.value[0].value.real,e=D.value[1].value.real));void 0!==b.scalex&&(D=y(b.scalex),"number"===D.ctype&&(a=D.value.real));void 0!==b.scaley&&(D=y(b.scaley),"number"===D.ctype&&(e=D.value.real));void 0!==b.flipx&&(D=y(b.flipx),"boolean"===D.ctype&&D.value&&(c=-1));void 0!==b.flipy&&(D=y(b.flipy),"boolean"===D.ctype&&D.value&&(f=-1));void 0!==b.alpha&&
(D=y(b.alpha),"number"===D.ctype&&(l=D.value.real));var p=v.drawingstate.matrix,q=v.drawingstate.initialmatrix;D=ga[k.value].width;var r=ga[k.value].height,t=m.x*p.a-m.y*p.b+p.tx,hb=m.x*p.c-m.y*p.d-p.ty,w=(m.x+1)*p.a-m.y*p.b+p.tx-t,p=(m.x+1)*p.c-m.y*p.d-p.ty-hb,x=(m.x+1)*q.a-m.y*q.b+q.tx-(m.x*q.a-m.y*q.b+q.tx),q=(m.x+1)*q.c-m.y*q.d-q.ty-(m.x*q.c-m.y*q.d-q.ty),m=Math.sqrt(w*w+p*p)/Math.sqrt(x*x+q*q),w=-Math.atan2(w,p)+Math.atan2(x,q);1!==l&&(B.globalAlpha=l);B.translate(t,hb);B.scale(a*c*m,e*f*m);
B.rotate(h+w);B.translate(-t,-hb);B.translate(-D/2,-r/2);B.drawImage(ga[k.value],t,hb);B.globalAlpha=1;B.restore()}function c(){var a=1,e=1,g=1,l=1,m=E.extractPoint(d),D=E.extractPoint(f),p;if(!m.ok||!D.ok||"string"!==k.ctype)return u;if(void 0!==ga&&void 0!==ga[k.value]){var q=ga[k.value].width,r=ga[k.value].height;if(0===h)p={},p.x=m.x-(D.y-m.y),p.y=m.y+(D.x-m.x),l=r/q;else if(p=E.extractPoint(h),!m.ok)return u;B.save();var t;void 0!==b.alpha&&(t=y(b.alpha),"number"===t.ctype&&(a=t.value.real));
void 0!==b.aspect&&(t=y(b.aspect),"number"===t.ctype&&(l=t.value.real));void 0!==b.flipx&&(t=y(b.flipx),"boolean"===t.ctype&&t.value&&(e=-1));void 0!==b.flipy&&(t=y(b.flipy),"boolean"===t.ctype&&t.value&&(g=-1));t=v.drawingstate.matrix;1!==a&&(B.globalAlpha=a);a=m.x*t.a-m.y*t.b+t.tx;m=m.x*t.c-m.y*t.d-t.ty;B.transform(D.x*t.a-D.y*t.b+t.tx-a,D.x*t.c-D.y*t.d-t.ty-m,p.x*t.a-p.y*t.b+t.tx-a,p.x*t.c-p.y*t.d-t.ty-m,a,m);B.scale(1/q,-1/r*l);B.translate(q/2,-r/2);B.scale(e,g);B.translate(-q/2,r/2);B.translate(0,
-r);B.drawImage(ga[k.value],0,0);B.globalAlpha=1;B.restore()}}var d,f,h,k;return 2===a.length?(d=z(a[0]),k=z(a[1]),e()):3===a.length?(d=z(a[0]),f=z(a[1]),h=0,k=z(a[2]),c()):4===a.length?(d=z(a[0]),f=z(a[1]),h=z(a[2]),k=z(a[3]),c()):u};t.drawimage$3=t.drawimage$2;t.drawimage$4=t.drawimage$2;var $b={},Qb;Qb=[0,0,0,0,0,0,0,0,0,0,0,0];t.playsin$1=function(a,b){var e=z(a[0]),c=0;if("number"===e.ctype){var d;void 0!==b.line&&(d=y(b.line),"number"===d.ctype&&(c=Math.floor(d.value.real),0>c&&(c=0),10<c&&
(c=10)));e=e.value.real;0!==Qb[c]&&Qb[c].set({freq:e})}return u};var N={printArr:function(a){for(var b=a.value.length,e=[],c=[],d=!1,f=0;f<b;f++)e[f]=a.value[f].value.real,c[f]=a.value[f].value.imag,0!==c[f]&&(d=!0);console.log(e);d&&console.log(c)},zero:function(a){for(var b=[],e=k.real(0),c=0;c<a.value.real;c++)b[c]=e;return g.turnIntoCSList(b)},number:function(a,b){var e=N.zero(b);e.value[0]=a;return e},variable:function(a,b){var e=N.zero(b);e.value[0]=a;e.value[1]=k.real(1);return e},add:function(a,
b){return g.add(a,b)},sub:function(a,b){return g.sub(a,b)},mult:function(a,b){if(a.value.length!==b.value.length)return console.error("dims don't fit return nada"),u;for(var e=a.value.length,c=N.zero(k.real(e)),d=k.real(0),f=0;f<e;f++){for(var g=0;g<=f;g++)d=k.add(d,k.mult(a.value[g],b.value[f-g]));c.value[f]=d;d=k.real(0)}return c},pow:function(a,b){if(0>b.value.real||b.value.real!==Math.floor(b.value.real))return N.root(a,b);for(var e=a,c=1;c<b.value.real;c++)e=N.mult(e,a);return e},root:function(a,
b){var e=k.real(0),c=k.real(1),d=k.add(c,b),f=a.value.length,g=N.zero(k.real(f));g.value[0]=k.pow(a.value[0],b);for(var h=e,l,m,p=1;p<f;p++){m=k.real(p);for(var q=1;q<=p;q++)l=k.mult(d,k.real(q)),l=k.div(l,m),l=k.sub(l,c),l=k.mult(l,a.value[q]),l=k.mult(l,g.value[p-q]),h=k.add(h,l);h=k.div(h,a.value[0]);g.value[p]=h;h=e}return g},findFirstNoneZero:function(a,b,e){for(var c=Infinity,d=Infinity,f=e;f<a.value.length;f++)if(1E-12<k.abs2(a.value[f]).value.real){c=f;break}for(a=e;a<b.value.length;a++)if(1E-12<
k.abs2(b.value[a]).value.real){d=a;break}return[c,d]},div:function(a,b){if(a.value.length!==b.value.length)return console.log("dims don't fit - return nada"),u;for(var e=a.value.length,c=k.real(0),d=N.zero(k.real(e)),f=c,g=c,h=0;h<e;h++){g=N.findFirstNoneZero(a,b,h);h<g[0]&&g[0]===g[1]&&Infinity!==g[0]&&(a.value.splice(h,g[0]),b.value.splice(h,g[0]),d.value.splice(h,g[0]),e-=g[0]);for(var g=a.value[h],l=0;l<h;l++)f=k.add(f,k.mult(d.value[l],b.value[h-l]));g=k.sub(g,f);g=k.div(g,b.value[0]);d.value[h]=
g;f=c}return d},exp:function(a){var b=k.real(0),e=a.value.length,c=N.zero(k.real(e)),d=b,f;c.value[0]=k.exp(a.value[0]);for(var g=1;g<e;g++){for(var h=1;h<=g;h++)f=k.mult(k.real(h),a.value[h]),f=k.mult(f,c.value[g-h]),d=k.add(d,f);c.value[g]=k.div(d,k.real(g));d=b}return c},log:function(a){var b=k.real(0),e=a.value.length,c=N.zero(k.real(e));c.value[0]=k.log(a.value[0]);for(var d=b,f,g,h=1;h<e;h++){f=a.value[h];for(var l=1;l<h;l++)g=k.mult(k.real(l),c.value[l]),g=k.mult(g,a.value[h-l]),d=k.add(d,
g);d=k.div(d,k.real(h));f=k.sub(f,d);f=k.div(f,a.value[0]);c.value[h]=f;d=b}return c},sincos:function(a){var b=k.real(0),e=a.value.length,c=N.zero(k.real(e)),d=N.zero(k.real(e));c.value[0]=k.sin(a.value[0]);d.value[0]=k.cos(a.value[0]);for(var f=b,g=b,h,l,m,p=1;p<e;p++){m=k.real(p);for(var q=1;q<=p;q++)l=k.mult(k.real(q),a.value[q]),h=k.mult(l,d.value[p-q]),l=k.mult(l,c.value[p-q]),g=k.add(g,h),f=k.add(f,l);g=k.div(g,m);f=k.div(f,k.neg(m));c.value[p]=g;d.value[p]=f;f=g=b}N.sinsave=c;N.cossave=d;return[c,
d]},sin:function(a){return N.sincos(a)[0]},cos:function(a){return N.sincos(a)[1]},faculty:function(a){var b=[];b[0]=k.real(1);for(var e=1,c=1;c<=a.value.real;c++)e*=c,b[c]=k.real(e);return b=g.turnIntoCSList(b)},diff:function(a,b,e,c){var d;if("variable"===a.ctype)d=a.name!==b?N.number(y(a),c):N.variable(e,c);else if("number"===a.ctype)d=N.number(a,c);else{if("infix"===a.ctype){if("*"===a.oper)return N.mult(N.diff(a.args[0],b,e,c),N.diff(a.args[1],b,e,c));if("^"===a.oper)return N.pow(N.diff(a.args[0],
b,e,c),N.diff(a.args[1],b,e,c).value[0]);if("/"===a.oper)return N.div(N.diff(a.args[0],b,e,c),N.diff(a.args[1],b,e,c));if("+"===a.oper)return N.add(N.diff(a.args[0],b,e,c),N.diff(a.args[1],b,e,c));if("-"===a.oper)return N.sub(N.diff(a.args[0],b,e,c),N.diff(a.args[1],b,e,c));console.log("infix not found",a.oper);return u}if("function"===a.ctype){if("exp$1"===a.oper)return N.exp(N.diff(a.args[0],b,e,c));if("log$1"===a.oper)return N.log(N.diff(a.args[0],b,e,c));if("sin$1"===a.oper)return N.sin(N.diff(a.args[0],
b,e,c));if("cos$1"===a.oper)return N.cos(N.diff(a.args[0],b,e,c))}else return console.log("ctype not found",a.ctype),u}return d},adevaluate:function(a,b,e,c){a=N.diff(a,b,e,c);c=N.faculty(c);for(b=2;b<a.value.length;b++)a.value[b]=k.mult(a.value[b],c.value[b]);return a},autodiff:function(a,b,e,c){for(var d=[],f=e.value.length,h,k=0;k<f;k++)h=N.adevaluate(a,b,e.value[k],c),d[k]=h;return d=g.turnIntoCSList(d)}},A={handleModifs:function(a,b){A.dashing&&A.unSetDash();A.colorraw=null;A.size=null;0>=A.psize&&
(A.psize=0);0>=A.lsize&&(A.lsize=0);A.overhang=1;A.dashing=!1;A.isArrow=!1;A.arrowSides="==>";A.arrowposition=1;A.headlen=10;A.arrowShape="default";A.alpha=v.drawingstate.alpha;A.bold="";A.italics="";A.family="Arial";A.align=0;A.xOffset=0;A.yOffset=0;var e,c;for(e in a){var d=a[e];d&&((c=b[e])?(!0===c&&(c=A.modifHandlers[e]),c(y(d))):console.log("Modifier not supported: "+e))}null!==A.size?A.psize=A.lsize=A.size:(A.psize=v.drawingstate.pointsize,A.lsize=v.drawingstate.linesize);A.dashing&&A.dashing(A.lsize);
null!==A.colorraw?A.pointColor=A.lineColor=A.textColor=A.makeColor(A.colorraw):1===A.alpha?(A.pointColor=v.drawingstate.pointcolor,A.lineColor=v.drawingstate.linecolor,A.textColor=v.drawingstate.textcolor):(A.pointColor=A.makeColor(v.drawingstate.pointcolorraw),A.lineColor=A.makeColor(v.drawingstate.linecolorraw),A.textColor=A.makeColor(v.drawingstate.textcolorraw));A.black=1===A.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+A.alpha+")"},sin30deg:.5};A.cos30deg=Math.sqrt(.75);A.modifHandlers={size:function(a){"number"===
a.ctype&&(A.size=a.value.real,0>A.size&&(A.size=0),1E3<A.size&&(A.size=1E3))},color:function(a){g.isNumberVector(a).value&&3===a.value.length&&(A.colorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},alpha:function(a){"number"===a.ctype&&(A.alpha=a.value.real)},dashpattern:function(a){if("list"===a.ctype){for(var b=[],e=0,c=0;e<a.value.length;e++)"number"===a.value[e].ctype&&(b[c++]=a.value[e].value.real);A.dashing=A.setDash.bind(null,b)}},dashtype:function(a){if("number"===
a.ctype)a=Math.floor(a.value.real);else if("string"===a.ctype)a=a.value;else return;if(a=A.dashTypes[a])A.dashing=A.setDash.bind(null,a)},dashing:function(a){"number"===a.ctype&&(a=Math.floor(a.value.real),A.dashing=A.setDash.bind(null,[2*a,a]))},overhang:function(a){"number"===a.ctype&&(A.overhang=A.overhang*a.value.real+(1-A.overhang)*(1-a.value.real))},arrow:function(a){"boolean"===a.ctype?A.isArrow=a.value:console.error("arrow needs to be of type boolean")},arrowshape:function(a){"string"===a.ctype?
(A.arrowShape=a.value,A.isArrow=!0):console.error("arrowshape needs to be of type string")},arrowsides:function(a){"string"!==a.ctype?console.error("arrowsides is not of type string"):"==>"!==a.value&&"<==>"!==a.value&&"<=="!==a.value?console.error("arrowsides is unknows"):(A.arrowSides=a.value,A.isArrow=!0)},arrowposition:function(a){"number"!==a.ctype?console.error("arrowposition is not of type number"):0>a.value.real?console.error("arrowposition has to be positive"):1<a.value.real?A.overhang=A.overhang*
a.value.real+(1-A.overhang)*(1-a.value.real):(A.arrowposition=a.value.real,A.isArrow=!0)},arrowsize:function(a){"number"!==a.ctype?console.error("arrowsize is not of type number"):0>a.value.real?console.error("arrowsize has to be positive"):A.headlen*=a.value.real},bold:function(a){"boolean"===a.ctype&&a.value&&(A.bold="bold ")},italics:function(a){"boolean"===a.ctype&&a.value&&(A.italics="italic ")},family:function(a){"string"===a.ctype&&(A.family=a.value)},align:function(a){"string"===a.ctype&&
(a=a.value,"left"===a&&(A.align=0),"right"===a&&(A.align=1),"mid"===a&&(A.align=.5))},x_offset:function(a){"number"===a.ctype&&(A.xOffset=a.value.real)},y_offset:function(a){"number"===a.ctype&&(A.yOffset=a.value.real)},offset:function(a){"list"===a.ctype&&2===a.value.length&&"number"===a.value[0].ctype&&"number"===a.value[1].ctype&&(A.xOffset=a.value[0].value.real,A.yOffset=a.value[1].value.real)}};A.lineModifs={size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,
arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0};A.pointModifs={size:!0,color:!0,alpha:!0};A.pointAndLineModifs=A.lineModifs;A.conicModifs=A.pointModifs;A.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0};A.makeColor=function(a){return"rgba("+Math.floor(255*a[0])+","+Math.floor(255*a[1])+","+Math.floor(255*a[2])+","+A.alpha+")"};A.preDrawCurve=function(){B.lineWidth=A.lsize;B.lineCap="round";B.lineJoin="miter";B.strokeStyle=A.lineColor};
A.drawsegcore=function(a,b){function e(a,b,e){var c=a-e*w,d=b-e*y;B.beginPath();"full"===A.arrowShape&&(B.lineWidth=A.lsize/2);var f=a-e*x;e=b-e*z;B.moveTo(c,d);B.lineTo(a,b);B.lineTo(f,e);"full"===A.arrowShape?(B.fillStyle=A.lineColor,B.closePath(),B.fill()):"default"!==A.arrowShape&&console.error("arrowshape is unknown");B.stroke()}var c=v.drawingstate.matrix,d=a.x*c.a-a.y*c.b+c.tx,f=a.x*c.c-a.y*c.d-c.ty,g=b.x*c.a-b.y*c.b+c.tx,h=b.x*c.c-b.y*c.d-c.ty,k=A.overhang,l=1-k,c=k*d+l*g,m=k*f+l*h,p=k*g+
l*d,k=k*h+l*f;B.lineWidth=A.lsize;B.lineCap="round";B.lineJoin="miter";B.strokeStyle=A.lineColor;if(!A.isArrow||d===f&&g===h).01>A.lsize||(B.beginPath(),B.moveTo(c,m),B.lineTo(p,k),B.stroke());else{var d=g-d,f=h-f,g=Math.sqrt(d*d+f*f),l=d/g,q=f/g,h=A.arrowposition,r=1-h,f=h*c+r*p,d=h*m+r*k,g=h*p+r*c,h=h*k+r*m,r=A.headlen,t=A.sin30deg,u=A.cos30deg,w=r*(l*u+q*t),x=r*(l*u-q*t),y=r*(q*u-l*t),z=r*(q*u+l*t),l=A.arrowSides;B.beginPath();"full"===A.arrowShape?("<==>"===l||"<=="===l?(q=f+w,r=d+y,t=f+x,u=d+
z,1>A.arrowposition&&(B.moveTo(c,m),B.lineTo(f,d)),B.moveTo((q+t)/2,(r+u)/2)):B.moveTo(c,m),"==>"===l||"<==>"===l?(B.lineTo((g-w+(g-x))/2,(h-y+(h-z))/2),1>A.arrowposition&&(B.moveTo(g,h),B.lineTo(p,k))):B.lineTo(p,k)):(B.moveTo(c,m),B.lineTo(p,k));B.stroke();"==>"!==l&&"<==>"!==l||e(g,h,1);"<=="!==l&&"<==>"!==l||e(f,d,-1)}};A.drawpoint=function(a){var b=v.drawingstate.matrix,e=a.x*b.a-a.y*b.b+b.tx;a=a.x*b.c-a.y*b.d-b.ty;B.lineWidth=.3*A.psize;B.beginPath();B.arc(e,a,A.psize,0,2*Math.PI);B.fillStyle=
A.pointColor;B.fill();B.beginPath();B.arc(e,a,1.15*A.psize,0,2*Math.PI);B.fillStyle=A.black;B.strokeStyle=A.black;B.stroke()};A.drawline=function(a){var b=k.abs(a.value[0]).value.real,e=k.abs(a.value[1]).value.real,c=k.abs(a.value[2]).value.real,d;b>=e&&b>=c&&(d=a.value[0]);e>=b&&e>=c&&(d=a.value[1]);c>=e&&c>=b&&(d=a.value[2]);b=k.div(a.value[0],d);e=k.div(a.value[1],d);a=k.div(a.value[2],d);a=[b.value.real,e.value.real,a.value.real];Math.abs(a[0])<Math.abs(a[1])?(b=[1,0,30],d=[-1,0,30]):(b=[0,1,
30],d=[0,-1,30]);b=[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];a=[a[1]*d[2]-a[2]*d[1],a[2]*d[0]-a[0]*d[2],a[0]*d[1]-a[1]*d[0]];A.drawsegcore({x:b[0]/b[2],y:b[1]/b[2]},{x:a[0]/a[2],y:a[1]/a[2]})};A.dashTypes={solid:[],dashed:[10,10],tightdash:[10,4],dotted:[1,3],dashdot:[10,5,1,5],"dashvalue.solid":[],"dashvalue.dashed":[10,10],"dashvalue.tightdash":[10,4],"dashvalue.dotted":[1,3],"dashvalue.dashdot":[10,5,1,5],0:[],1:[10,10],2:[10,4],3:[1,3],4:[10,5,1,5]};A.setDash=function(a,b){var e=
Math.sqrt(b);a=a.slice();for(var c=0;c<a.length;c++)a[c]*=e;B.webkitLineDash=a;B.setLineDash(a);B.mozDash=a};A.unSetDash=function(){B.webkitLineDash=[];B.setLineDash([]);B.mozDash=[]};var Ca={},v={drawingstate:{}};v.drawingstate.linecolor="rgb(0,0,255)";v.drawingstate.linecolorraw=[0,0,1];v.drawingstate.pointcolor="rgb(255,200,0)";v.drawingstate.pointcolorraw=[1,.78,0];v.drawingstate.textcolor="rgb(0,0,0)";v.drawingstate.textcolorraw=[0,0,0];v.drawingstate.alpha=1;v.drawingstate.pointsize=4;v.drawingstate.linesize=
1;v.drawingstate.textsize=20;v.drawingstate.matrix={};v.drawingstate.matrix.a=25;v.drawingstate.matrix.b=0;v.drawingstate.matrix.c=0;v.drawingstate.matrix.d=25;v.drawingstate.matrix.tx=250.5;v.drawingstate.matrix.ty=250.5;v.drawingstate.matrix.det=v.drawingstate.matrix.a*v.drawingstate.matrix.d-v.drawingstate.matrix.b*v.drawingstate.matrix.c;v.drawingstate.matrix.sdet=Math.sqrt(v.drawingstate.matrix.det);v.drawingstate.initialmatrix={};v.drawingstate.initialmatrix.a=v.drawingstate.matrix.a;v.drawingstate.initialmatrix.b=
v.drawingstate.matrix.b;v.drawingstate.initialmatrix.c=v.drawingstate.matrix.c;v.drawingstate.initialmatrix.d=v.drawingstate.matrix.d;v.drawingstate.initialmatrix.tx=v.drawingstate.matrix.tx;v.drawingstate.initialmatrix.ty=v.drawingstate.matrix.ty;v.drawingstate.initialmatrix.det=v.drawingstate.matrix.det;v.drawingstate.initialmatrix.sdet=v.drawingstate.matrix.sdet;v.clone=function(a){if(null===a||"object"!==typeof a)return a;var b=a.constructor(),e;for(e in a)b[e]=v.clone(a[e]);return b};Ca.backup=
v.clone(v.drawingstate);Ca.stack=[];v.clone(v.drawingstate);v.reset=function(){v.drawingstate.matrix.a=v.drawingstate.initialmatrix.a;v.drawingstate.matrix.b=v.drawingstate.initialmatrix.b;v.drawingstate.matrix.c=v.drawingstate.initialmatrix.c;v.drawingstate.matrix.d=v.drawingstate.initialmatrix.d;v.drawingstate.matrix.tx=v.drawingstate.initialmatrix.tx;v.drawingstate.matrix.ty=v.drawingstate.initialmatrix.ty;v.drawingstate.matrix.det=v.drawingstate.initialmatrix.det;v.drawingstate.matrix.sdet=v.drawingstate.initialmatrix.sdet};
v.from=function(a,b,e){a/=e;b/=e;e=v.drawingstate.matrix;return[a*e.a-b*e.b+e.tx,a*e.c-b*e.d-e.ty]};v.to=function(a,b){var e=v.drawingstate.matrix,c=a-e.tx,d=b+e.ty;return[(c*e.d-d*e.b)/e.det,-(-c*e.c+d*e.a)/e.det,1]};v.dumpTrafo=function(){function a(a){return Math.round(1E3*a)/1E3}var b=v.drawingstate.matrix;console.log("a:"+a(b.a)+" b:"+a(b.b)+" c:"+a(b.c)+" d:"+a(b.d)+" tx:"+a(b.ty)+" ty:"+a(b.tx))};v.setMat=function(a,b,e,c,d,f){var g=v.drawingstate.matrix;g.a=a;g.b=b;g.c=e;g.d=c;g.tx=d;g.ty=
f;g.det=a*c-b*e;g.sdet=Math.sqrt(g.det)};v.scaleAndOrigin=function(a,b,e){v.setMat(a,0,0,a,b,e)};v.visibleRect=function(a,b,e,c){var d=e-a,f=b-c,d=ia*f<ba*d?ia/d:ba/f;v.setMat(d,0,0,d,(ia-d*(a+e))/2,(ba-d*(b+c))/2)};v.applyMat=function(a,b,c,d,f,g){var h=v.drawingstate.matrix;v.setMat(h.a*a+h.c*b,h.b*a+h.d*b,h.a*c+h.c*d,h.b*c+h.d*d,h.a*f+h.c*g+h.tx,h.b*f+h.d*g+h.ty);a=v.to(0,-ba);b=v.to(ia,0);console.log("{visibleRect: ["+a[0]+","+a[1]+","+b[0]+","+b[1]+"]}")};v.translate=function(a,b){v.applyMat(1,
0,0,1,a,b)};v.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);v.applyMat(b,a,-a,b,0,0)};v.scale=function(a){v.applyMat(a,0,0,a,0,0)};v.gsave=function(){Ca.stack.push(v.clone(v.drawingstate))};v.grestore=function(){0!==Ca.stack.length&&(v.drawingstate=Ca.stack.pop())};v.greset=function(){v.drawingstate=v.clone(Ca.backup);v.drawingstate.matrix.ty-=ba;v.drawingstate.initialmatrix.ty-=ba;Ca.stack=[]};v.createnewbackup=function(){v.drawingstate.initialmatrix.a=v.drawingstate.matrix.a;v.drawingstate.initialmatrix.b=
v.drawingstate.matrix.b;v.drawingstate.initialmatrix.c=v.drawingstate.matrix.c;v.drawingstate.initialmatrix.d=v.drawingstate.matrix.d;v.drawingstate.initialmatrix.tx=v.drawingstate.matrix.tx;v.drawingstate.initialmatrix.ty=v.drawingstate.matrix.ty;v.drawingstate.initialmatrix.det=v.drawingstate.matrix.det;v.drawingstate.initialmatrix.sdet=v.drawingstate.matrix.sdet;Ca.backup=v.clone(v.drawingstate)};v.makecolor=function(a,b,c){a=Math.floor(255*a);b=Math.floor(255*b);c=Math.floor(255*c);return 1===
v.drawingstate.alpha?"rgb("+a+","+b+","+c+")":"rgba("+a+","+b+","+c+","+v.drawingstate.alpha+")"};v.setcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;v.drawingstate.linecolor=v.drawingstate.pointcolor=v.makecolor(b,c,a);v.drawingstate.linecolorraw=v.drawingstate.pointcolorraw=[b,c,a]};v.setlinecolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;v.drawingstate.linecolor=v.makecolor(b,c,a);v.drawingstate.linecolorraw=
[b,c,a]};v.settextcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;v.drawingstate.textcolor=v.makecolor(b,c,a);v.drawingstate.textcolorraw=[b,c,a]};v.setpointcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;v.drawingstate.pointcolor=v.makecolor(b,c,a);v.drawingstate.pointcolorraw=[b,c,a]};v.setalpha=function(a){v.drawingstate.alpha=a.value.real;v.drawingstate.linecolor=v.makecolor(v.drawingstate.linecolorraw[0],
v.drawingstate.linecolorraw[1],v.drawingstate.linecolorraw[2]);v.drawingstate.pointcolor=v.makecolor(v.drawingstate.pointcolorraw[0],v.drawingstate.pointcolorraw[1],v.drawingstate.pointcolorraw[2]);v.drawingstate.textcolor=v.makecolor(v.drawingstate.textcolorraw[0],v.drawingstate.textcolorraw[1],v.drawingstate.textcolorraw[2])};v.setpointsize=function(a){v.drawingstate.pointsize=a.value.real};v.setlinesize=function(a){v.drawingstate.linesize=a.value.real};v.settextsize=function(a){v.drawingstate.textsize=
a.value.real};var ra={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:1,alpha:1,overhangLine:1.1,overhangSeg:1,dimDependent:1,fontFamily:"sans-serif"};r.defaultAppearance&&Qc(r.defaultAppearance);var Ib={},Gb=["in","out","good","backup"],Ka=new Float64Array(0),Ha={};Gb.forEach(function(a){Ha[a]=Ka});var ea=Ka,ua=Ka,qa=Ka,ja,pa,Sa,va,Ya,Kb=!1,qc={toString:function(){return"RefineException"}},H=null;r.enableTraceLog&&(H={logLength:Infinity,fullLog:[],currentMouseAndScripts:null,
currentMover:null,currentStep:null,currentElement:null,currentParam:null,labelTracing2:w.wrap("tracing2"),labelTracing4:w.wrap("tracing4"),labelTracingSesq:w.wrap("tracingSesq"),postMouseHooks:[]},"number"===typeof r.enableTraceLog&&(H.logLength=r.enableTraceLog),sa.getTraceLog=Tc,sa.formatTraceLog=Uc,sa.addTraceHook=H.postMouseHooks.push.bind(H.postMouseHooks));Ba.stateSize=12;Mb.stateSize=24;var p={_helper:{},RandomLine:{}};p.RandomLine.kind="L";p.RandomLine.signature=[];p.RandomLine.updatePosition=
function(a){a.homog=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};p.FreeLine={};p.FreeLine.kind="L";p.FreeLine.signature=[];p.FreeLine.isMovable=!0;p.FreeLine.initialize=function(a){a=p._helper.initializePoint(a);R(a)};p.FreeLine.getParamForInput=function(a,b,c){a=g.cross(b,g.ez);a=g.cross(a,b);return g.normalizeMax(a)};p.FreeLine.getParamFromState=function(a){return X(3)};p.FreeLine.putParamToState=function(a,
b){R(b)};p.FreeLine.updatePosition=function(a){var b=X(3);R(b);a.homog=w.withUsage(b,"Line")};p.FreeLine.stateSize=6;p.RandomPoint={};p.RandomPoint.kind="P";p.RandomPoint.signature=[];p.RandomPoint.updatePosition=function(a){a.homog=g.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};p.Join={};p.Join.kind="L";p.Join.signature=["P","P"];p.Join.updatePosition=function(a){a.homog=g.cross(q[a.args[0]].homog,q[a.args[1]].homog);
a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};p.Segment={};p.Segment.kind="S";p.Segment.signature=["P","P"];p.Segment.updatePosition=function(a){var b=q[a.args[0]],c=q[a.args[1]];a.homog=g.cross(b.homog,c.homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line");a.startpos=b.homog;a.endpos=c.homog;a.farpoint=g.cross(a.homog,g.linfty)};p.Meet={};p.Meet.kind="P";p.Meet.signature=["L","L"];p.Meet.updatePosition=function(a){a.homog=g.cross(q[a.args[0]].homog,q[a.args[1]].homog);
a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};p.Meet.visiblecheck=function(a){var b=!0,c=q[a.args[0]],d=q[a.args[1]];"Segment"===c.type&&(b=oc(a,c));b&&"Segment"===c.type&&(b=oc(a,d));a.isshowing=b};p._helper.midpoint=function(a,b){return g.normalizeMax(g.add(g.scalmult(b.value[2],a),g.scalmult(a.value[2],b)))};p.Mid={};p.Mid.kind="P";p.Mid.signature=["P","P"];p.Mid.updatePosition=function(a){var b=p._helper.midpoint(q[a.args[0]].homog,q[a.args[1]].homog);a.homog=w.withUsage(b,
"Point")};p.Perp={};p.Perp.kind="L";p.Perp.signature=["L","P"];p.Perp.updatePosition=function(a){var b=q[a.args[0]].homog,c=q[a.args[1]].homog,b=g.turnIntoCSList([b.value[0],b.value[1],k.zero]);a.homog=g.cross(b,c);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};p.Para={};p.Para.kind="L";p.Para.signature=["L","P"];p.Para.updatePosition=function(a){var b=q[a.args[1]].homog;a.homog=g.cross(g.cross(g.linfty,q[a.args[0]].homog),b);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,
"Line")};p.Horizontal={};p.Horizontal.kind="L";p.Horizontal.signature=["P"];p.Horizontal.updatePosition=function(a){a.homog=g.cross(g.ex,q[a.args[0]].homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};p.HorizontalLine={};p.HorizontalLine.kind="L";p.HorizontalLine.signature=[];p.HorizontalLine.isMovable=!0;p.HorizontalLine.initialize=function(a){a=p._helper.initializePoint(a);a=g.turnIntoCSList([k.zero,a.value[1],a.value[2]]);a=g.normalizeMax(a);R(a)};p.HorizontalLine.getParamForInput=
function(a,b,c){a=g.cross(b,g.ex);return g.normalizeMax(a)};p.HorizontalLine.getParamFromState=function(a){return X(3)};p.HorizontalLine.putParamToState=function(a,b){R(b)};p.HorizontalLine.updatePosition=function(a){var b=X(3);R(b);a.homog=w.withUsage(b,"Line")};p.HorizontalLine.stateSize=6;p.Vertical={};p.Vertical.kind="L";p.Vertical.signature=["P"];p.Vertical.updatePosition=function(a){a.homog=g.cross(g.ey,q[a.args[0]].homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};
p.VerticalLine={};p.VerticalLine.kind="L";p.VerticalLine.signature=[];p.VerticalLine.isMovable=!0;p.VerticalLine.initialize=function(a){a=p._helper.initializePoint(a);a=g.turnIntoCSList([a.value[0],k.zero,a.value[2]]);a=g.normalizeMax(a);R(a)};p.VerticalLine.getParamForInput=function(a,b,c){a=g.cross(b,g.ey);return g.normalizeMax(a)};p.VerticalLine.getParamFromState=function(a){return X(3)};p.VerticalLine.putParamToState=function(a,b){R(b)};p.VerticalLine.updatePosition=function(a){var b=X(3);R(b);
a.homog=w.withUsage(b,"Line")};p.VerticalLine.stateSize=6;p.LineByFixedAngle={};p.LineByFixedAngle.kind="L";p.LineByFixedAngle.signature=["L","P"];p.LineByFixedAngle.initialize=function(a){var b=k._helper.input(a.angle),c=k.cos(b),b=k.sin(b);a.rot=g.turnIntoCSList([g.turnIntoCSList([b,c,k.zero]),g.turnIntoCSList([k.neg(c),b,k.zero]),g.turnIntoCSList([k.zero,k.zero,k.zero])])};p.LineByFixedAngle.updatePosition=function(a){var b=q[a.args[1]],c=g.productMV(a.rot,q[a.args[0]].homog);a.homog=g.cross(b.homog,
c);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};p.Through={};p.Through.kind="L";p.Through.signature=["P"];p.Through.isMovable=!0;p.Through.initialize=function(a){a=a.dir?w.wrap(a.dir):g.realVector([a.pos[1],-a.pos[0],0]);R(a)};p.Through.getParamForInput=function(a,b,c){a="mouse"===c?g.cross(q[a.args[0]].homog,b):"homog"===c?b:g.turnIntoCSList([k.zero,k.zero,k.zero]);a=g.cross(g.linfty,a);return g.normalizeMax(a)};p.Through.getParamFromState=function(a){return X(3)};p.Through.putParamToState=
function(a,b){R(b)};p.Through.updatePosition=function(a){var b=X(3);R(b);b=g.cross(q[a.args[0]].homog,b);b=g.normalizeMax(b);a.homog=w.withUsage(b,"Line")};p.Through.stateSize=6;p.Free={};p.Free.kind="P";p.Free.signature=[];p.Free.isMovable=!0;p.Free.initialize=function(a){a=p._helper.initializePoint(a);R(a)};p.Free.getParamForInput=function(a,b,c){if("mouse"===c&&Zb&&0!==Ga){b=g.normalizeZ(b);a=b.value[0].value.real;c=b.value[1].value.real;var d=Math.round(a/Ga)*Ga,f=Math.round(c/Ga)*Ga;.2>Math.abs(d-
a)&&.2>Math.abs(f-c)&&(b=g.realVector([d,f,1]))}return g.normalizeMax(b)};p.Free.getParamFromState=function(a){return X(3)};p.Free.putParamToState=function(a,b){R(b)};p.Free.updatePosition=function(a){var b=X(3);R(b);a.homog=w.withUsage(b,"Point")};p.Free.stateSize=6;p._helper.projectPointToLine=function(a,b){var c=g.turnIntoCSList([b.value[0],b.value[1],k.zero]),c=g.cross(c,a);return g.normalizeMax(g.cross(c,b))};p.PointOnLine={};p.PointOnLine.kind="P";p.PointOnLine.signature=["L"];p.PointOnLine.isMovable=
!0;p.PointOnLine.initialize=function(a){var b=p._helper.initializePoint(a);a=q[a.args[0]].homog;var b=p._helper.projectPointToLine(b,a),b=g.normalizeMax(b),c=g.cross(g.linfty,b);g.normalizeMax(c);R(b);R(a);Sa=!1};p.PointOnLine.updatePosition=function(a,b){var c,d=q[a.args[0]].homog;c=X(3);X(3);if(!b){ja=a.stateIdx;var f=ea;ea=qa;var h=X(3),k=X(3);ea=f;f=g.cross(k,d);g._helper.isAlmostZero(f)&&(f=g.cross(g.linfty,d));h=p._helper.CircleMP(f,h);h=p._helper.IntersectLC(d,h);f=p._helper.pointReflection(f,
c);c=sc(h[0],h[1],c,f)[0]}c=g.normalizeMax(c);R(c);R(d);a.homog=w.withUsage(c,"Point")};p.PointOnLine.getParamForInput=function(a,b,c){return b=p._helper.projectPointToLine(b,q[a.args[0]].homog)};p.PointOnLine.getParamFromState=function(a){return X(3)};p.PointOnLine.putParamToState=function(a,b){return R(b)};p.PointOnLine.stateSize=12;p.PointOnCircle={};p.PointOnCircle.kind="P";p.PointOnCircle.signature=["C"];p.PointOnCircle.isMovable=!0;p.PointOnCircle.initialize=function(a){var b=q[a.args[0]];a=
g.normalizeZ(p._helper.initializePoint(a));var c=g.normalizeZ(p._helper.CenterOfConic(b.matrix)),d=g.sub(a,c),d=g.turnIntoCSList([d.value[1],k.neg(d.value[0]),k.zero]),c=g.cross(a,c),b=p._helper.IntersectLC(c,b.matrix),c=g.projectiveDistMinScal(a,b[0]);g.projectiveDistMinScal(a,b[1])<c?(a=b[1],b=b[0]):(a=b[0],b=b[1]);R(d);R(a);R(b);Sa=!1};p.PointOnCircle.putParamToState=function(a,b){R(b)};p.PointOnCircle.getParamFromState=function(a){return X(3)};p.PointOnCircle.getParamForInput=function(a,b,c){c=
g.normalizeZ(p._helper.CenterOfConic(q[a.args[0]].matrix));b=g.sub(b,c);ja=a.stateIdx;a=X(3);var d=g.normalizeZ(X(3));c=g.sub(d,c);0>k.sub(k.mult(a.value[0],c.value[1]),k.mult(a.value[1],c.value[0])).value.real&&(b=g.neg(b));return g.turnIntoCSList([b.value[1],k.neg(b.value[0]),k.zero])};p.PointOnCircle.parameterPath=function(a,b,c,d,f){d=g.normalizeAbs(d);f=g.normalizeAbs(f);var h=g.scalproduct(d,f);if(0<=h.value.real)return rc(a,b,c,d,f);a=g.turnIntoCSList([k.sub(d.value[1],f.value[1]),k.sub(f.value[0],
d.value[0]),k.zero]);h=g.scalproduct(d,a);0>h.value.real&&(a=g.neg(a));0>b?(b=2*b+1,c=b*b,h=.25/(1+c),c=k.complex(2*b*h+.25,(1-c)*h)):(b=2*b-1,c=b*b,h=.25/(1+c),c=k.complex(2*b*h+.75,(1-c)*h));var l=k.sub(k.real(1),c);b=k.mult(c,c);h=k.mult(l,l);c=k.mult(c,l);d=g.scalmult(h,d);d=g.add(d,g.scalmult(c,a));return d=g.add(d,g.scalmult(b,f))};p.PointOnCircle.updatePosition=function(a){var b=X(3);R(b);var c=q[a.args[0]],b=g.productMV(c.matrix,b),c=p._helper.IntersectLC(b,c.matrix),c=Ba(c[0],c[1]),b=g.normalizeMax(c.value[0]);
a.homog=w.withUsage(b,"Point");a.antipodalPoint=c.value[1]};p.PointOnCircle.stateSize=6+Ba.stateSize;p.OtherPointOnCircle={};p.OtherPointOnCircle.kind="P";p.OtherPointOnCircle.signature=["P"];p.OtherPointOnCircle.signatureConstraints=function(a){return"PointOnCircle"===q[a.args[0]].type};p.OtherPointOnCircle.updatePosition=function(a){var b=q[a.args[0]].antipodalPoint,b=g.normalizeMax(b);a.homog=w.withUsage(b,"Point")};p.PointOnSegment={};p.PointOnSegment.kind="P";p.PointOnSegment.signature=["S"];
p.PointOnSegment.isMovable=!0;p.PointOnSegment.initialize=function(a){var b=p._helper.initializePoint(a);a=p.PointOnSegment.getParamForInput(a,b);Ta(a)};p.PointOnSegment.getParamForInput=function(a,b){var c=q[a.args[0]],d=c.homog,d=g.turnIntoCSList([d.value[0],d.value[1],k.zero]),c=g.crossratio3(c.farpoint,c.startpos,c.endpos,b,d);0>c.value.real&&(c=k.complex(0,c.value.imag));1<c.value.real&&(c=k.complex(1,c.value.imag));return c};p.PointOnSegment.getParamFromState=function(a){return cb()};p.PointOnSegment.putParamToState=
function(a,b){Ta(b)};p.PointOnSegment.updatePosition=function(a){var b=cb();Ta(b);var c=q[a.args[0]],d=g.scalmult(c.endpos.value[2],c.startpos),c=g.scalmult(c.startpos.value[2],c.endpos),c=g.sub(c,d),b=g.add(d,g.scalmult(b,c)),b=g.normalizeMax(b);a.homog=w.withUsage(b,"Point")};p.PointOnSegment.stateSize=2;p._helper.CenterOfConic=function(a){return w.mult(g.adjoint3(a),g.linfty)};p.CenterOfConic={};p.CenterOfConic.kind="P";p.CenterOfConic.signature=["C"];p.CenterOfConic.updatePosition=function(a){var b=
p._helper.CenterOfConic(q[a.args[0]].matrix);a.homog=b;a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};p._helper.CircleMP=function(a,b){var c=a.value[0],d=a.value[1],f=k.neg(a.value[2]),h=k.zero,c=g.turnIntoCSList([g.turnIntoCSList([f,h,c]),g.turnIntoCSList([h,f,d]),g.turnIntoCSList([c,d,h])]),f=w.mult(w.mult(b,c),b),d=w.mult(w.mult(b,g.fund),b),f=w.mult(f,g.fund),c=w.mult(d,c);return g.sub(f,c)};p.CircleMP={};p.CircleMP.kind="C";p.CircleMP.signature=["P","P"];p.CircleMP.updatePosition=
function(a){a.matrix=p._helper.CircleMP(q[a.args[0]].homog,q[a.args[1]].homog);a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Circle")};p.CircleMr={};p.CircleMr.kind="C";p.CircleMr.signature=["P"];p.CircleMr.isMovable=!0;p.CircleMr.initialize=function(a){Ta(k.real(a.radius))};p.CircleMr.getParamForInput=function(a,b){var c=q[a.args[0]].homog,c=g.normalizeZ(c);b=g.normalizeZ(b);c=g.sub(c,b);return c=g.abs(c)};p.CircleMr.getParamFromState=function(a){return cb()};p.CircleMr.putParamToState=
function(a,b){Ta(b)};p.CircleMr.updatePosition=function(a){var b=cb();Ta(b);var c=q[a.args[0]].homog,c=g.normalizeZ(c),d=g.turnIntoCSList([b,k.zero,k.zero]),d=g.add(d,c),c=p._helper.CircleMP(c,d),c=g.normalizeMax(c);a.matrix=w.withUsage(c,"Circle");a.radius=b};p.CircleMr.stateSize=2;p.Compass={};p.Compass.kind="C";p.Compass.signature=["P","P","P"];p.Compass.updatePosition=function(a){var b=q[a.args[2]].homog,c=q[a.args[1]].homog,d=q[a.args[0]].homog,b=g.normalizeZ(b),c=g.normalizeZ(c),d=g.normalizeZ(d),
c=g.sub(c,d),c=g.add(c,b),c=g.normalizeZ(c),b=p._helper.CircleMP(b,c),b=g.normalizeMax(b);a.matrix=w.withUsage(b,"Circle")};p._helper.getConicType=function(a){if(1E-16>k.abs(g.det(a)).value.real)return"degenerate";var b=k.mult(a.value[0].value[0],a.value[1].value[1]),b=k.sub(b,k.pow(a.value[0].value[1],k.real(2))),b=b.value.real;return 1E-16>Math.abs(b)?"parabola":1E-16<b?"ellipsoid":"hyperbola"};p._helper.ConicBy5=function(a,b,c,d,f,h){a=g.turnIntoCSList([g.cross(c,d)]);var k=g.turnIntoCSList([g.cross(b,
f)]);b=g.turnIntoCSList([g.cross(b,c)]);d=g.turnIntoCSList([g.cross(d,f)]);w.mult(g.transpose(k),a);return p._helper.conicFromTwoDegenerates(a,k,b,d,h)};p._helper.conicFromTwoDegenerates=function(a,b,c,d,f){a=w.mult(g.transpose(b),a);c=w.mult(g.transpose(d),c);a=g.add(a,g.transpose(a));c=g.add(c,g.transpose(c));d=w.mult(w.mult(f,a),f);f=w.mult(w.mult(f,c),f);c=w.mult(d,c);f=w.mult(f,a);return g.sub(c,f)};p.ConicBy5={};p.ConicBy5.kind="C";p.ConicBy5.signature=["P","P","P","P","P"];p.ConicBy5.updatePosition=
function(a){var b=p._helper.ConicBy5(a,q[a.args[0]].homog,q[a.args[1]].homog,q[a.args[2]].homog,q[a.args[3]].homog,q[a.args[4]].homog);a.matrix=b;a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};p._helper.buildConicMatrix=function(a){var b=a[1],c=a[2],d=a[3],f=a[4],h=a[5];return g.turnIntoCSList([g.turnIntoCSList([a[0],b,d]),g.turnIntoCSList([b,c,f]),g.turnIntoCSList([d,f,h])])};p._helper.splitDegenConic=function(a){var b=g.adjoint3(a),c=0,d,f,h=k.abs2(b.value[0].value[0]).value.real;
for(d=1;3>d;d++)f=k.abs2(b.value[d].value[d]).value.real,f>h&&(c=d,h=f);d=k.sqrt(k.mult(k.real(-1),b.value[c].value[c]));if(1E-16>k.abs2(d).value.real)return a=g.turnIntoCSList([k.zero,k.zero,k.zero]),[a,a];c=k.real(c+1);f=g.column(b,c);f=g.scaldiv(d,f);d=f.value[0];h=f.value[1];f=f.value[2];d=g.turnIntoCSList([g.turnIntoCSList([k.real(0),f,k.mult(k.real(-1),h)]),g.turnIntoCSList([k.mult(k.real(-1),f),k.real(0),d]),g.turnIntoCSList([h,k.mult(k.real(-1),d),k.real(0)])]);a=g.add(a,d);var l=0;for(d=
h=b=0;3>d;d++)for(c=0;3>c;c++)f=k.abs2(a.value[d].value[c]).value.real,f>h&&(l=d,b=c,h=f);d=a.value[l];a=g.transpose(a);a=a.value[b];d=g.normalizeMax(d);a=g.normalizeMax(a);d=w.withUsage(d,"Line");a=w.withUsage(a,"Line");return[d,a]};p.SelectConic={};p.SelectConic.kind="C";p.SelectConic.signature=["Cs"];p.SelectConic.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=k._helper.input(a.pos.xx),c=k._helper.input(a.pos.yy),d=k._helper.input(a.pos.zz),f=k.realmult(.5,k._helper.input(a.pos.xy)),
h=k.realmult(.5,k._helper.input(a.pos.xz)),l=k.realmult(.5,k._helper.input(a.pos.yz)),b=g.turnIntoCSList([g.turnIntoCSList([b,f,h]),g.turnIntoCSList([f,c,l]),g.turnIntoCSList([h,l,d])]);a=q[a.args[0]].results;c=g.conicDist(b,a[0]);d=0;for(f=1;f<a.length;++f)h=g.conicDist(b,a[f]),h<c&&(c=h,d=f);return d};p.SelectConic.updatePosition=function(a){a.matrix=q[a.args[0]].results[a.param];a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};p._helper.ConicBy4p1l=function(a,b,c,d,f,h){var l=
g.cross(g.cross(b,d),h),m=g.cross(g.cross(c,f),h),q=g.cross(g.cross(b,c),h),r=g.cross(g.cross(d,f),h),t=g.realVector(v.to(100*Math.random(),100*Math.random()));h=k.mult(g.det3(t,m,q),g.det3(t,m,r));h=k.sqrt(h);q=k.mult(g.det3(t,l,q),g.det3(t,l,r));q=k.sqrt(q);l=g.scalmult(h,l);q=g.scalmult(q,m);m=g.add(l,q);l=g.sub(l,q);m=p._helper.ConicBy5(a,b,c,d,f,m);a=p._helper.ConicBy5(a,b,c,d,f,l);return[m,a]};p.ConicBy4p1l={};p.ConicBy4p1l.kind="Cs";p.ConicBy4p1l.signature=["P","P","P","P","L"];p.ConicBy4p1l.updatePosition=
function(a){var b=p._helper.ConicBy4p1l(a,q[a.args[0]].homog,q[a.args[1]].homog,q[a.args[2]].homog,q[a.args[3]].homog,q[a.args[4]].homog);a.results=b};p._helper.ConicBy3p2l=function(a,b,c,d,f){function h(a,b,c,e){return k.sub(k.mult(a,e),k.mult(b,c))}var l=g.cross(a,b),m=g.cross(d,f);d=g.cross(d,l);f=g.cross(f,l);l=g.turnIntoCSList([d,f,m]);c=g.productVM(c,g.adjoint3(l));m=g.adjoint3(g.turnIntoCSList([g.scalmult(c.value[0],d),g.scalmult(c.value[1],f),g.scalmult(c.value[2],m)]));c=g.transpose(m);d=
k.mult;f=g.productMV(c,a);a=f.value[0];f=f.value[1];l=g.productMV(c,b);b=l.value[0];var l=l.value[1],p=k.sqrt(d(a,f)),q=k.sqrt(d(b,l)),r,t=Array(4);for(r=0;4>r;++r){var u=(r&2)-1,v=d(k.real(((r&1)<<1)-1),p),w=d(k.real(u),q),x=h(f,v,l,w),y=h(b,w,a,v),u=h(a,f,b,l),z=k.add(k.add(h(b,l,a,f),h(l,w,f,v)),h(w,b,v,a)),v=d(x,x),w=d(y,y),A=d(z,z),B=d(x,y),x=d(x,z),y=d(y,z),B=k.sub(B,d(k.real(.5),d(u,u))),u=g.turnIntoCSList([g.turnIntoCSList([v,B,x]),g.turnIntoCSList([B,w,y]),g.turnIntoCSList([x,y,A])]),u=g.productMM(m,
g.productMM(u,c)),u=g.turnIntoCSList([u.value[0].value[0],u.value[0].value[1],u.value[0].value[2],u.value[1].value[1],u.value[1].value[2],u.value[2].value[2]]);t[r]=u}return t};p.ConicBy3p2l={};p.ConicBy3p2l.kind="Cs";p.ConicBy3p2l.signature=["P","P","P","L","L"];p.ConicBy3p2l.updatePosition=function(a){for(var b=p._helper.ConicBy3p2l(q[a.args[0]].homog,q[a.args[1]].homog,q[a.args[2]].homog,q[a.args[3]].homog,q[a.args[4]].homog),b=tc(b),c=Array(4),d=0;4>d;++d){var f=b[d].value;c[d]=g.turnIntoCSList([g.turnIntoCSList([f[0],
f[1],f[2]]),g.turnIntoCSList([f[1],f[3],f[4]]),g.turnIntoCSList([f[2],f[4],f[5]])])}a.results=c};p.ConicBy3p2l.stateSize=48;p.ConicBy2p3l={};p.ConicBy2p3l.kind="Cs";p.ConicBy2p3l.signature=["P","P","L","L","L"];p.ConicBy2p3l.updatePosition=function(a){for(var b=p._helper.ConicBy3p2l(q[a.args[2]].homog,q[a.args[3]].homog,q[a.args[4]].homog,q[a.args[0]].homog,q[a.args[1]].homog),b=tc(b),c=Array(4),d=0;4>d;++d){var f=b[d].value,f=g.turnIntoCSList([g.turnIntoCSList([f[0],f[1],f[2]]),g.turnIntoCSList([f[1],
f[3],f[4]]),g.turnIntoCSList([f[2],f[4],f[5]])]);c[d]=g.normalizeMax(g.adjoint3(f))}a.results=c};p.ConicBy2p3l.stateSize=48;p.ConicBy1p4l={};p.ConicBy1p4l.kind="Cs";p.ConicBy1p4l.signature=["P","L","L","L","L"];p.ConicBy1p4l.updatePosition=function(a){var b=p._helper.ConicBy4p1l(a,q[a.args[1]].homog,q[a.args[2]].homog,q[a.args[3]].homog,q[a.args[4]].homog,q[a.args[0]].homog),c=b[0],b=b[1],c=g.adjoint3(c),b=g.adjoint3(b),b=[c,b];a.results=b};p.ConicParabolaPL={};p.ConicParabolaPL.kind="C";p.ConicParabolaPL.signature=
["P","L"];p.ConicParabolaPL.updatePosition=function(a){var b=q[a.args[0]].homog.value,c=q[a.args[1]].homog.value,d=k.mult,f=k.neg,h=k.add,l=k.sub,m=b[0],r=b[1],t=b[2],u=c[0],b=c[1],c=c[2],v=d(t,t),x=d(u,u),y=d(b,b),z=d(t,c),A=f(t),t=h(x,y),y=d(v,y),x=d(v,x),f=d(f(v),d(u,b)),u=d(A,h(d(m,t),d(z,u))),b=d(A,h(d(r,t),d(z,b))),d=l(d(h(d(m,m),d(r,r)),t),d(v,d(c,c))),d=p._helper.buildConicMatrix([y,f,x,u,b,d]),d=g.normalizeMax(d);a.matrix=w.withUsage(d,"Conic")};p.ConicBy2Foci1P={};p.ConicBy2Foci1P.kind=
"Cs";p.ConicBy2Foci1P.signature=["P","P","P"];p.ConicBy2Foci1P.updatePosition=function(a){var b=q[a.args[0]].homog,c=q[a.args[1]].homog,d=q[a.args[2]].homog,f=g.ii,h=g.jj,l=g.normalizeMax(g.cross(b,d)),m=g.normalizeMax(g.cross(c,d)),r=g.normalizeMax(g.cross(d,f)),d=g.normalizeMax(g.cross(d,h)),m=p._helper.coHarmonic(r,d,l,m),l=g.normalizeMax(m[0]),m=g.normalizeMax(m[1]),f=g.turnIntoCSList([f]),r=g.turnIntoCSList([h]),d=g.turnIntoCSList([b]),t=g.turnIntoCSList([c]),h=p._helper.conicFromTwoDegenerates(f,
r,d,t,l),h=g.normalizeMax(h),f=p._helper.conicFromTwoDegenerates(f,r,d,t,m),f=g.normalizeMax(f),h=g.normalizeMax(g.adjoint3(h)),f=g.normalizeMax(g.adjoint3(f));"ellipsoid"!==p._helper.getConicType(h)&&(l=h,h=f,f=l);g.almostequals(b,c).value&&(b=k.real(3),f=g.zeromatrix(b,b));a.results=[h,f]};p._helper.coHarmonic=function(a,b,c,d){var f=g.realVector([100*Math.random(),100*Math.random(),1]),h=g.det3(f,c,a),l=g.det3(f,c,b);c=g.det3(f,d,a);d=g.det3(f,d,b);d=k.sqrt(k.mult(d,l));h=k.sqrt(k.mult(c,h));a=
w.mult(a,d);h=w.mult(b,h);b=g.add(a,h);a=g.sub(a,h);return[b,a]};p.ConicInSquare={};p.ConicInSquare.kind="C";p.ConicInSquare.signature=["P","P","P","P"];p.ConicInSquare.updatePosition=function(a){var b=E.basismap(q[a.args[0]].homog,q[a.args[1]].homog,q[a.args[2]].homog,q[a.args[3]].homog),c=k.one,c=p._helper.buildConicMatrix([c,c,c,k.real(-3),c,c]),b=g.adjoint3(b),b=g.productMM(g.productMM(g.transpose(b),c),b),b=g.normalizeMax(b);a.matrix=w.withUsage(b,"Conic")};p.ConicBy5lines={};p.ConicBy5lines.kind=
"C";p.ConicBy5lines.signature=["L","L","L","L","L"];p.ConicBy5lines.updatePosition=function(a){var b=p._helper.ConicBy5(a,q[a.args[0]].homog,q[a.args[1]].homog,q[a.args[2]].homog,q[a.args[3]].homog,q[a.args[4]].homog),b=g.adjoint3(b);a.matrix=b;a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};p.ConicFromPrincipalDirections={};p.ConicFromPrincipalDirections.kind="C";p.ConicFromPrincipalDirections.signature=["P","P","P"];p.ConicFromPrincipalDirections.updatePosition=function(a){var b=
q[a.args[0]].homog,c=q[a.args[1]].homog,d=q[a.args[2]].homog,f=p._helper.pointReflection(b,c),h=g.cross(c,b),b=g.turnIntoCSList([h.value[0],h.value[1],k.zero]),h=g.turnIntoCSList([h]),c=g.turnIntoCSList([g.cross(c,b)]),f=g.turnIntoCSList([g.cross(f,b)]);a.matrix=p._helper.conicFromTwoDegenerates(h,h,c,f,d);a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};p.CircleBy3={};p.CircleBy3.kind="C";p.CircleBy3.signature=["P","P","P"];p.CircleBy3.updatePosition=function(a){var b=p._helper.ConicBy5(a,
q[a.args[0]].homog,q[a.args[1]].homog,g.ii,g.jj,q[a.args[2]].homog);a.matrix=g.normalizeMax(b);a.matrix=w.withUsage(a.matrix,"Circle")};p.ArcBy3={};p.ArcBy3.kind="C";p.ArcBy3.signature=["P","P","P"];p.ArcBy3.updatePosition=function(a){p.CircleBy3.updatePosition(a);a.startPoint=q[a.args[0]].homog;a.viaPoint=q[a.args[1]].homog;a.endPoint=q[a.args[2]].homog};p.ArcBy3.initialize=function(a){a.startPoint=q[a.args[0]].homog;a.viaPoint=q[a.args[1]].homog;a.endPoint=q[a.args[2]].homog;a.isArc=!0};p.PolarOfPoint=
{};p.PolarOfPoint.kind="L";p.PolarOfPoint.signature=["P","C"];p.PolarOfPoint.updatePosition=function(a){var b=w.mult(q[a.args[1]].matrix,q[a.args[0]].homog),b=g.normalizeMax(b);a.homog=w.withUsage(b,"Line")};p.PolarOfLine={};p.PolarOfLine.kind="P";p.PolarOfLine.signature=["L","C"];p.PolarOfLine.updatePosition=function(a){var b=q[a.args[0]],c=g.adjoint3(q[a.args[1]].matrix),b=w.mult(c,b.homog),b=g.normalizeMax(b);a.homog=w.withUsage(b,"Point")};p.angleBisector={};p.angleBisector.kind="Ls";p.angleBisector.signature=
["L","L"];p.angleBisector.updatePosition=function(a){var b=q[a.args[0]],c=q[a.args[1]],d=g.normalizeMax(g.cross(b.homog,c.homog)),f=g.normalizeMax(g.cross(g.ii,d)),h=g.normalizeMax(g.cross(g.jj,d)),l=k.sqrt(k.mult(g.det3(d,c.homog,f),g.det3(d,b.homog,f))),m=k.sqrt(k.mult(g.det3(d,c.homog,h),g.det3(d,b.homog,h))),f=w.mult(f,m),l=w.mult(h,l),h=g.add(f,l),l=g.sub(f,l),f=g.abs(h).value.real<k.eps,m=g.abs(l).value.real<k.eps;f||m?f?l=g.normalizeMax(l):m&&(h=g.normalizeMax(h)):(h=g.normalizeMax(h),l=g.normalizeMax(l));
if(g.almostequals(h,g.linfty).value&&m||g.almostequals(l,g.linfty).value&&f)g.abs(h).value.real<g.abs(l).value.real?(f=g.det3(d,c.homog,l),d=g.det3(d,b.homog,l),b=w.mult(b.homog,f),c=w.mult(c.homog,d),h=g.add(b,c)):(f=g.det3(d,c.homog,h),d=g.det3(d,b.homog,h),b=w.mult(b.homog,f),c=w.mult(c.homog,d),l=g.add(b,c));h=g.normalizeMax(h);l=g.normalizeMax(l);a.results=Ba(h,l)};p.angleBisector.stateSize=Ba.stateSize;p._helper.IntersectLC=function(a,b){var c=k,d=g.crossOperator(a),f=g.transpose(d),f=w.mult(f,
w.mult(b,d)),h=g.maxIndex(a,k.abs2),l,m,p,q;0===h?(h=f.value[1].value[1],l=f.value[1].value[2],m=f.value[2].value[1],p=f.value[2].value[2],q=a.value[0]):1===h?(h=f.value[0].value[0],l=f.value[0].value[2],m=f.value[2].value[0],p=f.value[2].value[2],q=a.value[1]):(h=f.value[0].value[0],l=f.value[0].value[1],m=f.value[1].value[0],p=f.value[1].value[1],q=a.value[2]);c=c.div(c.sqrt(c.sub(c.mult(l,m),c.mult(h,p))),q);c=g.add(f,g.scalmult(c,d));h=g.maxIndex(c,g.abs2);d=c.value[h];d=g.normalizeMax(d);d=w.withUsage(d,
"Point");c=g.transpose(c);h=g.maxIndex(c,g.abs2);c=c.value[h];c=g.normalizeMax(c);c=w.withUsage(c,"Point");return[d,c]};p.IntersectLC={};p.IntersectLC.kind="Ps";p.IntersectLC.signature=["L","C"];p.IntersectLC.updatePosition=function(a){var b=p._helper.IntersectLC(q[a.args[0]].homog,q[a.args[1]].matrix);a.results=Ba(b[0],b[1])};p.IntersectLC.stateSize=Ba.stateSize;p.OtherIntersectionCL={};p.OtherIntersectionCL.kind="P";p.OtherIntersectionCL.signature=["C","L","P"];p.OtherIntersectionCL.updatePosition=
function(a){var b=q[a.args[2]].homog,c=p._helper.IntersectLC(q[a.args[1]].homog,q[a.args[0]].matrix),d=c[0],c=c[1],f=g.projectiveDistMinScal(d,b),b=g.projectiveDistMinScal(c,b);a.homog=f<b?c:d;a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};p.IntersectCirCir={};p.IntersectCirCir.kind="Ps";p.IntersectCirCir.signature=["C","C"];p.IntersectCirCir.updatePosition=function(a){var b=q[a.args[0]].matrix,c=q[a.args[1]].matrix,d=g.scalmult(c.value[0].value[0],b.value[2]),c=g.scalmult(b.value[0].value[0],
c.value[2]),d=g.sub(d,c),d=g.turnIntoCSList([d.value[0],d.value[1],k.realmult(.5,d.value[2])]),d=g.normalizeMax(d),b=p._helper.IntersectLC(d,b);a.results=Ba(b[0],b[1])};p.IntersectCirCir.stateSize=Ba.stateSize;p.OtherIntersectionCC={};p.OtherIntersectionCC.kind="P";p.OtherIntersectionCC.signature=["C","C","P"];p.OtherIntersectionCC.updatePosition=function(a){var b=q[a.args[0]].matrix,c=q[a.args[1]].matrix,d=q[a.args[2]].homog,f=g.scalmult(c.value[0].value[0],b.value[2]),c=g.scalmult(b.value[0].value[0],
c.value[2]),f=g.sub(f,c),f=g.turnIntoCSList([f.value[0],f.value[1],k.realmult(.5,f.value[2])]),f=g.normalizeMax(f),f=p._helper.IntersectLC(f,b),b=f[0],f=f[1],c=g.projectiveDistMinScal(b,d),d=g.projectiveDistMinScal(f,d);a.homog=c<d?f:b;a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};p._helper.IntersectConicConic=function(a,b){var c=a.value[0],d=a.value[1],f=a.value[2],h=b.value[0],l=b.value[1],m=b.value[2],q=g.det3(c,d,f),r=k.add(k.add(g.det3(c,d,m),g.det3(c,l,f)),g.det3(h,d,
f)),c=k.add(k.add(g.det3(c,l,m),g.det3(h,d,m)),g.det3(h,l,f)),h=g.det3(h,l,m),m=k.abs2(q).value.real,l=k.abs2(h).value.real;m<l&&(m=a,a=b,b=m,m=h,h=q,q=m,m=c,c=r,r=m,m=l);1E-24>m?(q=a,c=b):(r=k.solveCubic(q,r,c,h),c=k.abs2(k.sub(r[0],r[1])).value.real,h=k.abs2(k.sub(r[0],r[2])).value.real,l=k.abs2(k.sub(r[1],r[2])).value.real,c>h?(q=r[1],r=c>l?r[0]:r[2]):(q=r[2],r=h>l?r[0]:r[1]),q=g.add(g.scalmult(q,a),b),c=g.add(g.scalmult(r,a),b));r=p._helper.splitDegenConic(q);q=r[0];r=r[1];c=p._helper.splitDegenConic(c);
l=c[0];h=c[1];c=g.cross(q,l);l=g.cross(r,l);q=g.cross(q,h);r=g.cross(r,h);c=g.normalizeMax(c);l=g.normalizeMax(l);q=g.normalizeMax(q);r=g.normalizeMax(r);c=w.withUsage(c,"Point");l=w.withUsage(l,"Point");q=w.withUsage(q,"Point");r=w.withUsage(r,"Point");return[c,l,q,r]};p.IntersectConicConic={};p.IntersectConicConic.kind="Ps";p.IntersectConicConic.signature=["C","C"];p.IntersectConicConic.updatePosition=function(a){var b=p._helper.IntersectConicConic(q[a.args[0]].matrix,q[a.args[1]].matrix),b=Mb(b[0],
b[1],b[2],b[3]);a.results=b};p.IntersectConicConic.stateSize=Mb.stateSize;p.SelectP={};p.SelectP.kind="P";p.SelectP.signature=["Ps"];p.SelectP.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=q[a.args[0]].results.value;a=p._helper.initializePoint(a);for(var c=g.projectiveDistMinScal(a,b[0]),d=0,f=1;f<b.length;++f){var h=g.projectiveDistMinScal(a,b[f]);h<c&&(c=h,d=f)}return d};p.SelectP.updatePosition=function(a){a.homog=q[a.args[0]].results.value[a.param]};p.SelectL={};p.SelectL.kind=
"L";p.SelectL.signature=["Ls"];p.SelectL.updatePosition=function(a){a.homog=q[a.args[0]].results.value[a.index-1];a.homog=w.withUsage(a.homog,"Line")};p._helper.moebiusStep=function(a,b,c){var d=k.add,f=k.sub,g=k.mult,h=a.value[0],l=a.value[1];a=a.value[2];var m=b.value[0],p=b.value[1];b=b.value[2];var q=c.value[0],r=c.value[1],t=c.value[2];c=f(g(b,q),g(m,t));var u=f(g(b,r),g(p,t)),q=f(g(h,t),g(a,q)),r=f(g(l,t),g(a,r));return[f(g(h,c),g(l,u)),d(g(l,c),g(h,u)),g(a,c),g(a,u),f(g(m,q),g(p,r)),d(g(p,
q),g(m,r)),g(b,q),g(b,r)]};p.TrMoebius={};p.TrMoebius.kind="Mt";p.TrMoebius.signature="PPPPPP".split("");p.TrMoebius.updatePosition=function(a){var b=k.neg,c=p._helper.moebiusStep(q[a.args[0]].homog,q[a.args[2]].homog,q[a.args[4]].homog),d=p._helper.moebiusStep(q[a.args[1]].homog,q[a.args[3]].homog,q[a.args[5]].homog),d=g.normalizeMax(g.matrix([[d[0],b(d[1]),d[4],b(d[5])],[d[1],d[0],d[5],d[4]],[d[2],b(d[3]),d[6],b(d[7])],[d[3],d[2],d[7],d[6]]])),c=g.normalizeMax(g.matrix([[c[6],b(c[4])],[c[7],b(c[5])],
[b(c[2]),c[0]],[b(c[3]),c[1]]])),f=g.productMM(d,c),c=f.value[0].value[0],d=f.value[1].value[0],h=f.value[0].value[1],l=f.value[1].value[1],m=f.value[2].value[0],r=f.value[3].value[0],t=f.value[2].value[1],f=f.value[3].value[1];a.mat1=g.normalizeMax(g.matrix([[b(m),r,b(t)],[r,m,f],[c,b(d),h]]));a.mat2=g.normalizeMax(g.matrix([[b(r),b(m),b(f)],[b(m),r,b(t)],[d,c,l]]))};p.TrMoebiusP={};p.TrMoebiusP.kind="P";p.TrMoebiusP.signature=["Mt","P"];p.TrMoebiusP.updatePosition=function(a){var b=q[a.args[0]],
c=q[a.args[1]].homog,d=g.productMV(b.mat1,c),b=g.productMV(b.mat2,c);a.homog=g.normalizeMax(g.cross(d,b));a.homog=w.withUsage(a.homog,"Point")};p._helper.TrMoebiusP=function(a,b){var c=g.productMV(b.mat1,a),d=g.productMV(b.mat2,a);return g.normalizeMax(g.cross(c,d))};p.TrMoebiusL={};p.TrMoebiusL.kind="C";p.TrMoebiusL.signature=["Mt","L"];p.TrMoebiusL.updatePosition=function(a){var b=q[a.args[0]],c=q[a.args[1]].homog,d=function(){var a=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-
.5]);return g.normalizeMax(a)},f=g.cross(d(),c),h=g.cross(d(),c),c=g.cross(d(),c),f=p._helper.TrMoebiusP(f,b),h=p._helper.TrMoebiusP(h,b),b=p._helper.TrMoebiusP(c,b);a.matrix=g.normalizeMax(p._helper.ConicBy5(null,f,h,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,"Circle")};p.TrMoebiusC={};p.TrMoebiusC.kind="C";p.TrMoebiusC.signature=["Mt","C"];p.TrMoebiusC.updatePosition=function(a){var b=q[a.args[0]],c=q[a.args[1]].matrix;if("Circle"!==c.usage)console.log("applying Moebius transform to conics is not implemented yet"),
b=k.real(3),a.matrix=g.zeromatrix(b,b);else{var d=function(){var a=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return g.normalizeMax(a)},f=p._helper.IntersectLC(d(),c),d=p._helper.IntersectLC(d(),c),c=f[1],d=d[1],f=p._helper.TrMoebiusP(f[0],b),c=p._helper.TrMoebiusP(c,b),b=p._helper.TrMoebiusP(d,b);a.matrix=g.normalizeMax(p._helper.ConicBy5(null,f,c,b,g.ii,g.jj))}a.matrix=w.withUsage(a.matrix,"Circle")};p.TrMoebiusArc={};p.TrMoebiusArc.kind="C";p.TrMoebiusArc.signature=["Mt",
"C"];p.TrMoebiusArc.updatePosition=function(a){var b=q[a.args[0]],c=q[a.args[1]],d=c.viaPoint,f=c.endPoint,c=p._helper.TrMoebiusP(c.startPoint,b),d=p._helper.TrMoebiusP(d,b),b=p._helper.TrMoebiusP(f,b);a.startPoint=c;a.viaPoint=d;a.endPoint=b;a.isArc=!0;a.matrix=g.normalizeMax(p._helper.ConicBy5(null,c,d,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,"Circle")};p._helper.trBuildMatrix=function(a,b){var c=b(0),d=b(1),f=g.productMM(d,g.adjoint3(c));a.matrix=g.normalizeMax(f);f=g.transpose(g.productMM(c,
g.adjoint3(d)));a.dualMatrix=g.normalizeMax(f)};p.TrProjection={};p.TrProjection.kind="Tr";p.TrProjection.signature="PPPPPPPP".split("");p.TrProjection.updatePosition=function(a){p._helper.trBuildMatrix(a,function(b){return E.basismap(q[a.args[0+b]].homog,q[a.args[2+b]].homog,q[a.args[4+b]].homog,q[a.args[6+b]].homog)})};p.TrAffine={};p.TrAffine.kind="Tr";p.TrAffine.signature="PPPPPP".split("");p.TrAffine.updatePosition=function(a){var b=k.mult,c=g.scalmult,d=g.turnIntoCSList,f=g.transpose,h=g.normalizeMax,
l=g.productMM,m=g.adjoint3,p=d([q[a.args[0]].homog,q[a.args[2]].homog,q[a.args[4]].homog]),r=d([q[a.args[1]].homog,q[a.args[3]].homog,q[a.args[5]].homog]),t=f(p),f=f(r),u=t.value[2].value,v=f.value[2].value,w=[b(u[0],v[2]),b(u[1],v[0]),b(u[2],v[1])],t=m(t).value;a.matrix=h(l(f,d([c(b(w[0],v[1]),t[0]),c(b(w[1],v[2]),t[1]),c(b(w[2],v[0]),t[2])])));t=p.value;a.dualMatrix=h(l(m(r),d([c(b(u[2],w[1]),t[0]),c(b(u[0],w[2]),t[1]),c(b(u[1],w[0]),t[2])])))};p.TrSimilarity={};p.TrSimilarity.kind="Tr";p.TrSimilarity.signature=
["P","P","P","P"];p.TrSimilarity.updatePosition=function(a){p._helper.trBuildMatrix(a,function(b){return E.basismap(q[a.args[0+b]].homog,q[a.args[2+b]].homog,g.ii,g.jj)})};p.TrTranslation={};p.TrTranslation.kind="Tr";p.TrTranslation.signature=["P","P"];p.TrTranslation.updatePosition=function(a){var b=q[a.args[0]].homog,c=q[a.args[1]].homog,d=g.cross(b,c).value,b=k.mult(b.value[2],c.value[2]),c=g.turnIntoCSList,f=k.neg,h=k.zero,d=c([c([b,h,d[1]]),c([h,b,f(d[0])]),c([h,h,b])]),d=g.normalizeMax(d);a.matrix=
d;b=f(d.value[0].value[0]);d=c([c([b,h,h]),c([h,b,h]),c([d.value[0].value[2],d.value[1].value[2],b])]);a.dualMatrix=d};p.TrInverse={};p.TrInverse.kind="Tr";p.TrInverse.signature=["Tr"];p.TrInverse.updatePosition=function(a){var b=q[a.args[0]];a.dualMatrix=g.transpose(b.matrix);a.matrix=g.transpose(b.dualMatrix)};p.TransformC={};p.TransformC.kind="C";p.TransformC.signature=["Tr","C"];p.TransformC.updatePosition=function(a){var b=q[a.args[0]].dualMatrix,b=g.productMM(g.productMM(b,q[a.args[1]].matrix),
g.transpose(b)),b=g.normalizeMax(b);a.matrix=w.withUsage(b,"Conic")};p.TransformArc={};p.TransformArc.kind="C";p.TransformArc.signature=["Tr","C"];p.TransformArc.updatePosition=function(a){var b=q[a.args[0]].matrix,c=q[a.args[1]],d=c.viaPoint,f=c.endPoint,c=g.normalizeMax(g.productMV(b,c.startPoint)),d=g.normalizeMax(g.productMV(b,d)),b=g.normalizeMax(g.productMV(b,f));a.startPoint=c;a.viaPoint=d;a.endPoint=b;a.isArc=!0;a.matrix=g.normalizeMax(p._helper.ConicBy5(null,c,d,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,
"Circle")};p.TransformP={};p.TransformP.kind="P";p.TransformP.signature=["Tr","P"];p.TransformP.updatePosition=function(a){a.homog=g.normalizeMax(g.productMV(q[a.args[0]].matrix,q[a.args[1]].homog));a.homog=w.withUsage(a.homog,"Point")};p.TransformL={};p.TransformL.kind="L";p.TransformL.signature=["Tr","L"];p.TransformL.updatePosition=function(a){a.homog=g.normalizeMax(g.productMV(q[a.args[0]].dualMatrix,q[a.args[1]].homog));a.homog=w.withUsage(a.homog,"Line")};p.TransformS={};p.TransformS.kind="S";
p.TransformS.signature=["Tr","S"];p.TransformS.updatePosition=function(a){var b=q[a.args[0]],c=q[a.args[1]];a.homog=g.normalizeMax(g.productMV(b.dualMatrix,c.homog));a.homog=w.withUsage(a.homog,"Line");a.startpos=g.normalizeMax(g.productMV(b.matrix,c.startpos));a.endpos=g.normalizeMax(g.productMV(b.matrix,c.endpos));a.farpoint=g.normalizeMax(g.productMV(b.matrix,c.farpoint))};p._helper.pointReflection=function(a,b){return g.normalizeMax(g.sub(g.scalmult(k.realmult(2,b.value[2]),a),g.scalmult(a.value[2],
b)))};p._helper.conicOtherIntersection=function(a,b,c){var d=g.productMV(a,c);a=g.scalproduct(c,d);d=g.scalproduct(b,d);d=k.realmult(-2,d);b=g.scalmult(a,b);c=g.scalmult(d,c);c=g.add(b,c);return c=g.normalizeMax(c)};p._helper.initializePoint=function(a){var b=0,c=0,d=0;if(a.pos){if("list"===a.pos.ctype&&g.isNumberVector(a.pos))return a.pos;2===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=1);3===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=a.pos[2])}a=g.turnIntoCSList([k._helper.input(b),k._helper.input(c),k._helper.input(d)]);
return a=g.normalizeMax(a)};var Sc={CircleMFixedr:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByRadius:function(a){a.type="CircleMr";return[a]},IntersectionConicLine:function(a){a.args=[a.args[1],a.args[0]];a.type="IntersectLC";return[a]},IntersectionCircleCircle:function(a){a.type="IntersectCirCir";return[a]},IntersectionConicConic:function(a){a.type="IntersectConicConic";return[a]},FreePoint:function(a){a.type="Free";return[a]},Orthogonal:function(a){a.type="Perp";return[a]},Parallel:function(a){a.type=
"Para";return[a]},Pole:function(a){a.type="PolarOfLine";return[a]},Polar:function(a){a.type="PolarOfPoint";return[a]},Calculation:function(a){console.log("Calculation stripped from construction");return[]},Arc:function(a){a.type="ArcBy3";return[a]},Transform:function(a){var b=q[a.args[1]],b={Tr:"Transform",Mt:"TrMoebius"}[q[a.args[0]].kind]+(b.isArc?"Arc":b.kind);if(p.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]}},la={},zc,db,Ac,Bc;zc=[[],[.2],[.075,.225],[44/
45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]];db=[0,.2,.3,.8,8/9,1,1];Ac=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];Bc=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025];var oa,Z=[],xb=!1;la.tick=function(){for(var a=0;a<I.env.accuracy;a++)la.tick1(I.env.deltat/I.env.accuracy),y(ka.simulationstep)};la.tick1=function(a){for(var b=a,c=0;0<a&&c<.999*a||0>a&&c>.999*a;)b=la.oneRKStep(b),
c+=b,b=Math.min(2*b,a-c),b=Math.max(b,1E-16),la.restorePosition(),la.doCollisions(),la.calculateForces(),la.moveToFinalPos();return!0};la.restorePosition=function(){oa.forEach(function(a){a=a.behavior;I[a.type].restorePos(a,9)})};la.doCollisions=function(){oa.forEach(function(a){a=a.behavior;I[a.type].doCollisions(a)})};la.calculateForces=function(){oa.forEach(function(a){a=a.behavior;I[a.type].calculateForces(a)})};la.moveToFinalPos=function(){oa.forEach(function(a){a=a.behavior;I[a.type].move(a)})};
la.oneRKStep=function(a){for(var b=function(a){oa.forEach(function(b){b=b.behavior;I[b.type].initRK(b,a);I[b.type].storePosition(b)})},c=function(a){oa.forEach(function(b){b=b.behavior;I[b.type].setToTimestep(b,db[a])})},d=function(a){oa.forEach(function(b){b=b.behavior;I[b.type].proceedMotion(b,db[a],a,zc[a])})},f=function(){oa.forEach(function(a){a=a.behavior;I[a.type].resetForces(a)})},g=function(a){oa.forEach(function(b){b=b.behavior;I[b.type].calculateDelta(b,a)})},h=function(b){var c=0;oa.forEach(function(a){a=
a.behavior;I[a.type].proceedMotion(a,db[6],7,Ac);I[a.type].savePos(a,8);I[a.type].proceedMotion(a,db[6],7,Bc);I[a.type].savePos(a,9);c+=I[a.type].sqDist(a,8,9)});return c=Math.sqrt(c)/a},k=function(a){oa.forEach(function(a){a=a.behavior;I[a.type].recallPosition(a)})},l=!1;!l;){b(a);for(var m=0;7>m;m++)c(m),d(m),f(),la.calculateForces(),g(m);h(a)>I.env.errorbound&&a>I.env.lowestdeltat?(a/=I.env.slowdownfactor,k()):l=!0}return a};var I={Mass:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;
"undefined"===typeof a.mass&&(a.mass=1);"undefined"===typeof a.charge&&(a.charge=0);"undefined"===typeof a.friction&&(a.friction=0);a.lnfrict=0;"undefined"===typeof a.limitspeed&&(a.limitspeed=!1);"undefined"===typeof a.fixed&&(a.fixed=!1);"undefined"===typeof a.radius&&(a.radius=1);a.internalmove=!1;a.fx=0;a.fy=0;a.fz=0;a.vx=a.vx||0;a.vy=a.vy||0;a.vz=a.vz||0;a.mtype=0;a.env=I.env;a.deltat=0;a.mx=0;a.my=0;a.mz=0;a.mvx=0;a.mvy=0;a.mvz=0;a.dx=[0,0,0,0,0,0,0,0,0,0];a.dy=[0,0,0,0,0,0,0,0,0,0];a.dz=[0,
0,0,0,0,0,0,0,0,0];a.dvx=[0,0,0,0,0,0,0,0,0,0];a.dvy=[0,0,0,0,0,0,0,0,0,0];a.dvz=[0,0,0,0,0,0,0,0,0,0];a.midx=0;a.midy=0;a.midz=0;a.lx=0;a.ly=0;a.lz=0},resetForces:function(a){a.fx=0;a.fy=0;a.fz=0},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=E.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0;a.xo=a.x;a.yo=a.y;a.zo=a.z;a.vxo=a.vx;a.vyo=a.vy;a.vzo=a.vz;a.deltat=b;a.fx=0;a.fy=0;a.fz=0},setVelocity:function(a,b,c,d){d||(d=0);a.vx=b;a.vy=c;a.vz=d},move:function(a){a.pos=[a.x,a.y,
1];a.internalmove=!0;fa&&W.down&&a.el===fa.mover||Ra(a.el,g.realVector(a.pos),"homog");a.el.sx=a.x;a.el.sy=a.y;a.internalmove=!1},proceedMotion:function(a,b,c,d){if(!a.fixed)for(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz,b=0;b<c;b++)a.x+=d[b]*a.dx[b]*a.deltat,a.y+=d[b]*a.dy[b]*a.deltat,a.z+=d[b]*a.dz[b]*a.deltat,a.vx+=d[b]*a.dvx[b]*a.deltat,a.vy+=d[b]*a.dvy[b]*a.deltat,a.vz+=d[b]*a.dvz[b]*a.deltat},calculateForces:function(a){var b=Math.sqrt(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz);a.lnfrict=
-Math.log((1-a.friction)*(1-a.env.friction)*(.1<b&&a.limitSpeed?.1/b:1));a.fx+=-a.vx*a.lnfrict*a.mass;a.fy+=-a.vy*a.lnfrict*a.mass;a.fz+=-a.vz*a.lnfrict*a.mass},calculateDelta:function(a,b){a.dx[b]=a.vx;a.dy[b]=a.vy;a.dz[b]=a.vz;a.dvx[b]=a.fx/a.mass;a.dvy[b]=a.fy/a.mass;a.dvz[b]=a.fz/a.mass},savePos:function(a,b){a.dx[b]=a.x;a.dy[b]=a.y;a.dz[b]=a.z;a.dvx[b]=a.vx;a.dvy[b]=a.vy;a.dvz[b]=a.vz},restorePos:function(a,b){a.fixed||(a.x=a.dx[b],a.y=a.dy[b],a.z=a.dz[b],a.vx=a.dvx[b],a.vy=a.dvy[b],a.vz=a.dvz[b])},
sqDist:function(a,b,c){var d=(a.dx[b]-a.dx[c])*(a.dx[b]-a.dx[c]),d=d+(a.dy[b]-a.dy[c])*(a.dy[b]-a.dy[c]),d=d+(a.dz[b]-a.dz[c])*(a.dz[b]-a.dz[c]),d=d+(a.dvx[b]-a.dvx[c])*(a.dvx[b]-a.dvx[c]),d=d+(a.dvy[b]-a.dvy[c])*(a.dvy[b]-a.dvy[c]);return d+=(a.dvz[b]-a.dvz[c])*(a.dvz[b]-a.dvz[c])},kineticEnergy:function(a){return.5*a.mass*(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz)},storePosition:function(a){a.mx=a.x;a.my=a.y;a.mz=a.z;a.mvx=a.vx;a.mvy=a.vy;a.mvz=a.vz},recallPosition:function(a){a.fixed||(a.x=a.mx,a.y=a.my,
a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz)},doCollisions:function(a){}},Sun:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=10);"undefined"===typeof a.friction&&(a.friction=0);a.charge=0;a.x=0;a.y=0;a.z=0},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=E.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,
b){},calculateForces:function(a){for(var b=a.x,c=a.y,d=a.z,f=0;f<Z.length;f++){var g=Z[f],h=g.behavior.x,k=g.behavior.y,l=g.behavior.z,m=Math.sqrt((b-h)*(b-h)+(c-k)*(c-k)+(d-l)*(d-l)),k=(c-k)*a.mass*g.behavior.mass/(m*m*m),l=(d-l)*a.mass*g.behavior.mass/(m*m*m);g.behavior.fx+=(b-h)*a.mass*g.behavior.mass/(m*m*m)*g.behavior.mass;g.behavior.fy+=k*g.behavior.mass;g.behavior.fz+=l*g.behavior.mass}},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},
storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Gravity:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.strength&&(a.strength=1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=q[a.namea];a.mb=q[a.nameb]},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){var b=
E.extractPoint(a.ma.homog),c=E.extractPoint(a.mb.homog),d=(c.x-b.x)*a.strength;a=(c.y-b.y)*a.strength;for(b=0;b<Z.length;b++)c=Z[b],c.behavior.fx+=d*c.behavior.mass,c.behavior.fy+=a*c.behavior.mass,c.behavior.fz+=0*c.behavior.mass},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Spring:{init:function(a,b){a.el=b;"undefined"===typeof a.strength&&(a.strength=
1);"undefined"===typeof a.amplitude&&(a.amplitude=0);"undefined"===typeof a.phase&&(a.phase=0);"undefined"===typeof a.speed&&(a.speed=1);"undefined"===typeof a.l0&&(a.l0=0);"undefined"===typeof a.stype&&(a.stype=1);"undefined"===typeof a.readOnInit&&(a.readOnInit=!1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=q[a.namea];a.mb=q[a.nameb];var c=E.extractPoint(a.ma.homog),d=E.extractPoint(a.mb.homog);a.l0=Math.sqrt((c.x-d.x)*(c.x-d.x)+(c.y-d.y)*(c.y-d.y));a.env=I.env},resetForces:function(a){},getBlock:!1,
setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,f;!a.ma.behavior||fa&&W.down&&a.ma===fa.mover?(c=E.extractPoint(a.ma.homog),b=c.x,d=c.y):(b=a.ma.behavior.x,d=a.ma.behavior.y);!a.mb.behavior||fa&&W.down&&a.mb===fa.mover?(f=E.extractPoint(a.mb.homog),c=f.x,f=f.y):(c=a.mb.behavior.x,f=a.mb.behavior.y);var g=Math.sqrt((b-c)*(b-c)+(d-f)*(d-f)),h=a.l0,k=a.stype;1===k&&(h=0);
var l=0;if(2===k||3===k)l=a.ma.behavior.mass*a.mb.behavior.mass*a.strength;2===k&&(l=-l);var m,p;if(0===g||0!==k&&1!==k)if(a.ma.behavior&&a.mb.behavior&&0!==g){if(g*=g*g,2===k||3===k)m=(b-c)*l/g,p=(d-f)*l/g}else m=p=0;else m=-(b-c)*a.strength*(g-h)/g*a.env.springstrength,p=-(d-f)*a.strength*(g-h)/g*a.env.springstrength;a.ma.behavior&&(a.ma.behavior.fx+=m,a.ma.behavior.fy+=p);a.mb.behavior&&(a.mb.behavior.fx-=m,a.mb.behavior.fy-=p)},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,
b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},det:function(a,b,c,d,f,g){return c*g-f*d+f*b-a*g+a*d-c*b},Bouncer:{init:function(a,b){a.el=b;"undefined"===typeof a.xdamp&&(a.xdamp=0);"undefined"===typeof a.ydamp&&(a.ydamp=0);"undefined"===typeof a.motorchanger&&(a.motorchanger=!0);a.namea=b.args[0];a.nameb=b.args[1];a.ma=q[a.namea];a.mb=q[a.nameb];var c=E.extractPoint(a.ma.homog),d=E.extractPoint(a.mb.homog);
a.x1o=1.01*c.x-.01*d.x;a.y1o=1.01*c.y-.01*d.y;a.x2o=1.01*d.x-.01*c.x;a.y2o=1.01*d.y-.01*c.y;a.env=I.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){a.deltat=b},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},
doCollisions:function(a){for(var b=E.extractPoint(a.ma.homog),c=E.extractPoint(a.mb.homog),d=b.x,b=b.y,f=c.x,c=c.y,g=a.x1o,h=a.y1o,l=a.x2o,m=a.y2o,p=Math.sqrt((d-f)*(d-f)+(b-c)*(b-c)),q=(d-f)/p,p=(b-c)/p,r=0;r<Z.length;r++){var t=Z[r],u=t.behavior.xo,v=t.behavior.yo,w=t.behavior.x,x=t.behavior.y,y=k.mult(k.complex(g,h),k.complex(f,c)),z=k.mult(k.complex(l,m),k.complex(d,b)),y=k.sub(y,z),z=k.mult(k.complex(u,v),k.complex(d,b)),y=k.add(y,z),z=k.mult(k.complex(u,v),k.complex(f,c)),y=k.sub(y,z),z=k.sub(k.complex(g,
h),k.complex(l,m)),y=k.div(y,z);0>I.det(d,b,f,c,w,x)*I.det(d,b,f,c,y.value.real,y.value.imag)&&0>I.det(d,b,w,x,y.value.real,y.value.imag)*I.det(f,c,w,x,y.value.real,y.value.imag)&&(v=t.behavior.mvx+a.deltat*(-y.value.real+t.behavior.xo),w=t.behavior.mvy+a.deltat*(-y.value.imag+t.behavior.yo),u=q*v+p*w,v=p*v-q*w,t.behavior.x=y.value.real,t.behavior.y=y.value.imag,t.behavior.vx=q*u*(1-a.xdamp),t.behavior.vy=p*u*(1-a.xdamp),t.behavior.vx+=-p*v*(1-a.ydamp),t.behavior.vy+=q*v*(1-a.ydamp))}a.x1o=d;a.y1o=
b;a.x2o=f;a.y2o=c}},Environment:{init:function(a){"undefined"===typeof a.gravity&&(a.gravity=0);"undefined"===typeof a.friction&&(a.friction=0);"undefined"===typeof a.springstrength&&(a.springstrength=1);"undefined"===typeof a.accuracy&&(a.accuracy=10);"undefined"===typeof a.deltat&&(a.deltat=.3);"undefined"===typeof a.charges&&(a.charges=!1);"undefined"===typeof a.balls&&(a.balls=!1);"undefined"===typeof a.newton&&(a.newton=!1);"undefined"===typeof a.ballInteractionBoosting&&(a.ballInteractionBoosting=
1);I.env=a;a.errorbound=.001;a.lowestdeltat=1E-7;a.slowdownfactor=2},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,f,g,h,k,l,m,p;if(a.newton)for(b=0;b<Z.length-1;b++)for(c=Z[b],d=c.behavior.x,f=c.behavior.y,g=b+1;g<Z.length;g++)h=Z[g],k=h.behavior.x,l=h.behavior.y,p=Math.sqrt((d-k)*(d-k)+(f-l)*(f-l)),k=(d-k)*c.behavior.mass*h.behavior.mass/
(p*p*p),l=(f-l)*c.behavior.mass*h.behavior.mass/(p*p*p),c.behavior.fx-=k,c.behavior.fy-=l,h.behavior.fx+=k,h.behavior.fy+=l;if(a.charges)for(b=0;b<Z.length-1;b++)for(c=Z[b],d=c.behavior.x,f=c.behavior.y,g=b+1;g<Z.length;g++)h=Z[g],k=h.behavior.x,l=h.behavior.y,p=Math.sqrt((d-k)*(d-k)+(f-l)*(f-l)),k=(d-k)*c.behavior.charge*h.behavior.charge/(p*p*p),l=(f-l)*c.behavior.charge*h.behavior.charge/(p*p*p),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l;if(a.balls)for(b=0;b<Z.length-1;b++)if(c=
Z[b],0!==c.behavior.radius)for(d=c.behavior.x,f=c.behavior.y,g=b+1;g<Z.length;g++)h=Z[g],0!==h.behavior.radius&&(k=h.behavior.x,l=h.behavior.y,m=c.behavior.radius+h.behavior.radius,p=Math.sqrt((d-k)*(d-k)+(f-l)*(f-l)),0===a.ballInteractionBoosting?(k=(d-k)/(p*p*p)*(p>m?0:(p-m)*(p-m)),l=(f-l)/(p*p*p)*(p>m?0:(p-m)*(p-m))):1===a.ballInteractionBoosting?(k=(d-k)/(p*p*p*p)*(p>m?0:(p-m)*(p-m)),l=(f-l)/(p*p*p*p)*(p>m?0:(p-m)*(p-m))):(k=(d-k)/(p*p*p*p*p)*(p>m?0:(p-m)*(p-m)),l=(f-l)/(p*p*p*p*p)*(p>m?0:(p-
m)*(p-m))),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l);for(b=0;b<Z.length;b++)c=Z[b],c.behavior.fx+=0,c.behavior.fy+=a.gravity,c.behavior.fz+=0},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}}};return sa};return F}();
"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports=createCindy);
//# sourceMappingURL=Cindy.js.map

